<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DataAgent Widget æµ‹è¯•é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        h1 {
            color: #1a1a2e;
            font-size: 28px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .subtitle {
            color: #666;
            font-size: 15px;
            margin-bottom: 32px;
        }

        .card {
            background: #f8f9fc;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .card h2 {
            color: #409EFF;
            font-size: 18px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card p {
            color: #555;
            line-height: 1.7;
            margin: 8px 0;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .status-badge.success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-badge.info {
            background: #e3f2fd;
            color: #1565c0;
        }

        .feature-list {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
        }

        .feature-list li {
            padding: 12px 16px;
            background: white;
            border-radius: 8px;
            color: #444;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .feature-list li::before {
            content: "âœ“";
            color: #52c41a;
            font-weight: bold;
            font-size: 16px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .config-item {
            background: white;
            padding: 14px 18px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .config-item label {
            display: block;
            color: #888;
            font-size: 12px;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .config-item code {
            display: block;
            background: #f5f5f5;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            color: #333;
            word-break: break-all;
        }

        .note {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border-left: 4px solid #ffc107;
            padding: 16px 20px;
            border-radius: 0 8px 8px 0;
            margin-top: 24px;
        }

        .note strong {
            color: #f57c00;
        }

        .architecture {
            background: #f0f4f8;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.6;
            overflow-x: auto;
            white-space: pre;
            color: #37474f;
        }

        @media (max-width: 600px) {
            .config-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ¤– DataAgent Widget æµ‹è¯•é¡µé¢</h1>
        <p class="subtitle">åŸºäº PostMessage é€šä¿¡çš„ iframe åµŒå…¥æ–¹æ¡ˆ</p>

        <div class="card">
            <h2>ğŸ¯ æ¶æ„è¯´æ˜</h2>
            <div class="architecture">
                ç¬¬ä¸‰æ–¹ç½‘ç«™ (Host)
                â”œâ”€â”€ widget.js (åµŒå…¥è„šæœ¬)
                â”‚ â”œâ”€â”€ åˆ›å»ºæµ®åŠ¨æŒ‰é’®
                â”‚ â”œâ”€â”€ åˆ›å»º iframe
                â”‚ â””â”€â”€ postMessage é€šä¿¡
                â”‚
                â””â”€â”€ iframe
                â””â”€â”€ /widget/{id} (ä½ çš„æœåŠ¡å™¨)
                â”œâ”€â”€ WidgetPage.vue
                â””â”€â”€ èŠå¤©ç•Œé¢</div>
        </div>

        <div class="card">
            <h2>ğŸ“Š å½“å‰çŠ¶æ€</h2>
            <p><span class="status-badge success">âœ“ PostMessage é€šä¿¡å·²å¯ç”¨</span></p>
            <p><span class="status-badge info">â„¹ iframe åµŒå…¥æ¨¡å¼</span></p>
        </div>

        <div class="card">
            <h2>âš™ï¸ é…ç½®ä¿¡æ¯</h2>
            <div class="config-grid">
                <div class="config-item">
                    <label>Agent ID</label>
                    <code id="agent-id">2</code>
                </div>
                <div class="config-item">
                    <label>API Key</label>
                    <code id="api-key">sk-xxx</code>
                </div>
                <div class="config-item">
                    <label>Base URL</label>
                    <code id="base-url">http://localhost:8065</code>
                </div>
                <div class="config-item">
                    <label>ä¸»é¢˜è‰²</label>
                    <code>#409EFF</code>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ›  æµ‹è¯•åŠŸèƒ½</h2>
            <ul class="feature-list">
                <li>ç‚¹å‡»å³ä¸‹è§’æµ®åŠ¨æŒ‰é’®æ‰“å¼€èŠå¤©</li>
                <li>æ‹–æ‹½æµ®åŠ¨æŒ‰é’®æ”¹å˜ä½ç½®</li>
                <li>å‘é€æ¶ˆæ¯æµ‹è¯•æµå¼å“åº”</li>
                <li>ESC é”®å…³é—­çª—å£</li>
                <li>æŸ¥çœ‹é¢„è®¾é—®é¢˜åˆ—è¡¨</li>
                <li>æœ€å¤§åŒ–/è¿˜åŸçª—å£</li>
            </ul>
        </div>

        <div class="note">
            <strong>ğŸ’¡ æç¤ºï¼š</strong> å¦‚æœçœ‹ä¸åˆ°æµ®åŠ¨æŒ‰é’®ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ã€‚
            ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨ä¸” API Key é…ç½®æ­£ç¡®ã€‚
        </div>
    </div>

    <!-- DataAgent Widget é…ç½® -->
    <script>
        // Detect backend URL based on current port
        var baseUrl = window.location.origin;
        // If running on Vite dev server (port 3000), use backend port 8065
        if (window.location.port === '3000') {
            baseUrl = window.location.protocol + '//' + window.location.hostname + ':8065';
        }

        // Widget configuration
        window.DataAgentConfig = {
            agentId: 2,
            apiKey: 'sk-hMrPaVPQgMervZIevXv1l9gsTQS5fUTp',
            baseUrl: baseUrl,
            title: 'AI é—®æ•°åŠ©æ‰‹',
            position: 'bottom-right',
            primaryColor: '#409EFF',
            welcomeMessage: 'æ‚¨å¥½ï¼æˆ‘æ˜¯ AI é—®æ•°åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ',
            draggable: true
        };

        // Update UI with config values
        document.getElementById('agent-id').textContent = window.DataAgentConfig.agentId;
        document.getElementById('api-key').textContent = window.DataAgentConfig.apiKey;
        document.getElementById('base-url').textContent = window.DataAgentConfig.baseUrl;
    </script>

    <!-- Load widget.js from public folder (same origin during dev) -->
    <script src="/widget.js" defer></script>
</body>

</html>