import{d as re,b as ne,a as Ue,e as Ke,E as i,h as Z,u as Pe,_ as oe,m as R,l as a,q as l,j as r,w as o,k as v,x as f,n as J,D as Ae,t as M,F as Y,y as ye,z as De,G as le,H as ue,I as et,J as E,K as Ne,s as Ce,o as ve,f as V,L as Le,p as _e,i as P,M as Ie,N as Ve,O as Me,P as tt,Q as lt,R as ot,c as at,S as nt,T as st,U as qe,V as rt,W as it,B as dt,A as ut,X as pt,Y as mt,Z as ct,$ as gt,a0 as ft,a1 as yt,a2 as vt,a3 as bt,a4 as wt,a5 as ht,a6 as Ct,a7 as kt}from"./index-DCpnB5N_.js";import{A as se,g as Vt,a as _t}from"./avatar-D0nR9CLY.js";import{B as $t}from"./BaseLayout-DoPvOnpR.js";import{P as Fe,c as ze}from"./clipboard-2mtjmfup.js";import Dt from"./NotFound-Ca688QUJ.js";import{f as Tt}from"./fileUpload-BQXCDLCH.js";const St=re({name:"AgentBaseSetting",props:{agent:{type:Object,required:!0}},setup(t){const e=Pe(),n=async()=>{try{const m=await se.update(t.agent.id,t.agent);m===null?(console.error("更新智能体失败:",m),i.error("更新失败：未知错误")):i.success("更新成功！")}catch(m){console.error("更新智能体失败:",m),i.error("更新失败："+(m.message||"未知错误"))}},s=async()=>{try{await Z.confirm(`确定要删除智能体"${t.agent.name}"吗？删除后将无法恢复。`,"删除智能体",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!1}),await se.delete(t.agent.id)?(i.success("智能体已删除"),await e.push("/agents")):i.error("删除失败：智能体不存在")}catch{}},g=m=>m?new Date(m).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",y=ne(()=>g(t.agent.createTime)),p=ne(()=>g(t.agent.updateTime));return{Edit:Ke,Delete:Ue,props:t,updateAgent:n,handleDeleteAgent:s,formattedCreateTime:y,formattedUpdateTime:p}}}),At={class:"agent-base-setting"},Ft={class:"form-item"},Nt={class:"form-item"},It={class:"form-item"},Et={class:"form-item"},zt={class:"form-item"},Ut={class:"form-item"},Kt={class:"form-item"},Pt={class:"form-item"},Lt={class:"form-item form-switch"},Mt={class:"button-group"};function qt(t,e,n,s,g,y){const p=r("el-divider"),m=r("el-input"),h=r("el-col"),_=r("el-row"),A=r("el-option"),c=r("el-select"),q=r("el-switch"),C=r("el-text"),D=r("el-button");return v(),R("div",At,[e[19]||(e[19]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"基本信息")],-1)),l(p),l(_,{gutter:20},{default:o(()=>[l(h,{span:12},{default:o(()=>[a("div",Ft,[e[7]||(e[7]=a("label",null,"智能体名称",-1)),l(m,{modelValue:t.props.agent.name,"onUpdate:modelValue":e[0]||(e[0]=F=>t.props.agent.name=F),placeholder:"请输入智能体名称",size:"large"},null,8,["modelValue"])])]),_:1}),l(h,{span:12},{default:o(()=>[a("div",Nt,[e[8]||(e[8]=a("label",null,"分类",-1)),l(m,{modelValue:t.props.agent.category,"onUpdate:modelValue":e[1]||(e[1]=F=>t.props.agent.category=F),placeholder:"请输入智能体分类",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(h,{span:24},{default:o(()=>[a("div",It,[e[9]||(e[9]=a("label",null,"描述",-1)),l(m,{modelValue:t.props.agent.description,"onUpdate:modelValue":e[2]||(e[2]=F=>t.props.agent.description=F),rows:4,type:"textarea",placeholder:"请输入智能体描述",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(h,{span:24},{default:o(()=>[a("div",Et,[e[10]||(e[10]=a("label",null,"智能体Prompt",-1)),l(m,{modelValue:t.props.agent.prompt,"onUpdate:modelValue":e[3]||(e[3]=F=>t.props.agent.prompt=F),rows:4,type:"textarea",placeholder:"请输入智能体Prompt",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(h,{span:12},{default:o(()=>[a("div",zt,[e[11]||(e[11]=a("label",null,"标签",-1)),l(m,{modelValue:t.props.agent.tags,"onUpdate:modelValue":e[4]||(e[4]=F=>t.props.agent.tags=F),placeholder:"多个标签用逗号分隔",size:"large"},null,8,["modelValue"])])]),_:1}),l(h,{span:12},{default:o(()=>[a("div",Ut,[e[12]||(e[12]=a("label",null,"状态",-1)),l(c,{modelValue:t.props.agent.status,"onUpdate:modelValue":e[5]||(e[5]=F=>t.props.agent.status=F),placeholder:"请选择状态",style:{width:"100%"},size:"large"},{default:o(()=>[l(A,{key:"draft",label:"待发布",value:"draft"}),l(A,{key:"published",label:"已发布",value:"published"}),l(A,{key:"offline",label:"已下线",value:"offline"})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(h,{span:12},{default:o(()=>[a("div",Kt,[e[13]||(e[13]=a("label",null,"创建时间",-1)),l(m,{disabled:"","model-value":t.formattedCreateTime,size:"large"},null,8,["model-value"])])]),_:1}),l(h,{span:12},{default:o(()=>[a("div",Pt,[e[14]||(e[14]=a("label",null,"更新时间",-1)),l(m,{disabled:"","model-value":t.formattedUpdateTime,size:"large"},null,8,["model-value"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(h,{span:24},{default:o(()=>[a("div",Lt,[l(q,{modelValue:t.props.agent.humanReviewEnabled,"onUpdate:modelValue":e[6]||(e[6]=F=>t.props.agent.humanReviewEnabled=F),size:"large"},null,8,["modelValue"]),e[16]||(e[16]=a("span",null,"启用计划人工复核",-1)),l(C,{class:"mx-1"},{default:o(()=>[...e[15]||(e[15]=[f("（开启后，Planner 计划会在执行前等待人工复核）",-1)])]),_:1})])]),_:1})]),_:1}),a("div",Mt,[l(D,{type:"primary",icon:t.Edit,round:"",onClick:t.updateAgent,size:"large"},{default:o(()=>[...e[17]||(e[17]=[f(" 保存 ",-1)])]),_:1},8,["icon","onClick"]),l(D,{type:"danger",icon:t.Delete,round:"",onClick:t.handleDeleteAgent,size:"large"},{default:o(()=>[...e[18]||(e[18]=[f(" 删除智能体 ",-1)])]),_:1},8,["icon","onClick"])])])}const Bt=oe(St,[["render",qt],["__scopeId","data-v-c5a3b1ac"]]),Ot={name:"AgentPromptConfig",props:{agentId:{type:[String,Number],required:!0},promptType:{type:String,default:"report-generator"},agentPrompt:{type:String,default:""}},data(){return{optimizationConfigs:[],showAddConfigDialog:!1,editingConfig:null,showBatchActions:!1,showPriorityDialog:!1,selectedConfigs:[],editingPriorityConfig:null,formData:{name:"",description:"",optimizationPrompt:"",priority:0,displayOrder:0},priorityForm:{priority:0,displayOrder:0},loading:!1,message:{show:!1,text:"",type:"success"}}},computed:{isAllSelected(){return this.optimizationConfigs.length>0&&this.selectedConfigs.length===this.optimizationConfigs.length},isIndeterminate(){return this.selectedConfigs.length>0&&this.selectedConfigs.length<this.optimizationConfigs.length}},mounted(){this.loadOptimizationConfigs()},methods:{async loadOptimizationConfigs(){try{this.loading=!0;const t=this.agentId?`?agentId=${this.agentId}`:"",n=await(await fetch(`/api/prompt-config/list-by-type/${this.promptType}${t}`)).json();n.success&&(this.optimizationConfigs=n.data||[],this.optimizationConfigs.length===0&&(this.showBatchActions=!1,this.selectedConfigs=[]))}catch(t){console.error("加载优化配置失败:",t),this.showMessage("加载优化配置失败","error")}finally{this.loading=!1}},async saveConfig(){try{const t={...this.formData,promptType:this.promptType,agentId:this.agentId?Number(this.agentId):null,enabled:!0,creator:"user",priority:this.formData.priority||0,displayOrder:this.formData.displayOrder||0};this.editingConfig&&(t.id=this.editingConfig.id);const n=await(await fetch("/api/prompt-config/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();n.success?(this.showMessage(n.message||"保存成功","success"),this.closeDialog(),this.loadOptimizationConfigs()):this.showMessage(n.message||"保存失败","error")}catch(t){console.error("保存配置失败:",t),this.showMessage("保存配置失败","error")}},async toggleConfig(t){try{const e=t.enabled?`/api/prompt-config/${t.id}/disable`:`/api/prompt-config/${t.id}/enable`,s=await(await fetch(e,{method:"POST"})).json();s.success?(this.showMessage(s.message,"success"),this.loadOptimizationConfigs()):this.showMessage(s.message,"error")}catch(e){console.error("切换配置状态失败:",e),this.showMessage("操作失败","error")}},async deleteConfig(t){if(confirm("确定要删除这个优化配置吗？"))try{const n=await(await fetch(`/api/prompt-config/${t}`,{method:"DELETE"})).json();n.success?(this.showMessage(n.message,"success"),this.loadOptimizationConfigs(),this.selectedConfigs=this.selectedConfigs.filter(s=>s!==t)):this.showMessage(n.message,"error")}catch(e){console.error("删除配置失败:",e),this.showMessage("删除配置失败","error")}},editConfig(t){this.editingConfig=t,this.formData={name:t.name,description:t.description,optimizationPrompt:t.optimizationPrompt,priority:t.priority||0,displayOrder:t.displayOrder||0}},closeDialog(){this.showAddConfigDialog=!1,this.editingConfig=null,this.formData={name:"",description:"",optimizationPrompt:"",priority:0,displayOrder:0}},async batchEnable(){if(this.selectedConfigs.length!==0)try{const e=await(await fetch("/api/prompt-config/batch-enable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.selectedConfigs)})).json();e.success?(this.showMessage(e.message,"success"),this.loadOptimizationConfigs(),this.clearSelection()):this.showMessage(e.message,"error")}catch(t){console.error("批量启用失败:",t),this.showMessage("批量启用失败","error")}},async batchDisable(){if(this.selectedConfigs.length!==0)try{const e=await(await fetch("/api/prompt-config/batch-disable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.selectedConfigs)})).json();e.success?(this.showMessage(e.message,"success"),this.loadOptimizationConfigs(),this.clearSelection()):this.showMessage(e.message,"error")}catch(t){console.error("批量禁用失败:",t),this.showMessage("批量禁用失败","error")}},clearSelection(){this.selectedConfigs=[],this.showBatchActions=!1},toggleSelectAll(){this.isAllSelected?this.selectedConfigs=[]:this.selectedConfigs=this.optimizationConfigs.map(t=>t.id)},handleShowPriorityDialog(t){this.editingPriorityConfig=t,this.priorityForm={priority:t.priority||0,displayOrder:t.displayOrder||0},this.showPriorityDialog=!0},async updatePriority(){try{const e=await(await fetch(`/api/prompt-config/${this.editingPriorityConfig.id}/priority`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priority:this.priorityForm.priority})})).json();e.success?(this.showMessage("优先级更新成功","success"),this.loadOptimizationConfigs(),this.closePriorityDialog()):this.showMessage(e.message,"error")}catch(t){console.error("更新优先级失败:",t),this.showMessage("更新优先级失败","error")}},closePriorityDialog(){this.showPriorityDialog=!1,this.editingPriorityConfig=null,this.priorityForm={priority:0,displayOrder:0}},showMessage(t,e="success"){this.message={show:!0,text:t,type:e},setTimeout(()=>{this.message.show=!1},3e3)},hideMessage(){this.message.show=!1}}},Rt={class:"prompt-optimization-config"},jt={class:"agent-prompt-section"},Jt={class:"prompt-display"},Qt={class:"optimization-configs"},Ht={class:"config-list-header"},Gt={class:"header-actions"},Wt={key:0,class:"batch-actions-panel"},Xt={class:"batch-actions-content"},Yt={class:"batch-selection"},Zt=["checked","indeterminate"],xt={class:"batch-info"},el={class:"batch-buttons"},tl=["disabled"],ll=["disabled"],ol={key:1,class:"empty-state"},al={key:2,class:"config-list"},nl={class:"config-header"},sl={class:"config-info"},rl=["value"],il={class:"config-name"},dl={key:0,class:"config-priority"},ul={class:"config-actions"},pl=["onClick"],ml=["onClick"],cl=["onClick"],gl=["onClick"],fl={class:"config-content"},yl={class:"config-description"},vl={class:"optimization-prompt"},bl={class:"dialog-header"},wl={class:"form-group"},hl={class:"form-group"},Cl={class:"form-group"},kl={class:"form-row"},Vl={class:"form-group"},_l={class:"form-group"},$l={class:"form-actions"},Dl={class:"dialog-header"},Tl={class:"form-group"},Sl={class:"form-group"},Al={class:"form-actions"};function Fl(t,e,n,s,g,y){return v(),R("div",Rt,[g.message.show?(v(),R("div",{key:0,class:Ae(["message-toast",g.message.type])},[a("span",null,M(g.message.text),1),a("button",{class:"message-close",onClick:e[0]||(e[0]=(...p)=>y.hideMessage&&y.hideMessage(...p))},"×")],2)):J("",!0),e[42]||(e[42]=a("div",{class:"config-header"},[a("h3",null,"增强式Prompt优化配置"),a("p",{class:"config-description"}," 配置的Prompt仅用作效果优化，支持多个提示词配置，在原始模板基础上进行增强。示例配置： "),a("ul",{class:"optimization-tips"},[a("li",null,"1. 查询的年销售额精确到小数点后两位。"),a("li",null,"2. 报告格式第一章节请先总结年销售额")])],-1)),a("div",jt,[e[25]||(e[25]=a("h4",null,"智能体Prompt",-1)),a("div",Jt,M(n.agentPrompt||"你是一个销售数据分析专家，能够帮助用户分析销售趋势，客户行为和业务指标。"),1)]),a("div",Qt,[a("div",Ht,[e[28]||(e[28]=a("h4",null,"优化配置列表",-1)),a("div",Gt,[g.optimizationConfigs.length>0?(v(),R("button",{key:0,class:"batch-action-btn",onClick:e[1]||(e[1]=p=>g.showBatchActions=!g.showBatchActions)},[...e[26]||(e[26]=[a("i",{class:"icon-settings"},null,-1),f(" 批量操作 ",-1)])])):J("",!0),a("button",{class:"add-config-btn",onClick:e[2]||(e[2]=p=>g.showAddConfigDialog=!0)},[...e[27]||(e[27]=[a("i",{class:"icon-plus"},null,-1),f(" 添加优化配置 ",-1)])])])]),g.showBatchActions?(v(),R("div",Wt,[a("div",Xt,[a("div",Yt,[a("input",{type:"checkbox",checked:y.isAllSelected,indeterminate:y.isIndeterminate,onChange:e[3]||(e[3]=(...p)=>y.toggleSelectAll&&y.toggleSelectAll(...p)),class:"select-all-checkbox"},null,40,Zt),a("span",xt,M(y.isAllSelected?"已全选":`已选择 ${g.selectedConfigs.length} 个配置`),1)]),a("div",el,[a("button",{class:"batch-btn enable",onClick:e[4]||(e[4]=(...p)=>y.batchEnable&&y.batchEnable(...p)),disabled:g.selectedConfigs.length===0}," 批量启用 ",8,tl),a("button",{class:"batch-btn disable",onClick:e[5]||(e[5]=(...p)=>y.batchDisable&&y.batchDisable(...p)),disabled:g.selectedConfigs.length===0}," 批量禁用 ",8,ll),a("button",{class:"batch-btn cancel",onClick:e[6]||(e[6]=(...p)=>y.clearSelection&&y.clearSelection(...p))},"取消选择")])])])):J("",!0),g.optimizationConfigs.length===0?(v(),R("div",ol,[...e[29]||(e[29]=[a("p",null,'暂无优化配置，点击"添加优化配置"开始配置',-1)])])):(v(),R("div",al,[(v(!0),R(Y,null,ye(g.optimizationConfigs,p=>(v(),R("div",{key:p.id,class:Ae(["config-item",{disabled:!p.enabled,selected:g.selectedConfigs.includes(p.id)}])},[a("div",nl,[a("div",sl,[le(a("input",{type:"checkbox",value:p.id,"onUpdate:modelValue":e[7]||(e[7]=m=>g.selectedConfigs=m),class:"config-checkbox"},null,8,rl),[[et,g.selectedConfigs]]),a("span",il,M(p.name),1),p.priority!==void 0?(v(),R("span",dl," 优先级: "+M(p.priority),1)):J("",!0)]),a("div",ul,[a("button",{class:Ae(["toggle-btn",{active:p.enabled}]),onClick:m=>y.toggleConfig(p)},M(p.enabled?"已启用":"已禁用"),11,pl),a("button",{class:"edit-btn",onClick:m=>y.editConfig(p)},"编辑",8,ml),a("button",{class:"priority-btn",onClick:m=>y.handleShowPriorityDialog(p)},"优先级",8,cl),a("button",{class:"delete-btn",onClick:m=>y.deleteConfig(p.id)},"删除",8,gl)])]),a("div",fl,[a("p",yl,M(p.description),1),a("div",vl,M(p.optimizationPrompt),1)])],2))),128))]))]),g.showAddConfigDialog||g.editingConfig?(v(),R("div",{key:1,class:"dialog-overlay",onClick:e[17]||(e[17]=(...p)=>y.closeDialog&&y.closeDialog(...p))},[a("div",{class:"dialog-content",onClick:e[16]||(e[16]=De(()=>{},["stop"]))},[a("div",bl,[a("h3",null,M(g.editingConfig?"编辑优化配置":"添加优化配置"),1),a("button",{class:"close-btn",onClick:e[8]||(e[8]=(...p)=>y.closeDialog&&y.closeDialog(...p))},"×")]),a("form",{onSubmit:e[15]||(e[15]=De((...p)=>y.saveConfig&&y.saveConfig(...p),["prevent"])),class:"config-form"},[a("div",wl,[e[30]||(e[30]=a("label",{for:"configName"},"配置名称",-1)),le(a("input",{id:"configName","onUpdate:modelValue":e[9]||(e[9]=p=>g.formData.name=p),type:"text",placeholder:"请输入配置名称",required:""},null,512),[[ue,g.formData.name]])]),a("div",hl,[e[31]||(e[31]=a("label",{for:"description"},"配置描述",-1)),le(a("input",{id:"description","onUpdate:modelValue":e[10]||(e[10]=p=>g.formData.description=p),type:"text",placeholder:"请输入配置描述"},null,512),[[ue,g.formData.description]])]),a("div",Cl,[e[32]||(e[32]=a("label",{for:"optimizationPrompt"},"优化提示词内容",-1)),le(a("textarea",{id:"optimizationPrompt","onUpdate:modelValue":e[11]||(e[11]=p=>g.formData.optimizationPrompt=p),rows:"6",placeholder:"请输入优化提示词内容，支持模板变量如 {user_requirements_and_plan}",required:""},null,512),[[ue,g.formData.optimizationPrompt]])]),a("div",kl,[a("div",Vl,[e[33]||(e[33]=a("label",{for:"priority"},"优先级",-1)),le(a("input",{id:"priority","onUpdate:modelValue":e[12]||(e[12]=p=>g.formData.priority=p),type:"number",min:"0",max:"100",placeholder:"0-100，数字越大优先级越高"},null,512),[[ue,g.formData.priority,void 0,{number:!0}]])]),a("div",_l,[e[34]||(e[34]=a("label",{for:"displayOrder"},"显示顺序",-1)),le(a("input",{id:"displayOrder","onUpdate:modelValue":e[13]||(e[13]=p=>g.formData.displayOrder=p),type:"number",min:"0",placeholder:"显示顺序，数字越小越靠前"},null,512),[[ue,g.formData.displayOrder,void 0,{number:!0}]])])]),a("div",$l,[a("button",{type:"button",class:"cancel-btn",onClick:e[14]||(e[14]=(...p)=>y.closeDialog&&y.closeDialog(...p))},"取消"),e[35]||(e[35]=a("button",{type:"submit",class:"save-btn"},"保存配置",-1))])],32)])])):J("",!0),g.showPriorityDialog?(v(),R("div",{key:2,class:"dialog-overlay",onClick:e[24]||(e[24]=(...p)=>y.closePriorityDialog&&y.closePriorityDialog(...p))},[a("div",{class:"dialog-content",onClick:e[23]||(e[23]=De(()=>{},["stop"]))},[a("div",Dl,[e[36]||(e[36]=a("h3",null,"设置优先级",-1)),a("button",{class:"close-btn",onClick:e[18]||(e[18]=(...p)=>y.closePriorityDialog&&y.closePriorityDialog(...p))},"×")]),a("form",{onSubmit:e[22]||(e[22]=De((...p)=>y.updatePriority&&y.updatePriority(...p),["prevent"])),class:"priority-form"},[a("div",Tl,[e[37]||(e[37]=a("label",{for:"priorityValue"},"优先级 (0-100)",-1)),le(a("input",{id:"priorityValue","onUpdate:modelValue":e[19]||(e[19]=p=>g.priorityForm.priority=p),type:"number",min:"0",max:"100",placeholder:"数字越大优先级越高",required:""},null,512),[[ue,g.priorityForm.priority,void 0,{number:!0}]]),e[38]||(e[38]=a("p",{class:"form-hint"},"优先级越高，该配置在多个配置中的执行顺序越靠前",-1))]),a("div",Sl,[e[39]||(e[39]=a("label",{for:"displayOrderValue"},"显示顺序",-1)),le(a("input",{id:"displayOrderValue","onUpdate:modelValue":e[20]||(e[20]=p=>g.priorityForm.displayOrder=p),type:"number",min:"0",placeholder:"数字越小越靠前"},null,512),[[ue,g.priorityForm.displayOrder,void 0,{number:!0}]]),e[40]||(e[40]=a("p",{class:"form-hint"},"控制配置在列表中的显示顺序",-1))]),a("div",Al,[a("button",{type:"button",class:"cancel-btn",onClick:e[21]||(e[21]=(...p)=>y.closePriorityDialog&&y.closePriorityDialog(...p))},"取消"),e[41]||(e[41]=a("button",{type:"submit",class:"save-btn"},"保存",-1))])],32)])])):J("",!0)])}const Nl=oe(Ot,[["render",Fl],["__scopeId","data-v-dca7029e"]]),de="/api/business-knowledge";class Il{async list(e,n){try{const s={agentId:e.toString()};return n&&(s.keyword=n),(await E.get(de,{params:s})).data.data||[]}catch(s){throw console.error("Failed to fetch business knowledge list:",s),s}}async get(e){var n;try{return(await E.get(`${de}/${e}`)).data.data||null}catch(s){if(E.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return null;throw s}}async create(e){return(await E.post(de,e)).data.data}async update(e,n){var s;try{return(await E.put(`${de}/${e}`,n)).data.data||null}catch(g){if(E.isAxiosError(g)&&((s=g.response)==null?void 0:s.status)===404)return null;throw g}}async delete(e){var n;try{return(await E.delete(`${de}/${e}`)).data.success}catch(s){if(E.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return!1;throw s}}async recallKnowledge(e,n){return(await E.post(`${de}/recall/${e}`,null,{params:{isRecall:n}})).data.success}async retryEmbedding(e){return(await E.post(`${de}/retry-embedding/${e}`)).data.success}async refreshAllKnowledgeToVectorStore(e){return(await E.post(`${de}/refresh-vector-store`,null,{params:{agentId:e}})).data.success}}const pe=new Il,El=re({name:"AgentKnowledgeConfig",components:{Search:Ce,Warning:Ne},props:{agentId:{type:Number,required:!0}},setup(t){const e=V([]),n=V(!1),s=V(!1),g=V(""),y=V({businessTerm:"",description:"",synonyms:"",isRecall:!1}),p=V(null),m=V(!1),h=V(!1),_=V({}),A=()=>{s.value=!1,n.value=!0},c=()=>{q()},q=async()=>{try{e.value=await pe.list(t.agentId,g.value||void 0)}catch($){i.error("加载业务知识列表失败"),console.error("Failed to load business knowledge:",$)}},C=$=>{s.value=!0,p.value=$.id||null,y.value={...$},n.value=!0},D=async $=>{if($.id)try{await Z.confirm(`确定要删除业务知识 "${$.businessTerm}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await pe.delete($.id)?(i.success("删除成功"),await q()):i.error("删除失败")}catch{}},F=async($,w)=>{if($.id)try{await pe.recallKnowledge($.id,w)?(i.success(`${w?"设为召回":"取消召回"}成功`),$.isRecall=w):i.error(`${w?"设为召回":"取消召回"}失败`)}catch(B){i.error(`${w?"设为召回":"取消召回"}失败`),console.error("Failed to toggle recall:",B)}},N=async()=>{h.value=!0;try{if(s.value&&p.value){const $={businessTerm:y.value.businessTerm,description:y.value.description,synonyms:y.value.synonyms,agentId:t.agentId};if(await pe.update(p.value,$))i.success("更新成功");else{i.error("更新失败");return}}else{const $={businessTerm:y.value.businessTerm,description:y.value.description,synonyms:y.value.synonyms,isRecall:y.value.isRecall,agentId:t.agentId};await pe.create($),i.success("创建成功")}n.value=!1,await q()}catch($){i.error(`${s.value?"更新":"创建"}失败`),console.error("Failed to save knowledge:",$)}finally{h.value=!1}},T=async()=>{try{await Z.confirm("如果所有向量状态正常，即无需同步。确定要清除现有数据并开始重新同步吗？","确认同步",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),m.value=!0,await pe.refreshAllKnowledgeToVectorStore(t.agentId.toString())?i.success("同步到向量库成功"):i.error("同步到向量库失败")}catch($){$!=="cancel"&&(i.error("同步到向量库失败"),console.error("Failed to refresh vector store:",$))}finally{m.value=!1}},z=async $=>{if($.id)try{_.value[$.id]=!0,await pe.retryEmbedding($.id)?(i.success("重试向量化成功"),await q()):i.error("重试向量化失败")}catch(w){i.error("重试向量化失败"),console.error("Failed to retry vectorization:",w)}finally{_.value[$.id]=!1}},S=$=>{switch($){case"COMPLETED":return"success";case"FAILED":return"danger";case"PENDING":return"warning";case"PROCESSING":return"primary";default:return"info"}};return ve(()=>{q()}),{Plus:_e,Search:Ce,Document:Le,businessKnowledgeList:e,dialogVisible:n,isEdit:s,searchKeyword:g,knowledgeForm:y,refreshLoading:m,saveLoading:h,retryLoadingMap:_,openCreateDialog:A,editKnowledge:C,deleteKnowledge:D,toggleRecall:F,saveKnowledge:N,handleSearch:c,refreshVectorStore:T,retryEmbedding:z,getVectorStatusType:S}}}),zl={style:{padding:"20px"}},Ul={style:{"margin-bottom":"30px"}},Kl={style:{"text-align":"right"}};function Pl(t,e,n,s,g,y){const p=r("el-divider"),m=r("el-col"),h=r("Search"),_=r("el-icon"),A=r("el-input"),c=r("el-button"),q=r("el-row"),C=r("el-table-column"),D=r("Warning"),F=r("el-tooltip"),N=r("el-tag"),T=r("el-table"),z=r("el-form-item"),S=r("el-form"),$=r("el-dialog");return v(),R(Y,null,[a("div",zl,[e[15]||(e[15]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"业务知识管理")],-1)),l(p),a("div",Ul,[l(q,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(m,{span:12},{default:o(()=>[...e[6]||(e[6]=[a("h3",null,"业务知识列表",-1)])]),_:1}),l(m,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(A,{modelValue:t.searchKeyword,"onUpdate:modelValue":e[0]||(e[0]=w=>t.searchKeyword=w),placeholder:"请输入关键词，并按回车搜索",style:{width:"250px","margin-right":"10px"},clearable:"",onClear:t.handleSearch,onKeyup:Ie(t.handleSearch,["enter"]),size:"large"},{prefix:o(()=>[l(_,null,{default:o(()=>[l(h)]),_:1})]),_:1},8,["modelValue","onClear","onKeyup"]),t.refreshLoading?(v(),P(c,{key:1,size:"large",type:"success",round:"",loading:""},{default:o(()=>[...e[8]||(e[8]=[f("同步中...",-1)])]),_:1})):(v(),P(c,{key:0,onClick:t.refreshVectorStore,size:"large",type:"success",round:"",icon:t.Document},{default:o(()=>[...e[7]||(e[7]=[f(" 同步到向量库 ",-1)])]),_:1},8,["onClick","icon"])),l(c,{onClick:t.openCreateDialog,size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[9]||(e[9]=[f(" 添加知识 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1})]),l(T,{data:t.businessKnowledgeList,style:{width:"100%"},border:""},{default:o(()=>[l(C,{prop:"id",label:"ID","min-width":"60px"}),l(C,{prop:"businessTerm",label:"业务名词","min-width":"120px"}),l(C,{prop:"description",label:"描述","min-width":"150px"}),l(C,{prop:"synonyms",label:"同义词","min-width":"120px"}),l(C,{label:"向量化状态","min-width":"120px"},{default:o(w=>[l(N,{type:t.getVectorStatusType(w.row.embeddingStatus),round:""},{default:o(()=>[f(M(w.row.embeddingStatus||"未知")+" ",1),w.row.embeddingStatus==="FAILED"&&w.row.errorMsg?(v(),P(F,{key:0,content:w.row.errorMsg,placement:"top"},{default:o(()=>[l(_,{style:{"margin-left":"4px"}},{default:o(()=>[l(D)]),_:1})]),_:1},8,["content"])):J("",!0)]),_:2},1032,["type"])]),_:1}),l(C,{label:"是否召回","min-width":"80px"},{default:o(w=>[l(N,{type:w.row.isRecall?"success":"info",round:""},{default:o(()=>[f(M(w.row.isRecall?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(C,{prop:"createdTime",label:"创建时间","min-width":"120px"}),l(C,{label:"操作","min-width":"180px"},{default:o(w=>[l(c,{onClick:B=>t.editKnowledge(w.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[10]||(e[10]=[f(" 编辑 ",-1)])]),_:1},8,["onClick"]),w.row.embeddingStatus==="FAILED"?(v(),P(c,{key:0,onClick:B=>t.retryEmbedding(w.row),size:"small",type:"info",round:"",plain:"",loading:t.retryLoadingMap[w.row.id]},{default:o(()=>[...e[11]||(e[11]=[f(" 重试 ",-1)])]),_:1},8,["onClick","loading"])):J("",!0),w.row.isRecall?(v(),P(c,{key:1,onClick:B=>t.toggleRecall(w.row,!1),size:"small",type:"warning",round:"",plain:""},{default:o(()=>[...e[12]||(e[12]=[f(" 取消召回 ",-1)])]),_:1},8,["onClick"])):(v(),P(c,{key:2,onClick:B=>t.toggleRecall(w.row,!0),size:"small",type:"success",round:"",plain:""},{default:o(()=>[...e[13]||(e[13]=[f(" 设为召回 ",-1)])]),_:1},8,["onClick"])),l(c,{onClick:B=>t.deleteKnowledge(w.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[14]||(e[14]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),l($,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[5]||(e[5]=w=>t.dialogVisible=w),title:t.isEdit?"编辑业务知识":"添加业务知识",width:"800"},{footer:o(()=>[a("div",Kl,[l(c,{onClick:e[4]||(e[4]=w=>t.dialogVisible=!1)},{default:o(()=>[...e[16]||(e[16]=[f("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:t.saveKnowledge,loading:t.saveLoading,disabled:t.saveLoading},{default:o(()=>[f(M(t.isEdit?"更新":"创建"),1)]),_:1},8,["onClick","loading","disabled"])])]),default:o(()=>[l(S,{model:t.knowledgeForm,"label-width":"100px",ref:"knowledgeFormRef"},{default:o(()=>[l(z,{label:"业务名词",prop:"businessTerm",required:""},{default:o(()=>[l(A,{modelValue:t.knowledgeForm.businessTerm,"onUpdate:modelValue":e[1]||(e[1]=w=>t.knowledgeForm.businessTerm=w),placeholder:"请输入业务名词"},null,8,["modelValue"])]),_:1}),l(z,{label:"描述",prop:"description",required:""},{default:o(()=>[l(A,{modelValue:t.knowledgeForm.description,"onUpdate:modelValue":e[2]||(e[2]=w=>t.knowledgeForm.description=w),type:"textarea",rows:3,placeholder:"请输入业务知识描述"},null,8,["modelValue"])]),_:1}),l(z,{label:"同义词",prop:"synonyms"},{default:o(()=>[l(A,{modelValue:t.knowledgeForm.synonyms,"onUpdate:modelValue":e[3]||(e[3]=w=>t.knowledgeForm.synonyms=w),type:"textarea",rows:2,placeholder:"请输入同义词，多个同义词用逗号分隔"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}const Ll=oe(El,[["render",Pl]]),Ml=re({name:"BatchImportDialog",components:{UploadFilled:Ve},props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:"批量导入"},jsonTemplate:{type:Array,default:()=>[]},validateJson:{type:Function,required:!0},validateExcelFile:{type:Function,required:!0},onJsonImport:{type:Function,required:!0},onExcelImport:{type:Function,required:!0},onDownloadExcelTemplate:{type:Function,required:!0}},emits:["update:modelValue","imported"],setup(t,{emit:e}){const n=V(""),s=V("input"),g=V(null),y=V(!1),p=V("json"),m=V(null),h=ne({get:()=>t.modelValue,set:T=>e("update:modelValue",T)}),_=()=>{s.value="input",g.value=null,n.value="",p.value="json",m.value=null};return Me(()=>t.modelValue,T=>{T&&_()}),{dialogVisible:h,importJsonText:n,importTab:s,importResult:g,importing:y,importMode:p,loadTemplate:()=>{n.value=JSON.stringify(t.jsonTemplate,null,2),i.success("模板已加载")},handleValidateJson:()=>t.validateJson(n.value),handleJsonImport:async()=>{if(!t.validateJson(n.value))return;let T;try{T=JSON.parse(n.value)}catch(z){i.error("JSON格式错误："+z.message);return}try{y.value=!0;const z=await t.onJsonImport(T);g.value=z,s.value="result",z.failCount===0?i.success(`批量导入成功！共导入${z.successCount}条记录`):i.warning(`批量导入完成！成功${z.successCount}条，失败${z.failCount}条`),e("imported",z)}catch(z){i.error("批量导入失败："+z.message),console.error("Failed to batch import:",z)}finally{y.value=!1}},handleFileChange:T=>{m.value=T.raw??null},handleExceed:()=>{i.warning("只能上传一个文件")},downloadExcelTemplate:async()=>{try{await t.onDownloadExcelTemplate(),i.success("模板下载成功")}catch(T){i.error("模板下载失败："+T.message),console.error("Failed to download template:",T)}},handleExcelImport:async()=>{if(!(!t.validateExcelFile(m.value)||!m.value))try{y.value=!0;const T=await t.onExcelImport(m.value);g.value=T,s.value="result",T.failCount===0?i.success(`Excel导入成功！共导入${T.successCount}条记录`):i.warning(`Excel导入完成！成功${T.successCount}条，失败${T.failCount}条`),e("imported",T)}catch(T){i.error("Excel导入失败："+T.message),console.error("Failed to import excel:",T)}finally{y.value=!1}}}}}),ql={style:{"margin-top":"10px","text-align":"right"}},Bl={style:{"text-align":"center",padding:"40px 0"}},Ol={style:{"margin-top":"20px"}},Rl={key:0,style:{"text-align":"left","max-height":"300px","overflow-y":"auto"}},jl={style:{"text-align":"right"}};function Jl(t,e,n,s,g,y){const p=r("el-alert"),m=r("el-radio-button"),h=r("el-radio-group"),_=r("el-input"),A=r("el-button"),c=r("el-tab-pane"),q=r("upload-filled"),C=r("el-icon"),D=r("el-upload"),F=r("el-result"),N=r("el-tabs"),T=r("el-dialog");return v(),P(T,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[4]||(e[4]=z=>t.dialogVisible=z),title:t.title,width:"900"},{footer:o(()=>[a("div",jl,[l(A,{onClick:e[3]||(e[3]=z=>t.dialogVisible=!1)},{default:o(()=>[...e[13]||(e[13]=[f("关闭",-1)])]),_:1}),t.importMode==="json"?(v(),P(A,{key:0,type:"primary",onClick:t.handleJsonImport,loading:t.importing},{default:o(()=>[...e[14]||(e[14]=[f(" 开始导入 ",-1)])]),_:1},8,["onClick","loading"])):J("",!0),t.importMode==="excel"?(v(),P(A,{key:1,type:"primary",onClick:t.handleExcelImport,loading:t.importing},{default:o(()=>[...e[15]||(e[15]=[f(" 开始导入 ",-1)])]),_:1},8,["onClick","loading"])):J("",!0)])]),default:o(()=>[l(p,{title:"导入说明",type:"info",closable:!1,style:{"margin-bottom":"20px"}},{default:o(()=>[...e[5]||(e[5]=[a("p",null,"1. 支持JSON和Excel两种导入方式",-1),a("p",null,"2. 如果记录已存在（相同表名+字段名），将自动覆盖更新",-1),a("p",null,'3. 枚举字段信息可以直接写在"业务描述"中，例如：枚举值：1=资产工单, 2=账号工单',-1),a("p",null,"4. 必填字段：表名、字段名、业务名称、数据类型",-1)])]),_:1}),l(h,{modelValue:t.importMode,"onUpdate:modelValue":e[0]||(e[0]=z=>t.importMode=z),style:{"margin-bottom":"20px"}},{default:o(()=>[l(m,{value:"json"},{default:o(()=>[...e[6]||(e[6]=[f("JSON导入",-1)])]),_:1}),l(m,{value:"excel"},{default:o(()=>[...e[7]||(e[7]=[f("Excel导入",-1)])]),_:1})]),_:1},8,["modelValue"]),l(N,{modelValue:t.importTab,"onUpdate:modelValue":e[2]||(e[2]=z=>t.importTab=z)},{default:o(()=>[t.importMode==="json"?(v(),P(c,{key:0,label:"JSON输入",name:"input"},{default:o(()=>[l(_,{modelValue:t.importJsonText,"onUpdate:modelValue":e[1]||(e[1]=z=>t.importJsonText=z),type:"textarea",rows:15,placeholder:"请输入JSON格式的数据...",style:{"font-family":"'Courier New', monospace"}},null,8,["modelValue"]),a("div",ql,[l(A,{onClick:t.loadTemplate,size:"small"},{default:o(()=>[...e[8]||(e[8]=[f("加载模板",-1)])]),_:1},8,["onClick"]),l(A,{onClick:t.handleValidateJson,size:"small",type:"primary"},{default:o(()=>[...e[9]||(e[9]=[f("验证JSON",-1)])]),_:1},8,["onClick"])])]),_:1})):J("",!0),t.importMode==="excel"?(v(),P(c,{key:1,label:"Excel上传",name:"input"},{default:o(()=>[a("div",Bl,[l(D,{ref:"uploadRef","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":t.handleFileChange,"on-exceed":t.handleExceed,drag:""},{tip:o(()=>[...e[10]||(e[10]=[a("div",{class:"el-upload__tip"},"只能上传 xlsx/xls 文件，且不超过 10MB",-1)])]),default:o(()=>[l(C,{class:"el-icon--upload"},{default:o(()=>[l(q)]),_:1}),e[11]||(e[11]=a("div",{class:"el-upload__text"},[f(" 将Excel文件拖到此处，或 "),a("em",null,"点击上传")],-1))]),_:1},8,["on-change","on-exceed"]),a("div",Ol,[l(A,{onClick:t.downloadExcelTemplate,type:"primary",plain:""},{default:o(()=>[...e[12]||(e[12]=[f("下载Excel模板",-1)])]),_:1},8,["onClick"])])])]),_:1})):J("",!0),l(c,{label:"导入结果",name:"result",disabled:!t.importResult},{default:o(()=>[t.importResult?(v(),P(F,{key:0,icon:t.importResult.failCount===0?"success":"warning",title:t.importResult.failCount===0?"导入成功":"部分导入失败"},{"sub-title":o(()=>[a("p",null," 总数："+M(t.importResult.total)+" | 成功："+M(t.importResult.successCount)+" | 失败："+M(t.importResult.failCount),1)]),extra:o(()=>[t.importResult.errors.length>0?(v(),R("div",Rl,[(v(!0),R(Y,null,ye(t.importResult.errors,(z,S)=>(v(),P(p,{key:S,title:z,type:"error",closable:!1,style:{"margin-bottom":"10px"}},null,8,["title"]))),128))])):J("",!0)]),_:1},8,["icon","title"])):J("",!0)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}const Ql=oe(Ml,[["render",Jl]]),ee="/api/semantic-model";class Hl{async list(e,n){const s={};return e!==void 0&&(s.agentId=e.toString()),n&&(s.keyword=n),(await E.get(ee,{params:s})).data.data||[]}async get(e){var n;try{return(await E.get(`${ee}/${e}`)).data.data||null}catch(s){if(E.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return null;throw s}}async create(e){return(await E.post(ee,e)).data.success}async update(e,n){var s;try{return(await E.put(`${ee}/${e}`,n)).data.success}catch(g){if(E.isAxiosError(g)&&((s=g.response)==null?void 0:s.status)===404)return!1;throw g}}async delete(e){var n;try{return(await E.delete(`${ee}/${e}`)).data.success}catch(s){if(E.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return!1;throw s}}async batchDelete(e){return(await E.delete(`${ee}/batch`,{data:e})).data.success}async enable(e){return(await E.put(`${ee}/enable`,e)).data.success}async disable(e){return(await E.put(`${ee}/disable`,e)).data.success}async batchImport(e){return(await E.post(`${ee}/batch-import`,e)).data.data||{total:0,successCount:0,failCount:0,errors:[]}}async importExcel(e,n){const s=new FormData;return s.append("file",e),s.append("agentId",n.toString()),(await E.post(`${ee}/import/excel`,s,{headers:{"Content-Type":"multipart/form-data"}})).data.data||{total:0,successCount:0,failCount:0,errors:[]}}async downloadTemplate(){const e=await E.get(`${ee}/template/download`,{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=n,s.setAttribute("download","semantic_model_template.xlsx"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(n)}}const te=new Hl,Gl=re({name:"AgentSemanticsConfig",components:{UploadFilled:Ve,Search:Ce,BatchImportDialog:Ql},props:{agentId:{type:Number,required:!0}},setup(t){const e=V([]),n=V(!1),s=V(!1),g=V(""),y=V([]),p=V({tableName:"",columnName:"",businessName:"",synonyms:"",businessDescription:"",columnComment:"",dataType:"",status:1,agentId:t.agentId}),m=V(null),h=()=>{s.value=!1,p.value={tableName:"",columnName:"",businessName:"",synonyms:"",businessDescription:"",columnComment:"",dataType:"",status:1,agentId:t.agentId},n.value=!0},_=K=>{y.value=K},A=async()=>{if(y.value.length===0){i.warning("请先选择要删除的语义模型");return}try{await Z.confirm(`确定要删除选中的 ${y.value.length} 个语义模型吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const K=y.value.map(I=>I.id).filter(I=>I!==void 0);await te.batchDelete(K)?(i.success(`成功删除 ${K.length} 个语义模型`),y.value=[],await q()):i.error("批量删除失败")}catch{}},c=()=>{q()},q=async()=>{try{e.value=await te.list(t.agentId,g.value||void 0)}catch(K){i.error("加载语义模型列表失败"),console.error("Failed to load semantic models:",K)}},C=K=>{s.value=!0,m.value=K.id||null,p.value={...K},n.value=!0},D=async K=>{if(K.id)try{await Z.confirm(`确定要删除语义模型 "${K.businessName}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await te.delete(K.id)?(i.success("删除成功"),await q()):i.error("删除失败")}catch{}},F=async(K,O)=>{if(K.id)try{const I=[K.id];let b=!1;O===1?b=await te.enable(I):b=await te.disable(I),b?(i.success(`${O===1?"启用":"停用"}成功`),K.status=O):i.error(`${O===1?"启用":"停用"}失败`)}catch(I){i.error(`${O===1?"启用":"停用"}失败`),console.error("Failed to toggle status:",I)}},N=async()=>{try{if(s.value&&m.value){const K={...p.value,id:m.value};if(await te.update(m.value,K))i.success("更新成功");else{i.error("更新失败");return}}else{const K={agentId:t.agentId,tableName:p.value.tableName,columnName:p.value.columnName,businessName:p.value.businessName,synonyms:p.value.synonyms,businessDescription:p.value.businessDescription,columnComment:p.value.columnComment,dataType:p.value.dataType};if(await te.create(K))i.success("创建成功");else{i.error("创建失败");return}}n.value=!1,await q()}catch(K){i.error(`${s.value?"更新":"创建"}失败`),console.error("Failed to save model:",K)}};ve(()=>{q()});const T=V(!1);return{Plus:_e,Search:Ce,Delete:Ue,semanticModelList:e,dialogVisible:n,isEdit:s,searchKeyword:g,selectedModels:y,modelForm:p,openCreateDialog:h,handleSelectionChange:_,batchDeleteModels:A,editModel:C,deleteModel:D,toggleStatus:F,saveModel:N,handleSearch:c,batchImportDialogVisible:T,jsonTemplate:[{tableName:"work_order",columnName:"order_type",businessName:"工单类型",synonyms:"类型,工单种类",businessDesc:"用于区分工单种类。枚举值：1=资产工单, 2=账号工单",dataType:"int"},{tableName:"work_order",columnName:"status",businessName:"工单状态",synonyms:"状态,处理状态",businessDesc:"工单当前处理状态。枚举值：0=待处理 1=处理中 2=已完成 3=已关闭",dataType:"int"}],openBatchImportDialog:()=>{T.value=!0},validateJson:K=>{try{const O=JSON.parse(K);if(!Array.isArray(O))return i.error("JSON格式错误：数据必须是数组"),!1;if(O.length===0)return i.error("导入数据不能为空"),!1;for(let I=0;I<O.length;I++){const b=O[I];if(!b.tableName||!b.columnName||!b.businessName||!b.dataType)return i.error(`第${I+1}条记录缺少必填字段（tableName, columnName, businessName, dataType）`),!1}return i.success("JSON格式验证通过"),!0}catch(O){return i.error("JSON格式错误："+O.message),!1}},validateExcelFile:K=>K?!0:(i.error("请先选择Excel文件"),!1),executeBatchImport:async K=>{try{return await te.batchImport({agentId:t.agentId,items:K})}catch(O){throw i.error("批量导入失败："+O.message),console.error("Failed to batch import:",O),O}},downloadExcelTemplate:async()=>{try{await te.downloadTemplate(),i.success("模板下载成功")}catch(K){i.error("模板下载失败："+K.message),console.error("Failed to download template:",K)}},executeExcelImport:async K=>{try{return await te.importExcel(K,t.agentId)}catch(O){throw i.error("Excel导入失败："+O.message),console.error("Failed to import excel:",O),O}},handleBatchImported:async()=>{await q()},formatDateTime:K=>{if(!K)return"-";try{return new Date(K).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return K}}}}}),Wl={style:{padding:"20px"}},Xl={style:{"margin-bottom":"30px"}},Yl={style:{"text-align":"right"}};function Zl(t,e,n,s,g,y){const p=r("el-divider"),m=r("el-button"),h=r("el-col"),_=r("Search"),A=r("el-icon"),c=r("el-input"),q=r("UploadFilled"),C=r("el-row"),D=r("el-table-column"),F=r("el-tag"),N=r("el-table"),T=r("el-form-item"),z=r("el-form"),S=r("el-dialog"),$=r("BatchImportDialog");return v(),R(Y,null,[a("div",Wl,[e[18]||(e[18]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"语义模型管理")],-1)),l(p),a("div",Xl,[l(C,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(h,{span:12},{default:o(()=>[e[11]||(e[11]=a("h3",null,"语义模型列表",-1)),t.selectedModels.length>0?(v(),P(m,{key:0,onClick:t.batchDeleteModels,size:"default",type:"danger",plain:"",icon:t.Delete,style:{"margin-left":"10px"}},{default:o(()=>[f(" 批量删除 ("+M(t.selectedModels.length)+") ",1)]),_:1},8,["onClick","icon"])):J("",!0)]),_:1}),l(h,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(c,{modelValue:t.searchKeyword,"onUpdate:modelValue":e[0]||(e[0]=w=>t.searchKeyword=w),placeholder:"请输入关键词，并按回车搜索",style:{width:"250px","margin-right":"10px"},clearable:"",onClear:t.handleSearch,onKeyup:Ie(t.handleSearch,["enter"]),size:"large"},{prefix:o(()=>[l(A,null,{default:o(()=>[l(_)]),_:1})]),_:1},8,["modelValue","onClear","onKeyup"]),l(m,{onClick:t.openBatchImportDialog,size:"large",type:"success",round:""},{default:o(()=>[l(A,null,{default:o(()=>[l(q)]),_:1}),e[12]||(e[12]=f(" 批量导入 ",-1))]),_:1},8,["onClick"]),l(m,{onClick:t.openCreateDialog,size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[13]||(e[13]=[f(" 添加语义模型 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1})]),l(N,{data:t.semanticModelList,style:{width:"100%"},border:"",onSelectionChange:t.handleSelectionChange},{default:o(()=>[l(D,{type:"selection",width:"55"}),l(D,{prop:"id",label:"ID","min-width":"60px"}),l(D,{prop:"tableName",label:"表名","min-width":"120px"}),l(D,{prop:"columnName",label:"数据库字段名","min-width":"120px"}),l(D,{prop:"businessName",label:"业务名称","min-width":"120px"}),l(D,{prop:"synonyms",label:"同义词","min-width":"120px"}),l(D,{prop:"dataType",label:"数据类型","min-width":"80px"}),l(D,{label:"状态","min-width":"80px"},{default:o(w=>[l(F,{type:w.row.status===1?"success":"info",round:""},{default:o(()=>[f(M(w.row.status===1?"启用":"停用"),1)]),_:2},1032,["type"])]),_:1}),l(D,{label:"创建时间","min-width":"160px"},{default:o(w=>[f(M(t.formatDateTime(w.row.createdTime||w.row.createTime)),1)]),_:1}),l(D,{label:"操作","min-width":"180px"},{default:o(w=>[l(m,{onClick:B=>t.editModel(w.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[14]||(e[14]=[f(" 编辑 ",-1)])]),_:1},8,["onClick"]),w.row.status===0?(v(),P(m,{key:0,onClick:B=>t.toggleStatus(w.row,1),size:"small",type:"success",round:"",plain:""},{default:o(()=>[...e[15]||(e[15]=[f(" 启用 ",-1)])]),_:1},8,["onClick"])):(v(),P(m,{key:1,onClick:B=>t.toggleStatus(w.row,0),size:"small",type:"warning",round:"",plain:""},{default:o(()=>[...e[16]||(e[16]=[f(" 停用 ",-1)])]),_:1},8,["onClick"])),l(m,{onClick:B=>t.deleteModel(w.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[17]||(e[17]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])]),l(S,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[9]||(e[9]=w=>t.dialogVisible=w),title:t.isEdit?"编辑语义模型":"添加语义模型",width:"800"},{footer:o(()=>[a("div",Yl,[l(m,{onClick:e[8]||(e[8]=w=>t.dialogVisible=!1)},{default:o(()=>[...e[19]||(e[19]=[f("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:t.saveModel},{default:o(()=>[f(M(t.isEdit?"更新":"创建"),1)]),_:1},8,["onClick"])])]),default:o(()=>[l(z,{model:t.modelForm,"label-width":"120px",ref:"modelFormRef"},{default:o(()=>[l(T,{label:"表名",prop:"tableName",required:""},{default:o(()=>[l(c,{modelValue:t.modelForm.tableName,"onUpdate:modelValue":e[1]||(e[1]=w=>t.modelForm.tableName=w),placeholder:"请输入表名"},null,8,["modelValue"])]),_:1}),l(T,{label:"数据库字段名",prop:"columnName",required:""},{default:o(()=>[l(c,{modelValue:t.modelForm.columnName,"onUpdate:modelValue":e[2]||(e[2]=w=>t.modelForm.columnName=w),placeholder:"请输入数据库字段名"},null,8,["modelValue"])]),_:1}),l(T,{label:"业务名称",prop:"businessName",required:""},{default:o(()=>[l(c,{modelValue:t.modelForm.businessName,"onUpdate:modelValue":e[3]||(e[3]=w=>t.modelForm.businessName=w),placeholder:"请输入业务名称"},null,8,["modelValue"])]),_:1}),l(T,{label:"同义词",prop:"synonyms"},{default:o(()=>[l(c,{modelValue:t.modelForm.synonyms,"onUpdate:modelValue":e[4]||(e[4]=w=>t.modelForm.synonyms=w),type:"textarea",rows:2,placeholder:"请输入同义词，多个同义词用逗号分隔"},null,8,["modelValue"])]),_:1}),l(T,{label:"业务描述",prop:"businessDescription"},{default:o(()=>[l(c,{modelValue:t.modelForm.businessDescription,"onUpdate:modelValue":e[5]||(e[5]=w=>t.modelForm.businessDescription=w),type:"textarea",rows:3,placeholder:"请输入业务描述，用于向LLM解释字段的业务含义"},null,8,["modelValue"])]),_:1}),l(T,{label:"字段注释",prop:"columnComment"},{default:o(()=>[l(c,{modelValue:t.modelForm.columnComment,"onUpdate:modelValue":e[6]||(e[6]=w=>t.modelForm.columnComment=w),type:"textarea",rows:2,placeholder:"请输入数据库字段的原始注释"},null,8,["modelValue"])]),_:1}),l(T,{label:"数据类型",prop:"dataType",required:""},{default:o(()=>[l(c,{modelValue:t.modelForm.dataType,"onUpdate:modelValue":e[7]||(e[7]=w=>t.modelForm.dataType=w),placeholder:"请输入数据类型，如：int, varchar(20)"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l($,{modelValue:t.batchImportDialogVisible,"onUpdate:modelValue":e[10]||(e[10]=w=>t.batchImportDialogVisible=w),title:"批量导入语义模型","json-template":t.jsonTemplate,"validate-json":t.validateJson,"validate-excel-file":t.validateExcelFile,"on-json-import":t.executeBatchImport,"on-excel-import":t.executeExcelImport,"on-download-excel-template":t.downloadExcelTemplate,onImported:t.handleBatchImported},null,8,["modelValue","json-template","validate-json","validate-excel-file","on-json-import","on-excel-import","on-download-excel-template","onImported"])],64)}const xl=oe(Gl,[["render",Zl]]),eo=re({name:"AgentPresetsConfig",props:{agentId:{type:Number,required:!0}},setup(t){const e=V([]),n=V(!1),s=V(!1),g=V({agentId:t.agentId,question:"",sortOrder:0,isActive:!0}),y=V(null),p=()=>{s.value=!1,g.value={agentId:t.agentId,question:"",sortOrder:0,isActive:!0},n.value=!0},m=async()=>{try{e.value=await Fe.list(t.agentId)}catch(c){i.error("加载预设问题列表失败"),console.error("加载预设问题失败:",c)}},h=c=>{s.value=!0,y.value=c.id||null,g.value={...c},n.value=!0},_=async c=>{if(c.id)try{await Z.confirm(`确定要删除预设问题 "${c.question.substring(0,50)}..." 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Fe.delete(t.agentId,c.id)?(i.success("删除成功"),await m()):i.error("删除失败")}catch{}},A=async()=>{try{if(!g.value.question||g.value.question.trim()===""){i.error("请输入预设问题");return}let c=[];if(s.value&&y.value?c=e.value.map(C=>{const D={question:C.id===y.value?g.value.question:C.question};return C.id===y.value?D.isActive=g.value.isActive===!0:D.isActive=C.isActive===!0,D}):c=[...e.value.map(C=>({question:C.question,isActive:C.isActive===!0})),{question:g.value.question,isActive:g.value.isActive===!0}],console.log("发送的数据:",JSON.stringify(c)),await Fe.batchSave(t.agentId,c))i.success(s.value?"更新成功":"创建成功");else{i.error(s.value?"更新失败":"创建失败");return}n.value=!1,await m()}catch(c){i.error(`${s.value?"更新":"创建"}失败`),console.error("保存预设问题失败:",c)}};return ve(()=>{m()}),{Plus:_e,presetQuestionList:e,dialogVisible:n,isEdit:s,questionForm:g,openCreateDialog:p,editQuestion:h,deleteQuestion:_,saveQuestion:A}}}),to={style:{padding:"20px"}},lo={style:{"margin-bottom":"30px"}},oo={style:{"text-align":"right"}};function ao(t,e,n,s,g,y){const p=r("el-divider"),m=r("el-col"),h=r("el-button"),_=r("el-row"),A=r("el-table-column"),c=r("el-tag"),q=r("el-table"),C=r("el-input"),D=r("el-form-item"),F=r("el-input-number"),N=r("el-switch"),T=r("el-form"),z=r("el-dialog");return v(),R(Y,null,[a("div",to,[e[9]||(e[9]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"预设问题管理")],-1)),l(p),a("div",lo,[l(_,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(m,{span:12},{default:o(()=>[...e[5]||(e[5]=[a("h3",null,"预设问题列表",-1)])]),_:1}),l(m,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(h,{onClick:t.openCreateDialog,size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[6]||(e[6]=[f(" 添加问题 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1})]),l(q,{data:t.presetQuestionList,style:{width:"100%"},border:""},{default:o(()=>[l(A,{prop:"id",label:"ID","min-width":"60px"}),l(A,{prop:"question",label:"问题","min-width":"250px","show-overflow-tooltip":""}),l(A,{prop:"sortOrder",label:"排序","min-width":"80px"}),l(A,{label:"状态","min-width":"80px"},{default:o(S=>[l(c,{type:S.row.isActive?"success":"info",round:""},{default:o(()=>[f(M(S.row.isActive?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(A,{prop:"createTime",label:"创建时间","min-width":"150px"}),l(A,{label:"操作","min-width":"200px"},{default:o(S=>[l(h,{onClick:$=>t.editQuestion(S.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[7]||(e[7]=[f(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(h,{onClick:$=>t.deleteQuestion(S.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[8]||(e[8]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),l(z,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[4]||(e[4]=S=>t.dialogVisible=S),title:t.isEdit?"编辑预设问题":"添加预设问题",width:"600"},{footer:o(()=>[a("div",oo,[l(h,{onClick:e[3]||(e[3]=S=>t.dialogVisible=!1)},{default:o(()=>[...e[10]||(e[10]=[f("取消",-1)])]),_:1}),l(h,{type:"primary",onClick:t.saveQuestion},{default:o(()=>[f(M(t.isEdit?"更新":"创建"),1)]),_:1},8,["onClick"])])]),default:o(()=>[l(T,{model:t.questionForm,"label-width":"80px",ref:"questionFormRef"},{default:o(()=>[l(D,{label:"问题",prop:"question",required:""},{default:o(()=>[l(C,{modelValue:t.questionForm.question,"onUpdate:modelValue":e[0]||(e[0]=S=>t.questionForm.question=S),type:"textarea",rows:4,placeholder:"请输入预设问题"},null,8,["modelValue"])]),_:1}),l(D,{label:"排序",prop:"sortOrder"},{default:o(()=>[l(F,{modelValue:t.questionForm.sortOrder,"onUpdate:modelValue":e[1]||(e[1]=S=>t.questionForm.sortOrder=S),min:0,"controls-position":"right"},null,8,["modelValue"])]),_:1}),l(D,{label:"状态",prop:"isActive"},{default:o(()=>[l(N,{modelValue:t.questionForm.isActive,"onUpdate:modelValue":e[2]||(e[2]=S=>t.questionForm.isActive=S)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}const no=oe(eo,[["render",ao]]),so=re({name:"AgentAccessApi",props:{agentId:{type:[Number,String],required:!1,default:null}},setup(t){const e=lt(),n=ne(()=>Number(t.agentId??e.params.id)),s=V(null),g=V(!1),y=V(!0),p=V(!1),m=V({generate:!1,reset:!1,delete:!1,toggle:!1,fetch:!1}),h=V("curl"),_=V({title:"AI 助手",position:"bottom-right",primaryColor:"#409EFF",welcomeMessage:"您好！我是 AI 助手，有什么可以帮您的吗？"}),A=U=>U?U.startsWith("****")?U:U.length<=8?"****":"****"+U.slice(-4):"",c=ne(()=>s.value?y.value?A(s.value):s.value:""),q=ne(()=>{const U=window.location.origin,Q=n.value;return`# 创建会话
curl -X POST "${U}/api/agent/${Q}/sessions" \\
  -H "Content-Type: application/json" \\
  -H "X-API-Key: <your_api_key>" \\
  -d '{"title":"demo"}'

# 发送消息
curl -X POST "${U}/api/sessions/<sessionId>/messages" \\
  -H "Content-Type: application/json" \\
  -H "X-API-Key: <your_api_key>" \\
  -d '{"role":"user","content":"给我一个示例","messageType":"text"}'`}),C=ne(()=>{const U=window.location.origin,Q=n.value;return String.raw`const apiKey = '<your_api_key>';
const baseUrl = '${U}/api';
const agentId = ${Q};

(async () => {
  // 创建会话
  const sessionRes = await fetch(\`${"${baseUrl}"}/agent/${"${agentId}"}/sessions\`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-API-Key': apiKey,
    },
    body: JSON.stringify({ title: 'demo' }),
  });
  const session = await sessionRes.json();

  // 发送消息
  await fetch(\`${"${baseUrl}"}/sessions/${"${session.id}"}/messages\`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-API-Key': apiKey,
    },
    body: JSON.stringify({ role: 'user', content: '你好', messageType: 'text' }),
  });
})();`}),D=ne(()=>{const U=window.location.origin,Q=n.value;return`import requests

api_key = '<your_api_key>'
base_url = '${U}/api'

headers = {
    'Content-Type': 'application/json',
    'X-API-Key': api_key,
}

# 创建会话
session_resp = requests.post(
    f"{base_url}/agent/${Q}/sessions",
    headers=headers,
    json={"title": "demo"},
)
session_id = session_resp.json().get("id")

# 发送消息
requests.post(
    f"{base_url}/sessions/{session_id}/messages",
    headers=headers,
    json={"role": "user", "content": "你好", "messageType": "text"},
)
`}),F=ne(()=>{const U=window.location.origin,Q=n.value,X=_.value,K=JSON.stringify({agentId:Q,apiKey:"<your_api_key>",title:X.title,position:X.position,primaryColor:X.primaryColor,welcomeMessage:X.welcomeMessage},null,2),O="<script>",I="<\/script>";return`<!-- 将以下代码添加到您的网页 </body> 标签之前 -->
${O}
  window.DataAgentConfig = ${K};
${I}
${O} src="${U}/widget.js"${I}`}),N=async()=>{m.value.fetch=!0;try{const U=await se.getApiKey(n.value);s.value=(U==null?void 0:U.apiKey)??null,g.value=!!(U!=null&&U.apiKeyEnabled),y.value=!0,p.value=!1}catch{i.error("获取 API Key 失败")}finally{m.value.fetch=!1}},T=async()=>{m.value.generate=!0;try{const U=await se.generateApiKey(n.value);s.value=U.apiKey,g.value=!!U.apiKeyEnabled,y.value=!1,p.value=!0,i.success("已生成 API Key")}catch{i.error("生成失败")}finally{m.value.generate=!1}},z=async()=>{if(!s.value){await T();return}m.value.reset=!0;try{const U=await se.resetApiKey(n.value);s.value=U.apiKey,g.value=!!U.apiKeyEnabled,y.value=!1,p.value=!0,i.success("已重置 API Key")}catch{i.error("重置失败")}finally{m.value.reset=!1}},S=async()=>{if(s.value){try{await Z.confirm("确认删除当前 API Key？删除后需重新生成。","提示",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"})}catch{return}m.value.delete=!0;try{const U=await se.deleteApiKey(n.value);s.value=U.apiKey,g.value=!!U.apiKeyEnabled,y.value=!0,p.value=!1,i.success("已删除 API Key")}catch{i.error("删除失败")}finally{m.value.delete=!1}}},$=async()=>{if(!p.value||!s.value){i.info("请重新生成或重置后复制完整 Key");return}await ze(s.value)?i.success("已复制到剪贴板"):i.error("复制失败，请手动复制")},w=()=>{s.value&&(y.value=!y.value)},B=async U=>{m.value.toggle=!0;try{const Q=await se.toggleApiKey(n.value,U);g.value=!!Q.apiKeyEnabled,s.value=Q.apiKey,y.value=!0,p.value=!1,i.success(U?"已启用 API Key":"已禁用 API Key")}catch{g.value=!U,i.error("切换失败")}finally{m.value.toggle=!1}},j=async()=>{await ze(F.value)?i.success("嵌入代码已复制到剪贴板"):i.error("复制失败，请手动复制")};return ve(()=>{N()}),{apiKey:s,apiKeyEnabled:g,masked:y,canCopy:p,loading:m,exampleTab:h,displayKey:c,curlExample:q,jsExample:C,pyExample:D,embedConfig:_,embedCode:F,handleGenerate:T,handleReset:z,handleDelete:S,handleCopy:$,handleToggle:B,toggleMask:w,handleCopyEmbedCode:j,DocumentCopy:tt}}}),ro={class:"access-api"},io={class:"section"},uo={class:"card"},po={class:"row"},mo={class:"row key-row"},co={class:"section"},go={class:"code"},fo={class:"code"},yo={class:"code"},vo={class:"embed-section"},bo={class:"embed-config"},wo={class:"embed-code-wrapper"},ho={class:"embed-code-header"},Co={class:"code"};function ko(t,e,n,s,g,y){const p=r("el-switch"),m=r("el-tag"),h=r("el-input"),_=r("el-button"),A=r("el-alert"),c=r("el-tab-pane"),q=r("el-form-item"),C=r("el-option"),D=r("el-select"),F=r("el-color-picker"),N=r("el-form"),T=r("DocumentCopy"),z=r("el-icon"),S=r("el-tabs");return v(),R("div",ro,[a("section",io,[e[13]||(e[13]=a("h3",null,"访问 API Key",-1)),e[14]||(e[14]=a("p",{class:"desc"},"为该智能体生成并管理 API Key，用于外部系统访问。",-1)),a("div",uo,[a("div",po,[e[8]||(e[8]=a("div",{class:"label"},"API Key 状态",-1)),l(p,{modelValue:t.apiKeyEnabled,"onUpdate:modelValue":e[0]||(e[0]=$=>t.apiKeyEnabled=$),disabled:!t.apiKey,"active-text":"已启用","inactive-text":"已禁用",onChange:t.handleToggle},null,8,["modelValue","disabled","onChange"]),t.apiKey?J("",!0):(v(),P(m,{key:0,type:"info",size:"small",class:"tag"},{default:o(()=>[...e[7]||(e[7]=[f("未生成",-1)])]),_:1}))]),a("div",mo,[e[12]||(e[12]=a("div",{class:"label"},"当前 Key",-1)),l(h,{modelValue:t.displayKey,"onUpdate:modelValue":e[1]||(e[1]=$=>t.displayKey=$),class:"key-input",readonly:"",placeholder:"尚未生成 API Key"},null,8,["modelValue"]),l(_,{type:"primary",onClick:t.handleGenerate,loading:t.loading.generate},{default:o(()=>[f(M(t.apiKey?"重新生成":"生成 Key"),1)]),_:1},8,["onClick","loading"]),l(_,{onClick:t.handleReset,disabled:!t.apiKey,loading:t.loading.reset},{default:o(()=>[...e[9]||(e[9]=[f(" 重置 ",-1)])]),_:1},8,["onClick","disabled","loading"]),l(_,{onClick:t.handleDelete,disabled:!t.apiKey,loading:t.loading.delete},{default:o(()=>[...e[10]||(e[10]=[f(" 删除 ",-1)])]),_:1},8,["onClick","disabled","loading"]),l(_,{onClick:t.handleCopy,disabled:!t.apiKey||!t.canCopy},{default:o(()=>[...e[11]||(e[11]=[f("复制",-1)])]),_:1},8,["onClick","disabled"]),l(_,{onClick:t.toggleMask,disabled:!t.apiKey},{default:o(()=>[f(M(t.masked?"显示":"隐藏"),1)]),_:1},8,["onClick","disabled"])]),!t.canCopy&&t.apiKey?(v(),P(A,{key:0,type:"info",closable:!1,"show-icon":"",title:"为安全起见，已生成/重置时才显示完整 Key，之后仅显示掩码。如需复制请重新生成/重置。"})):J("",!0)])]),a("section",co,[e[18]||(e[18]=a("h3",null,"调用示例",-1)),e[19]||(e[19]=a("p",{class:"desc"},"使用 `X-API-Key` 请求头调用会话接口。",-1)),l(S,{modelValue:t.exampleTab,"onUpdate:modelValue":e[6]||(e[6]=$=>t.exampleTab=$)},{default:o(()=>[l(c,{label:"curl",name:"curl"},{default:o(()=>[a("pre",go,[a("code",null,M(t.curlExample),1)])]),_:1}),l(c,{label:"JavaScript",name:"js"},{default:o(()=>[a("pre",fo,[a("code",null,M(t.jsExample),1)])]),_:1}),l(c,{label:"Python",name:"py"},{default:o(()=>[a("pre",yo,[a("code",null,M(t.pyExample),1)])]),_:1}),l(c,{label:"网页嵌入",name:"embed"},{default:o(()=>[a("div",vo,[e[17]||(e[17]=a("p",{class:"embed-desc"}," 在您的网站中添加以下代码，即可嵌入 AI 智能体聊天窗口。窗口将显示为页面右下角的浮动按钮。 ",-1)),a("div",bo,[l(N,{"label-width":"120px",size:"default"},{default:o(()=>[l(q,{label:"窗口标题"},{default:o(()=>[l(h,{modelValue:t.embedConfig.title,"onUpdate:modelValue":e[2]||(e[2]=$=>t.embedConfig.title=$),placeholder:"AI 助手"},null,8,["modelValue"])]),_:1}),l(q,{label:"按钮位置"},{default:o(()=>[l(D,{modelValue:t.embedConfig.position,"onUpdate:modelValue":e[3]||(e[3]=$=>t.embedConfig.position=$),style:{width:"100%"}},{default:o(()=>[l(C,{label:"右下角",value:"bottom-right"}),l(C,{label:"左下角",value:"bottom-left"})]),_:1},8,["modelValue"])]),_:1}),l(q,{label:"主题色"},{default:o(()=>[l(F,{modelValue:t.embedConfig.primaryColor,"onUpdate:modelValue":e[4]||(e[4]=$=>t.embedConfig.primaryColor=$)},null,8,["modelValue"])]),_:1}),l(q,{label:"欢迎消息"},{default:o(()=>[l(h,{modelValue:t.embedConfig.welcomeMessage,"onUpdate:modelValue":e[5]||(e[5]=$=>t.embedConfig.welcomeMessage=$),type:"textarea",rows:2,placeholder:"您好！我是 Audaque DataAgent AI 助手，有什么可以帮您的吗？"},null,8,["modelValue"])]),_:1})]),_:1})]),a("div",wo,[a("div",ho,[e[16]||(e[16]=a("span",null,"嵌入代码",-1)),l(_,{size:"small",onClick:t.handleCopyEmbedCode},{default:o(()=>[l(z,null,{default:o(()=>[l(T)]),_:1}),e[15]||(e[15]=f(" 复制代码 ",-1))]),_:1},8,["onClick"])]),a("pre",Co,[a("code",null,M(t.embedCode),1)])]),l(A,{type:"warning",closable:!1,"show-icon":"",title:"注意：请确保已生成并启用 API Key，否则嵌入的聊天窗口将无法正常工作。"})])]),_:1})]),_:1},8,["modelValue"])])])}const Vo=oe(so,[["render",ko],["__scopeId","data-v-4f41159d"]]),me="/api/datasource";class _o{async getAllDatasource(e,n){const s=new URLSearchParams;return e&&s.append("status",e),n&&s.append("type",n),(await E.get(`${me}${s.toString()?`?${s.toString()}`:""}`)).data}async getDatasourceById(e){var n;try{return(await E.get(`${me}/${e}`)).data}catch(s){if(E.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return null;throw s}}async getDatasourceTables(e){var n;try{return(await E.get(`${me}/${e}/tables`)).data}catch(s){if(E.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===400)return[];throw s}}async createDatasource(e){return(await E.post(me,e)).data}async updateDatasource(e,n){return(await E.put(`${me}/${e}`,n)).data}async deleteDatasource(e){return(await E.delete(`${me}/${e}`)).data}async testConnection(e){return(await E.post(`${me}/${e}/test`)).data}}const ce=new _o,ge=t=>`/api/agent/${t}/datasources`;class $o{async initSchema(e){try{return(await E.post(`${ge(e)}/init`)).data}catch(n){throw new Error(`初始化Schema失败: ${n}`)}}async getAgentDatasource(e){try{const n=await E.get(ge(String(e)));if(n.data.success)return n.data.data||[];throw new Error(n.data.message)}catch(n){throw new Error(`获取数据源列表失败: ${n}`)}}async getActiveAgentDatasource(e){try{const n=await E.get(ge(String(e))+"/active");if(n.data.success){if(n.data.data===void 0)throw new Error("后端错误");return n.data.data}throw new Error(n.data.message)}catch(n){throw new Error(`获取数据源列表失败: ${n}`)}}async addDatasourceToAgent(e,n){try{return(await E.post(`${ge(e)}/${n}`)).data}catch(s){throw new Error(`添加数据源失败: ${s}`)}}async removeDatasourceFromAgent(e,n){try{return(await E.delete(`${ge(e)}/${n}`)).data}catch(s){throw new Error(`移除数据源失败: ${s}`)}}async toggleDatasourceForAgent(e,n){try{return(await E.put(`${ge(e)}/toggle`,n)).data}catch(s){throw new Error(`切换数据源状态失败: ${s}`)}}async updateDatasourceTables(e,n){try{return(await E.post(`${ge(e)}/tables`,n)).data}catch(s){throw new Error(`更新数据源表列表失败: ${s}`)}}}const fe=new $o,we="/api/datasource";class Do{async getLogicalRelations(e){try{return(await E.get(`${we}/${e}/logical-relations`)).data.data||[]}catch(n){return console.error("Failed to get logical relations:",n),[]}}async addLogicalRelation(e,n){try{return(await E.post(`${we}/${e}/logical-relations`,n)).data.data||null}catch(s){throw console.error("Failed to add logical relation:",s),s}}async updateLogicalRelation(e,n,s){return(await E.put(`${we}/${e}/logical-relations/${n}`,s)).data}async deleteLogicalRelation(e,n){return(await E.delete(`${we}/${e}/logical-relations/${n}`)).data}async saveLogicalRelations(e,n){return(await E.put(`${we}/${e}/logical-relations`,n)).data}async getTableColumns(e,n){try{const s=await E.get(`${we}/${e}/tables/${n}/columns`);if(s.data.success)return s.data.data||[];throw new Error(s.data.message)}catch(s){return console.error("Failed to get table columns:",s),[]}}}const he=new Do,To=re({name:"AgentDataSourceConfig",props:{agentId:{type:Number,required:!0}},setup(t){const e=V([]),n=V(!1),s=V(!1),g=V("select"),y=V([]),p=V({port:3306}),m=V(null),h=V(!1),_=V({}),A=V({}),c=V({}),q=V({}),C=V({}),D=V([]),F=V(!1),N=V(null),T=V([]),z=V(null),S=V({sourceTableName:"",sourceColumnName:"",targetTableName:"",targetColumnName:"",relationType:"",description:""}),$=V([]),w=V([]),B=V([]),j=V(!1);Me(s,u=>{u&&(X(),p.value={port:3306})});const U=async()=>{m.value=null;try{const u=await fe.getAgentDatasource(t.agentId);D.value=u||[];const k=u||[];e.value=k.map(L=>{var ie;const W={...L.datasource};return W.status=L.isActive===1?"active":"inactive",L.selectTables&&((ie=L.datasource)!=null&&ie.id)&&(c.value[L.datasource.id]=[...L.selectTables]),W})}catch(u){i.error("加载当前智能体的数据源列表失败"),console.error("Failed to load datasource:",u)}},Q=u=>{u==null?m.value=null:m.value=u.id},X=async()=>{try{const u=await ce.getAllDatasource();y.value=u||[]}catch(u){i.error("加载所有数据源列表失败"),console.error("Failed to load all datasource:",u)}},K=async()=>{n.value=!0;try{try{const k=await fe.getActiveAgentDatasource(t.agentId);if(k.datasource==null&&k.datasourceId==null){i.warning("当前智能体没有启用的数据源！请添加一个新数据源，或者启用已有的数据源");return}else if(k.selectTables==null||k.selectTables.length===0){i.warning("当前启用的数据源没有选择相应的数据表！请点击相应数据源左侧按钮，选择相应数据表并更新！");return}}catch{i.warning("当前智能体没有启用的数据源！请添加一个新数据源，或者启用已有的数据源");return}const u=await fe.initSchema(t.agentId);if(u.success===void 0||u.success==null||!u.success)throw i.error("初始化数据源失败"),new Error("初始化数据源失败");i.success("初始化当前智能体的数据源成功")}catch(u){i.error("初始化当前智能体的数据源失败"),console.error("Failed to init datasource:",u)}finally{n.value=!1}},O=async(u,k)=>{const L=u.id;try{const W=await fe.toggleDatasourceForAgent(t.agentId,{datasourceId:L,isActive:k});W.success?(i.success("操作成功！"),u.status=k?"active":"inactive"):(i.error("操作失败！"),console.error("Failed to change datasource:",W))}catch(W){i.error("操作失败！"),console.error("Failed to change datasource:",W)}},I=async u=>{const k=u.id;try{const L=await ce.testConnection(k);L.success?(i.success("测试连接成功！"),u.testStatus="success"):(i.error("测试连接失败！"),console.error("Failed to test connection:",L),u.testStatus="fail")}catch(L){i.error("测试连接失败！"),console.error("Failed to test connection:",L),u.testStatus="fail"}},b=async u=>{const k=u.id;try{await Z.confirm("是否要删除当前数据源吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}catch{return}try{const L=await fe.removeDatasourceFromAgent(t.agentId,k);L.success?(i.success("移除成功！"),e.value=e.value.filter(W=>W.id!==k)):(i.error("移除失败！"),console.error("Failed to remove datasource:",L))}catch(L){i.error("移除失败！"),console.error("Failed to remove datasource:",L)}},H=async u=>{try{await fe.addDatasourceToAgent(t.agentId,u),await U(),i.success("添加数据源成功"),s.value=!1}catch(k){i.error("添加数据源失败"),console.error("Failed to add datasource:",k)}},x=async()=>{const u=m.value;if(u==null){i.warning("请选择一个数据源");return}await H(u)},d=u=>{const k=[];return(!u.name||u.name.trim()==="")&&k.push("数据源名称不能为空"),u.type||k.push("请选择数据源类型"),(!u.host||u.host.trim()==="")&&k.push("主机地址不能为空"),(!u.port||u.port<=0||u.port>65535)&&k.push("请输入有效的端口号（1-65535）"),(!u.databaseName||u.databaseName.trim()==="")&&k.push("数据库名不能为空"),(!u.username||u.username.trim()==="")&&k.push("用户名不能为空"),(!u.password||u.password.trim()==="")&&k.push("密码不能为空"),k},G=async()=>{const u=d(p.value);if(u.length>0){i.error(u.join(`\r
`));return}try{const L=(await ce.createDatasource(p.value)).id;if(L==null)throw new Error("创建数据源失败");await H(L)}catch(k){i.error("创建数据源失败"),console.error("Failed to create datasource:",k)}s.value=!1},Te=u=>{_.value=JSON.parse(JSON.stringify(u)),h.value=!0},$e=async()=>{const u=d(_.value);if(u.length>0){i.error(u.join(`
`));return}try{const k=await ce.updateDatasource(_.value.id,_.value);if(k&&k.id){i.success("修改成功！");const L=y.value.findIndex(W=>W.id===_.value.id);L>=0&&(y.value[L]=k),h.value=!1}else i.error("修改失败！"),console.error("Failed to update datasource:",k)}catch(k){i.error("修改失败！"),console.error("Failed to update datasource:",k)}},Se=async u=>{const k=u.id;try{await Z.confirm("删除后无法恢复，确定要删除该数据源吗？","确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{const L=await ce.deleteDatasource(k);L.success?(i.success("删除成功！"),y.value=y.value.filter(W=>W.id!==k)):(i.error("删除失败！"),console.error("Failed to delete datasource:",L))}catch(L){i.error("删除失败！"),console.error("Failed to delete datasource:",L)}},be=async u=>{if(u.id){q.value[u.id]=!0;try{const k=await ce.getDatasourceTables(u.id);if(A.value[u.id]=k,!c.value[u.id]){const L=D.value.find(W=>{var ie;return((ie=W.datasource)==null?void 0:ie.id)===u.id});c.value[u.id]=(L==null?void 0:L.selectTables)||[]}i.success(`成功加载 ${k.length} 个表`)}catch(k){i.error("加载表列表失败"),console.error("Failed to load datasource tables:",k)}finally{q.value[u.id]=!1}}},Be=async u=>{if(u.id){C.value[u.id]=!0;try{if((await fe.updateDatasourceTables(String(t.agentId),{datasourceId:u.id,tables:c.value[u.id]||[]})).success){i.success("数据表更新成功");const L=D.value.find(W=>{var ie;return((ie=W.datasource)==null?void 0:ie.id)===u.id});L&&(L.selectTables=[...c.value[u.id]||[]])}else i.error("数据表更新失败")}catch(k){i.error("数据表更新失败"),console.error("Failed to update datasource tables:",k)}finally{C.value[u.id]=!1}}},Oe=u=>{!u.id||!A.value[u.id]||(c.value[u.id]=[...A.value[u.id]])},Re=u=>{u.id&&(c.value[u.id]=[])},je=(u,k)=>!u||u.length<=k?u:u.substring(0,k)+"...",Je=(u,k)=>{k.includes(u)&&u.status==="active"&&u.id&&be(u)};ve(()=>{U()});const Qe=async u=>{if(!u.id){i.warning("数据源ID不存在");return}N.value=u,F.value=!0;try{$.value=await ce.getDatasourceTables(u.id)}catch(k){i.error("加载表列表失败"),console.error("Failed to load table list:",k)}await He(u.id),Ee()},He=async u=>{try{T.value=await he.getLogicalRelations(u)}catch(k){i.error("加载逻辑外键列表失败"),console.error("Failed to load logical relations:",k)}},Ge=async u=>{var k;if(!u||!((k=N.value)!=null&&k.id)){w.value=[],S.value.sourceColumnName="";return}try{w.value=await he.getTableColumns(N.value.id,u),S.value.sourceColumnName=""}catch(L){i.error("加载字段列表失败"),console.error("Failed to load source columns:",L)}},We=async u=>{var k;if(!u||!((k=N.value)!=null&&k.id)){B.value=[],S.value.targetColumnName="";return}try{B.value=await he.getTableColumns(N.value.id,u),S.value.targetColumnName=""}catch(L){i.error("加载字段列表失败"),console.error("Failed to load target columns:",L)}},Xe=async u=>{var k,L;if(z.value=u,S.value={id:u.id,datasourceId:u.datasourceId,sourceTableName:u.sourceTableName,sourceColumnName:u.sourceColumnName,targetTableName:u.targetTableName,targetColumnName:u.targetColumnName,relationType:u.relationType||"",description:u.description||""},u.sourceTableName&&((k=N.value)!=null&&k.id))try{w.value=await he.getTableColumns(N.value.id,u.sourceTableName)}catch(W){console.error("Failed to load source columns:",W)}if(u.targetTableName&&((L=N.value)!=null&&L.id))try{B.value=await he.getTableColumns(N.value.id,u.targetTableName)}catch(W){console.error("Failed to load target columns:",W)}i.info('正在编辑逻辑外键，修改后点击"更新"按钮')},Ye=async()=>{if(!S.value.sourceTableName||!S.value.sourceColumnName||!S.value.targetTableName||!S.value.targetColumnName){i.warning("请完整填写主表、字段、关联表和字段");return}if(T.value.some(k=>{var L;return k.id!==((L=z.value)==null?void 0:L.id)&&k.sourceTableName===S.value.sourceTableName&&k.sourceColumnName===S.value.sourceColumnName&&k.targetTableName===S.value.targetTableName&&k.targetColumnName===S.value.targetColumnName})){i.warning("该逻辑外键关系已存在");return}if(z.value&&z.value.id){const k=T.value.findIndex(L=>L.id===z.value.id);k!==-1&&(T.value[k]={...T.value[k],sourceTableName:S.value.sourceTableName,sourceColumnName:S.value.sourceColumnName,targetTableName:S.value.targetTableName,targetColumnName:S.value.targetColumnName,relationType:S.value.relationType||"",description:S.value.description||""}),i.success('更新成功，请点击"保存全部配置"以保存到数据库')}else T.value.push({sourceTableName:S.value.sourceTableName,sourceColumnName:S.value.sourceColumnName,targetTableName:S.value.targetTableName,targetColumnName:S.value.targetColumnName,relationType:S.value.relationType||"",description:S.value.description||""}),i.success('添加成功，请点击"保存全部配置"以保存到数据库');Ee()},Ze=async(u,k)=>{try{await Z.confirm("确定要删除这条逻辑外键关系吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),T.value.splice(k,1),i.success('删除成功，请点击"保存全部配置"以保存到数据库')}catch{}},xe=async()=>{var u;if(!((u=N.value)!=null&&u.id)){i.error("数据源ID不存在");return}j.value=!0;try{(await he.saveLogicalRelations(N.value.id,T.value)).success?(i.success("保存成功"),F.value=!1):i.error("保存失败")}catch(k){i.error("保存失败"),console.error("Failed to save logical relations:",k)}finally{j.value=!1}},Ee=()=>{z.value=null,S.value={sourceTableName:"",sourceColumnName:"",targetTableName:"",targetColumnName:"",relationType:"",description:""},w.value=[],B.value=[]};return{props:t,Plus:_e,UploadFilled:Ve,Loading:dt,FolderOpened:it,Lock:rt,datasource:e,initStatus:n,dialogVisible:s,dialogActiveName:g,allDatasource:y,newDatasource:p,editDialogVisible:h,editingDatasource:_,tableLists:A,selectedTables:c,tableLoadingStates:q,updateLoadingStates:C,initAgentDatasource:K,changeDatasource:O,testConnection:I,removeAgentDatasource:b,loadAllDatasource:X,addSelectDatasource:x,createNewDatasource:G,handleSelectDatasourceChange:Q,editDatasource:Te,saveEditDatasource:$e,deleteDatasource:Se,loadDatasourceTables:be,updateDatasourceTables:Be,selectAllTables:Oe,clearAllTables:Re,truncateText:je,handleExpandChange:Je,Connection:qe,Link:st,CirclePlus:nt,Check:at,Right:ot,Edit:Ke,foreignKeyDialogVisible:F,currentForeignKeyDatasource:N,foreignKeyList:T,newForeignKey:S,tableList:$,sourceColumnList:w,targetColumnList:B,savingForeignKeys:j,openForeignKeyDialog:Qe,handleSourceTableChange:Ge,handleTargetTableChange:We,editForeignKey:Xe,saveOrUpdateForeignKey:Ye,deleteForeignKey:Ze,saveForeignKeyConfig:xe,editingForeignKey:z}}}),So={style:{padding:"20px"}},Ao={style:{"margin-bottom":"30px"}},Fo={key:0,style:{padding:"20px",background:"#f8f9fa","border-radius":"8px"}},No={style:{"margin-bottom":"15px",display:"flex","justify-content":"space-between","align-items":"center"}},Io={key:0},Eo={style:{"margin-top":"20px","text-align":"right"}},zo={key:1,style:{"text-align":"center",padding:"20px"}},Uo={key:2,style:{"text-align":"center",padding:"20px",color:"#999"}},Ko={key:1,style:{padding:"20px","text-align":"center",color:"#999"}},Po={class:"connection-url-text"},Lo={style:{"text-align":"right"}},Mo={class:"form-item"},qo={class:"form-item"},Bo={class:"form-item"},Oo={class:"form-item"},Ro={class:"form-item"},jo={class:"form-item"},Jo={class:"form-item"},Qo={class:"form-item"},Ho={class:"form-item"},Go={style:{"text-align":"right"}},Wo={class:"form-item"},Xo={class:"form-item"},Yo={class:"form-item"},Zo={class:"form-item"},xo={class:"form-item"},ea={class:"form-item"},ta={class:"form-item"},la={class:"form-item"},oa={class:"form-item"},aa={style:{"text-align":"right"}},na={key:0},sa={style:{"margin-bottom":"20px",padding:"10px",background:"#f0f9ff","border-radius":"4px"}},ra={style:{margin:"0","font-size":"14px",color:"#666"}},ia={style:{"font-weight":"600",color:"#1890ff"}},da={style:{"margin-bottom":"30px"}},ua={style:{"font-family":"monospace",color:"#1890ff"}},pa={style:{"font-family":"monospace"}},ma={style:{color:"#999","margin-right":"4px"}},ca={style:{"font-family":"monospace"}},ga={style:{"font-family":"monospace",color:"#52c41a"}},fa={style:{"font-family":"monospace"}},ya={key:0,style:{"text-align":"center",padding:"40px",color:"#999",background:"#fafafa",border:"1px solid #e8e8e8","border-radius":"4px"}},va={style:{background:"#f0f9ff",padding:"20px","border-radius":"8px",border:"1px solid #bae7ff"}},ba={style:{"font-size":"14px","font-weight":"600",color:"#333","margin-bottom":"15px"}},wa={style:{"vertical-align":"middle"}},ha={style:{"text-align":"right"}};function Ca(t,e,n,s,g,y){const p=r("el-divider"),m=r("el-col"),h=r("el-button"),_=r("el-row"),A=r("el-checkbox"),c=r("el-checkbox-group"),q=r("Loading"),C=r("el-icon"),D=r("FolderOpened"),F=r("Lock"),N=r("el-table-column"),T=r("el-tooltip"),z=r("el-tag"),S=r("Connection"),$=r("el-table"),w=r("el-tab-pane"),B=r("el-input"),j=r("el-option"),U=r("el-select"),Q=r("el-input-number"),X=r("el-tabs"),K=r("el-dialog"),O=r("Link"),I=r("CirclePlus"),b=r("Edit"),H=r("Right"),x=r("Check");return v(),R(Y,null,[a("div",So,[e[50]||(e[50]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"数据源配置")],-1)),l(p),a("div",Ao,[l(_,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(m,{span:12},{default:o(()=>[...e[33]||(e[33]=[a("h3",null,"数据源列表",-1)])]),_:1}),l(m,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(h,{onClick:e[0]||(e[0]=d=>t.dialogVisible=!0),size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[34]||(e[34]=[f(" 添加数据源 ",-1)])]),_:1},8,["icon"]),t.initStatus?(v(),P(h,{key:1,size:"large",type:"primary",round:"",loading:""},{default:o(()=>[...e[36]||(e[36]=[f("初始化中...",-1)])]),_:1})):(v(),P(h,{key:0,onClick:t.initAgentDatasource,size:"large",type:"primary",round:"",icon:t.UploadFilled},{default:o(()=>[...e[35]||(e[35]=[f(" 初始化数据源 ",-1)])]),_:1},8,["onClick","icon"]))]),_:1})]),_:1})]),l($,{data:t.datasource,style:{width:"100%"},border:"",onExpandChange:t.handleExpandChange},{default:o(()=>[l(N,{type:"expand",width:"100",label:"选择数据表"},{default:o(d=>[d.row.status==="active"?(v(),R("div",Fo,[a("div",No,[e[38]||(e[38]=a("h4",{style:{margin:"0"}},"数据表管理",-1)),l(h,{onClick:G=>t.loadDatasourceTables(d.row),size:"small",type:"primary",loading:t.tableLoadingStates[d.row.id],round:""},{default:o(()=>[...e[37]||(e[37]=[f(" 刷新表列表 ",-1)])]),_:1},8,["onClick","loading"])]),t.tableLists[d.row.id]&&t.tableLists[d.row.id].length>0?(v(),R("div",Io,[l(c,{modelValue:t.selectedTables[d.row.id],"onUpdate:modelValue":G=>t.selectedTables[d.row.id]=G},{default:o(()=>[l(_,{gutter:10},{default:o(()=>[(v(!0),R(Y,null,ye(t.tableLists[d.row.id],G=>(v(),P(m,{key:G,span:6,style:{"margin-bottom":"10px"}},{default:o(()=>[l(A,{label:G,size:"large"},{default:o(()=>[f(M(G),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"]),a("div",Eo,[l(h,{onClick:G=>t.updateDatasourceTables(d.row),size:"small",type:"success",loading:t.updateLoadingStates[d.row.id],round:""},{default:o(()=>[...e[39]||(e[39]=[f(" 更新数据表 ",-1)])]),_:1},8,["onClick","loading"]),l(h,{onClick:G=>t.selectAllTables(d.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[40]||(e[40]=[f(" 全选 ",-1)])]),_:1},8,["onClick"]),l(h,{onClick:G=>t.clearAllTables(d.row),size:"small",type:"info",round:"",plain:""},{default:o(()=>[...e[41]||(e[41]=[f(" 清空 ",-1)])]),_:1},8,["onClick"])])])):t.tableLoadingStates[d.row.id]?(v(),R("div",zo,[l(C,{class:"is-loading",style:{"font-size":"24px"}},{default:o(()=>[l(q)]),_:1}),e[42]||(e[42]=a("div",{style:{"margin-top":"10px",color:"#666"}},"正在加载表列表...",-1))])):(v(),R("div",Uo,[l(C,{style:{"font-size":"24px"}},{default:o(()=>[l(D)]),_:1}),e[43]||(e[43]=a("div",{style:{"margin-top":"10px"}},"暂无表数据，请点击刷新表列表",-1))]))])):(v(),R("div",Ko,[l(C,{style:{"font-size":"24px"}},{default:o(()=>[l(F)]),_:1}),e[44]||(e[44]=a("div",{style:{"margin-top":"10px"}},"请先启用数据源以管理表",-1))]))]),_:1}),l(N,{prop:"name",label:"数据源名称","min-width":"120px"}),l(N,{prop:"type",label:"数据源类型","min-width":"100px"}),l(N,{prop:"connectionUrl",label:"连接地址","min-width":"200px"},{default:o(d=>[l(T,{content:d.row.connectionUrl,placement:"top",disabled:!d.row.connectionUrl||d.row.connectionUrl.length<=50},{default:o(()=>[a("span",Po,M(d.row.connectionUrl?t.truncateText(d.row.connectionUrl,50):"-"),1)]),_:2},1032,["content","disabled"])]),_:1}),l(N,{label:"连接状态","min-width":"50px"},{default:o(d=>[l(z,{type:d.row.testStatus==="success"?"success":"danger",round:""},{default:o(()=>[f(M(d.row.testStatus==="success"?"连接成功":"连接失败"),1)]),_:2},1032,["type"])]),_:1}),l(N,{label:"状态","min-width":"40px"},{default:o(d=>[l(z,{type:d.row.status==="active"?"success":"info",round:""},{default:o(()=>[f(M(d.row.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(N,{prop:"createTime",label:"创建时间","min-width":"100px"}),l(N,{label:"操作","min-width":"120px"},{default:o(d=>[d.row.status==="active"?(v(),P(h,{key:0,onClick:G=>t.changeDatasource(d.row,!1),size:"small",type:"warning",round:"",plain:""},{default:o(()=>[...e[45]||(e[45]=[f(" 禁用 ",-1)])]),_:1},8,["onClick"])):(v(),P(h,{key:1,onClick:G=>t.changeDatasource(d.row,!0),size:"small",type:"success",round:"",plain:""},{default:o(()=>[...e[46]||(e[46]=[f(" 启用 ",-1)])]),_:1},8,["onClick"])),l(h,{onClick:G=>t.testConnection(d.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[47]||(e[47]=[f(" 测试连接 ",-1)])]),_:1},8,["onClick"]),l(h,{onClick:G=>t.openForeignKeyDialog(d.row),size:"small",type:"success",round:"",plain:""},{default:o(()=>[l(C,{style:{"margin-right":"4px"}},{default:o(()=>[l(S)]),_:1}),e[48]||(e[48]=f(" 逻辑外键配置 ",-1))]),_:1},8,["onClick"]),l(h,{onClick:G=>t.removeAgentDatasource(d.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[49]||(e[49]=[f(" 移除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","onExpandChange"])]),l(K,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[13]||(e[13]=d=>t.dialogVisible=d),title:"添加数据源",width:"1000"},{default:o(()=>[l(X,{modelValue:t.dialogActiveName,"onUpdate:modelValue":e[12]||(e[12]=d=>t.dialogActiveName=d),type:"card",stretch:""},{default:o(()=>[l(w,{label:"选择已有数据源",name:"select"},{default:o(()=>[l($,{onCurrentChange:t.handleSelectDatasourceChange,data:t.allDatasource,"highlight-current-row":"",style:{width:"100%"}},{default:o(()=>[l(N,{property:"name",label:"数据源名称",width:"150"}),l(N,{property:"type",label:"数据源类型",width:"100"}),l(N,{property:"host",label:"Host",width:"100"}),l(N,{property:"port",label:"Port",width:"80"}),l(N,{property:"description",label:"描述",width:"300"}),l(N,{label:"操作",width:"150"},{default:o(d=>[l(h,{onClick:G=>t.editDatasource(d.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[51]||(e[51]=[f(" 修改 ",-1)])]),_:1},8,["onClick"]),l(h,{onClick:G=>t.deleteDatasource(d.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[52]||(e[52]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["onCurrentChange","data"]),l(p),a("div",Lo,[l(h,{onClick:e[1]||(e[1]=d=>t.dialogVisible=!1)},{default:o(()=>[...e[53]||(e[53]=[f("取消",-1)])]),_:1}),l(h,{type:"primary",onClick:t.addSelectDatasource},{default:o(()=>[...e[54]||(e[54]=[f("添加选中数据源",-1)])]),_:1},8,["onClick"])])]),_:1}),l(w,{label:"添加新数据源",name:"add"},{default:o(()=>[l(_,{gutter:20},{default:o(()=>[l(m,{span:12},{default:o(()=>[a("div",Mo,[e[55]||(e[55]=a("label",null,"数据源名称 *",-1)),l(B,{modelValue:t.newDatasource.name,"onUpdate:modelValue":e[2]||(e[2]=d=>t.newDatasource.name=d),placeholder:"请输入数据源名称",size:"large"},null,8,["modelValue"])])]),_:1}),l(m,{span:12},{default:o(()=>[a("div",qo,[e[56]||(e[56]=a("label",null,"数据源类型 *",-1)),l(U,{modelValue:t.newDatasource.type,"onUpdate:modelValue":e[3]||(e[3]=d=>t.newDatasource.type=d),placeholder:"请选择数据源类型",style:{width:"100%"},size:"large"},{default:o(()=>[l(j,{key:"mysql",label:"MySQL",value:"mysql"}),l(j,{key:"postgresql",label:"PostgreSQL",value:"postgresql"}),l(j,{key:"sqlserver",label:"SQL Server",value:"sqlserver"}),l(j,{key:"dameng",label:"达梦(Dameng)",value:"dameng"})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(m,{span:12},{default:o(()=>[a("div",Bo,[e[57]||(e[57]=a("label",null,"主机地址 *",-1)),l(B,{modelValue:t.newDatasource.host,"onUpdate:modelValue":e[4]||(e[4]=d=>t.newDatasource.host=d),placeholder:"例如：localhost 或 192.168.1.100",size:"large"},null,8,["modelValue"])])]),_:1}),l(m,{span:12},{default:o(()=>[a("div",Oo,[e[58]||(e[58]=a("label",null,"端口号 *",-1)),l(Q,{modelValue:t.newDatasource.port,"onUpdate:modelValue":e[5]||(e[5]=d=>t.newDatasource.port=d),min:0,max:65535,size:"large",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(m,null,{default:o(()=>[a("div",Ro,[e[59]||(e[59]=a("label",null,"数据库名 *",-1)),l(B,{modelValue:t.newDatasource.databaseName,"onUpdate:modelValue":e[6]||(e[6]=d=>t.newDatasource.databaseName=d),placeholder:"请输入数据库（schema）名称",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(m,null,{default:o(()=>[a("div",jo,[e[60]||(e[60]=a("label",null,"连接地址",-1)),l(B,{modelValue:t.newDatasource.connectionUrl,"onUpdate:modelValue":e[7]||(e[7]=d=>t.newDatasource.connectionUrl=d),placeholder:"请输入JDBC地址（若不填则自动生成）",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(m,{span:12},{default:o(()=>[a("div",Jo,[e[61]||(e[61]=a("label",null,"用户名 *",-1)),l(B,{modelValue:t.newDatasource.username,"onUpdate:modelValue":e[8]||(e[8]=d=>t.newDatasource.username=d),placeholder:"请输入数据库用户名",size:"large"},null,8,["modelValue"])])]),_:1}),l(m,{span:12},{default:o(()=>[a("div",Qo,[e[62]||(e[62]=a("label",null,"密码 *",-1)),l(B,{modelValue:t.newDatasource.password,"onUpdate:modelValue":e[9]||(e[9]=d=>t.newDatasource.password=d),placeholder:"请输入数据库密码",size:"large","show-password":""},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:30},{default:o(()=>[l(m,{span:24},{default:o(()=>[a("div",Ho,[e[63]||(e[63]=a("label",null,"描述",-1)),l(B,{modelValue:t.newDatasource.description,"onUpdate:modelValue":e[10]||(e[10]=d=>t.newDatasource.description=d),rows:4,type:"textarea",placeholder:"请输入数据源描述（可选）",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(p),a("div",Go,[l(h,{onClick:e[11]||(e[11]=d=>t.dialogVisible=!1)},{default:o(()=>[...e[64]||(e[64]=[f("取消",-1)])]),_:1}),l(h,{type:"primary",onClick:t.createNewDatasource},{default:o(()=>[...e[65]||(e[65]=[f("创建并添加",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),l(K,{modelValue:t.editDialogVisible,"onUpdate:modelValue":e[24]||(e[24]=d=>t.editDialogVisible=d),title:"编辑数据源",width:"1000"},{default:o(()=>[l(_,{gutter:20},{default:o(()=>[l(m,{span:12},{default:o(()=>[a("div",Wo,[e[66]||(e[66]=a("label",null,"数据源名称 *",-1)),l(B,{modelValue:t.editingDatasource.name,"onUpdate:modelValue":e[14]||(e[14]=d=>t.editingDatasource.name=d),placeholder:"请输入数据源名称",size:"large"},null,8,["modelValue"])])]),_:1}),l(m,{span:12},{default:o(()=>[a("div",Xo,[e[67]||(e[67]=a("label",null,"数据源类型 *",-1)),l(U,{modelValue:t.editingDatasource.type,"onUpdate:modelValue":e[15]||(e[15]=d=>t.editingDatasource.type=d),placeholder:"请选择数据源类型",style:{width:"100%"},size:"large"},{default:o(()=>[l(j,{key:"mysql",label:"MySQL",value:"mysql"}),l(j,{key:"postgresql",label:"PostgreSQL",value:"postgresql"}),l(j,{key:"dameng",label:"达梦(Dameng)",value:"dameng"})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(m,{span:12},{default:o(()=>[a("div",Yo,[e[68]||(e[68]=a("label",null,"主机地址 *",-1)),l(B,{modelValue:t.editingDatasource.host,"onUpdate:modelValue":e[16]||(e[16]=d=>t.editingDatasource.host=d),placeholder:"例如：localhost 或 192.168.1.100",size:"large"},null,8,["modelValue"])])]),_:1}),l(m,{span:12},{default:o(()=>[a("div",Zo,[e[69]||(e[69]=a("label",null,"端口号 *",-1)),l(Q,{modelValue:t.editingDatasource.port,"onUpdate:modelValue":e[17]||(e[17]=d=>t.editingDatasource.port=d),min:0,max:65535,size:"large",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(m,null,{default:o(()=>[a("div",xo,[e[70]||(e[70]=a("label",null,"数据库名 *",-1)),l(B,{modelValue:t.editingDatasource.databaseName,"onUpdate:modelValue":e[18]||(e[18]=d=>t.editingDatasource.databaseName=d),placeholder:"请输入数据库（schema）名称",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(m,null,{default:o(()=>[a("div",ea,[e[71]||(e[71]=a("label",null,"连接地址",-1)),l(B,{modelValue:t.editingDatasource.connectionUrl,"onUpdate:modelValue":e[19]||(e[19]=d=>t.editingDatasource.connectionUrl=d),placeholder:"请输入JDBC地址（若不填则自动生成）",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(m,{span:12},{default:o(()=>[a("div",ta,[e[72]||(e[72]=a("label",null,"用户名 *",-1)),l(B,{modelValue:t.editingDatasource.username,"onUpdate:modelValue":e[20]||(e[20]=d=>t.editingDatasource.username=d),placeholder:"请输入数据库用户名",size:"large"},null,8,["modelValue"])])]),_:1}),l(m,{span:12},{default:o(()=>[a("div",la,[e[73]||(e[73]=a("label",null,"密码 *",-1)),l(B,{modelValue:t.editingDatasource.password,"onUpdate:modelValue":e[21]||(e[21]=d=>t.editingDatasource.password=d),placeholder:"请输入数据库密码",size:"large","show-password":""},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:30},{default:o(()=>[l(m,{span:24},{default:o(()=>[a("div",oa,[e[74]||(e[74]=a("label",null,"描述",-1)),l(B,{modelValue:t.editingDatasource.description,"onUpdate:modelValue":e[22]||(e[22]=d=>t.editingDatasource.description=d),rows:4,type:"textarea",placeholder:"请输入数据源描述（可选）",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(p),a("div",aa,[l(h,{onClick:e[23]||(e[23]=d=>t.editDialogVisible=!1)},{default:o(()=>[...e[75]||(e[75]=[f("取消",-1)])]),_:1}),l(h,{type:"primary",onClick:t.saveEditDatasource},{default:o(()=>[...e[76]||(e[76]=[f("保存修改",-1)])]),_:1},8,["onClick"])])]),_:1},8,["modelValue"]),l(K,{modelValue:t.foreignKeyDialogVisible,"onUpdate:modelValue":e[32]||(e[32]=d=>t.foreignKeyDialogVisible=d),title:"逻辑外键配置",width:"900px","close-on-click-modal":!1},{footer:o(()=>[a("div",ha,[l(h,{onClick:e[31]||(e[31]=d=>t.foreignKeyDialogVisible=!1),size:"large"},{default:o(()=>[...e[87]||(e[87]=[f("取消",-1)])]),_:1}),l(h,{type:"primary",onClick:t.saveForeignKeyConfig,size:"large",loading:t.savingForeignKeys},{default:o(()=>[...e[88]||(e[88]=[f(" 保存全部配置 ",-1)])]),_:1},8,["onClick","loading"])])]),default:o(()=>[t.currentForeignKeyDatasource?(v(),R("div",na,[a("div",sa,[a("p",ra,[e[77]||(e[77]=f(" 当前配置数据源： ",-1)),a("span",ia,M(t.currentForeignKeyDatasource.name),1)])]),a("div",da,[e[81]||(e[81]=a("h4",{style:{"font-size":"14px","font-weight":"600",color:"#333","margin-bottom":"15px","border-left":"4px solid #1890ff","padding-left":"10px"}}," 已生效的逻辑外键 (Logical Foreign Keys) ",-1)),l($,{data:t.foreignKeyList,border:"",style:{width:"100%"},size:"small"},{default:o(()=>[l(N,{prop:"sourceTableName",label:"主表 (Source)","min-width":"100px"},{default:o(d=>[a("span",ua,M(d.row.sourceTableName),1)]),_:1}),l(N,{prop:"sourceColumnName",label:"字段","min-width":"80px"},{default:o(d=>[a("span",pa,M(d.row.sourceColumnName),1)]),_:1}),l(N,{label:"关系类型","min-width":"90px",align:"center"},{default:o(d=>[a("span",ma,[l(C,null,{default:o(()=>[l(O)]),_:1})]),a("span",ca,M(d.row.relationType||"-"),1)]),_:1}),l(N,{prop:"targetTableName",label:"关联表 (Target)","min-width":"100px"},{default:o(d=>[a("span",ga,M(d.row.targetTableName),1)]),_:1}),l(N,{prop:"targetColumnName",label:"字段","min-width":"80px"},{default:o(d=>[a("span",fa,M(d.row.targetColumnName),1)]),_:1}),l(N,{prop:"description",label:"描述","min-width":"120px"}),l(N,{label:"操作",width:"140px",align:"right"},{default:o(d=>[l(h,{onClick:G=>t.editForeignKey(d.row),size:"small",type:"primary",link:""},{default:o(()=>[...e[78]||(e[78]=[f(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(h,{onClick:G=>t.deleteForeignKey(d.row,d.$index),size:"small",type:"danger",link:""},{default:o(()=>[...e[79]||(e[79]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),!t.foreignKeyList||t.foreignKeyList.length===0?(v(),R("div",ya,[l(C,{style:{"font-size":"32px","margin-bottom":"10px"}},{default:o(()=>[l(D)]),_:1}),e[80]||(e[80]=a("div",null,"暂无逻辑外键配置",-1))])):J("",!0)]),a("div",va,[a("h4",ba,[l(C,{style:{"margin-right":"6px","vertical-align":"middle",color:"#1890ff"}},{default:o(()=>[t.editingForeignKey?(v(),P(b,{key:1})):(v(),P(I,{key:0}))]),_:1}),a("span",wa,M(t.editingForeignKey?"编辑关联关系":"新增关联关系"),1)]),l(_,{gutter:10},{default:o(()=>[l(m,{span:5},{default:o(()=>[e[82]||(e[82]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}}," 主表 (Left Table) ")],-1)),l(U,{modelValue:t.newForeignKey.sourceTableName,"onUpdate:modelValue":e[25]||(e[25]=d=>t.newForeignKey.sourceTableName=d),placeholder:"请选择表...",style:{width:"100%"},size:"large",onChange:t.handleSourceTableChange,clearable:"",filterable:""},{default:o(()=>[(v(!0),R(Y,null,ye(t.tableList,d=>(v(),P(j,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(m,{span:4},{default:o(()=>[e[83]||(e[83]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}},"字段")],-1)),l(U,{modelValue:t.newForeignKey.sourceColumnName,"onUpdate:modelValue":e[26]||(e[26]=d=>t.newForeignKey.sourceColumnName=d),placeholder:"先选表",style:{width:"100%"},size:"large",disabled:!t.newForeignKey.sourceTableName,clearable:"",filterable:""},{default:o(()=>[(v(!0),R(Y,null,ye(t.sourceColumnList,d=>(v(),P(j,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(m,{span:1,style:{"text-align":"center","line-height":"70px"}},{default:o(()=>[l(C,{color:"#999",size:20},{default:o(()=>[l(H)]),_:1})]),_:1}),l(m,{span:5},{default:o(()=>[e[84]||(e[84]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}}," 关联表 (Right Table) ")],-1)),l(U,{modelValue:t.newForeignKey.targetTableName,"onUpdate:modelValue":e[27]||(e[27]=d=>t.newForeignKey.targetTableName=d),placeholder:"请选择表...",style:{width:"100%"},size:"large",onChange:t.handleTargetTableChange,clearable:"",filterable:""},{default:o(()=>[(v(!0),R(Y,null,ye(t.tableList,d=>(v(),P(j,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(m,{span:4},{default:o(()=>[e[85]||(e[85]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}},"字段")],-1)),l(U,{modelValue:t.newForeignKey.targetColumnName,"onUpdate:modelValue":e[28]||(e[28]=d=>t.newForeignKey.targetColumnName=d),placeholder:"先选表",style:{width:"100%"},size:"large",disabled:!t.newForeignKey.targetTableName,clearable:"",filterable:""},{default:o(()=>[(v(!0),R(Y,null,ye(t.targetColumnList,d=>(v(),P(j,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(m,{span:5,style:{"line-height":"70px"}},{default:o(()=>[l(h,{onClick:t.saveOrUpdateForeignKey,type:"primary",size:"large",style:{width:"100%"}},{default:o(()=>[l(C,{style:{"margin-right":"4px"}},{default:o(()=>[l(x)]),_:1}),f(" "+M(t.editingForeignKey?"更新":"添加"),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),l(_,{style:{"margin-top":"10px"}},{default:o(()=>[l(m,{span:24},{default:o(()=>[e[86]||(e[86]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}}," 关系类型 (Relation Type) ")],-1)),l(U,{modelValue:t.newForeignKey.relationType,"onUpdate:modelValue":e[29]||(e[29]=d=>t.newForeignKey.relationType=d),placeholder:"选择关系类型（可选）",size:"large",clearable:"",style:{width:"100%"}},{default:o(()=>[l(j,{label:"1:1 (一对一)",value:"1:1"}),l(j,{label:"1:N (一对多)",value:"1:N"}),l(j,{label:"N:1 (多对一)",value:"N:1"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(_,{style:{"margin-top":"10px"}},{default:o(()=>[l(m,{span:24},{default:o(()=>[l(B,{modelValue:t.newForeignKey.description,"onUpdate:modelValue":e[30]||(e[30]=d=>t.newForeignKey.description=d),placeholder:"描述（可选）：例如 '订单关联用户'，帮助 LLM 理解语义",size:"large",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})])])):J("",!0)]),_:1},8,["modelValue"])],64)}const ka=oe(To,[["render",Ca]]),ae="/api/agent-knowledge";class Va{async queryByPage(e){return(await E.post(`${ae}/query/page`,e)).data}async listByAgentId(e,n,s,g){const y={};return n&&(y.type=n),s&&(y.status=s),g&&(y.keyword=g),(await E.get(`${ae}/agent/${e}`,{params:y})).data.data}async getById(e){var n;try{return(await E.get(`${ae}/${e}`)).data.data}catch(s){if(E.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return null;throw s}}async create(e){return(await E.post(`${ae}/create`,e)).data.data}async update(e,n){var s;try{return(await E.put(`${ae}/${e}`,n)).data.data}catch(g){if(E.isAxiosError(g)&&((s=g.response)==null?void 0:s.status)===404)return null;throw g}}async updateRecallStatus(e,n){try{return(await E.put(`${ae}/recall/${e}`,null,{params:{isRecall:n}})).data.data}catch(s){return console.error("Failed to update recall status:",s),null}}async delete(e){var n;try{return await E.delete(`${ae}/${e}`),!0}catch(s){if(E.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return!1;throw s}}async retryEmbedding(e){try{return(await E.post(`${ae}/retry-embedding/${e}`)).data.success}catch(n){return console.error("Failed to retry embedding:",n),!1}}async getStatistics(e){return(await E.get(`${ae}/statistics/${e}`)).data.data}}const ke=new Va,_a=re({name:"AgentKnowledgeConfig",components:{Search:Ce,Warning:Ne,UploadFilled:Ve},props:{agentId:{type:Number,required:!0}},setup(t){const e=V([]),n=V(0),s=V(!1),g=V(!1),y=V(!1),p=V(!1),m=V(null),h=V([]),_=V(!1),A=ut({agentId:t.agentId,title:"",type:"",embeddingStatus:"",pageNum:1,pageSize:10}),c=V({agentId:t.agentId,title:"",content:"",type:"DOCUMENT",isRecall:!0,question:"",answer:""}),q=()=>{_.value=!_.value},C=()=>{A.type="",A.embeddingStatus="",F()},D=async()=>{s.value=!0;try{const I={...A,type:A.type?A.type:"",embeddingStatus:A.embeddingStatus?A.embeddingStatus:""},b=await ke.queryByPage(I);b.success?(e.value=b.data,n.value=b.total):i.error(b.message||"加载知识列表失败")}catch(I){i.error("加载知识列表失败"),console.error("Failed to load knowledge list:",I)}finally{s.value=!1}},F=()=>{A.pageNum=1,D()},N=I=>{A.pageSize=I,D()},T=I=>{A.pageNum=I,D()},z=()=>{y.value=!1,g.value=!0,O()},S=()=>{g.value=!1,O()},$=I=>{y.value=!0,m.value=I.id||null,c.value={...I,type:I.type},(I.type==="QA"||I.type==="FAQ")&&(c.value.answer=I.content),g.value=!0},w=I=>{if(!I.id)return;const b=!I.isRecall,H=b?"召回":"取消召回";Z.confirm(`确定要${H}知识 "${I.title}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ke.updateRecallStatus(I.id,b)?(I.isRecall=b,i.success(`${H}成功`)):i.error(`${H}失败`)}catch(x){i.error(`${H}失败`),console.error(`Failed to ${H} knowledge:`,x)}}).catch(()=>{})},B=async I=>{if(I.id)try{await ke.retryEmbedding(I.id)?(i.success("重试请求已发送"),D()):i.error("重试失败")}catch{i.error("重试失败")}},j=I=>{I.id&&Z.confirm(`确定要删除知识 "${I.title}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ke.delete(I.id)?(i.success("删除成功"),await D()):i.error("删除失败")}catch(b){i.error("删除失败"),console.error("Failed to delete knowledge:",b)}}).catch(()=>{})},U=()=>{c.value.content="",c.value.question="",c.value.answer="",h.value=[]},Q=I=>{h.value=[I],c.value.file=I.raw},X=I=>{if(!I)return"0 B";const b=1024,H=["B","KB","MB","GB"],x=Math.floor(Math.log(I)/Math.log(b));return Math.round(I/Math.pow(b,x)*100)/100+" "+H[x]},K=async()=>{var I;if(!c.value.title||!c.value.title.trim()){i.warning("请输入知识标题");return}if(c.value.type==="DOCUMENT"){if(!y.value&&!c.value.file&&h.value.length===0){i.warning("请上传文件");return}}else if(c.value.type==="QA"||c.value.type==="FAQ"){if(!c.value.question||!c.value.question.trim()){i.warning("请输入问题");return}if(!c.value.answer||!c.value.answer.trim()){i.warning("请输入答案");return}c.value.content=c.value.answer}p.value=!0;try{if(y.value&&m.value){const b={...c.value,type:(I=c.value.type)==null?void 0:I.toUpperCase()};if(await ke.update(m.value,b))i.success("更新成功");else{i.error("更新失败");return}}else{const b=new FormData;b.append("agentId",String(c.value.agentId)),b.append("title",c.value.title),b.append("type",c.value.type||"DOCUMENT"),b.append("isRecall",c.value.isRecall?"1":"0"),c.value.type==="DOCUMENT"&&c.value.file?b.append("file",c.value.file):(c.value.content&&b.append("content",c.value.content),c.value.question&&b.append("question",c.value.question));const H=await E.post("/api/agent-knowledge/create",b,{headers:{"Content-Type":"multipart/form-data"}});if(H.data.success)i.success("创建成功");else{i.error(H.data.message||"创建失败");return}}g.value=!1,await D()}catch(b){i.error(`${y.value?"更新":"创建"}失败`),console.error("Failed to save knowledge:",b)}finally{p.value=!1}},O=()=>{c.value={agentId:t.agentId,title:"",content:"",type:"DOCUMENT",isRecall:!0,question:"",answer:""},m.value=null,h.value=[]};return ve(()=>{D()}),{Plus:_e,Search:Ce,FilterIcon:mt,RefreshLeft:pt,UploadFilled:Ve,Warning:Ne,knowledgeList:e,total:n,loading:s,dialogVisible:g,isEdit:y,saveLoading:p,queryParams:A,knowledgeForm:c,fileList:h,filterVisible:_,toggleFilter:q,clearFilters:C,loadKnowledgeList:D,handleSearch:F,handleSizeChange:N,handleCurrentChange:T,openCreateDialog:z,closeDialog:S,editKnowledge:$,deleteKnowledge:j,saveKnowledge:K,resetForm:O,handleTypeChange:U,handleFileChange:Q,toggleStatus:w,handleRetry:B,formatFileSize:X}}}),$a={style:{padding:"20px"}},Da={style:{"margin-bottom":"30px"}},Ta={style:{"margin-bottom":"20px"}},Sa={key:0},Aa={key:1},Fa={key:2},Na={key:3},Ia={style:{display:"flex","align-items":"center"}},Ea={key:1},za={style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},Ua={key:0,style:{width:"100%"}},Ka={key:0,class:"el-upload__tip",style:{color:"#409eff"}},Pa={key:1},La={style:{"text-align":"right"}};function Ma(t,e,n,s,g,y){const p=r("el-divider"),m=r("el-col"),h=r("Search"),_=r("el-icon"),A=r("el-input"),c=r("el-button"),q=r("el-row"),C=r("el-option"),D=r("el-select"),F=r("el-form-item"),N=r("el-form"),T=r("el-card"),z=r("el-collapse-transition"),S=r("el-table-column"),$=r("el-tag"),w=r("Warning"),B=r("el-tooltip"),j=r("el-table"),U=r("el-pagination"),Q=r("el-alert"),X=r("UploadFilled"),K=r("el-upload"),O=r("el-dialog"),I=ct("loading");return v(),R(Y,null,[a("div",$a,[e[19]||(e[19]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"智能体知识库"),a("p",{style:{color:"#909399","font-size":"14px","margin-top":"5px"}}," 管理用于增强智能体能力的知识源。 ")],-1)),l(p),a("div",Da,[l(q,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(m,{span:12},{default:o(()=>[...e[10]||(e[10]=[a("h3",null,"知识列表",-1)])]),_:1}),l(m,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(A,{modelValue:t.queryParams.title,"onUpdate:modelValue":e[0]||(e[0]=b=>t.queryParams.title=b),placeholder:"请输入知识标题搜索",style:{width:"400px","margin-right":"10px"},clearable:"",onClear:t.handleSearch,onKeyup:Ie(t.handleSearch,["enter"]),size:"large"},{prefix:o(()=>[l(_,null,{default:o(()=>[l(h)]),_:1})]),_:1},8,["modelValue","onClear","onKeyup"]),l(c,{onClick:t.toggleFilter,size:"large",type:t.filterVisible?"primary":"",round:"",icon:t.FilterIcon},{default:o(()=>[...e[11]||(e[11]=[f(" 筛选 ",-1)])]),_:1},8,["onClick","type","icon"]),l(c,{onClick:t.openCreateDialog,size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[12]||(e[12]=[f(" 添加知识 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1})]),l(z,null,{default:o(()=>[le(a("div",Ta,[l(T,{shadow:"never"},{default:o(()=>[l(N,{inline:!0,model:t.queryParams},{default:o(()=>[l(F,{label:"知识类型"},{default:o(()=>[l(D,{modelValue:t.queryParams.type,"onUpdate:modelValue":e[1]||(e[1]=b=>t.queryParams.type=b),placeholder:"全部类型",clearable:"",onChange:t.handleSearch,style:{width:"150px"}},{default:o(()=>[l(C,{label:"文档",value:"DOCUMENT"}),l(C,{label:"问答对",value:"QA"}),l(C,{label:"常见问题",value:"FAQ"})]),_:1},8,["modelValue","onChange"])]),_:1}),l(F,{label:"处理状态"},{default:o(()=>[l(D,{modelValue:t.queryParams.embeddingStatus,"onUpdate:modelValue":e[2]||(e[2]=b=>t.queryParams.embeddingStatus=b),placeholder:"全部状态",clearable:"",onChange:t.handleSearch,style:{width:"150px"}},{default:o(()=>[l(C,{label:"COMPLETED",value:"COMPLETED"}),l(C,{label:"PROCESSING",value:"PROCESSING"}),l(C,{label:"FAILED",value:"FAILED"}),l(C,{label:"PENDING",value:"PENDING"})]),_:1},8,["modelValue","onChange"])]),_:1}),l(F,null,{default:o(()=>[l(c,{onClick:t.clearFilters,icon:t.RefreshLeft},{default:o(()=>[...e[13]||(e[13]=[f("清空筛选",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1},8,["model"])]),_:1})],512),[[gt,t.filterVisible]])]),_:1}),le((v(),P(j,{data:t.knowledgeList,style:{width:"100%"},border:""},{default:o(()=>[l(S,{prop:"title",label:"标题","min-width":"150px"}),l(S,{prop:"type",label:"类型","min-width":"100px"},{default:o(b=>[b.row.type==="DOCUMENT"?(v(),R("span",Sa,"文档")):b.row.type==="QA"?(v(),R("span",Aa,"问答对")):b.row.type==="FAQ"?(v(),R("span",Fa,"常见问题")):(v(),R("span",Na,M(b.row.type),1))]),_:1}),l(S,{label:"处理状态","min-width":"120px"},{default:o(b=>[b.row.embeddingStatus==="COMPLETED"?(v(),P($,{key:0,type:"success",round:""},{default:o(()=>[f(M(b.row.embeddingStatus),1)]),_:2},1024)):b.row.embeddingStatus==="PROCESSING"?(v(),P($,{key:1,type:"primary",round:""},{default:o(()=>[f(M(b.row.embeddingStatus),1)]),_:2},1024)):b.row.embeddingStatus==="FAILED"?(v(),P($,{key:2,type:"danger",round:""},{default:o(()=>[b.row.errorMsg?(v(),P(B,{key:0,content:b.row.errorMsg,placement:"top"},{default:o(()=>[a("span",Ia,[l(_,{style:{"margin-right":"4px"}},{default:o(()=>[l(w)]),_:1}),f(" "+M(b.row.embeddingStatus),1)])]),_:2},1032,["content"])):(v(),R("span",Ea,M(b.row.embeddingStatus),1))]),_:2},1024)):(v(),P($,{key:3,type:"info",round:""},{default:o(()=>[f(M(b.row.embeddingStatus),1)]),_:2},1024))]),_:1}),l(S,{label:"召回状态","min-width":"100px"},{default:o(b=>[l($,{type:b.row.isRecall?"success":"info",round:""},{default:o(()=>[f(M(b.row.isRecall?"已召回":"未召回"),1)]),_:2},1032,["type"])]),_:1}),l(S,{label:"操作","min-width":"280px"},{default:o(b=>[l(c,{onClick:H=>t.editKnowledge(b.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[14]||(e[14]=[f(" 管理 ",-1)])]),_:1},8,["onClick"]),b.row.embeddingStatus==="FAILED"?(v(),P(c,{key:0,onClick:H=>t.handleRetry(b.row),size:"small",type:"info",round:"",plain:""},{default:o(()=>[...e[15]||(e[15]=[f(" 重试 ",-1)])]),_:1},8,["onClick"])):J("",!0),b.row.isRecall?(v(),P(c,{key:1,onClick:H=>t.toggleStatus(b.row),size:"small",type:"warning",round:"",plain:""},{default:o(()=>[...e[16]||(e[16]=[f(" 取消召回 ",-1)])]),_:1},8,["onClick"])):(v(),P(c,{key:2,onClick:H=>t.toggleStatus(b.row),size:"small",type:"success",round:"",plain:""},{default:o(()=>[...e[17]||(e[17]=[f(" 召回 ",-1)])]),_:1},8,["onClick"])),l(c,{onClick:H=>t.deleteKnowledge(b.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[18]||(e[18]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,t.loading]]),a("div",za,[l(U,{"current-page":t.queryParams.pageNum,"onUpdate:currentPage":e[3]||(e[3]=b=>t.queryParams.pageNum=b),"page-size":t.queryParams.pageSize,"onUpdate:pageSize":e[4]||(e[4]=b=>t.queryParams.pageSize=b),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:t.total,onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),l(O,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[9]||(e[9]=b=>t.dialogVisible=b),title:t.isEdit?"编辑知识":"添加新知识",width:"800","close-on-click-modal":!1},{footer:o(()=>[a("div",La,[l(c,{onClick:t.closeDialog},{default:o(()=>[...e[25]||(e[25]=[f("取消",-1)])]),_:1},8,["onClick"]),l(c,{type:"primary",onClick:t.saveKnowledge,loading:t.saveLoading},{default:o(()=>[f(M(t.isEdit?"更新":"添加并处理"),1)]),_:1},8,["onClick","loading"])])]),default:o(()=>[l(N,{model:t.knowledgeForm,"label-width":"100px",ref:"knowledgeFormRef"},{default:o(()=>[l(F,{label:"知识类型",prop:"type",required:""},{default:o(()=>[l(D,{modelValue:t.knowledgeForm.type,"onUpdate:modelValue":e[5]||(e[5]=b=>t.knowledgeForm.type=b),placeholder:"请选择知识类型",onChange:t.handleTypeChange,disabled:t.isEdit,style:{width:"100%"}},{default:o(()=>[l(C,{label:"文档 (文件上传)",value:"DOCUMENT"}),l(C,{label:"问答对 (Q&A)",value:"QA"}),l(C,{label:"常见问题 (FAQ)",value:"FAQ"})]),_:1},8,["modelValue","onChange","disabled"])]),_:1}),t.knowledgeForm.type==="QA"?(v(),P(F,{key:0},{default:o(()=>[l(Q,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"10px"}},{title:o(()=>[...e[20]||(e[20]=[a("div",{style:{"line-height":"1.6"}}," 请录入具体的'分析需求'作为问题,并在答案中写出详细的'思考步骤'与'数据查找逻辑'(而非直接给结果),以此教会 AI 如何拆解任务。 ",-1)])]),_:1})]),_:1})):J("",!0),t.knowledgeForm.type==="FAQ"?(v(),P(F,{key:1},{default:o(()=>[l(Q,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"10px"}},{title:o(()=>[...e[21]||(e[21]=[a("div",{style:{"line-height":"1.6"}}," 请针对特定的'业务术语'、'指标口径'或'常见歧义'进行提问和定义(例如:'什么是有效日活'),以此统一 AI 的判断标准。 ",-1)])]),_:1})]),_:1})):J("",!0),t.knowledgeForm.type==="DOCUMENT"?(v(),P(F,{key:2},{default:o(()=>[l(Q,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"10px"}},{title:o(()=>[...e[22]||(e[22]=[a("div",{style:{"line-height":"1.6"}}," 请上传完整的'数据库表结构'、'码表映射字典'或'业务背景说明',供 AI 在分析时检索字段含义和数据关系。 ",-1)])]),_:1})]),_:1})):J("",!0),l(F,{label:"知识标题",prop:"title",required:""},{default:o(()=>[l(A,{modelValue:t.knowledgeForm.title,"onUpdate:modelValue":e[6]||(e[6]=b=>t.knowledgeForm.title=b),placeholder:"为这份知识起一个易于识别的名称"},null,8,["modelValue"])]),_:1}),t.knowledgeForm.type==="DOCUMENT"?(v(),P(F,{key:3,label:"上传文件",required:""},{default:o(()=>[t.isEdit?(v(),R("div",Pa,[l(Q,{type:"info",closable:!1,"show-icon":"",title:"文档类型知识不支持修改文件内容，如需修改请删除后重新创建"})])):(v(),R("div",Ua,[l(K,{"auto-upload":!1,limit:1,"on-change":t.handleFileChange,"on-remove":()=>t.fileList=[],"file-list":t.fileList,drag:""},{tip:o(()=>[e[23]||(e[23]=a("div",{class:"el-upload__tip"},"支持 PDF, DOCX, TXT, MD 等格式",-1)),t.fileList.length>0?(v(),R("div",Ka," 文件大小: "+M(t.formatFileSize(t.fileList[0].size)),1)):J("",!0)]),default:o(()=>[l(_,{class:"el-icon--upload"},{default:o(()=>[l(X)]),_:1}),e[24]||(e[24]=a("div",{class:"el-upload__text"},[f(" 拖拽文件到此处或 "),a("em",null,"点击选择文件")],-1))]),_:1},8,["on-change","on-remove","file-list"])]))]),_:1})):J("",!0),t.knowledgeForm.type==="QA"||t.knowledgeForm.type==="FAQ"?(v(),R(Y,{key:4},[l(F,{label:"问题",prop:"question",required:""},{default:o(()=>[l(A,{modelValue:t.knowledgeForm.question,"onUpdate:modelValue":e[7]||(e[7]=b=>t.knowledgeForm.question=b),type:"textarea",rows:2,placeholder:"输入用户可能会问的问题..."},null,8,["modelValue"])]),_:1}),l(F,{label:"答案",prop:"answer",required:""},{default:o(()=>[l(A,{modelValue:t.knowledgeForm.answer,"onUpdate:modelValue":e[8]||(e[8]=b=>t.knowledgeForm.answer=b),type:"textarea",rows:5,placeholder:"输入标准答案..."},null,8,["modelValue"])]),_:1})],64)):J("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}const qa=oe(_a,[["render",Ma],["__scopeId","data-v-51c3d2d0"]]),Ba=re({name:"AgentDetail",components:{BaseLayout:$t,AgentBaseSetting:Bt,AgentPromptConfig:Nl,BusinessKnowledgeConfig:Ll,AgentSemanticsConfig:xl,AgentPresetsConfig:no,AgentAccessApi:Vo,AgentDataSourceConfig:ka,AgentKnowledgeConfig:qa,NotFound:Dt,InfoFilled:Ct,Coin:ht,ChatLineSquare:wt,User:bt,Suitcase:vt,Setting:yt,VideoPlay:ft,Connection:qe,Document:Le},setup(){const t=Pe(),e=V("basic"),n=V({id:0,name:"loading...",description:"",status:"draft",createdAt:"",updatedAt:"",avatar:"",prompt:"",category:"",adminId:"",tags:"",humanReviewEnabled:!1}),s=V(null),g=V(!1),y=V(!1),p=V(""),m=()=>{console.error("头像图片加载失败"),(!n.value.avatar||n.value.avatar.startsWith("data:"))&&(n.value.avatar=_t())},h=()=>{s.value&&s.value.click()},_=async C=>{var N;const F=(N=C.target.files)==null?void 0:N[0];if(F){if(!F.type.startsWith("image/")){i.error("请选择图片文件");return}if(F.size>5*1024*1024){i.error("图片大小不能超过5MB");return}try{g.value=!0,p.value=n.value.avatar||"";const T=new FileReader;T.onload=S=>{var $;n.value.avatar=($=S.target)==null?void 0:$.result},T.readAsDataURL(F);const z=await Tt.uploadAvatar(F);if(z.success)n.value.avatar=z.url,n.value.id&&await se.update(Number(n.value.id),{...n.value,avatar:z.url}),i.success("头像上传成功");else throw new Error(z.message||"上传失败")}catch(T){i.error("头像上传失败: "+(T instanceof Error?T.message:"未知错误")),n.value.avatar=p.value}finally{g.value=!1,s.value&&(s.value.value="")}}},A=C=>{const D=t.currentRoute.value.params.id;e.value=C,C==="go-run"&&t.push(`/agent/${D}/run`)},c=()=>{t.push("/agents")},q=async()=>{try{const C=Number(t.currentRoute.value.params.id),D=await se.get(C);if(D)n.value=D;else throw new Error("Agent 不存在")}catch(C){i.error("加载失败"),console.error("加载失败:",C)}};return ve(async()=>{await q()}),{ArrowLeft:kt,agent:n,activeMenuIndex:e,handleMenuSelect:A,goBack:c,headerFileInput:s,headerUploading:g,showHeaderAvatarButton:y,triggerHeaderFileUpload:h,handleHeaderFileUpload:_,getAvatarUrl:Vt,handleImageError:m}}}),Oa={key:0,class:"avatar-overlay-header"};function Ra(t,e,n,s,g,y){const p=r("el-button"),m=r("el-col"),h=r("el-avatar"),_=r("el-row"),A=r("el-divider"),c=r("el-header"),q=r("InfoFilled"),C=r("el-icon"),D=r("el-menu-item"),F=r("el-menu-item-group"),N=r("Coin"),T=r("ChatLineSquare"),z=r("Document"),S=r("User"),$=r("Suitcase"),w=r("Setting"),B=r("VideoPlay"),j=r("Connection"),U=r("el-menu"),Q=r("el-aside"),X=r("AgentBaseSetting"),K=r("AgentDataSourceConfig"),O=r("AgentPromptConfig"),I=r("BusinessKnowledgeConfig"),b=r("AgentSemanticsConfig"),H=r("AgentPresetsConfig"),x=r("AgentAccessApi"),d=r("AgentKnowledgeConfig"),G=r("NotFound"),Te=r("el-main"),$e=r("el-container"),Se=r("BaseLayout");return v(),P(Se,null,{default:o(()=>[l($e,{style:{"margin-top":"20px",gap:"10px"}},{default:o(()=>[l(c,{style:{"background-color":"white","margin-bottom":"20px"}},{default:o(()=>[l(_,{gutter:20,align:"middle"},{default:o(()=>[l(m,{span:1},{default:o(()=>[l(p,{type:"primary",icon:t.ArrowLeft,onClick:t.goBack,circle:"",style:{transform:"scale(1.2)"}},null,8,["icon","onClick"])]),_:1}),l(m,{span:1,style:{"text-align":"left"}},{default:o(()=>[a("div",{class:"avatar-wrapper",onMouseenter:e[0]||(e[0]=be=>t.showHeaderAvatarButton=!0),onMouseleave:e[1]||(e[1]=be=>t.showHeaderAvatarButton=!1)},[l(h,{src:t.getAvatarUrl(t.agent.avatar),size:"large",class:"header-avatar",onError:t.handleImageError},{default:o(()=>[f(M(t.agent.name),1)]),_:1},8,["src","onError"]),t.showHeaderAvatarButton?(v(),R("div",Oa,[l(p,{type:"primary",size:"small",onClick:t.triggerHeaderFileUpload,loading:t.headerUploading},{default:o(()=>[f(M(t.headerUploading?"上传中...":"替换头像"),1)]),_:1},8,["onClick","loading"])])):J("",!0)],32),a("input",{ref:"headerFileInput",type:"file",accept:"image/*",style:{display:"none"},onChange:e[2]||(e[2]=(...be)=>t.handleHeaderFileUpload&&t.handleHeaderFileUpload(...be))},null,544)]),_:1}),l(m,{span:30,style:{"text-align":"left"}},{default:o(()=>[a("h2",null,M(t.agent.name),1)]),_:1})]),_:1}),l(A)]),_:1}),l($e,{style:{gap:"10px"}},{default:o(()=>[l(Q,{width:"200px",style:{"background-color":"white"}},{default:o(()=>[l(U,{"default-active":t.activeMenuIndex,class:"el-menu-vertical-demo",onSelect:t.handleMenuSelect},{default:o(()=>[l(F,{title:"基本信息"},{default:o(()=>[l(D,{index:"basic"},{default:o(()=>[l(C,null,{default:o(()=>[l(q)]),_:1}),e[3]||(e[3]=f(" 基本信息 ",-1))]),_:1})]),_:1}),l(F,{title:"数据源配置"},{default:o(()=>[l(D,{index:"datasource"},{default:o(()=>[l(C,null,{default:o(()=>[l(N)]),_:1}),e[4]||(e[4]=f(" 数据源配置 ",-1))]),_:1})]),_:1}),l(F,{title:"PROMPT配置"},{default:o(()=>[l(D,{index:"prompt"},{default:o(()=>[l(C,null,{default:o(()=>[l(T)]),_:1}),e[5]||(e[5]=f(" 自定义 PROMPT 配置 ",-1))]),_:1})]),_:1}),l(F,{title:"知识配置"},{default:o(()=>[l(D,{index:"agent-knowledge"},{default:o(()=>[l(C,null,{default:o(()=>[l(z)]),_:1}),e[6]||(e[6]=f(" 智能体知识配置 ",-1))]),_:1}),l(D,{index:"business-knowledge"},{default:o(()=>[l(C,null,{default:o(()=>[l(S)]),_:1}),e[7]||(e[7]=f(" 业务知识配置 ",-1))]),_:1}),l(D,{index:"semantic-model"},{default:o(()=>[l(C,null,{default:o(()=>[l($)]),_:1}),e[8]||(e[8]=f(" 语义模型配置 ",-1))]),_:1})]),_:1}),l(F,{title:"预设问题管理"},{default:o(()=>[l(D,{index:"preset-questions"},{default:o(()=>[l(C,null,{default:o(()=>[l(w)]),_:1}),e[9]||(e[9]=f(" 预设问题管理 ",-1))]),_:1})]),_:1}),l(F,{title:"运行与发布"},{default:o(()=>[l(D,{index:"go-run"},{default:o(()=>[l(C,null,{default:o(()=>[l(B)]),_:1}),e[10]||(e[10]=f(" 前往运行页面 ",-1))]),_:1}),l(D,{index:"access-api"},{default:o(()=>[l(C,null,{default:o(()=>[l(j)]),_:1}),e[11]||(e[11]=f(" 访问 API ",-1))]),_:1})]),_:1})]),_:1},8,["default-active","onSelect"])]),_:1}),l(Te,{style:{"background-color":"white"}},{default:o(()=>[t.activeMenuIndex==="basic"?(v(),P(X,{key:0,agent:t.agent},null,8,["agent"])):t.activeMenuIndex==="datasource"?(v(),P(K,{key:1,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="prompt"?(v(),P(O,{key:2,"agent-id":t.agent.id,"agent-prompt":t.agent.prompt},null,8,["agent-id","agent-prompt"])):t.activeMenuIndex==="business-knowledge"?(v(),P(I,{key:3,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="semantic-model"?(v(),P(b,{key:4,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="preset-questions"?(v(),P(H,{key:5,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="access-api"?(v(),P(x,{key:6,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="agent-knowledge"?(v(),P(d,{key:7,"agent-id":t.agent.id},null,8,["agent-id"])):(v(),P(G,{key:8}))]),_:1})]),_:1})]),_:1})]),_:1})}const Xa=oe(Ba,[["render",Ra],["__scopeId","data-v-4ad03a8f"]]);export{Xa as default};
