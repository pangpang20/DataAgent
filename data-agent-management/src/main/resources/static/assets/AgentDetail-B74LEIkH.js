import{d as ae,b as se,a as ze,e as Ke,E as i,h as Z,u as Me,_ as te,m as R,l as a,q as l,j as r,w as o,k as v,x as g,n as J,D as Ne,t as B,F as Y,y as ye,z as Se,G as oe,H as ue,I as et,J as U,K as Ie,s as Ce,o as ve,f as $,L as Le,p as De,i as M,M as Ee,N as $e,O as Te,P as tt,Q as lt,R as ot,c as at,S as nt,T as st,U as qe,V as rt,W as it,B as dt,A as ut,X as pt,Y as mt,Z as ct,$ as gt,a0 as ft,a1 as yt,a2 as vt,a3 as bt,a4 as wt,a5 as ht,a6 as Ct,a7 as kt}from"./index-C8bkOYxc.js";import{A as re,g as Vt,a as $t}from"./avatar-B7KpInp9.js";import{B as Dt}from"./BaseLayout-BFRTzKYD.js";import{P as ke,c as Pe}from"./clipboard-DhjUpj5U.js";import _t from"./NotFound--X09lzue.js";import{f as St}from"./fileUpload-BQXCDLCH.js";const Tt=ae({name:"AgentBaseSetting",props:{agent:{type:Object,required:!0}},setup(t){const e=Me(),n=async()=>{try{const d=await re.update(t.agent.id,t.agent);d===null?(console.error("更新智能体失败:",d),i.error("更新失败：未知错误")):i.success("更新成功！")}catch(d){console.error("更新智能体失败:",d),i.error("更新失败："+(d.message||"未知错误"))}},s=async()=>{try{await Z.confirm(`确定要删除智能体"${t.agent.name}"吗？删除后将无法恢复。`,"删除智能体",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!1}),await re.delete(t.agent.id)?(i.success("智能体已删除"),await e.push("/agents")):i.error("删除失败：智能体不存在")}catch{}},c=d=>d?new Date(d).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",f=se(()=>c(t.agent.createTime)),u=se(()=>c(t.agent.updateTime));return{Edit:Ke,Delete:ze,props:t,updateAgent:n,handleDeleteAgent:s,formattedCreateTime:f,formattedUpdateTime:u}}}),At={class:"agent-base-setting"},Ft={class:"form-item"},Nt={class:"form-item"},It={class:"form-item"},zt={class:"form-item"},Et={class:"form-item"},Ut={class:"form-item"},Pt={class:"form-item"},Kt={class:"form-item"},Mt={class:"form-item form-switch"},Lt={class:"button-group"};function qt(t,e,n,s,c,f){const u=r("el-divider"),d=r("el-input"),h=r("el-col"),_=r("el-row"),E=r("el-option"),y=r("el-select"),K=r("el-switch"),D=r("el-text"),A=r("el-button");return v(),R("div",At,[e[19]||(e[19]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"基本信息")],-1)),l(u),l(_,{gutter:20},{default:o(()=>[l(h,{span:12},{default:o(()=>[a("div",Ft,[e[7]||(e[7]=a("label",null,"智能体名称",-1)),l(d,{modelValue:t.props.agent.name,"onUpdate:modelValue":e[0]||(e[0]=F=>t.props.agent.name=F),placeholder:"请输入智能体名称",size:"large"},null,8,["modelValue"])])]),_:1}),l(h,{span:12},{default:o(()=>[a("div",Nt,[e[8]||(e[8]=a("label",null,"分类",-1)),l(d,{modelValue:t.props.agent.category,"onUpdate:modelValue":e[1]||(e[1]=F=>t.props.agent.category=F),placeholder:"请输入智能体分类",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(h,{span:24},{default:o(()=>[a("div",It,[e[9]||(e[9]=a("label",null,"描述",-1)),l(d,{modelValue:t.props.agent.description,"onUpdate:modelValue":e[2]||(e[2]=F=>t.props.agent.description=F),rows:4,type:"textarea",placeholder:"请输入智能体描述",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(h,{span:24},{default:o(()=>[a("div",zt,[e[10]||(e[10]=a("label",null,"智能体Prompt",-1)),l(d,{modelValue:t.props.agent.prompt,"onUpdate:modelValue":e[3]||(e[3]=F=>t.props.agent.prompt=F),rows:4,type:"textarea",placeholder:"请输入智能体Prompt",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(h,{span:12},{default:o(()=>[a("div",Et,[e[11]||(e[11]=a("label",null,"标签",-1)),l(d,{modelValue:t.props.agent.tags,"onUpdate:modelValue":e[4]||(e[4]=F=>t.props.agent.tags=F),placeholder:"多个标签用逗号分隔",size:"large"},null,8,["modelValue"])])]),_:1}),l(h,{span:12},{default:o(()=>[a("div",Ut,[e[12]||(e[12]=a("label",null,"状态",-1)),l(y,{modelValue:t.props.agent.status,"onUpdate:modelValue":e[5]||(e[5]=F=>t.props.agent.status=F),placeholder:"请选择状态",style:{width:"100%"},size:"large"},{default:o(()=>[l(E,{key:"draft",label:"待发布",value:"draft"}),l(E,{key:"published",label:"已发布",value:"published"}),l(E,{key:"offline",label:"已下线",value:"offline"})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(h,{span:12},{default:o(()=>[a("div",Pt,[e[13]||(e[13]=a("label",null,"创建时间",-1)),l(d,{disabled:"","model-value":t.formattedCreateTime,size:"large"},null,8,["model-value"])])]),_:1}),l(h,{span:12},{default:o(()=>[a("div",Kt,[e[14]||(e[14]=a("label",null,"更新时间",-1)),l(d,{disabled:"","model-value":t.formattedUpdateTime,size:"large"},null,8,["model-value"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(h,{span:24},{default:o(()=>[a("div",Mt,[l(K,{modelValue:t.props.agent.humanReviewEnabled,"onUpdate:modelValue":e[6]||(e[6]=F=>t.props.agent.humanReviewEnabled=F),size:"large"},null,8,["modelValue"]),e[16]||(e[16]=a("span",null,"启用计划人工复核",-1)),l(D,{class:"mx-1"},{default:o(()=>[...e[15]||(e[15]=[g("（开启后，Planner 计划会在执行前等待人工复核）",-1)])]),_:1})])]),_:1})]),_:1}),a("div",Lt,[l(A,{type:"primary",icon:t.Edit,round:"",onClick:t.updateAgent,size:"large"},{default:o(()=>[...e[17]||(e[17]=[g(" 保存 ",-1)])]),_:1},8,["icon","onClick"]),l(A,{type:"danger",icon:t.Delete,round:"",onClick:t.handleDeleteAgent,size:"large"},{default:o(()=>[...e[18]||(e[18]=[g(" 删除智能体 ",-1)])]),_:1},8,["icon","onClick"])])])}const Bt=te(Tt,[["render",qt],["__scopeId","data-v-c5a3b1ac"]]),Ot={name:"AgentPromptConfig",props:{agentId:{type:[String,Number],required:!0},promptType:{type:String,default:"report-generator"},agentPrompt:{type:String,default:""}},data(){return{optimizationConfigs:[],showAddConfigDialog:!1,editingConfig:null,showBatchActions:!1,showPriorityDialog:!1,selectedConfigs:[],editingPriorityConfig:null,formData:{name:"",description:"",optimizationPrompt:"",priority:0,displayOrder:0},priorityForm:{priority:0,displayOrder:0},loading:!1,message:{show:!1,text:"",type:"success"}}},computed:{isAllSelected(){return this.optimizationConfigs.length>0&&this.selectedConfigs.length===this.optimizationConfigs.length},isIndeterminate(){return this.selectedConfigs.length>0&&this.selectedConfigs.length<this.optimizationConfigs.length}},mounted(){this.loadOptimizationConfigs()},methods:{async loadOptimizationConfigs(){try{this.loading=!0;const t=this.agentId?`?agentId=${this.agentId}`:"",n=await(await fetch(`/api/prompt-config/list-by-type/${this.promptType}${t}`)).json();n.success&&(this.optimizationConfigs=n.data||[],this.optimizationConfigs.length===0&&(this.showBatchActions=!1,this.selectedConfigs=[]))}catch(t){console.error("加载优化配置失败:",t),this.showMessage("加载优化配置失败","error")}finally{this.loading=!1}},async saveConfig(){try{const t={...this.formData,promptType:this.promptType,agentId:this.agentId?Number(this.agentId):null,enabled:!0,creator:"user",priority:this.formData.priority||0,displayOrder:this.formData.displayOrder||0};this.editingConfig&&(t.id=this.editingConfig.id);const n=await(await fetch("/api/prompt-config/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();n.success?(this.showMessage(n.message||"保存成功","success"),this.closeDialog(),this.loadOptimizationConfigs()):this.showMessage(n.message||"保存失败","error")}catch(t){console.error("保存配置失败:",t),this.showMessage("保存配置失败","error")}},async toggleConfig(t){try{const e=t.enabled?`/api/prompt-config/${t.id}/disable`:`/api/prompt-config/${t.id}/enable`,s=await(await fetch(e,{method:"POST"})).json();s.success?(this.showMessage(s.message,"success"),this.loadOptimizationConfigs()):this.showMessage(s.message,"error")}catch(e){console.error("切换配置状态失败:",e),this.showMessage("操作失败","error")}},async deleteConfig(t){if(confirm("确定要删除这个优化配置吗？"))try{const n=await(await fetch(`/api/prompt-config/${t}`,{method:"DELETE"})).json();n.success?(this.showMessage(n.message,"success"),this.loadOptimizationConfigs(),this.selectedConfigs=this.selectedConfigs.filter(s=>s!==t)):this.showMessage(n.message,"error")}catch(e){console.error("删除配置失败:",e),this.showMessage("删除配置失败","error")}},editConfig(t){this.editingConfig=t,this.formData={name:t.name,description:t.description,optimizationPrompt:t.optimizationPrompt,priority:t.priority||0,displayOrder:t.displayOrder||0}},closeDialog(){this.showAddConfigDialog=!1,this.editingConfig=null,this.formData={name:"",description:"",optimizationPrompt:"",priority:0,displayOrder:0}},async batchEnable(){if(this.selectedConfigs.length!==0)try{const e=await(await fetch("/api/prompt-config/batch-enable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.selectedConfigs)})).json();e.success?(this.showMessage(e.message,"success"),this.loadOptimizationConfigs(),this.clearSelection()):this.showMessage(e.message,"error")}catch(t){console.error("批量启用失败:",t),this.showMessage("批量启用失败","error")}},async batchDisable(){if(this.selectedConfigs.length!==0)try{const e=await(await fetch("/api/prompt-config/batch-disable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.selectedConfigs)})).json();e.success?(this.showMessage(e.message,"success"),this.loadOptimizationConfigs(),this.clearSelection()):this.showMessage(e.message,"error")}catch(t){console.error("批量禁用失败:",t),this.showMessage("批量禁用失败","error")}},clearSelection(){this.selectedConfigs=[],this.showBatchActions=!1},toggleSelectAll(){this.isAllSelected?this.selectedConfigs=[]:this.selectedConfigs=this.optimizationConfigs.map(t=>t.id)},handleShowPriorityDialog(t){this.editingPriorityConfig=t,this.priorityForm={priority:t.priority||0,displayOrder:t.displayOrder||0},this.showPriorityDialog=!0},async updatePriority(){try{const e=await(await fetch(`/api/prompt-config/${this.editingPriorityConfig.id}/priority`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priority:this.priorityForm.priority})})).json();e.success?(this.showMessage("优先级更新成功","success"),this.loadOptimizationConfigs(),this.closePriorityDialog()):this.showMessage(e.message,"error")}catch(t){console.error("更新优先级失败:",t),this.showMessage("更新优先级失败","error")}},closePriorityDialog(){this.showPriorityDialog=!1,this.editingPriorityConfig=null,this.priorityForm={priority:0,displayOrder:0}},showMessage(t,e="success"){this.message={show:!0,text:t,type:e},setTimeout(()=>{this.message.show=!1},3e3)},hideMessage(){this.message.show=!1}}},Rt={class:"prompt-optimization-config"},jt={class:"agent-prompt-section"},Jt={class:"prompt-display"},Qt={class:"optimization-configs"},Ht={class:"config-list-header"},Gt={class:"header-actions"},Wt={key:0,class:"batch-actions-panel"},Xt={class:"batch-actions-content"},Yt={class:"batch-selection"},Zt=["checked","indeterminate"],xt={class:"batch-info"},el={class:"batch-buttons"},tl=["disabled"],ll=["disabled"],ol={key:1,class:"empty-state"},al={key:2,class:"config-list"},nl={class:"config-header"},sl={class:"config-info"},rl=["value"],il={class:"config-name"},dl={key:0,class:"config-priority"},ul={class:"config-actions"},pl=["onClick"],ml=["onClick"],cl=["onClick"],gl=["onClick"],fl={class:"config-content"},yl={class:"config-description"},vl={class:"optimization-prompt"},bl={class:"dialog-header"},wl={class:"form-group"},hl={class:"form-group"},Cl={class:"form-group"},kl={class:"form-row"},Vl={class:"form-group"},$l={class:"form-group"},Dl={class:"form-actions"},_l={class:"dialog-header"},Sl={class:"form-group"},Tl={class:"form-group"},Al={class:"form-actions"};function Fl(t,e,n,s,c,f){return v(),R("div",Rt,[c.message.show?(v(),R("div",{key:0,class:Ne(["message-toast",c.message.type])},[a("span",null,B(c.message.text),1),a("button",{class:"message-close",onClick:e[0]||(e[0]=(...u)=>f.hideMessage&&f.hideMessage(...u))},"×")],2)):J("",!0),e[42]||(e[42]=a("div",{class:"config-header"},[a("h3",null,"增强式Prompt优化配置"),a("p",{class:"config-description"}," 配置的Prompt仅用作效果优化，支持多个提示词配置，在原始模板基础上进行增强。示例配置： "),a("ul",{class:"optimization-tips"},[a("li",null,"1. 查询的年销售额精确到小数点后两位。"),a("li",null,"2. 报告格式第一章节请先总结年销售额")])],-1)),a("div",jt,[e[25]||(e[25]=a("h4",null,"智能体Prompt",-1)),a("div",Jt,B(n.agentPrompt||"你是一个销售数据分析专家，能够帮助用户分析销售趋势，客户行为和业务指标。"),1)]),a("div",Qt,[a("div",Ht,[e[28]||(e[28]=a("h4",null,"优化配置列表",-1)),a("div",Gt,[c.optimizationConfigs.length>0?(v(),R("button",{key:0,class:"batch-action-btn",onClick:e[1]||(e[1]=u=>c.showBatchActions=!c.showBatchActions)},[...e[26]||(e[26]=[a("i",{class:"icon-settings"},null,-1),g(" 批量操作 ",-1)])])):J("",!0),a("button",{class:"add-config-btn",onClick:e[2]||(e[2]=u=>c.showAddConfigDialog=!0)},[...e[27]||(e[27]=[a("i",{class:"icon-plus"},null,-1),g(" 添加优化配置 ",-1)])])])]),c.showBatchActions?(v(),R("div",Wt,[a("div",Xt,[a("div",Yt,[a("input",{type:"checkbox",checked:f.isAllSelected,indeterminate:f.isIndeterminate,onChange:e[3]||(e[3]=(...u)=>f.toggleSelectAll&&f.toggleSelectAll(...u)),class:"select-all-checkbox"},null,40,Zt),a("span",xt,B(f.isAllSelected?"已全选":`已选择 ${c.selectedConfigs.length} 个配置`),1)]),a("div",el,[a("button",{class:"batch-btn enable",onClick:e[4]||(e[4]=(...u)=>f.batchEnable&&f.batchEnable(...u)),disabled:c.selectedConfigs.length===0}," 批量启用 ",8,tl),a("button",{class:"batch-btn disable",onClick:e[5]||(e[5]=(...u)=>f.batchDisable&&f.batchDisable(...u)),disabled:c.selectedConfigs.length===0}," 批量禁用 ",8,ll),a("button",{class:"batch-btn cancel",onClick:e[6]||(e[6]=(...u)=>f.clearSelection&&f.clearSelection(...u))},"取消选择")])])])):J("",!0),c.optimizationConfigs.length===0?(v(),R("div",ol,[...e[29]||(e[29]=[a("p",null,'暂无优化配置，点击"添加优化配置"开始配置',-1)])])):(v(),R("div",al,[(v(!0),R(Y,null,ye(c.optimizationConfigs,u=>(v(),R("div",{key:u.id,class:Ne(["config-item",{disabled:!u.enabled,selected:c.selectedConfigs.includes(u.id)}])},[a("div",nl,[a("div",sl,[oe(a("input",{type:"checkbox",value:u.id,"onUpdate:modelValue":e[7]||(e[7]=d=>c.selectedConfigs=d),class:"config-checkbox"},null,8,rl),[[et,c.selectedConfigs]]),a("span",il,B(u.name),1),u.priority!==void 0?(v(),R("span",dl," 优先级: "+B(u.priority),1)):J("",!0)]),a("div",ul,[a("button",{class:Ne(["toggle-btn",{active:u.enabled}]),onClick:d=>f.toggleConfig(u)},B(u.enabled?"已启用":"已禁用"),11,pl),a("button",{class:"edit-btn",onClick:d=>f.editConfig(u)},"编辑",8,ml),a("button",{class:"priority-btn",onClick:d=>f.handleShowPriorityDialog(u)},"优先级",8,cl),a("button",{class:"delete-btn",onClick:d=>f.deleteConfig(u.id)},"删除",8,gl)])]),a("div",fl,[a("p",yl,B(u.description),1),a("div",vl,B(u.optimizationPrompt),1)])],2))),128))]))]),c.showAddConfigDialog||c.editingConfig?(v(),R("div",{key:1,class:"dialog-overlay",onClick:e[17]||(e[17]=(...u)=>f.closeDialog&&f.closeDialog(...u))},[a("div",{class:"dialog-content",onClick:e[16]||(e[16]=Se(()=>{},["stop"]))},[a("div",bl,[a("h3",null,B(c.editingConfig?"编辑优化配置":"添加优化配置"),1),a("button",{class:"close-btn",onClick:e[8]||(e[8]=(...u)=>f.closeDialog&&f.closeDialog(...u))},"×")]),a("form",{onSubmit:e[15]||(e[15]=Se((...u)=>f.saveConfig&&f.saveConfig(...u),["prevent"])),class:"config-form"},[a("div",wl,[e[30]||(e[30]=a("label",{for:"configName"},"配置名称",-1)),oe(a("input",{id:"configName","onUpdate:modelValue":e[9]||(e[9]=u=>c.formData.name=u),type:"text",placeholder:"请输入配置名称",required:""},null,512),[[ue,c.formData.name]])]),a("div",hl,[e[31]||(e[31]=a("label",{for:"description"},"配置描述",-1)),oe(a("input",{id:"description","onUpdate:modelValue":e[10]||(e[10]=u=>c.formData.description=u),type:"text",placeholder:"请输入配置描述"},null,512),[[ue,c.formData.description]])]),a("div",Cl,[e[32]||(e[32]=a("label",{for:"optimizationPrompt"},"优化提示词内容",-1)),oe(a("textarea",{id:"optimizationPrompt","onUpdate:modelValue":e[11]||(e[11]=u=>c.formData.optimizationPrompt=u),rows:"6",placeholder:"请输入优化提示词内容，支持模板变量如 {user_requirements_and_plan}",required:""},null,512),[[ue,c.formData.optimizationPrompt]])]),a("div",kl,[a("div",Vl,[e[33]||(e[33]=a("label",{for:"priority"},"优先级",-1)),oe(a("input",{id:"priority","onUpdate:modelValue":e[12]||(e[12]=u=>c.formData.priority=u),type:"number",min:"0",max:"100",placeholder:"0-100，数字越大优先级越高"},null,512),[[ue,c.formData.priority,void 0,{number:!0}]])]),a("div",$l,[e[34]||(e[34]=a("label",{for:"displayOrder"},"显示顺序",-1)),oe(a("input",{id:"displayOrder","onUpdate:modelValue":e[13]||(e[13]=u=>c.formData.displayOrder=u),type:"number",min:"0",placeholder:"显示顺序，数字越小越靠前"},null,512),[[ue,c.formData.displayOrder,void 0,{number:!0}]])])]),a("div",Dl,[a("button",{type:"button",class:"cancel-btn",onClick:e[14]||(e[14]=(...u)=>f.closeDialog&&f.closeDialog(...u))},"取消"),e[35]||(e[35]=a("button",{type:"submit",class:"save-btn"},"保存配置",-1))])],32)])])):J("",!0),c.showPriorityDialog?(v(),R("div",{key:2,class:"dialog-overlay",onClick:e[24]||(e[24]=(...u)=>f.closePriorityDialog&&f.closePriorityDialog(...u))},[a("div",{class:"dialog-content",onClick:e[23]||(e[23]=Se(()=>{},["stop"]))},[a("div",_l,[e[36]||(e[36]=a("h3",null,"设置优先级",-1)),a("button",{class:"close-btn",onClick:e[18]||(e[18]=(...u)=>f.closePriorityDialog&&f.closePriorityDialog(...u))},"×")]),a("form",{onSubmit:e[22]||(e[22]=Se((...u)=>f.updatePriority&&f.updatePriority(...u),["prevent"])),class:"priority-form"},[a("div",Sl,[e[37]||(e[37]=a("label",{for:"priorityValue"},"优先级 (0-100)",-1)),oe(a("input",{id:"priorityValue","onUpdate:modelValue":e[19]||(e[19]=u=>c.priorityForm.priority=u),type:"number",min:"0",max:"100",placeholder:"数字越大优先级越高",required:""},null,512),[[ue,c.priorityForm.priority,void 0,{number:!0}]]),e[38]||(e[38]=a("p",{class:"form-hint"},"优先级越高，该配置在多个配置中的执行顺序越靠前",-1))]),a("div",Tl,[e[39]||(e[39]=a("label",{for:"displayOrderValue"},"显示顺序",-1)),oe(a("input",{id:"displayOrderValue","onUpdate:modelValue":e[20]||(e[20]=u=>c.priorityForm.displayOrder=u),type:"number",min:"0",placeholder:"数字越小越靠前"},null,512),[[ue,c.priorityForm.displayOrder,void 0,{number:!0}]]),e[40]||(e[40]=a("p",{class:"form-hint"},"控制配置在列表中的显示顺序",-1))]),a("div",Al,[a("button",{type:"button",class:"cancel-btn",onClick:e[21]||(e[21]=(...u)=>f.closePriorityDialog&&f.closePriorityDialog(...u))},"取消"),e[41]||(e[41]=a("button",{type:"submit",class:"save-btn"},"保存",-1))])],32)])])):J("",!0)])}const Nl=te(Ot,[["render",Fl],["__scopeId","data-v-dca7029e"]]),de="/api/business-knowledge";class Il{async list(e,n){try{const s={agentId:e.toString()};return n&&(s.keyword=n),(await U.get(de,{params:s})).data.data||[]}catch(s){throw console.error("Failed to fetch business knowledge list:",s),s}}async get(e){var n;try{return(await U.get(`${de}/${e}`)).data.data||null}catch(s){if(U.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return null;throw s}}async create(e){return(await U.post(de,e)).data.data}async update(e,n){var s;try{return(await U.put(`${de}/${e}`,n)).data.data||null}catch(c){if(U.isAxiosError(c)&&((s=c.response)==null?void 0:s.status)===404)return null;throw c}}async delete(e){var n;try{return(await U.delete(`${de}/${e}`)).data.success}catch(s){if(U.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return!1;throw s}}async recallKnowledge(e,n){return(await U.post(`${de}/recall/${e}`,null,{params:{isRecall:n}})).data.success}async retryEmbedding(e){return(await U.post(`${de}/retry-embedding/${e}`)).data.success}async refreshAllKnowledgeToVectorStore(e){return(await U.post(`${de}/refresh-vector-store`,null,{params:{agentId:e}})).data.success}}const pe=new Il,zl=ae({name:"AgentKnowledgeConfig",components:{Search:Ce,Warning:Ie},props:{agentId:{type:Number,required:!0}},setup(t){const e=$([]),n=$(!1),s=$(!1),c=$(""),f=$({businessTerm:"",description:"",synonyms:"",isRecall:!1}),u=$(null),d=$(!1),h=$(!1),_=$({}),E=()=>{s.value=!1,n.value=!0},y=()=>{K()},K=async()=>{try{e.value=await pe.list(t.agentId,c.value||void 0)}catch(k){i.error("加载业务知识列表失败"),console.error("Failed to load business knowledge:",k)}},D=k=>{s.value=!0,u.value=k.id||null,f.value={...k},n.value=!0},A=async k=>{if(k.id)try{await Z.confirm(`确定要删除业务知识 "${k.businessTerm}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await pe.delete(k.id)?(i.success("删除成功"),await K()):i.error("删除失败")}catch{}},F=async(k,b)=>{if(k.id)try{await pe.recallKnowledge(k.id,b)?(i.success(`${b?"设为召回":"取消召回"}成功`),k.isRecall=b):i.error(`${b?"设为召回":"取消召回"}失败`)}catch(L){i.error(`${b?"设为召回":"取消召回"}失败`),console.error("Failed to toggle recall:",L)}},T=async()=>{h.value=!0;try{if(s.value&&u.value){const k={businessTerm:f.value.businessTerm,description:f.value.description,synonyms:f.value.synonyms,agentId:t.agentId};if(await pe.update(u.value,k))i.success("更新成功");else{i.error("更新失败");return}}else{const k={businessTerm:f.value.businessTerm,description:f.value.description,synonyms:f.value.synonyms,isRecall:f.value.isRecall,agentId:t.agentId};await pe.create(k),i.success("创建成功")}n.value=!1,await K()}catch(k){i.error(`${s.value?"更新":"创建"}失败`),console.error("Failed to save knowledge:",k)}finally{h.value=!1}},S=async()=>{try{await Z.confirm("如果所有向量状态正常，即无需同步。确定要清除现有数据并开始重新同步吗？","确认同步",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),d.value=!0,await pe.refreshAllKnowledgeToVectorStore(t.agentId.toString())?i.success("同步到向量库成功"):i.error("同步到向量库失败")}catch(k){k!=="cancel"&&(i.error("同步到向量库失败"),console.error("Failed to refresh vector store:",k))}finally{d.value=!1}},C=async k=>{if(k.id)try{_.value[k.id]=!0,await pe.retryEmbedding(k.id)?(i.success("重试向量化成功"),await K()):i.error("重试向量化失败")}catch(b){i.error("重试向量化失败"),console.error("Failed to retry vectorization:",b)}finally{_.value[k.id]=!1}},N=k=>{switch(k){case"COMPLETED":return"success";case"FAILED":return"danger";case"PENDING":return"warning";case"PROCESSING":return"primary";default:return"info"}};return ve(()=>{K()}),{Plus:De,Search:Ce,Document:Le,businessKnowledgeList:e,dialogVisible:n,isEdit:s,searchKeyword:c,knowledgeForm:f,refreshLoading:d,saveLoading:h,retryLoadingMap:_,openCreateDialog:E,editKnowledge:D,deleteKnowledge:A,toggleRecall:F,saveKnowledge:T,handleSearch:y,refreshVectorStore:S,retryEmbedding:C,getVectorStatusType:N}}}),El={style:{padding:"20px"}},Ul={style:{"margin-bottom":"30px"}},Pl={style:{"text-align":"right"}};function Kl(t,e,n,s,c,f){const u=r("el-divider"),d=r("el-col"),h=r("Search"),_=r("el-icon"),E=r("el-input"),y=r("el-button"),K=r("el-row"),D=r("el-table-column"),A=r("Warning"),F=r("el-tooltip"),T=r("el-tag"),S=r("el-table"),C=r("el-form-item"),N=r("el-form"),k=r("el-dialog");return v(),R(Y,null,[a("div",El,[e[15]||(e[15]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"业务知识管理")],-1)),l(u),a("div",Ul,[l(K,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(d,{span:12},{default:o(()=>[...e[6]||(e[6]=[a("h3",null,"业务知识列表",-1)])]),_:1}),l(d,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(E,{modelValue:t.searchKeyword,"onUpdate:modelValue":e[0]||(e[0]=b=>t.searchKeyword=b),placeholder:"请输入关键词，并按回车搜索",style:{width:"250px","margin-right":"10px"},clearable:"",onClear:t.handleSearch,onKeyup:Ee(t.handleSearch,["enter"]),size:"large"},{prefix:o(()=>[l(_,null,{default:o(()=>[l(h)]),_:1})]),_:1},8,["modelValue","onClear","onKeyup"]),t.refreshLoading?(v(),M(y,{key:1,size:"large",type:"success",round:"",loading:""},{default:o(()=>[...e[8]||(e[8]=[g("同步中...",-1)])]),_:1})):(v(),M(y,{key:0,onClick:t.refreshVectorStore,size:"large",type:"success",round:"",icon:t.Document},{default:o(()=>[...e[7]||(e[7]=[g(" 同步到向量库 ",-1)])]),_:1},8,["onClick","icon"])),l(y,{onClick:t.openCreateDialog,size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[9]||(e[9]=[g(" 添加知识 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1})]),l(S,{data:t.businessKnowledgeList,style:{width:"100%"},border:""},{default:o(()=>[l(D,{prop:"id",label:"ID","min-width":"60px"}),l(D,{prop:"businessTerm",label:"业务名词","min-width":"120px"}),l(D,{prop:"description",label:"描述","min-width":"150px"}),l(D,{prop:"synonyms",label:"同义词","min-width":"120px"}),l(D,{label:"向量化状态","min-width":"120px"},{default:o(b=>[l(T,{type:t.getVectorStatusType(b.row.embeddingStatus),round:""},{default:o(()=>[g(B(b.row.embeddingStatus||"未知")+" ",1),b.row.embeddingStatus==="FAILED"&&b.row.errorMsg?(v(),M(F,{key:0,content:b.row.errorMsg,placement:"top"},{default:o(()=>[l(_,{style:{"margin-left":"4px"}},{default:o(()=>[l(A)]),_:1})]),_:1},8,["content"])):J("",!0)]),_:2},1032,["type"])]),_:1}),l(D,{label:"是否召回","min-width":"80px"},{default:o(b=>[l(T,{type:b.row.isRecall?"success":"info",round:""},{default:o(()=>[g(B(b.row.isRecall?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(D,{prop:"createdTime",label:"创建时间","min-width":"120px"}),l(D,{label:"操作","min-width":"180px"},{default:o(b=>[l(y,{onClick:L=>t.editKnowledge(b.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[10]||(e[10]=[g(" 编辑 ",-1)])]),_:1},8,["onClick"]),b.row.embeddingStatus==="FAILED"?(v(),M(y,{key:0,onClick:L=>t.retryEmbedding(b.row),size:"small",type:"info",round:"",plain:"",loading:t.retryLoadingMap[b.row.id]},{default:o(()=>[...e[11]||(e[11]=[g(" 重试 ",-1)])]),_:1},8,["onClick","loading"])):J("",!0),b.row.isRecall?(v(),M(y,{key:1,onClick:L=>t.toggleRecall(b.row,!1),size:"small",type:"warning",round:"",plain:""},{default:o(()=>[...e[12]||(e[12]=[g(" 取消召回 ",-1)])]),_:1},8,["onClick"])):(v(),M(y,{key:2,onClick:L=>t.toggleRecall(b.row,!0),size:"small",type:"success",round:"",plain:""},{default:o(()=>[...e[13]||(e[13]=[g(" 设为召回 ",-1)])]),_:1},8,["onClick"])),l(y,{onClick:L=>t.deleteKnowledge(b.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[14]||(e[14]=[g(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),l(k,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[5]||(e[5]=b=>t.dialogVisible=b),title:t.isEdit?"编辑业务知识":"添加业务知识",width:"800"},{footer:o(()=>[a("div",Pl,[l(y,{onClick:e[4]||(e[4]=b=>t.dialogVisible=!1)},{default:o(()=>[...e[16]||(e[16]=[g("取消",-1)])]),_:1}),l(y,{type:"primary",onClick:t.saveKnowledge,loading:t.saveLoading,disabled:t.saveLoading},{default:o(()=>[g(B(t.isEdit?"更新":"创建"),1)]),_:1},8,["onClick","loading","disabled"])])]),default:o(()=>[l(N,{model:t.knowledgeForm,"label-width":"100px",ref:"knowledgeFormRef"},{default:o(()=>[l(C,{label:"业务名词",prop:"businessTerm",required:""},{default:o(()=>[l(E,{modelValue:t.knowledgeForm.businessTerm,"onUpdate:modelValue":e[1]||(e[1]=b=>t.knowledgeForm.businessTerm=b),placeholder:"请输入业务名词"},null,8,["modelValue"])]),_:1}),l(C,{label:"描述",prop:"description",required:""},{default:o(()=>[l(E,{modelValue:t.knowledgeForm.description,"onUpdate:modelValue":e[2]||(e[2]=b=>t.knowledgeForm.description=b),type:"textarea",rows:3,placeholder:"请输入业务知识描述"},null,8,["modelValue"])]),_:1}),l(C,{label:"同义词",prop:"synonyms"},{default:o(()=>[l(E,{modelValue:t.knowledgeForm.synonyms,"onUpdate:modelValue":e[3]||(e[3]=b=>t.knowledgeForm.synonyms=b),type:"textarea",rows:2,placeholder:"请输入同义词，多个同义词用逗号分隔"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}const Ml=te(zl,[["render",Kl]]),Ll=ae({name:"BatchImportDialog",components:{UploadFilled:$e},props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:"批量导入"},jsonTemplate:{type:Array,default:()=>[]},validateJson:{type:Function,required:!0},validateExcelFile:{type:Function,required:!0},onJsonImport:{type:Function,required:!0},onExcelImport:{type:Function,required:!0},onDownloadExcelTemplate:{type:Function,required:!0}},emits:["update:modelValue","imported"],setup(t,{emit:e}){const n=$(""),s=$("input"),c=$(null),f=$(!1),u=$("json"),d=$(null),h=se({get:()=>t.modelValue,set:S=>e("update:modelValue",S)}),_=()=>{s.value="input",c.value=null,n.value="",u.value="json",d.value=null};return Te(()=>t.modelValue,S=>{S&&_()}),{dialogVisible:h,importJsonText:n,importTab:s,importResult:c,importing:f,importMode:u,loadTemplate:()=>{n.value=JSON.stringify(t.jsonTemplate,null,2),i.success("模板已加载")},handleValidateJson:()=>t.validateJson(n.value),handleJsonImport:async()=>{if(!t.validateJson(n.value))return;let S;try{S=JSON.parse(n.value)}catch(C){i.error("JSON格式错误："+C.message);return}try{f.value=!0;const C=await t.onJsonImport(S);c.value=C,s.value="result",C.failCount===0?i.success(`批量导入成功！共导入${C.successCount}条记录`):i.warning(`批量导入完成！成功${C.successCount}条，失败${C.failCount}条`),e("imported",C)}catch(C){i.error("批量导入失败："+C.message),console.error("Failed to batch import:",C)}finally{f.value=!1}},handleFileChange:S=>{d.value=S.raw??null},handleExceed:()=>{i.warning("只能上传一个文件")},downloadExcelTemplate:async()=>{try{await t.onDownloadExcelTemplate(),i.success("模板下载成功")}catch(S){i.error("模板下载失败："+S.message),console.error("Failed to download template:",S)}},handleExcelImport:async()=>{if(!(!t.validateExcelFile(d.value)||!d.value))try{f.value=!0;const S=await t.onExcelImport(d.value);c.value=S,s.value="result",S.failCount===0?i.success(`Excel导入成功！共导入${S.successCount}条记录`):i.warning(`Excel导入完成！成功${S.successCount}条，失败${S.failCount}条`),e("imported",S)}catch(S){i.error("Excel导入失败："+S.message),console.error("Failed to import excel:",S)}finally{f.value=!1}}}}}),ql={style:{"margin-top":"10px","text-align":"right"}},Bl={style:{"text-align":"center",padding:"40px 0"}},Ol={style:{"margin-top":"20px"}},Rl={key:0,style:{"text-align":"left","max-height":"300px","overflow-y":"auto"}},jl={style:{"text-align":"right"}};function Jl(t,e,n,s,c,f){const u=r("el-alert"),d=r("el-radio-button"),h=r("el-radio-group"),_=r("el-input"),E=r("el-button"),y=r("el-tab-pane"),K=r("upload-filled"),D=r("el-icon"),A=r("el-upload"),F=r("el-result"),T=r("el-tabs"),S=r("el-dialog");return v(),M(S,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[4]||(e[4]=C=>t.dialogVisible=C),title:t.title,width:"900"},{footer:o(()=>[a("div",jl,[l(E,{onClick:e[3]||(e[3]=C=>t.dialogVisible=!1)},{default:o(()=>[...e[13]||(e[13]=[g("关闭",-1)])]),_:1}),t.importMode==="json"?(v(),M(E,{key:0,type:"primary",onClick:t.handleJsonImport,loading:t.importing},{default:o(()=>[...e[14]||(e[14]=[g(" 开始导入 ",-1)])]),_:1},8,["onClick","loading"])):J("",!0),t.importMode==="excel"?(v(),M(E,{key:1,type:"primary",onClick:t.handleExcelImport,loading:t.importing},{default:o(()=>[...e[15]||(e[15]=[g(" 开始导入 ",-1)])]),_:1},8,["onClick","loading"])):J("",!0)])]),default:o(()=>[l(u,{title:"导入说明",type:"info",closable:!1,style:{"margin-bottom":"20px"}},{default:o(()=>[...e[5]||(e[5]=[a("p",null,"1. 支持JSON和Excel两种导入方式",-1),a("p",null,"2. 如果记录已存在（相同表名+字段名），将自动覆盖更新",-1),a("p",null,'3. 枚举字段信息可以直接写在"业务描述"中，例如：枚举值：1=资产工单, 2=账号工单',-1),a("p",null,"4. 必填字段：表名、字段名、业务名称、数据类型",-1)])]),_:1}),l(h,{modelValue:t.importMode,"onUpdate:modelValue":e[0]||(e[0]=C=>t.importMode=C),style:{"margin-bottom":"20px"}},{default:o(()=>[l(d,{value:"json"},{default:o(()=>[...e[6]||(e[6]=[g("JSON导入",-1)])]),_:1}),l(d,{value:"excel"},{default:o(()=>[...e[7]||(e[7]=[g("Excel导入",-1)])]),_:1})]),_:1},8,["modelValue"]),l(T,{modelValue:t.importTab,"onUpdate:modelValue":e[2]||(e[2]=C=>t.importTab=C)},{default:o(()=>[t.importMode==="json"?(v(),M(y,{key:0,label:"JSON输入",name:"input"},{default:o(()=>[l(_,{modelValue:t.importJsonText,"onUpdate:modelValue":e[1]||(e[1]=C=>t.importJsonText=C),type:"textarea",rows:15,placeholder:"请输入JSON格式的数据...",style:{"font-family":"'Courier New', monospace"}},null,8,["modelValue"]),a("div",ql,[l(E,{onClick:t.loadTemplate,size:"small"},{default:o(()=>[...e[8]||(e[8]=[g("加载模板",-1)])]),_:1},8,["onClick"]),l(E,{onClick:t.handleValidateJson,size:"small",type:"primary"},{default:o(()=>[...e[9]||(e[9]=[g("验证JSON",-1)])]),_:1},8,["onClick"])])]),_:1})):J("",!0),t.importMode==="excel"?(v(),M(y,{key:1,label:"Excel上传",name:"input"},{default:o(()=>[a("div",Bl,[l(A,{ref:"uploadRef","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":t.handleFileChange,"on-exceed":t.handleExceed,drag:""},{tip:o(()=>[...e[10]||(e[10]=[a("div",{class:"el-upload__tip"},"只能上传 xlsx/xls 文件，且不超过 10MB",-1)])]),default:o(()=>[l(D,{class:"el-icon--upload"},{default:o(()=>[l(K)]),_:1}),e[11]||(e[11]=a("div",{class:"el-upload__text"},[g(" 将Excel文件拖到此处，或 "),a("em",null,"点击上传")],-1))]),_:1},8,["on-change","on-exceed"]),a("div",Ol,[l(E,{onClick:t.downloadExcelTemplate,type:"primary",plain:""},{default:o(()=>[...e[12]||(e[12]=[g("下载Excel模板",-1)])]),_:1},8,["onClick"])])])]),_:1})):J("",!0),l(y,{label:"导入结果",name:"result",disabled:!t.importResult},{default:o(()=>[t.importResult?(v(),M(F,{key:0,icon:t.importResult.failCount===0?"success":"warning",title:t.importResult.failCount===0?"导入成功":"部分导入失败"},{"sub-title":o(()=>[a("p",null," 总数："+B(t.importResult.total)+" | 成功："+B(t.importResult.successCount)+" | 失败："+B(t.importResult.failCount),1)]),extra:o(()=>[t.importResult.errors.length>0?(v(),R("div",Rl,[(v(!0),R(Y,null,ye(t.importResult.errors,(C,N)=>(v(),M(u,{key:N,title:C,type:"error",closable:!1,style:{"margin-bottom":"10px"}},null,8,["title"]))),128))])):J("",!0)]),_:1},8,["icon","title"])):J("",!0)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}const Ql=te(Ll,[["render",Jl]]),ee="/api/semantic-model";class Hl{async list(e,n){const s={};return e!==void 0&&(s.agentId=e.toString()),n&&(s.keyword=n),(await U.get(ee,{params:s})).data.data||[]}async get(e){var n;try{return(await U.get(`${ee}/${e}`)).data.data||null}catch(s){if(U.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return null;throw s}}async create(e){return(await U.post(ee,e)).data.success}async update(e,n){var s;try{return(await U.put(`${ee}/${e}`,n)).data.success}catch(c){if(U.isAxiosError(c)&&((s=c.response)==null?void 0:s.status)===404)return!1;throw c}}async delete(e){var n;try{return(await U.delete(`${ee}/${e}`)).data.success}catch(s){if(U.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return!1;throw s}}async batchDelete(e){return(await U.delete(`${ee}/batch`,{data:e})).data.success}async enable(e){return(await U.put(`${ee}/enable`,e)).data.success}async disable(e){return(await U.put(`${ee}/disable`,e)).data.success}async batchImport(e){return(await U.post(`${ee}/batch-import`,e)).data.data||{total:0,successCount:0,failCount:0,errors:[]}}async importExcel(e,n){const s=new FormData;return s.append("file",e),s.append("agentId",n.toString()),(await U.post(`${ee}/import/excel`,s,{headers:{"Content-Type":"multipart/form-data"}})).data.data||{total:0,successCount:0,failCount:0,errors:[]}}async downloadTemplate(){const e=await U.get(`${ee}/template/download`,{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=n,s.setAttribute("download","semantic_model_template.xlsx"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(n)}}const le=new Hl,Gl=ae({name:"AgentSemanticsConfig",components:{UploadFilled:$e,Search:Ce,BatchImportDialog:Ql},props:{agentId:{type:Number,required:!0}},setup(t){const e=$([]),n=$(!1),s=$(!1),c=$(""),f=$([]),u=$({tableName:"",columnName:"",businessName:"",synonyms:"",businessDescription:"",columnComment:"",dataType:"",status:1,agentId:t.agentId}),d=$(null),h=()=>{s.value=!1,u.value={tableName:"",columnName:"",businessName:"",synonyms:"",businessDescription:"",columnComment:"",dataType:"",status:1,agentId:t.agentId},n.value=!0},_=q=>{f.value=q},E=async()=>{if(f.value.length===0){i.warning("请先选择要删除的语义模型");return}try{await Z.confirm(`确定要删除选中的 ${f.value.length} 个语义模型吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const q=f.value.map(I=>I.id).filter(I=>I!==void 0);await le.batchDelete(q)?(i.success(`成功删除 ${q.length} 个语义模型`),f.value=[],await K()):i.error("批量删除失败")}catch{}},y=()=>{K()},K=async()=>{try{e.value=await le.list(t.agentId,c.value||void 0)}catch(q){i.error("加载语义模型列表失败"),console.error("Failed to load semantic models:",q)}},D=q=>{s.value=!0,d.value=q.id||null,u.value={...q},n.value=!0},A=async q=>{if(q.id)try{await Z.confirm(`确定要删除语义模型 "${q.businessName}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await le.delete(q.id)?(i.success("删除成功"),await K()):i.error("删除失败")}catch{}},F=async(q,j)=>{if(q.id)try{const I=[q.id];let w=!1;j===1?w=await le.enable(I):w=await le.disable(I),w?(i.success(`${j===1?"启用":"停用"}成功`),q.status=j):i.error(`${j===1?"启用":"停用"}失败`)}catch(I){i.error(`${j===1?"启用":"停用"}失败`),console.error("Failed to toggle status:",I)}},T=async()=>{try{if(s.value&&d.value){const q={...u.value,id:d.value};if(await le.update(d.value,q))i.success("更新成功");else{i.error("更新失败");return}}else{const q={agentId:t.agentId,tableName:u.value.tableName,columnName:u.value.columnName,businessName:u.value.businessName,synonyms:u.value.synonyms,businessDescription:u.value.businessDescription,columnComment:u.value.columnComment,dataType:u.value.dataType};if(await le.create(q))i.success("创建成功");else{i.error("创建失败");return}}n.value=!1,await K()}catch(q){i.error(`${s.value?"更新":"创建"}失败`),console.error("Failed to save model:",q)}};ve(()=>{K()});const S=$(!1);return{Plus:De,Search:Ce,Delete:ze,semanticModelList:e,dialogVisible:n,isEdit:s,searchKeyword:c,selectedModels:f,modelForm:u,openCreateDialog:h,handleSelectionChange:_,batchDeleteModels:E,editModel:D,deleteModel:A,toggleStatus:F,saveModel:T,handleSearch:y,batchImportDialogVisible:S,jsonTemplate:[{tableName:"work_order",columnName:"order_type",businessName:"工单类型",synonyms:"类型,工单种类",businessDesc:"用于区分工单种类。枚举值：1=资产工单, 2=账号工单",dataType:"int"},{tableName:"work_order",columnName:"status",businessName:"工单状态",synonyms:"状态,处理状态",businessDesc:"工单当前处理状态。枚举值：0=待处理 1=处理中 2=已完成 3=已关闭",dataType:"int"}],openBatchImportDialog:()=>{S.value=!0},validateJson:q=>{try{const j=JSON.parse(q);if(!Array.isArray(j))return i.error("JSON格式错误：数据必须是数组"),!1;if(j.length===0)return i.error("导入数据不能为空"),!1;for(let I=0;I<j.length;I++){const w=j[I];if(!w.tableName||!w.columnName||!w.businessName||!w.dataType)return i.error(`第${I+1}条记录缺少必填字段（tableName, columnName, businessName, dataType）`),!1}return i.success("JSON格式验证通过"),!0}catch(j){return i.error("JSON格式错误："+j.message),!1}},validateExcelFile:q=>q?!0:(i.error("请先选择Excel文件"),!1),executeBatchImport:async q=>{try{return await le.batchImport({agentId:t.agentId,items:q})}catch(j){throw i.error("批量导入失败："+j.message),console.error("Failed to batch import:",j),j}},downloadExcelTemplate:async()=>{try{await le.downloadTemplate(),i.success("模板下载成功")}catch(q){i.error("模板下载失败："+q.message),console.error("Failed to download template:",q)}},executeExcelImport:async q=>{try{return await le.importExcel(q,t.agentId)}catch(j){throw i.error("Excel导入失败："+j.message),console.error("Failed to import excel:",j),j}},handleBatchImported:async()=>{await K()},formatDateTime:q=>{if(!q)return"-";try{return new Date(q).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return q}}}}}),Wl={style:{padding:"20px"}},Xl={style:{"margin-bottom":"30px"}},Yl={style:{"text-align":"right"}};function Zl(t,e,n,s,c,f){const u=r("el-divider"),d=r("el-button"),h=r("el-col"),_=r("Search"),E=r("el-icon"),y=r("el-input"),K=r("UploadFilled"),D=r("el-row"),A=r("el-table-column"),F=r("el-tag"),T=r("el-table"),S=r("el-form-item"),C=r("el-form"),N=r("el-dialog"),k=r("BatchImportDialog");return v(),R(Y,null,[a("div",Wl,[e[18]||(e[18]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"语义模型管理")],-1)),l(u),a("div",Xl,[l(D,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(h,{span:12},{default:o(()=>[e[11]||(e[11]=a("h3",null,"语义模型列表",-1)),t.selectedModels.length>0?(v(),M(d,{key:0,onClick:t.batchDeleteModels,size:"default",type:"danger",plain:"",icon:t.Delete,style:{"margin-left":"10px"}},{default:o(()=>[g(" 批量删除 ("+B(t.selectedModels.length)+") ",1)]),_:1},8,["onClick","icon"])):J("",!0)]),_:1}),l(h,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(y,{modelValue:t.searchKeyword,"onUpdate:modelValue":e[0]||(e[0]=b=>t.searchKeyword=b),placeholder:"请输入关键词，并按回车搜索",style:{width:"250px","margin-right":"10px"},clearable:"",onClear:t.handleSearch,onKeyup:Ee(t.handleSearch,["enter"]),size:"large"},{prefix:o(()=>[l(E,null,{default:o(()=>[l(_)]),_:1})]),_:1},8,["modelValue","onClear","onKeyup"]),l(d,{onClick:t.openBatchImportDialog,size:"large",type:"success",round:""},{default:o(()=>[l(E,null,{default:o(()=>[l(K)]),_:1}),e[12]||(e[12]=g(" 批量导入 ",-1))]),_:1},8,["onClick"]),l(d,{onClick:t.openCreateDialog,size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[13]||(e[13]=[g(" 添加语义模型 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1})]),l(T,{data:t.semanticModelList,style:{width:"100%"},border:"",onSelectionChange:t.handleSelectionChange},{default:o(()=>[l(A,{type:"selection",width:"55"}),l(A,{prop:"id",label:"ID","min-width":"60px"}),l(A,{prop:"tableName",label:"表名","min-width":"120px"}),l(A,{prop:"columnName",label:"数据库字段名","min-width":"120px"}),l(A,{prop:"businessName",label:"业务名称","min-width":"120px"}),l(A,{prop:"synonyms",label:"同义词","min-width":"120px"}),l(A,{prop:"dataType",label:"数据类型","min-width":"80px"}),l(A,{label:"状态","min-width":"80px"},{default:o(b=>[l(F,{type:b.row.status===1?"success":"info",round:""},{default:o(()=>[g(B(b.row.status===1?"启用":"停用"),1)]),_:2},1032,["type"])]),_:1}),l(A,{label:"创建时间","min-width":"160px"},{default:o(b=>[g(B(t.formatDateTime(b.row.createdTime||b.row.createTime)),1)]),_:1}),l(A,{label:"操作","min-width":"180px"},{default:o(b=>[l(d,{onClick:L=>t.editModel(b.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[14]||(e[14]=[g(" 编辑 ",-1)])]),_:1},8,["onClick"]),b.row.status===0?(v(),M(d,{key:0,onClick:L=>t.toggleStatus(b.row,1),size:"small",type:"success",round:"",plain:""},{default:o(()=>[...e[15]||(e[15]=[g(" 启用 ",-1)])]),_:1},8,["onClick"])):(v(),M(d,{key:1,onClick:L=>t.toggleStatus(b.row,0),size:"small",type:"warning",round:"",plain:""},{default:o(()=>[...e[16]||(e[16]=[g(" 停用 ",-1)])]),_:1},8,["onClick"])),l(d,{onClick:L=>t.deleteModel(b.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[17]||(e[17]=[g(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])]),l(N,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[9]||(e[9]=b=>t.dialogVisible=b),title:t.isEdit?"编辑语义模型":"添加语义模型",width:"800"},{footer:o(()=>[a("div",Yl,[l(d,{onClick:e[8]||(e[8]=b=>t.dialogVisible=!1)},{default:o(()=>[...e[19]||(e[19]=[g("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:t.saveModel},{default:o(()=>[g(B(t.isEdit?"更新":"创建"),1)]),_:1},8,["onClick"])])]),default:o(()=>[l(C,{model:t.modelForm,"label-width":"120px",ref:"modelFormRef"},{default:o(()=>[l(S,{label:"表名",prop:"tableName",required:""},{default:o(()=>[l(y,{modelValue:t.modelForm.tableName,"onUpdate:modelValue":e[1]||(e[1]=b=>t.modelForm.tableName=b),placeholder:"请输入表名"},null,8,["modelValue"])]),_:1}),l(S,{label:"数据库字段名",prop:"columnName",required:""},{default:o(()=>[l(y,{modelValue:t.modelForm.columnName,"onUpdate:modelValue":e[2]||(e[2]=b=>t.modelForm.columnName=b),placeholder:"请输入数据库字段名"},null,8,["modelValue"])]),_:1}),l(S,{label:"业务名称",prop:"businessName",required:""},{default:o(()=>[l(y,{modelValue:t.modelForm.businessName,"onUpdate:modelValue":e[3]||(e[3]=b=>t.modelForm.businessName=b),placeholder:"请输入业务名称"},null,8,["modelValue"])]),_:1}),l(S,{label:"同义词",prop:"synonyms"},{default:o(()=>[l(y,{modelValue:t.modelForm.synonyms,"onUpdate:modelValue":e[4]||(e[4]=b=>t.modelForm.synonyms=b),type:"textarea",rows:2,placeholder:"请输入同义词，多个同义词用逗号分隔"},null,8,["modelValue"])]),_:1}),l(S,{label:"业务描述",prop:"businessDescription"},{default:o(()=>[l(y,{modelValue:t.modelForm.businessDescription,"onUpdate:modelValue":e[5]||(e[5]=b=>t.modelForm.businessDescription=b),type:"textarea",rows:3,placeholder:"请输入业务描述，用于向LLM解释字段的业务含义"},null,8,["modelValue"])]),_:1}),l(S,{label:"字段注释",prop:"columnComment"},{default:o(()=>[l(y,{modelValue:t.modelForm.columnComment,"onUpdate:modelValue":e[6]||(e[6]=b=>t.modelForm.columnComment=b),type:"textarea",rows:2,placeholder:"请输入数据库字段的原始注释"},null,8,["modelValue"])]),_:1}),l(S,{label:"数据类型",prop:"dataType",required:""},{default:o(()=>[l(y,{modelValue:t.modelForm.dataType,"onUpdate:modelValue":e[7]||(e[7]=b=>t.modelForm.dataType=b),placeholder:"请输入数据类型，如：int, varchar(20)"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(k,{modelValue:t.batchImportDialogVisible,"onUpdate:modelValue":e[10]||(e[10]=b=>t.batchImportDialogVisible=b),title:"批量导入语义模型","json-template":t.jsonTemplate,"validate-json":t.validateJson,"validate-excel-file":t.validateExcelFile,"on-json-import":t.executeBatchImport,"on-excel-import":t.executeExcelImport,"on-download-excel-template":t.downloadExcelTemplate,onImported:t.handleBatchImported},null,8,["modelValue","json-template","validate-json","validate-excel-file","on-json-import","on-excel-import","on-download-excel-template","onImported"])],64)}const xl=te(Gl,[["render",Zl]]),eo=ae({name:"Pagination",props:{total:{type:Number,required:!0,default:0},pageNum:{type:Number,default:1},pageSize:{type:Number,default:10},pageSizes:{type:Array,default:()=>[10,20,50,100]},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0}},emits:["change","update:pageNum","update:pageSize"],setup(t,{emit:e}){const n=$(t.pageNum),s=$(t.pageSize);Te(()=>t.pageNum,d=>{n.value=d}),Te(()=>t.pageSize,d=>{s.value=d});const c=d=>{s.value=d,n.value=1,u()},f=d=>{n.value=d,u()},u=()=>{e("update:pageNum",n.value),e("update:pageSize",s.value),e("change",{pageNum:n.value,pageSize:s.value})};return{currentPage:n,currentPageSize:s,handleSizeChange:c,handleCurrentChange:f}}}),to={key:0,class:"pagination-container"};function lo(t,e,n,s,c,f){const u=r("el-pagination");return t.total>0?(v(),R("div",to,[l(u,{"current-page":t.currentPage,"onUpdate:currentPage":e[0]||(e[0]=d=>t.currentPage=d),"page-size":t.currentPageSize,"onUpdate:pageSize":e[1]||(e[1]=d=>t.currentPageSize=d),"page-sizes":t.pageSizes,total:t.total,layout:t.layout,background:t.background,onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","page-sizes","total","layout","background","onSizeChange","onCurrentChange"])])):J("",!0)}const oo=te(eo,[["render",lo],["__scopeId","data-v-676d1602"]]),ao=ae({name:"AgentPresetsConfig",components:{Pagination:oo},props:{agentId:{type:Number,required:!0}},setup(t){const e=$([]),n=$(!1),s=$(!1),c=$({agentId:t.agentId,question:"",sortOrder:0,isActive:!0}),f=$(null),u=$({keyword:"",isActive:null,dateRange:[]}),d=$({pageNum:1,pageSize:10,total:0}),h=$([]),_=C=>{h.value=C},E=()=>{s.value=!1,c.value={agentId:t.agentId,question:"",sortOrder:0,isActive:!0},n.value=!0},y=async()=>{try{const C={pageNum:d.value.pageNum,pageSize:d.value.pageSize,keyword:u.value.keyword||void 0,isActive:u.value.isActive??void 0};u.value.dateRange&&u.value.dateRange.length===2&&(C.createTimeStart=u.value.dateRange[0],C.createTimeEnd=u.value.dateRange[1]);const N=await ke.queryPage(t.agentId,C);N.success?(e.value=N.data,d.value.total=N.total):i.error(N.message||"Failed to load preset questions")}catch(C){i.error("加载预设问题列表失败"),console.error("Load preset questions failed:",C)}},K=()=>{d.value.pageNum=1,y()},D=()=>{u.value={keyword:"",isActive:null,dateRange:[]},K()},A=async()=>{if(h.value.length===0){i.warning("请选择要删除的记录");return}try{await Z.confirm(`确定要删除 ${h.value.length} 条预设问题吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const C=h.value.map(k=>k.id).filter(k=>k!==void 0);await ke.batchDelete(t.agentId,C)?(i.success("批量删除成功"),h.value=[],await y()):i.error("批量删除失败")}catch(C){C!=="cancel"&&(i.error("批量删除失败"),console.error("Batch delete error:",C))}},F=C=>{s.value=!0,f.value=C.id||null,c.value={...C},n.value=!0},T=async C=>{if(C.id)try{await Z.confirm(`确定要删除预设问题 "${C.question.substring(0,50)}..." 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ke.delete(t.agentId,C.id)?(i.success("删除成功"),await y()):i.error("删除失败")}catch{}},S=async()=>{try{if(!c.value.question||c.value.question.trim()===""){i.error("请输入预设问题");return}const C=await ke.queryPage(t.agentId,{pageNum:1,pageSize:1e3});if(!C.success){i.error("获取完整列表失败");return}const N=C.data;let k=[];if(s.value&&f.value?k=N.map(L=>{const P={question:L.id===f.value?c.value.question:L.question};return L.id===f.value?P.isActive=c.value.isActive===!0:P.isActive=L.isActive===!0,P}):k=[...N.map(L=>({question:L.question,isActive:L.isActive===!0})),{question:c.value.question,isActive:c.value.isActive===!0}],console.log("发送的数据:",JSON.stringify(k)),await ke.batchSave(t.agentId,k))i.success(s.value?"更新成功":"创建成功");else{i.error(s.value?"更新失败":"创建失败");return}n.value=!1,await y()}catch(C){i.error(`${s.value?"更新":"创建"}失败`),console.error("保存预设问题失败:",C)}};return ve(()=>{y()}),{Plus:De,Delete:ze,presetQuestionList:e,dialogVisible:n,isEdit:s,questionForm:c,searchForm:u,pagination:d,selectedRows:h,handleSelectionChange:_,openCreateDialog:E,editQuestion:F,deleteQuestion:T,saveQuestion:S,loadPresetQuestions:y,handleSearch:K,handleReset:D,handleBatchDelete:A}}}),no={style:{padding:"20px"}},so={style:{"margin-bottom":"30px"}},ro={style:{"text-align":"right"}};function io(t,e,n,s,c,f){const u=r("el-divider"),d=r("el-input"),h=r("el-form-item"),_=r("el-option"),E=r("el-select"),y=r("el-date-picker"),K=r("el-button"),D=r("el-form"),A=r("el-col"),F=r("el-row"),T=r("el-table-column"),S=r("el-tag"),C=r("el-table"),N=r("Pagination"),k=r("el-input-number"),b=r("el-switch"),L=r("el-dialog");return v(),R(Y,null,[a("div",no,[e[15]||(e[15]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"预设问题管理")],-1)),l(u),l(D,{inline:!0,model:t.searchForm,style:{"margin-bottom":"20px"}},{default:o(()=>[l(h,{label:"关键词"},{default:o(()=>[l(d,{modelValue:t.searchForm.keyword,"onUpdate:modelValue":e[0]||(e[0]=P=>t.searchForm.keyword=P),placeholder:"搜索问题内容",clearable:"",onClear:t.handleSearch,style:{width:"200px"}},null,8,["modelValue","onClear"])]),_:1}),l(h,{label:"状态"},{default:o(()=>[l(E,{modelValue:t.searchForm.isActive,"onUpdate:modelValue":e[1]||(e[1]=P=>t.searchForm.isActive=P),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:o(()=>[l(_,{label:"启用",value:!0}),l(_,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),_:1}),l(h,{label:"创建时间"},{default:o(()=>[l(y,{modelValue:t.searchForm.dateRange,"onUpdate:modelValue":e[2]||(e[2]=P=>t.searchForm.dateRange=P),type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),l(h,null,{default:o(()=>[l(K,{type:"primary",onClick:t.handleSearch},{default:o(()=>[...e[10]||(e[10]=[g("搜索",-1)])]),_:1},8,["onClick"]),l(K,{onClick:t.handleReset},{default:o(()=>[...e[11]||(e[11]=[g("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),a("div",so,[l(F,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(A,{span:12},{default:o(()=>[t.selectedRows.length>0?(v(),M(K,{key:0,onClick:t.handleBatchDelete,type:"danger",plain:"",icon:t.Delete},{default:o(()=>[g(" 批量删除 ("+B(t.selectedRows.length)+") ",1)]),_:1},8,["onClick","icon"])):J("",!0)]),_:1}),l(A,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(K,{onClick:t.openCreateDialog,size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[12]||(e[12]=[g(" 添加问题 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1})]),l(C,{data:t.presetQuestionList,onSelectionChange:t.handleSelectionChange,style:{width:"100%"},border:""},{default:o(()=>[l(T,{type:"selection",width:"55"}),l(T,{prop:"id",label:"ID","min-width":"60px"}),l(T,{prop:"question",label:"问题","min-width":"250px","show-overflow-tooltip":""}),l(T,{prop:"sortOrder",label:"排序","min-width":"80px"}),l(T,{label:"状态","min-width":"80px"},{default:o(P=>[l(S,{type:P.row.isActive?"success":"info",round:""},{default:o(()=>[g(B(P.row.isActive?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(T,{prop:"createTime",label:"创建时间","min-width":"150px"}),l(T,{label:"操作","min-width":"200px"},{default:o(P=>[l(K,{onClick:z=>t.editQuestion(P.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[13]||(e[13]=[g(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(K,{onClick:z=>t.deleteQuestion(P.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[14]||(e[14]=[g(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"]),l(N,{"page-num":t.pagination.pageNum,"onUpdate:pageNum":e[3]||(e[3]=P=>t.pagination.pageNum=P),"page-size":t.pagination.pageSize,"onUpdate:pageSize":e[4]||(e[4]=P=>t.pagination.pageSize=P),total:t.pagination.total,"page-sizes":[10,20,50,100],onChange:t.loadPresetQuestions},null,8,["page-num","page-size","total","onChange"])]),l(L,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[9]||(e[9]=P=>t.dialogVisible=P),title:t.isEdit?"编辑预设问题":"添加预设问题",width:"600"},{footer:o(()=>[a("div",ro,[l(K,{onClick:e[8]||(e[8]=P=>t.dialogVisible=!1)},{default:o(()=>[...e[16]||(e[16]=[g("取消",-1)])]),_:1}),l(K,{type:"primary",onClick:t.saveQuestion},{default:o(()=>[g(B(t.isEdit?"更新":"创建"),1)]),_:1},8,["onClick"])])]),default:o(()=>[l(D,{model:t.questionForm,"label-width":"80px",ref:"questionFormRef"},{default:o(()=>[l(h,{label:"问题",prop:"question",required:""},{default:o(()=>[l(d,{modelValue:t.questionForm.question,"onUpdate:modelValue":e[5]||(e[5]=P=>t.questionForm.question=P),type:"textarea",rows:4,placeholder:"请输入预设问题"},null,8,["modelValue"])]),_:1}),l(h,{label:"排序",prop:"sortOrder"},{default:o(()=>[l(k,{modelValue:t.questionForm.sortOrder,"onUpdate:modelValue":e[6]||(e[6]=P=>t.questionForm.sortOrder=P),min:0,"controls-position":"right"},null,8,["modelValue"])]),_:1}),l(h,{label:"状态",prop:"isActive"},{default:o(()=>[l(b,{modelValue:t.questionForm.isActive,"onUpdate:modelValue":e[7]||(e[7]=P=>t.questionForm.isActive=P)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}const uo=te(ao,[["render",io]]),po=ae({name:"AgentAccessApi",props:{agentId:{type:[Number,String],required:!1,default:null}},setup(t){const e=lt(),n=se(()=>Number(t.agentId??e.params.id)),s=$(null),c=$(!1),f=$(!0),u=$(!1),d=$({generate:!1,reset:!1,delete:!1,toggle:!1,fetch:!1}),h=$("curl"),_=$({title:"AI 助手",position:"bottom-right",primaryColor:"#409EFF",welcomeMessage:"您好！我是 AI 助手，有什么可以帮您的吗？"}),E=z=>z?z.startsWith("****")?z:z.length<=8?"****":"****"+z.slice(-4):"",y=se(()=>s.value?f.value?E(s.value):s.value:""),K=se(()=>{const z=window.location.origin,Q=n.value;return`# 创建会话
curl -X POST "${z}/api/agent/${Q}/sessions" \\
  -H "Content-Type: application/json" \\
  -H "X-API-Key: <your_api_key>" \\
  -d '{"title":"demo"}'

# 发送消息
curl -X POST "${z}/api/sessions/<sessionId>/messages" \\
  -H "Content-Type: application/json" \\
  -H "X-API-Key: <your_api_key>" \\
  -d '{"role":"user","content":"给我一个示例","messageType":"text"}'`}),D=se(()=>{const z=window.location.origin,Q=n.value;return String.raw`const apiKey = '<your_api_key>';
const baseUrl = '${z}/api';
const agentId = ${Q};

(async () => {
  // 创建会话
  const sessionRes = await fetch(\`${"${baseUrl}"}/agent/${"${agentId}"}/sessions\`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-API-Key': apiKey,
    },
    body: JSON.stringify({ title: 'demo' }),
  });
  const session = await sessionRes.json();

  // 发送消息
  await fetch(\`${"${baseUrl}"}/sessions/${"${session.id}"}/messages\`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-API-Key': apiKey,
    },
    body: JSON.stringify({ role: 'user', content: '你好', messageType: 'text' }),
  });
})();`}),A=se(()=>{const z=window.location.origin,Q=n.value;return`import requests

api_key = '<your_api_key>'
base_url = '${z}/api'

headers = {
    'Content-Type': 'application/json',
    'X-API-Key': api_key,
}

# 创建会话
session_resp = requests.post(
    f"{base_url}/agent/${Q}/sessions",
    headers=headers,
    json={"title": "demo"},
)
session_id = session_resp.json().get("id")

# 发送消息
requests.post(
    f"{base_url}/sessions/{session_id}/messages",
    headers=headers,
    json={"role": "user", "content": "你好", "messageType": "text"},
)
`}),F=se(()=>{const z=window.location.origin,Q=n.value,X=_.value,q=JSON.stringify({agentId:Q,apiKey:"<your_api_key>",title:X.title,position:X.position,primaryColor:X.primaryColor,welcomeMessage:X.welcomeMessage},null,2),j="<script>",I="<\/script>";return`<!-- 将以下代码添加到您的网页 </body> 标签之前 -->
${j}
  window.DataAgentConfig = ${q};
${I}
${j} src="${z}/widget.js"${I}`}),T=async()=>{d.value.fetch=!0;try{const z=await re.getApiKey(n.value);s.value=(z==null?void 0:z.apiKey)??null,c.value=!!(z!=null&&z.apiKeyEnabled),f.value=!0,u.value=!1}catch{i.error("获取 API Key 失败")}finally{d.value.fetch=!1}},S=async()=>{d.value.generate=!0;try{const z=await re.generateApiKey(n.value);s.value=z.apiKey,c.value=!!z.apiKeyEnabled,f.value=!1,u.value=!0,i.success("已生成 API Key")}catch{i.error("生成失败")}finally{d.value.generate=!1}},C=async()=>{if(!s.value){await S();return}d.value.reset=!0;try{const z=await re.resetApiKey(n.value);s.value=z.apiKey,c.value=!!z.apiKeyEnabled,f.value=!1,u.value=!0,i.success("已重置 API Key")}catch{i.error("重置失败")}finally{d.value.reset=!1}},N=async()=>{if(s.value){try{await Z.confirm("确认删除当前 API Key？删除后需重新生成。","提示",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"})}catch{return}d.value.delete=!0;try{const z=await re.deleteApiKey(n.value);s.value=z.apiKey,c.value=!!z.apiKeyEnabled,f.value=!0,u.value=!1,i.success("已删除 API Key")}catch{i.error("删除失败")}finally{d.value.delete=!1}}},k=async()=>{if(!u.value||!s.value){i.info("请重新生成或重置后复制完整 Key");return}await Pe(s.value)?i.success("已复制到剪贴板"):i.error("复制失败，请手动复制")},b=()=>{s.value&&(f.value=!f.value)},L=async z=>{d.value.toggle=!0;try{const Q=await re.toggleApiKey(n.value,z);c.value=!!Q.apiKeyEnabled,s.value=Q.apiKey,f.value=!0,u.value=!1,i.success(z?"已启用 API Key":"已禁用 API Key")}catch{c.value=!z,i.error("切换失败")}finally{d.value.toggle=!1}},P=async()=>{await Pe(F.value)?i.success("嵌入代码已复制到剪贴板"):i.error("复制失败，请手动复制")};return ve(()=>{T()}),{apiKey:s,apiKeyEnabled:c,masked:f,canCopy:u,loading:d,exampleTab:h,displayKey:y,curlExample:K,jsExample:D,pyExample:A,embedConfig:_,embedCode:F,handleGenerate:S,handleReset:C,handleDelete:N,handleCopy:k,handleToggle:L,toggleMask:b,handleCopyEmbedCode:P,DocumentCopy:tt}}}),mo={class:"access-api"},co={class:"section"},go={class:"card"},fo={class:"row"},yo={class:"row key-row"},vo={class:"section"},bo={class:"code"},wo={class:"code"},ho={class:"code"},Co={class:"embed-section"},ko={class:"embed-config"},Vo={class:"embed-code-wrapper"},$o={class:"embed-code-header"},Do={class:"code"};function _o(t,e,n,s,c,f){const u=r("el-switch"),d=r("el-tag"),h=r("el-input"),_=r("el-button"),E=r("el-alert"),y=r("el-tab-pane"),K=r("el-form-item"),D=r("el-option"),A=r("el-select"),F=r("el-color-picker"),T=r("el-form"),S=r("DocumentCopy"),C=r("el-icon"),N=r("el-tabs");return v(),R("div",mo,[a("section",co,[e[13]||(e[13]=a("h3",null,"访问 API Key",-1)),e[14]||(e[14]=a("p",{class:"desc"},"为该智能体生成并管理 API Key，用于外部系统访问。",-1)),a("div",go,[a("div",fo,[e[8]||(e[8]=a("div",{class:"label"},"API Key 状态",-1)),l(u,{modelValue:t.apiKeyEnabled,"onUpdate:modelValue":e[0]||(e[0]=k=>t.apiKeyEnabled=k),disabled:!t.apiKey,"active-text":"已启用","inactive-text":"已禁用",onChange:t.handleToggle},null,8,["modelValue","disabled","onChange"]),t.apiKey?J("",!0):(v(),M(d,{key:0,type:"info",size:"small",class:"tag"},{default:o(()=>[...e[7]||(e[7]=[g("未生成",-1)])]),_:1}))]),a("div",yo,[e[12]||(e[12]=a("div",{class:"label"},"当前 Key",-1)),l(h,{modelValue:t.displayKey,"onUpdate:modelValue":e[1]||(e[1]=k=>t.displayKey=k),class:"key-input",readonly:"",placeholder:"尚未生成 API Key"},null,8,["modelValue"]),l(_,{type:"primary",onClick:t.handleGenerate,loading:t.loading.generate},{default:o(()=>[g(B(t.apiKey?"重新生成":"生成 Key"),1)]),_:1},8,["onClick","loading"]),l(_,{onClick:t.handleReset,disabled:!t.apiKey,loading:t.loading.reset},{default:o(()=>[...e[9]||(e[9]=[g(" 重置 ",-1)])]),_:1},8,["onClick","disabled","loading"]),l(_,{onClick:t.handleDelete,disabled:!t.apiKey,loading:t.loading.delete},{default:o(()=>[...e[10]||(e[10]=[g(" 删除 ",-1)])]),_:1},8,["onClick","disabled","loading"]),l(_,{onClick:t.handleCopy,disabled:!t.apiKey||!t.canCopy},{default:o(()=>[...e[11]||(e[11]=[g("复制",-1)])]),_:1},8,["onClick","disabled"]),l(_,{onClick:t.toggleMask,disabled:!t.apiKey},{default:o(()=>[g(B(t.masked?"显示":"隐藏"),1)]),_:1},8,["onClick","disabled"])]),!t.canCopy&&t.apiKey?(v(),M(E,{key:0,type:"info",closable:!1,"show-icon":"",title:"为安全起见，已生成/重置时才显示完整 Key，之后仅显示掩码。如需复制请重新生成/重置。"})):J("",!0)])]),a("section",vo,[e[18]||(e[18]=a("h3",null,"调用示例",-1)),e[19]||(e[19]=a("p",{class:"desc"},"使用 `X-API-Key` 请求头调用会话接口。",-1)),l(N,{modelValue:t.exampleTab,"onUpdate:modelValue":e[6]||(e[6]=k=>t.exampleTab=k)},{default:o(()=>[l(y,{label:"curl",name:"curl"},{default:o(()=>[a("pre",bo,[a("code",null,B(t.curlExample),1)])]),_:1}),l(y,{label:"JavaScript",name:"js"},{default:o(()=>[a("pre",wo,[a("code",null,B(t.jsExample),1)])]),_:1}),l(y,{label:"Python",name:"py"},{default:o(()=>[a("pre",ho,[a("code",null,B(t.pyExample),1)])]),_:1}),l(y,{label:"网页嵌入",name:"embed"},{default:o(()=>[a("div",Co,[e[17]||(e[17]=a("p",{class:"embed-desc"}," 在您的网站中添加以下代码，即可嵌入 AI 智能体聊天窗口。窗口将显示为页面右下角的浮动按钮。 ",-1)),a("div",ko,[l(T,{"label-width":"120px",size:"default"},{default:o(()=>[l(K,{label:"窗口标题"},{default:o(()=>[l(h,{modelValue:t.embedConfig.title,"onUpdate:modelValue":e[2]||(e[2]=k=>t.embedConfig.title=k),placeholder:"AI 助手"},null,8,["modelValue"])]),_:1}),l(K,{label:"按钮位置"},{default:o(()=>[l(A,{modelValue:t.embedConfig.position,"onUpdate:modelValue":e[3]||(e[3]=k=>t.embedConfig.position=k),style:{width:"100%"}},{default:o(()=>[l(D,{label:"右下角",value:"bottom-right"}),l(D,{label:"左下角",value:"bottom-left"})]),_:1},8,["modelValue"])]),_:1}),l(K,{label:"主题色"},{default:o(()=>[l(F,{modelValue:t.embedConfig.primaryColor,"onUpdate:modelValue":e[4]||(e[4]=k=>t.embedConfig.primaryColor=k)},null,8,["modelValue"])]),_:1}),l(K,{label:"欢迎消息"},{default:o(()=>[l(h,{modelValue:t.embedConfig.welcomeMessage,"onUpdate:modelValue":e[5]||(e[5]=k=>t.embedConfig.welcomeMessage=k),type:"textarea",rows:2,placeholder:"您好！我是 Audaque DataAgent AI 助手，有什么可以帮您的吗？"},null,8,["modelValue"])]),_:1})]),_:1})]),a("div",Vo,[a("div",$o,[e[16]||(e[16]=a("span",null,"嵌入代码",-1)),l(_,{size:"small",onClick:t.handleCopyEmbedCode},{default:o(()=>[l(C,null,{default:o(()=>[l(S)]),_:1}),e[15]||(e[15]=g(" 复制代码 ",-1))]),_:1},8,["onClick"])]),a("pre",Do,[a("code",null,B(t.embedCode),1)])]),l(E,{type:"warning",closable:!1,"show-icon":"",title:"注意：请确保已生成并启用 API Key，否则嵌入的聊天窗口将无法正常工作。"})])]),_:1})]),_:1},8,["modelValue"])])])}const So=te(po,[["render",_o],["__scopeId","data-v-4f41159d"]]),me="/api/datasource";class To{async getAllDatasource(e,n){const s=new URLSearchParams;return e&&s.append("status",e),n&&s.append("type",n),(await U.get(`${me}${s.toString()?`?${s.toString()}`:""}`)).data}async getDatasourceById(e){var n;try{return(await U.get(`${me}/${e}`)).data}catch(s){if(U.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return null;throw s}}async getDatasourceTables(e){var n;try{return(await U.get(`${me}/${e}/tables`)).data}catch(s){if(U.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===400)return[];throw s}}async createDatasource(e){return(await U.post(me,e)).data}async updateDatasource(e,n){return(await U.put(`${me}/${e}`,n)).data}async deleteDatasource(e){return(await U.delete(`${me}/${e}`)).data}async testConnection(e){return(await U.post(`${me}/${e}/test`)).data}}const ce=new To,ge=t=>`/api/agent/${t}/datasources`;class Ao{async initSchema(e){try{return(await U.post(`${ge(e)}/init`)).data}catch(n){throw new Error(`初始化Schema失败: ${n}`)}}async getAgentDatasource(e){try{const n=await U.get(ge(String(e)));if(n.data.success)return n.data.data||[];throw new Error(n.data.message)}catch(n){throw new Error(`获取数据源列表失败: ${n}`)}}async getActiveAgentDatasource(e){try{const n=await U.get(ge(String(e))+"/active");if(n.data.success){if(n.data.data===void 0)throw new Error("后端错误");return n.data.data}throw new Error(n.data.message)}catch(n){throw new Error(`获取数据源列表失败: ${n}`)}}async addDatasourceToAgent(e,n){try{return(await U.post(`${ge(e)}/${n}`)).data}catch(s){throw new Error(`添加数据源失败: ${s}`)}}async removeDatasourceFromAgent(e,n){try{return(await U.delete(`${ge(e)}/${n}`)).data}catch(s){throw new Error(`移除数据源失败: ${s}`)}}async toggleDatasourceForAgent(e,n){try{return(await U.put(`${ge(e)}/toggle`,n)).data}catch(s){throw new Error(`切换数据源状态失败: ${s}`)}}async updateDatasourceTables(e,n){try{return(await U.post(`${ge(e)}/tables`,n)).data}catch(s){throw new Error(`更新数据源表列表失败: ${s}`)}}}const fe=new Ao,we="/api/datasource";class Fo{async getLogicalRelations(e){try{return(await U.get(`${we}/${e}/logical-relations`)).data.data||[]}catch(n){return console.error("Failed to get logical relations:",n),[]}}async addLogicalRelation(e,n){try{return(await U.post(`${we}/${e}/logical-relations`,n)).data.data||null}catch(s){throw console.error("Failed to add logical relation:",s),s}}async updateLogicalRelation(e,n,s){return(await U.put(`${we}/${e}/logical-relations/${n}`,s)).data}async deleteLogicalRelation(e,n){return(await U.delete(`${we}/${e}/logical-relations/${n}`)).data}async saveLogicalRelations(e,n){return(await U.put(`${we}/${e}/logical-relations`,n)).data}async getTableColumns(e,n){try{const s=await U.get(`${we}/${e}/tables/${n}/columns`);if(s.data.success)return s.data.data||[];throw new Error(s.data.message)}catch(s){return console.error("Failed to get table columns:",s),[]}}}const he=new Fo,No=ae({name:"AgentDataSourceConfig",props:{agentId:{type:Number,required:!0}},setup(t){const e=$([]),n=$(!1),s=$(!1),c=$("select"),f=$([]),u=$({port:3306}),d=$(null),h=$(!1),_=$({}),E=$({}),y=$({}),K=$({}),D=$({}),A=$([]),F=$(!1),T=$(null),S=$([]),C=$(null),N=$({sourceTableName:"",sourceColumnName:"",targetTableName:"",targetColumnName:"",relationType:"",description:""}),k=$([]),b=$([]),L=$([]),P=$(!1);Te(s,m=>{m&&(X(),u.value={port:3306})});const z=async()=>{d.value=null;try{const m=await fe.getAgentDatasource(t.agentId);A.value=m||[];const V=m||[];e.value=V.map(O=>{var ie;const W={...O.datasource};return W.status=O.isActive===1?"active":"inactive",O.selectTables&&((ie=O.datasource)!=null&&ie.id)&&(y.value[O.datasource.id]=[...O.selectTables]),W})}catch(m){i.error("加载当前智能体的数据源列表失败"),console.error("Failed to load datasource:",m)}},Q=m=>{m==null?d.value=null:d.value=m.id},X=async()=>{try{const m=await ce.getAllDatasource();f.value=m||[]}catch(m){i.error("加载所有数据源列表失败"),console.error("Failed to load all datasource:",m)}},q=async()=>{n.value=!0;try{try{const V=await fe.getActiveAgentDatasource(t.agentId);if(V.datasource==null&&V.datasourceId==null){i.warning("当前智能体没有启用的数据源！请添加一个新数据源，或者启用已有的数据源");return}else if(V.selectTables==null||V.selectTables.length===0){i.warning("当前启用的数据源没有选择相应的数据表！请点击相应数据源左侧按钮，选择相应数据表并更新！");return}}catch{i.warning("当前智能体没有启用的数据源！请添加一个新数据源，或者启用已有的数据源");return}const m=await fe.initSchema(t.agentId);if(m.success===void 0||m.success==null||!m.success)throw i.error("初始化数据源失败"),new Error("初始化数据源失败");i.success("初始化当前智能体的数据源成功")}catch(m){i.error("初始化当前智能体的数据源失败"),console.error("Failed to init datasource:",m)}finally{n.value=!1}},j=async(m,V)=>{const O=m.id;try{const W=await fe.toggleDatasourceForAgent(t.agentId,{datasourceId:O,isActive:V});W.success?(i.success("操作成功！"),m.status=V?"active":"inactive"):(i.error("操作失败！"),console.error("Failed to change datasource:",W))}catch(W){i.error("操作失败！"),console.error("Failed to change datasource:",W)}},I=async m=>{const V=m.id;try{const O=await ce.testConnection(V);O.success?(i.success("测试连接成功！"),m.testStatus="success"):(i.error("测试连接失败！"),console.error("Failed to test connection:",O),m.testStatus="fail")}catch(O){i.error("测试连接失败！"),console.error("Failed to test connection:",O),m.testStatus="fail"}},w=async m=>{const V=m.id;try{await Z.confirm("是否要删除当前数据源吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}catch{return}try{const O=await fe.removeDatasourceFromAgent(t.agentId,V);O.success?(i.success("移除成功！"),e.value=e.value.filter(W=>W.id!==V)):(i.error("移除失败！"),console.error("Failed to remove datasource:",O))}catch(O){i.error("移除失败！"),console.error("Failed to remove datasource:",O)}},H=async m=>{try{await fe.addDatasourceToAgent(t.agentId,m),await z(),i.success("添加数据源成功"),s.value=!1}catch(V){i.error("添加数据源失败"),console.error("Failed to add datasource:",V)}},x=async()=>{const m=d.value;if(m==null){i.warning("请选择一个数据源");return}await H(m)},p=m=>{const V=[];return(!m.name||m.name.trim()==="")&&V.push("数据源名称不能为空"),m.type||V.push("请选择数据源类型"),(!m.host||m.host.trim()==="")&&V.push("主机地址不能为空"),(!m.port||m.port<=0||m.port>65535)&&V.push("请输入有效的端口号（1-65535）"),(!m.databaseName||m.databaseName.trim()==="")&&V.push("数据库名不能为空"),(!m.username||m.username.trim()==="")&&V.push("用户名不能为空"),(!m.password||m.password.trim()==="")&&V.push("密码不能为空"),V},G=async()=>{const m=p(u.value);if(m.length>0){i.error(m.join(`\r
`));return}try{const O=(await ce.createDatasource(u.value)).id;if(O==null)throw new Error("创建数据源失败");await H(O)}catch(V){i.error("创建数据源失败"),console.error("Failed to create datasource:",V)}s.value=!1},Ae=m=>{_.value=JSON.parse(JSON.stringify(m)),h.value=!0},_e=async()=>{const m=p(_.value);if(m.length>0){i.error(m.join(`
`));return}try{const V=await ce.updateDatasource(_.value.id,_.value);if(V&&V.id){i.success("修改成功！");const O=f.value.findIndex(W=>W.id===_.value.id);O>=0&&(f.value[O]=V),h.value=!1}else i.error("修改失败！"),console.error("Failed to update datasource:",V)}catch(V){i.error("修改失败！"),console.error("Failed to update datasource:",V)}},Fe=async m=>{const V=m.id;try{await Z.confirm("删除后无法恢复，确定要删除该数据源吗？","确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{const O=await ce.deleteDatasource(V);O.success?(i.success("删除成功！"),f.value=f.value.filter(W=>W.id!==V)):(i.error("删除失败！"),console.error("Failed to delete datasource:",O))}catch(O){i.error("删除失败！"),console.error("Failed to delete datasource:",O)}},be=async m=>{if(m.id){K.value[m.id]=!0;try{const V=await ce.getDatasourceTables(m.id);if(E.value[m.id]=V,!y.value[m.id]){const O=A.value.find(W=>{var ie;return((ie=W.datasource)==null?void 0:ie.id)===m.id});y.value[m.id]=(O==null?void 0:O.selectTables)||[]}i.success(`成功加载 ${V.length} 个表`)}catch(V){i.error("加载表列表失败"),console.error("Failed to load datasource tables:",V)}finally{K.value[m.id]=!1}}},Be=async m=>{if(m.id){D.value[m.id]=!0;try{if((await fe.updateDatasourceTables(String(t.agentId),{datasourceId:m.id,tables:y.value[m.id]||[]})).success){i.success("数据表更新成功");const O=A.value.find(W=>{var ie;return((ie=W.datasource)==null?void 0:ie.id)===m.id});O&&(O.selectTables=[...y.value[m.id]||[]])}else i.error("数据表更新失败")}catch(V){i.error("数据表更新失败"),console.error("Failed to update datasource tables:",V)}finally{D.value[m.id]=!1}}},Oe=m=>{!m.id||!E.value[m.id]||(y.value[m.id]=[...E.value[m.id]])},Re=m=>{m.id&&(y.value[m.id]=[])},je=(m,V)=>!m||m.length<=V?m:m.substring(0,V)+"...",Je=(m,V)=>{V.includes(m)&&m.status==="active"&&m.id&&be(m)};ve(()=>{z()});const Qe=async m=>{if(!m.id){i.warning("数据源ID不存在");return}T.value=m,F.value=!0;try{k.value=await ce.getDatasourceTables(m.id)}catch(V){i.error("加载表列表失败"),console.error("Failed to load table list:",V)}await He(m.id),Ue()},He=async m=>{try{S.value=await he.getLogicalRelations(m)}catch(V){i.error("加载逻辑外键列表失败"),console.error("Failed to load logical relations:",V)}},Ge=async m=>{var V;if(!m||!((V=T.value)!=null&&V.id)){b.value=[],N.value.sourceColumnName="";return}try{b.value=await he.getTableColumns(T.value.id,m),N.value.sourceColumnName=""}catch(O){i.error("加载字段列表失败"),console.error("Failed to load source columns:",O)}},We=async m=>{var V;if(!m||!((V=T.value)!=null&&V.id)){L.value=[],N.value.targetColumnName="";return}try{L.value=await he.getTableColumns(T.value.id,m),N.value.targetColumnName=""}catch(O){i.error("加载字段列表失败"),console.error("Failed to load target columns:",O)}},Xe=async m=>{var V,O;if(C.value=m,N.value={id:m.id,datasourceId:m.datasourceId,sourceTableName:m.sourceTableName,sourceColumnName:m.sourceColumnName,targetTableName:m.targetTableName,targetColumnName:m.targetColumnName,relationType:m.relationType||"",description:m.description||""},m.sourceTableName&&((V=T.value)!=null&&V.id))try{b.value=await he.getTableColumns(T.value.id,m.sourceTableName)}catch(W){console.error("Failed to load source columns:",W)}if(m.targetTableName&&((O=T.value)!=null&&O.id))try{L.value=await he.getTableColumns(T.value.id,m.targetTableName)}catch(W){console.error("Failed to load target columns:",W)}i.info('正在编辑逻辑外键，修改后点击"更新"按钮')},Ye=async()=>{if(!N.value.sourceTableName||!N.value.sourceColumnName||!N.value.targetTableName||!N.value.targetColumnName){i.warning("请完整填写主表、字段、关联表和字段");return}if(S.value.some(V=>{var O;return V.id!==((O=C.value)==null?void 0:O.id)&&V.sourceTableName===N.value.sourceTableName&&V.sourceColumnName===N.value.sourceColumnName&&V.targetTableName===N.value.targetTableName&&V.targetColumnName===N.value.targetColumnName})){i.warning("该逻辑外键关系已存在");return}if(C.value&&C.value.id){const V=S.value.findIndex(O=>O.id===C.value.id);V!==-1&&(S.value[V]={...S.value[V],sourceTableName:N.value.sourceTableName,sourceColumnName:N.value.sourceColumnName,targetTableName:N.value.targetTableName,targetColumnName:N.value.targetColumnName,relationType:N.value.relationType||"",description:N.value.description||""}),i.success('更新成功，请点击"保存全部配置"以保存到数据库')}else S.value.push({sourceTableName:N.value.sourceTableName,sourceColumnName:N.value.sourceColumnName,targetTableName:N.value.targetTableName,targetColumnName:N.value.targetColumnName,relationType:N.value.relationType||"",description:N.value.description||""}),i.success('添加成功，请点击"保存全部配置"以保存到数据库');Ue()},Ze=async(m,V)=>{try{await Z.confirm("确定要删除这条逻辑外键关系吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),S.value.splice(V,1),i.success('删除成功，请点击"保存全部配置"以保存到数据库')}catch{}},xe=async()=>{var m;if(!((m=T.value)!=null&&m.id)){i.error("数据源ID不存在");return}P.value=!0;try{(await he.saveLogicalRelations(T.value.id,S.value)).success?(i.success("保存成功"),F.value=!1):i.error("保存失败")}catch(V){i.error("保存失败"),console.error("Failed to save logical relations:",V)}finally{P.value=!1}},Ue=()=>{C.value=null,N.value={sourceTableName:"",sourceColumnName:"",targetTableName:"",targetColumnName:"",relationType:"",description:""},b.value=[],L.value=[]};return{props:t,Plus:De,UploadFilled:$e,Loading:dt,FolderOpened:it,Lock:rt,datasource:e,initStatus:n,dialogVisible:s,dialogActiveName:c,allDatasource:f,newDatasource:u,editDialogVisible:h,editingDatasource:_,tableLists:E,selectedTables:y,tableLoadingStates:K,updateLoadingStates:D,initAgentDatasource:q,changeDatasource:j,testConnection:I,removeAgentDatasource:w,loadAllDatasource:X,addSelectDatasource:x,createNewDatasource:G,handleSelectDatasourceChange:Q,editDatasource:Ae,saveEditDatasource:_e,deleteDatasource:Fe,loadDatasourceTables:be,updateDatasourceTables:Be,selectAllTables:Oe,clearAllTables:Re,truncateText:je,handleExpandChange:Je,Connection:qe,Link:st,CirclePlus:nt,Check:at,Right:ot,Edit:Ke,foreignKeyDialogVisible:F,currentForeignKeyDatasource:T,foreignKeyList:S,newForeignKey:N,tableList:k,sourceColumnList:b,targetColumnList:L,savingForeignKeys:P,openForeignKeyDialog:Qe,handleSourceTableChange:Ge,handleTargetTableChange:We,editForeignKey:Xe,saveOrUpdateForeignKey:Ye,deleteForeignKey:Ze,saveForeignKeyConfig:xe,editingForeignKey:C}}}),Io={style:{padding:"20px"}},zo={style:{"margin-bottom":"30px"}},Eo={key:0,style:{padding:"20px",background:"#f8f9fa","border-radius":"8px"}},Uo={style:{"margin-bottom":"15px",display:"flex","justify-content":"space-between","align-items":"center"}},Po={key:0},Ko={style:{"margin-top":"20px","text-align":"right"}},Mo={key:1,style:{"text-align":"center",padding:"20px"}},Lo={key:2,style:{"text-align":"center",padding:"20px",color:"#999"}},qo={key:1,style:{padding:"20px","text-align":"center",color:"#999"}},Bo={class:"connection-url-text"},Oo={style:{"text-align":"right"}},Ro={class:"form-item"},jo={class:"form-item"},Jo={class:"form-item"},Qo={class:"form-item"},Ho={class:"form-item"},Go={class:"form-item"},Wo={class:"form-item"},Xo={class:"form-item"},Yo={class:"form-item"},Zo={style:{"text-align":"right"}},xo={class:"form-item"},ea={class:"form-item"},ta={class:"form-item"},la={class:"form-item"},oa={class:"form-item"},aa={class:"form-item"},na={class:"form-item"},sa={class:"form-item"},ra={class:"form-item"},ia={style:{"text-align":"right"}},da={key:0},ua={style:{"margin-bottom":"20px",padding:"10px",background:"#f0f9ff","border-radius":"4px"}},pa={style:{margin:"0","font-size":"14px",color:"#666"}},ma={style:{"font-weight":"600",color:"#1890ff"}},ca={style:{"margin-bottom":"30px"}},ga={style:{"font-family":"monospace",color:"#1890ff"}},fa={style:{"font-family":"monospace"}},ya={style:{color:"#999","margin-right":"4px"}},va={style:{"font-family":"monospace"}},ba={style:{"font-family":"monospace",color:"#52c41a"}},wa={style:{"font-family":"monospace"}},ha={key:0,style:{"text-align":"center",padding:"40px",color:"#999",background:"#fafafa",border:"1px solid #e8e8e8","border-radius":"4px"}},Ca={style:{background:"#f0f9ff",padding:"20px","border-radius":"8px",border:"1px solid #bae7ff"}},ka={style:{"font-size":"14px","font-weight":"600",color:"#333","margin-bottom":"15px"}},Va={style:{"vertical-align":"middle"}},$a={style:{"text-align":"right"}};function Da(t,e,n,s,c,f){const u=r("el-divider"),d=r("el-col"),h=r("el-button"),_=r("el-row"),E=r("el-checkbox"),y=r("el-checkbox-group"),K=r("Loading"),D=r("el-icon"),A=r("FolderOpened"),F=r("Lock"),T=r("el-table-column"),S=r("el-tooltip"),C=r("el-tag"),N=r("Connection"),k=r("el-table"),b=r("el-tab-pane"),L=r("el-input"),P=r("el-option"),z=r("el-select"),Q=r("el-input-number"),X=r("el-tabs"),q=r("el-dialog"),j=r("Link"),I=r("CirclePlus"),w=r("Edit"),H=r("Right"),x=r("Check");return v(),R(Y,null,[a("div",Io,[e[50]||(e[50]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"数据源配置")],-1)),l(u),a("div",zo,[l(_,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(d,{span:12},{default:o(()=>[...e[33]||(e[33]=[a("h3",null,"数据源列表",-1)])]),_:1}),l(d,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(h,{onClick:e[0]||(e[0]=p=>t.dialogVisible=!0),size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[34]||(e[34]=[g(" 添加数据源 ",-1)])]),_:1},8,["icon"]),t.initStatus?(v(),M(h,{key:1,size:"large",type:"primary",round:"",loading:""},{default:o(()=>[...e[36]||(e[36]=[g("初始化中...",-1)])]),_:1})):(v(),M(h,{key:0,onClick:t.initAgentDatasource,size:"large",type:"primary",round:"",icon:t.UploadFilled},{default:o(()=>[...e[35]||(e[35]=[g(" 初始化数据源 ",-1)])]),_:1},8,["onClick","icon"]))]),_:1})]),_:1})]),l(k,{data:t.datasource,style:{width:"100%"},border:"",onExpandChange:t.handleExpandChange},{default:o(()=>[l(T,{type:"expand",width:"100",label:"选择数据表"},{default:o(p=>[p.row.status==="active"?(v(),R("div",Eo,[a("div",Uo,[e[38]||(e[38]=a("h4",{style:{margin:"0"}},"数据表管理",-1)),l(h,{onClick:G=>t.loadDatasourceTables(p.row),size:"small",type:"primary",loading:t.tableLoadingStates[p.row.id],round:""},{default:o(()=>[...e[37]||(e[37]=[g(" 刷新表列表 ",-1)])]),_:1},8,["onClick","loading"])]),t.tableLists[p.row.id]&&t.tableLists[p.row.id].length>0?(v(),R("div",Po,[l(y,{modelValue:t.selectedTables[p.row.id],"onUpdate:modelValue":G=>t.selectedTables[p.row.id]=G},{default:o(()=>[l(_,{gutter:10},{default:o(()=>[(v(!0),R(Y,null,ye(t.tableLists[p.row.id],G=>(v(),M(d,{key:G,span:6,style:{"margin-bottom":"10px"}},{default:o(()=>[l(E,{label:G,size:"large"},{default:o(()=>[g(B(G),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"]),a("div",Ko,[l(h,{onClick:G=>t.updateDatasourceTables(p.row),size:"small",type:"success",loading:t.updateLoadingStates[p.row.id],round:""},{default:o(()=>[...e[39]||(e[39]=[g(" 更新数据表 ",-1)])]),_:1},8,["onClick","loading"]),l(h,{onClick:G=>t.selectAllTables(p.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[40]||(e[40]=[g(" 全选 ",-1)])]),_:1},8,["onClick"]),l(h,{onClick:G=>t.clearAllTables(p.row),size:"small",type:"info",round:"",plain:""},{default:o(()=>[...e[41]||(e[41]=[g(" 清空 ",-1)])]),_:1},8,["onClick"])])])):t.tableLoadingStates[p.row.id]?(v(),R("div",Mo,[l(D,{class:"is-loading",style:{"font-size":"24px"}},{default:o(()=>[l(K)]),_:1}),e[42]||(e[42]=a("div",{style:{"margin-top":"10px",color:"#666"}},"正在加载表列表...",-1))])):(v(),R("div",Lo,[l(D,{style:{"font-size":"24px"}},{default:o(()=>[l(A)]),_:1}),e[43]||(e[43]=a("div",{style:{"margin-top":"10px"}},"暂无表数据，请点击刷新表列表",-1))]))])):(v(),R("div",qo,[l(D,{style:{"font-size":"24px"}},{default:o(()=>[l(F)]),_:1}),e[44]||(e[44]=a("div",{style:{"margin-top":"10px"}},"请先启用数据源以管理表",-1))]))]),_:1}),l(T,{prop:"name",label:"数据源名称","min-width":"120px"}),l(T,{prop:"type",label:"数据源类型","min-width":"100px"}),l(T,{prop:"connectionUrl",label:"连接地址","min-width":"200px"},{default:o(p=>[l(S,{content:p.row.connectionUrl,placement:"top",disabled:!p.row.connectionUrl||p.row.connectionUrl.length<=50},{default:o(()=>[a("span",Bo,B(p.row.connectionUrl?t.truncateText(p.row.connectionUrl,50):"-"),1)]),_:2},1032,["content","disabled"])]),_:1}),l(T,{label:"连接状态","min-width":"50px"},{default:o(p=>[l(C,{type:p.row.testStatus==="success"?"success":"danger",round:""},{default:o(()=>[g(B(p.row.testStatus==="success"?"连接成功":"连接失败"),1)]),_:2},1032,["type"])]),_:1}),l(T,{label:"状态","min-width":"40px"},{default:o(p=>[l(C,{type:p.row.status==="active"?"success":"info",round:""},{default:o(()=>[g(B(p.row.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(T,{prop:"createTime",label:"创建时间","min-width":"100px"}),l(T,{label:"操作","min-width":"120px"},{default:o(p=>[p.row.status==="active"?(v(),M(h,{key:0,onClick:G=>t.changeDatasource(p.row,!1),size:"small",type:"warning",round:"",plain:""},{default:o(()=>[...e[45]||(e[45]=[g(" 禁用 ",-1)])]),_:1},8,["onClick"])):(v(),M(h,{key:1,onClick:G=>t.changeDatasource(p.row,!0),size:"small",type:"success",round:"",plain:""},{default:o(()=>[...e[46]||(e[46]=[g(" 启用 ",-1)])]),_:1},8,["onClick"])),l(h,{onClick:G=>t.testConnection(p.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[47]||(e[47]=[g(" 测试连接 ",-1)])]),_:1},8,["onClick"]),l(h,{onClick:G=>t.openForeignKeyDialog(p.row),size:"small",type:"success",round:"",plain:""},{default:o(()=>[l(D,{style:{"margin-right":"4px"}},{default:o(()=>[l(N)]),_:1}),e[48]||(e[48]=g(" 逻辑外键配置 ",-1))]),_:1},8,["onClick"]),l(h,{onClick:G=>t.removeAgentDatasource(p.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[49]||(e[49]=[g(" 移除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","onExpandChange"])]),l(q,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[13]||(e[13]=p=>t.dialogVisible=p),title:"添加数据源",width:"1000"},{default:o(()=>[l(X,{modelValue:t.dialogActiveName,"onUpdate:modelValue":e[12]||(e[12]=p=>t.dialogActiveName=p),type:"card",stretch:""},{default:o(()=>[l(b,{label:"选择已有数据源",name:"select"},{default:o(()=>[l(k,{onCurrentChange:t.handleSelectDatasourceChange,data:t.allDatasource,"highlight-current-row":"",style:{width:"100%"}},{default:o(()=>[l(T,{property:"name",label:"数据源名称",width:"150"}),l(T,{property:"type",label:"数据源类型",width:"100"}),l(T,{property:"host",label:"Host",width:"100"}),l(T,{property:"port",label:"Port",width:"80"}),l(T,{property:"description",label:"描述",width:"300"}),l(T,{label:"操作",width:"150"},{default:o(p=>[l(h,{onClick:G=>t.editDatasource(p.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[51]||(e[51]=[g(" 修改 ",-1)])]),_:1},8,["onClick"]),l(h,{onClick:G=>t.deleteDatasource(p.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[52]||(e[52]=[g(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["onCurrentChange","data"]),l(u),a("div",Oo,[l(h,{onClick:e[1]||(e[1]=p=>t.dialogVisible=!1)},{default:o(()=>[...e[53]||(e[53]=[g("取消",-1)])]),_:1}),l(h,{type:"primary",onClick:t.addSelectDatasource},{default:o(()=>[...e[54]||(e[54]=[g("添加选中数据源",-1)])]),_:1},8,["onClick"])])]),_:1}),l(b,{label:"添加新数据源",name:"add"},{default:o(()=>[l(_,{gutter:20},{default:o(()=>[l(d,{span:12},{default:o(()=>[a("div",Ro,[e[55]||(e[55]=a("label",null,"数据源名称 *",-1)),l(L,{modelValue:t.newDatasource.name,"onUpdate:modelValue":e[2]||(e[2]=p=>t.newDatasource.name=p),placeholder:"请输入数据源名称",size:"large"},null,8,["modelValue"])])]),_:1}),l(d,{span:12},{default:o(()=>[a("div",jo,[e[56]||(e[56]=a("label",null,"数据源类型 *",-1)),l(z,{modelValue:t.newDatasource.type,"onUpdate:modelValue":e[3]||(e[3]=p=>t.newDatasource.type=p),placeholder:"请选择数据源类型",style:{width:"100%"},size:"large"},{default:o(()=>[l(P,{key:"mysql",label:"MySQL",value:"mysql"}),l(P,{key:"postgresql",label:"PostgreSQL",value:"postgresql"}),l(P,{key:"sqlserver",label:"SQL Server",value:"sqlserver"}),l(P,{key:"dameng",label:"达梦(Dameng)",value:"dameng"})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(d,{span:12},{default:o(()=>[a("div",Jo,[e[57]||(e[57]=a("label",null,"主机地址 *",-1)),l(L,{modelValue:t.newDatasource.host,"onUpdate:modelValue":e[4]||(e[4]=p=>t.newDatasource.host=p),placeholder:"例如：localhost 或 192.168.1.100",size:"large"},null,8,["modelValue"])])]),_:1}),l(d,{span:12},{default:o(()=>[a("div",Qo,[e[58]||(e[58]=a("label",null,"端口号 *",-1)),l(Q,{modelValue:t.newDatasource.port,"onUpdate:modelValue":e[5]||(e[5]=p=>t.newDatasource.port=p),min:0,max:65535,size:"large",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(d,null,{default:o(()=>[a("div",Ho,[e[59]||(e[59]=a("label",null,"数据库名 *",-1)),l(L,{modelValue:t.newDatasource.databaseName,"onUpdate:modelValue":e[6]||(e[6]=p=>t.newDatasource.databaseName=p),placeholder:"请输入数据库（schema）名称",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(d,null,{default:o(()=>[a("div",Go,[e[60]||(e[60]=a("label",null,"连接地址",-1)),l(L,{modelValue:t.newDatasource.connectionUrl,"onUpdate:modelValue":e[7]||(e[7]=p=>t.newDatasource.connectionUrl=p),placeholder:"请输入JDBC地址（若不填则自动生成）",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(d,{span:12},{default:o(()=>[a("div",Wo,[e[61]||(e[61]=a("label",null,"用户名 *",-1)),l(L,{modelValue:t.newDatasource.username,"onUpdate:modelValue":e[8]||(e[8]=p=>t.newDatasource.username=p),placeholder:"请输入数据库用户名",size:"large"},null,8,["modelValue"])])]),_:1}),l(d,{span:12},{default:o(()=>[a("div",Xo,[e[62]||(e[62]=a("label",null,"密码 *",-1)),l(L,{modelValue:t.newDatasource.password,"onUpdate:modelValue":e[9]||(e[9]=p=>t.newDatasource.password=p),placeholder:"请输入数据库密码",size:"large","show-password":""},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:30},{default:o(()=>[l(d,{span:24},{default:o(()=>[a("div",Yo,[e[63]||(e[63]=a("label",null,"描述",-1)),l(L,{modelValue:t.newDatasource.description,"onUpdate:modelValue":e[10]||(e[10]=p=>t.newDatasource.description=p),rows:4,type:"textarea",placeholder:"请输入数据源描述（可选）",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(u),a("div",Zo,[l(h,{onClick:e[11]||(e[11]=p=>t.dialogVisible=!1)},{default:o(()=>[...e[64]||(e[64]=[g("取消",-1)])]),_:1}),l(h,{type:"primary",onClick:t.createNewDatasource},{default:o(()=>[...e[65]||(e[65]=[g("创建并添加",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),l(q,{modelValue:t.editDialogVisible,"onUpdate:modelValue":e[24]||(e[24]=p=>t.editDialogVisible=p),title:"编辑数据源",width:"1000"},{default:o(()=>[l(_,{gutter:20},{default:o(()=>[l(d,{span:12},{default:o(()=>[a("div",xo,[e[66]||(e[66]=a("label",null,"数据源名称 *",-1)),l(L,{modelValue:t.editingDatasource.name,"onUpdate:modelValue":e[14]||(e[14]=p=>t.editingDatasource.name=p),placeholder:"请输入数据源名称",size:"large"},null,8,["modelValue"])])]),_:1}),l(d,{span:12},{default:o(()=>[a("div",ea,[e[67]||(e[67]=a("label",null,"数据源类型 *",-1)),l(z,{modelValue:t.editingDatasource.type,"onUpdate:modelValue":e[15]||(e[15]=p=>t.editingDatasource.type=p),placeholder:"请选择数据源类型",style:{width:"100%"},size:"large"},{default:o(()=>[l(P,{key:"mysql",label:"MySQL",value:"mysql"}),l(P,{key:"postgresql",label:"PostgreSQL",value:"postgresql"}),l(P,{key:"dameng",label:"达梦(Dameng)",value:"dameng"})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(d,{span:12},{default:o(()=>[a("div",ta,[e[68]||(e[68]=a("label",null,"主机地址 *",-1)),l(L,{modelValue:t.editingDatasource.host,"onUpdate:modelValue":e[16]||(e[16]=p=>t.editingDatasource.host=p),placeholder:"例如：localhost 或 192.168.1.100",size:"large"},null,8,["modelValue"])])]),_:1}),l(d,{span:12},{default:o(()=>[a("div",la,[e[69]||(e[69]=a("label",null,"端口号 *",-1)),l(Q,{modelValue:t.editingDatasource.port,"onUpdate:modelValue":e[17]||(e[17]=p=>t.editingDatasource.port=p),min:0,max:65535,size:"large",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(d,null,{default:o(()=>[a("div",oa,[e[70]||(e[70]=a("label",null,"数据库名 *",-1)),l(L,{modelValue:t.editingDatasource.databaseName,"onUpdate:modelValue":e[18]||(e[18]=p=>t.editingDatasource.databaseName=p),placeholder:"请输入数据库（schema）名称",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(d,null,{default:o(()=>[a("div",aa,[e[71]||(e[71]=a("label",null,"连接地址",-1)),l(L,{modelValue:t.editingDatasource.connectionUrl,"onUpdate:modelValue":e[19]||(e[19]=p=>t.editingDatasource.connectionUrl=p),placeholder:"请输入JDBC地址（若不填则自动生成）",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(d,{span:12},{default:o(()=>[a("div",na,[e[72]||(e[72]=a("label",null,"用户名 *",-1)),l(L,{modelValue:t.editingDatasource.username,"onUpdate:modelValue":e[20]||(e[20]=p=>t.editingDatasource.username=p),placeholder:"请输入数据库用户名",size:"large"},null,8,["modelValue"])])]),_:1}),l(d,{span:12},{default:o(()=>[a("div",sa,[e[73]||(e[73]=a("label",null,"密码 *",-1)),l(L,{modelValue:t.editingDatasource.password,"onUpdate:modelValue":e[21]||(e[21]=p=>t.editingDatasource.password=p),placeholder:"请输入数据库密码",size:"large","show-password":""},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:30},{default:o(()=>[l(d,{span:24},{default:o(()=>[a("div",ra,[e[74]||(e[74]=a("label",null,"描述",-1)),l(L,{modelValue:t.editingDatasource.description,"onUpdate:modelValue":e[22]||(e[22]=p=>t.editingDatasource.description=p),rows:4,type:"textarea",placeholder:"请输入数据源描述（可选）",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(u),a("div",ia,[l(h,{onClick:e[23]||(e[23]=p=>t.editDialogVisible=!1)},{default:o(()=>[...e[75]||(e[75]=[g("取消",-1)])]),_:1}),l(h,{type:"primary",onClick:t.saveEditDatasource},{default:o(()=>[...e[76]||(e[76]=[g("保存修改",-1)])]),_:1},8,["onClick"])])]),_:1},8,["modelValue"]),l(q,{modelValue:t.foreignKeyDialogVisible,"onUpdate:modelValue":e[32]||(e[32]=p=>t.foreignKeyDialogVisible=p),title:"逻辑外键配置",width:"900px","close-on-click-modal":!1},{footer:o(()=>[a("div",$a,[l(h,{onClick:e[31]||(e[31]=p=>t.foreignKeyDialogVisible=!1),size:"large"},{default:o(()=>[...e[87]||(e[87]=[g("取消",-1)])]),_:1}),l(h,{type:"primary",onClick:t.saveForeignKeyConfig,size:"large",loading:t.savingForeignKeys},{default:o(()=>[...e[88]||(e[88]=[g(" 保存全部配置 ",-1)])]),_:1},8,["onClick","loading"])])]),default:o(()=>[t.currentForeignKeyDatasource?(v(),R("div",da,[a("div",ua,[a("p",pa,[e[77]||(e[77]=g(" 当前配置数据源： ",-1)),a("span",ma,B(t.currentForeignKeyDatasource.name),1)])]),a("div",ca,[e[81]||(e[81]=a("h4",{style:{"font-size":"14px","font-weight":"600",color:"#333","margin-bottom":"15px","border-left":"4px solid #1890ff","padding-left":"10px"}}," 已生效的逻辑外键 (Logical Foreign Keys) ",-1)),l(k,{data:t.foreignKeyList,border:"",style:{width:"100%"},size:"small"},{default:o(()=>[l(T,{prop:"sourceTableName",label:"主表 (Source)","min-width":"100px"},{default:o(p=>[a("span",ga,B(p.row.sourceTableName),1)]),_:1}),l(T,{prop:"sourceColumnName",label:"字段","min-width":"80px"},{default:o(p=>[a("span",fa,B(p.row.sourceColumnName),1)]),_:1}),l(T,{label:"关系类型","min-width":"90px",align:"center"},{default:o(p=>[a("span",ya,[l(D,null,{default:o(()=>[l(j)]),_:1})]),a("span",va,B(p.row.relationType||"-"),1)]),_:1}),l(T,{prop:"targetTableName",label:"关联表 (Target)","min-width":"100px"},{default:o(p=>[a("span",ba,B(p.row.targetTableName),1)]),_:1}),l(T,{prop:"targetColumnName",label:"字段","min-width":"80px"},{default:o(p=>[a("span",wa,B(p.row.targetColumnName),1)]),_:1}),l(T,{prop:"description",label:"描述","min-width":"120px"}),l(T,{label:"操作",width:"140px",align:"right"},{default:o(p=>[l(h,{onClick:G=>t.editForeignKey(p.row),size:"small",type:"primary",link:""},{default:o(()=>[...e[78]||(e[78]=[g(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(h,{onClick:G=>t.deleteForeignKey(p.row,p.$index),size:"small",type:"danger",link:""},{default:o(()=>[...e[79]||(e[79]=[g(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),!t.foreignKeyList||t.foreignKeyList.length===0?(v(),R("div",ha,[l(D,{style:{"font-size":"32px","margin-bottom":"10px"}},{default:o(()=>[l(A)]),_:1}),e[80]||(e[80]=a("div",null,"暂无逻辑外键配置",-1))])):J("",!0)]),a("div",Ca,[a("h4",ka,[l(D,{style:{"margin-right":"6px","vertical-align":"middle",color:"#1890ff"}},{default:o(()=>[t.editingForeignKey?(v(),M(w,{key:1})):(v(),M(I,{key:0}))]),_:1}),a("span",Va,B(t.editingForeignKey?"编辑关联关系":"新增关联关系"),1)]),l(_,{gutter:10},{default:o(()=>[l(d,{span:5},{default:o(()=>[e[82]||(e[82]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}}," 主表 (Left Table) ")],-1)),l(z,{modelValue:t.newForeignKey.sourceTableName,"onUpdate:modelValue":e[25]||(e[25]=p=>t.newForeignKey.sourceTableName=p),placeholder:"请选择表...",style:{width:"100%"},size:"large",onChange:t.handleSourceTableChange,clearable:"",filterable:""},{default:o(()=>[(v(!0),R(Y,null,ye(t.tableList,p=>(v(),M(P,{key:p,label:p,value:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(d,{span:4},{default:o(()=>[e[83]||(e[83]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}},"字段")],-1)),l(z,{modelValue:t.newForeignKey.sourceColumnName,"onUpdate:modelValue":e[26]||(e[26]=p=>t.newForeignKey.sourceColumnName=p),placeholder:"先选表",style:{width:"100%"},size:"large",disabled:!t.newForeignKey.sourceTableName,clearable:"",filterable:""},{default:o(()=>[(v(!0),R(Y,null,ye(t.sourceColumnList,p=>(v(),M(P,{key:p,label:p,value:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(d,{span:1,style:{"text-align":"center","line-height":"70px"}},{default:o(()=>[l(D,{color:"#999",size:20},{default:o(()=>[l(H)]),_:1})]),_:1}),l(d,{span:5},{default:o(()=>[e[84]||(e[84]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}}," 关联表 (Right Table) ")],-1)),l(z,{modelValue:t.newForeignKey.targetTableName,"onUpdate:modelValue":e[27]||(e[27]=p=>t.newForeignKey.targetTableName=p),placeholder:"请选择表...",style:{width:"100%"},size:"large",onChange:t.handleTargetTableChange,clearable:"",filterable:""},{default:o(()=>[(v(!0),R(Y,null,ye(t.tableList,p=>(v(),M(P,{key:p,label:p,value:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(d,{span:4},{default:o(()=>[e[85]||(e[85]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}},"字段")],-1)),l(z,{modelValue:t.newForeignKey.targetColumnName,"onUpdate:modelValue":e[28]||(e[28]=p=>t.newForeignKey.targetColumnName=p),placeholder:"先选表",style:{width:"100%"},size:"large",disabled:!t.newForeignKey.targetTableName,clearable:"",filterable:""},{default:o(()=>[(v(!0),R(Y,null,ye(t.targetColumnList,p=>(v(),M(P,{key:p,label:p,value:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(d,{span:5,style:{"line-height":"70px"}},{default:o(()=>[l(h,{onClick:t.saveOrUpdateForeignKey,type:"primary",size:"large",style:{width:"100%"}},{default:o(()=>[l(D,{style:{"margin-right":"4px"}},{default:o(()=>[l(x)]),_:1}),g(" "+B(t.editingForeignKey?"更新":"添加"),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),l(_,{style:{"margin-top":"10px"}},{default:o(()=>[l(d,{span:24},{default:o(()=>[e[86]||(e[86]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}}," 关系类型 (Relation Type) ")],-1)),l(z,{modelValue:t.newForeignKey.relationType,"onUpdate:modelValue":e[29]||(e[29]=p=>t.newForeignKey.relationType=p),placeholder:"选择关系类型（可选）",size:"large",clearable:"",style:{width:"100%"}},{default:o(()=>[l(P,{label:"1:1 (一对一)",value:"1:1"}),l(P,{label:"1:N (一对多)",value:"1:N"}),l(P,{label:"N:1 (多对一)",value:"N:1"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(_,{style:{"margin-top":"10px"}},{default:o(()=>[l(d,{span:24},{default:o(()=>[l(L,{modelValue:t.newForeignKey.description,"onUpdate:modelValue":e[30]||(e[30]=p=>t.newForeignKey.description=p),placeholder:"描述（可选）：例如 '订单关联用户'，帮助 LLM 理解语义",size:"large",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})])])):J("",!0)]),_:1},8,["modelValue"])],64)}const _a=te(No,[["render",Da]]),ne="/api/agent-knowledge";class Sa{async queryByPage(e){return(await U.post(`${ne}/query/page`,e)).data}async listByAgentId(e,n,s,c){const f={};return n&&(f.type=n),s&&(f.status=s),c&&(f.keyword=c),(await U.get(`${ne}/agent/${e}`,{params:f})).data.data}async getById(e){var n;try{return(await U.get(`${ne}/${e}`)).data.data}catch(s){if(U.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return null;throw s}}async create(e){return(await U.post(`${ne}/create`,e)).data.data}async update(e,n){var s;try{return(await U.put(`${ne}/${e}`,n)).data.data}catch(c){if(U.isAxiosError(c)&&((s=c.response)==null?void 0:s.status)===404)return null;throw c}}async updateRecallStatus(e,n){try{return(await U.put(`${ne}/recall/${e}`,null,{params:{isRecall:n}})).data.data}catch(s){return console.error("Failed to update recall status:",s),null}}async delete(e){var n;try{return await U.delete(`${ne}/${e}`),!0}catch(s){if(U.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return!1;throw s}}async retryEmbedding(e){try{return(await U.post(`${ne}/retry-embedding/${e}`)).data.success}catch(n){return console.error("Failed to retry embedding:",n),!1}}async getStatistics(e){return(await U.get(`${ne}/statistics/${e}`)).data.data}}const Ve=new Sa,Ta=ae({name:"AgentKnowledgeConfig",components:{Search:Ce,Warning:Ie,UploadFilled:$e},props:{agentId:{type:Number,required:!0}},setup(t){const e=$([]),n=$(0),s=$(!1),c=$(!1),f=$(!1),u=$(!1),d=$(null),h=$([]),_=$(!1),E=ut({agentId:t.agentId,title:"",type:"",embeddingStatus:"",pageNum:1,pageSize:10}),y=$({agentId:t.agentId,title:"",content:"",type:"DOCUMENT",isRecall:!0,question:"",answer:""}),K=()=>{_.value=!_.value},D=()=>{E.type="",E.embeddingStatus="",F()},A=async()=>{s.value=!0;try{const I={...E,type:E.type?E.type:"",embeddingStatus:E.embeddingStatus?E.embeddingStatus:""},w=await Ve.queryByPage(I);w.success?(e.value=w.data,n.value=w.total):i.error(w.message||"加载知识列表失败")}catch(I){i.error("加载知识列表失败"),console.error("Failed to load knowledge list:",I)}finally{s.value=!1}},F=()=>{E.pageNum=1,A()},T=I=>{E.pageSize=I,A()},S=I=>{E.pageNum=I,A()},C=()=>{f.value=!1,c.value=!0,j()},N=()=>{c.value=!1,j()},k=I=>{f.value=!0,d.value=I.id||null,y.value={...I,type:I.type},(I.type==="QA"||I.type==="FAQ")&&(y.value.answer=I.content),c.value=!0},b=I=>{if(!I.id)return;const w=!I.isRecall,H=w?"召回":"取消召回";Z.confirm(`确定要${H}知识 "${I.title}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ve.updateRecallStatus(I.id,w)?(I.isRecall=w,i.success(`${H}成功`)):i.error(`${H}失败`)}catch(x){i.error(`${H}失败`),console.error(`Failed to ${H} knowledge:`,x)}}).catch(()=>{})},L=async I=>{if(I.id)try{await Ve.retryEmbedding(I.id)?(i.success("重试请求已发送"),A()):i.error("重试失败")}catch{i.error("重试失败")}},P=I=>{I.id&&Z.confirm(`确定要删除知识 "${I.title}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ve.delete(I.id)?(i.success("删除成功"),await A()):i.error("删除失败")}catch(w){i.error("删除失败"),console.error("Failed to delete knowledge:",w)}}).catch(()=>{})},z=()=>{y.value.content="",y.value.question="",y.value.answer="",h.value=[]},Q=I=>{h.value=[I],y.value.file=I.raw},X=I=>{if(!I)return"0 B";const w=1024,H=["B","KB","MB","GB"],x=Math.floor(Math.log(I)/Math.log(w));return Math.round(I/Math.pow(w,x)*100)/100+" "+H[x]},q=async()=>{var I;if(!y.value.title||!y.value.title.trim()){i.warning("请输入知识标题");return}if(y.value.type==="DOCUMENT"){if(!f.value&&!y.value.file&&h.value.length===0){i.warning("请上传文件");return}}else if(y.value.type==="QA"||y.value.type==="FAQ"){if(!y.value.question||!y.value.question.trim()){i.warning("请输入问题");return}if(!y.value.answer||!y.value.answer.trim()){i.warning("请输入答案");return}y.value.content=y.value.answer}u.value=!0;try{if(f.value&&d.value){const w={...y.value,type:(I=y.value.type)==null?void 0:I.toUpperCase()};if(await Ve.update(d.value,w))i.success("更新成功");else{i.error("更新失败");return}}else{const w=new FormData;w.append("agentId",String(y.value.agentId)),w.append("title",y.value.title),w.append("type",y.value.type||"DOCUMENT"),w.append("isRecall",y.value.isRecall?"1":"0"),y.value.type==="DOCUMENT"&&y.value.file?w.append("file",y.value.file):(y.value.content&&w.append("content",y.value.content),y.value.question&&w.append("question",y.value.question));const H=await U.post("/api/agent-knowledge/create",w,{headers:{"Content-Type":"multipart/form-data"}});if(H.data.success)i.success("创建成功");else{i.error(H.data.message||"创建失败");return}}c.value=!1,await A()}catch(w){i.error(`${f.value?"更新":"创建"}失败`),console.error("Failed to save knowledge:",w)}finally{u.value=!1}},j=()=>{y.value={agentId:t.agentId,title:"",content:"",type:"DOCUMENT",isRecall:!0,question:"",answer:""},d.value=null,h.value=[]};return ve(()=>{A()}),{Plus:De,Search:Ce,FilterIcon:mt,RefreshLeft:pt,UploadFilled:$e,Warning:Ie,knowledgeList:e,total:n,loading:s,dialogVisible:c,isEdit:f,saveLoading:u,queryParams:E,knowledgeForm:y,fileList:h,filterVisible:_,toggleFilter:K,clearFilters:D,loadKnowledgeList:A,handleSearch:F,handleSizeChange:T,handleCurrentChange:S,openCreateDialog:C,closeDialog:N,editKnowledge:k,deleteKnowledge:P,saveKnowledge:q,resetForm:j,handleTypeChange:z,handleFileChange:Q,toggleStatus:b,handleRetry:L,formatFileSize:X}}}),Aa={style:{padding:"20px"}},Fa={style:{"margin-bottom":"30px"}},Na={style:{"margin-bottom":"20px"}},Ia={key:0},za={key:1},Ea={key:2},Ua={key:3},Pa={style:{display:"flex","align-items":"center"}},Ka={key:1},Ma={style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},La={key:0,style:{width:"100%"}},qa={key:0,class:"el-upload__tip",style:{color:"#409eff"}},Ba={key:1},Oa={style:{"text-align":"right"}};function Ra(t,e,n,s,c,f){const u=r("el-divider"),d=r("el-col"),h=r("Search"),_=r("el-icon"),E=r("el-input"),y=r("el-button"),K=r("el-row"),D=r("el-option"),A=r("el-select"),F=r("el-form-item"),T=r("el-form"),S=r("el-card"),C=r("el-collapse-transition"),N=r("el-table-column"),k=r("el-tag"),b=r("Warning"),L=r("el-tooltip"),P=r("el-table"),z=r("el-pagination"),Q=r("el-alert"),X=r("UploadFilled"),q=r("el-upload"),j=r("el-dialog"),I=ct("loading");return v(),R(Y,null,[a("div",Aa,[e[19]||(e[19]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"智能体知识库"),a("p",{style:{color:"#909399","font-size":"14px","margin-top":"5px"}}," 管理用于增强智能体能力的知识源。 ")],-1)),l(u),a("div",Fa,[l(K,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(d,{span:12},{default:o(()=>[...e[10]||(e[10]=[a("h3",null,"知识列表",-1)])]),_:1}),l(d,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(E,{modelValue:t.queryParams.title,"onUpdate:modelValue":e[0]||(e[0]=w=>t.queryParams.title=w),placeholder:"请输入知识标题搜索",style:{width:"400px","margin-right":"10px"},clearable:"",onClear:t.handleSearch,onKeyup:Ee(t.handleSearch,["enter"]),size:"large"},{prefix:o(()=>[l(_,null,{default:o(()=>[l(h)]),_:1})]),_:1},8,["modelValue","onClear","onKeyup"]),l(y,{onClick:t.toggleFilter,size:"large",type:t.filterVisible?"primary":"",round:"",icon:t.FilterIcon},{default:o(()=>[...e[11]||(e[11]=[g(" 筛选 ",-1)])]),_:1},8,["onClick","type","icon"]),l(y,{onClick:t.openCreateDialog,size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[12]||(e[12]=[g(" 添加知识 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1})]),l(C,null,{default:o(()=>[oe(a("div",Na,[l(S,{shadow:"never"},{default:o(()=>[l(T,{inline:!0,model:t.queryParams},{default:o(()=>[l(F,{label:"知识类型"},{default:o(()=>[l(A,{modelValue:t.queryParams.type,"onUpdate:modelValue":e[1]||(e[1]=w=>t.queryParams.type=w),placeholder:"全部类型",clearable:"",onChange:t.handleSearch,style:{width:"150px"}},{default:o(()=>[l(D,{label:"文档",value:"DOCUMENT"}),l(D,{label:"问答对",value:"QA"}),l(D,{label:"常见问题",value:"FAQ"})]),_:1},8,["modelValue","onChange"])]),_:1}),l(F,{label:"处理状态"},{default:o(()=>[l(A,{modelValue:t.queryParams.embeddingStatus,"onUpdate:modelValue":e[2]||(e[2]=w=>t.queryParams.embeddingStatus=w),placeholder:"全部状态",clearable:"",onChange:t.handleSearch,style:{width:"150px"}},{default:o(()=>[l(D,{label:"COMPLETED",value:"COMPLETED"}),l(D,{label:"PROCESSING",value:"PROCESSING"}),l(D,{label:"FAILED",value:"FAILED"}),l(D,{label:"PENDING",value:"PENDING"})]),_:1},8,["modelValue","onChange"])]),_:1}),l(F,null,{default:o(()=>[l(y,{onClick:t.clearFilters,icon:t.RefreshLeft},{default:o(()=>[...e[13]||(e[13]=[g("清空筛选",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1},8,["model"])]),_:1})],512),[[gt,t.filterVisible]])]),_:1}),oe((v(),M(P,{data:t.knowledgeList,style:{width:"100%"},border:""},{default:o(()=>[l(N,{prop:"title",label:"标题","min-width":"150px"}),l(N,{prop:"type",label:"类型","min-width":"100px"},{default:o(w=>[w.row.type==="DOCUMENT"?(v(),R("span",Ia,"文档")):w.row.type==="QA"?(v(),R("span",za,"问答对")):w.row.type==="FAQ"?(v(),R("span",Ea,"常见问题")):(v(),R("span",Ua,B(w.row.type),1))]),_:1}),l(N,{label:"处理状态","min-width":"120px"},{default:o(w=>[w.row.embeddingStatus==="COMPLETED"?(v(),M(k,{key:0,type:"success",round:""},{default:o(()=>[g(B(w.row.embeddingStatus),1)]),_:2},1024)):w.row.embeddingStatus==="PROCESSING"?(v(),M(k,{key:1,type:"primary",round:""},{default:o(()=>[g(B(w.row.embeddingStatus),1)]),_:2},1024)):w.row.embeddingStatus==="FAILED"?(v(),M(k,{key:2,type:"danger",round:""},{default:o(()=>[w.row.errorMsg?(v(),M(L,{key:0,content:w.row.errorMsg,placement:"top"},{default:o(()=>[a("span",Pa,[l(_,{style:{"margin-right":"4px"}},{default:o(()=>[l(b)]),_:1}),g(" "+B(w.row.embeddingStatus),1)])]),_:2},1032,["content"])):(v(),R("span",Ka,B(w.row.embeddingStatus),1))]),_:2},1024)):(v(),M(k,{key:3,type:"info",round:""},{default:o(()=>[g(B(w.row.embeddingStatus),1)]),_:2},1024))]),_:1}),l(N,{label:"召回状态","min-width":"100px"},{default:o(w=>[l(k,{type:w.row.isRecall?"success":"info",round:""},{default:o(()=>[g(B(w.row.isRecall?"已召回":"未召回"),1)]),_:2},1032,["type"])]),_:1}),l(N,{label:"操作","min-width":"280px"},{default:o(w=>[l(y,{onClick:H=>t.editKnowledge(w.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[14]||(e[14]=[g(" 管理 ",-1)])]),_:1},8,["onClick"]),w.row.embeddingStatus==="FAILED"?(v(),M(y,{key:0,onClick:H=>t.handleRetry(w.row),size:"small",type:"info",round:"",plain:""},{default:o(()=>[...e[15]||(e[15]=[g(" 重试 ",-1)])]),_:1},8,["onClick"])):J("",!0),w.row.isRecall?(v(),M(y,{key:1,onClick:H=>t.toggleStatus(w.row),size:"small",type:"warning",round:"",plain:""},{default:o(()=>[...e[16]||(e[16]=[g(" 取消召回 ",-1)])]),_:1},8,["onClick"])):(v(),M(y,{key:2,onClick:H=>t.toggleStatus(w.row),size:"small",type:"success",round:"",plain:""},{default:o(()=>[...e[17]||(e[17]=[g(" 召回 ",-1)])]),_:1},8,["onClick"])),l(y,{onClick:H=>t.deleteKnowledge(w.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[18]||(e[18]=[g(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,t.loading]]),a("div",Ma,[l(z,{"current-page":t.queryParams.pageNum,"onUpdate:currentPage":e[3]||(e[3]=w=>t.queryParams.pageNum=w),"page-size":t.queryParams.pageSize,"onUpdate:pageSize":e[4]||(e[4]=w=>t.queryParams.pageSize=w),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:t.total,onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),l(j,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[9]||(e[9]=w=>t.dialogVisible=w),title:t.isEdit?"编辑知识":"添加新知识",width:"800","close-on-click-modal":!1},{footer:o(()=>[a("div",Oa,[l(y,{onClick:t.closeDialog},{default:o(()=>[...e[25]||(e[25]=[g("取消",-1)])]),_:1},8,["onClick"]),l(y,{type:"primary",onClick:t.saveKnowledge,loading:t.saveLoading},{default:o(()=>[g(B(t.isEdit?"更新":"添加并处理"),1)]),_:1},8,["onClick","loading"])])]),default:o(()=>[l(T,{model:t.knowledgeForm,"label-width":"100px",ref:"knowledgeFormRef"},{default:o(()=>[l(F,{label:"知识类型",prop:"type",required:""},{default:o(()=>[l(A,{modelValue:t.knowledgeForm.type,"onUpdate:modelValue":e[5]||(e[5]=w=>t.knowledgeForm.type=w),placeholder:"请选择知识类型",onChange:t.handleTypeChange,disabled:t.isEdit,style:{width:"100%"}},{default:o(()=>[l(D,{label:"文档 (文件上传)",value:"DOCUMENT"}),l(D,{label:"问答对 (Q&A)",value:"QA"}),l(D,{label:"常见问题 (FAQ)",value:"FAQ"})]),_:1},8,["modelValue","onChange","disabled"])]),_:1}),t.knowledgeForm.type==="QA"?(v(),M(F,{key:0},{default:o(()=>[l(Q,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"10px"}},{title:o(()=>[...e[20]||(e[20]=[a("div",{style:{"line-height":"1.6"}}," 请录入具体的'分析需求'作为问题,并在答案中写出详细的'思考步骤'与'数据查找逻辑'(而非直接给结果),以此教会 AI 如何拆解任务。 ",-1)])]),_:1})]),_:1})):J("",!0),t.knowledgeForm.type==="FAQ"?(v(),M(F,{key:1},{default:o(()=>[l(Q,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"10px"}},{title:o(()=>[...e[21]||(e[21]=[a("div",{style:{"line-height":"1.6"}}," 请针对特定的'业务术语'、'指标口径'或'常见歧义'进行提问和定义(例如:'什么是有效日活'),以此统一 AI 的判断标准。 ",-1)])]),_:1})]),_:1})):J("",!0),t.knowledgeForm.type==="DOCUMENT"?(v(),M(F,{key:2},{default:o(()=>[l(Q,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"10px"}},{title:o(()=>[...e[22]||(e[22]=[a("div",{style:{"line-height":"1.6"}}," 请上传完整的'数据库表结构'、'码表映射字典'或'业务背景说明',供 AI 在分析时检索字段含义和数据关系。 ",-1)])]),_:1})]),_:1})):J("",!0),l(F,{label:"知识标题",prop:"title",required:""},{default:o(()=>[l(E,{modelValue:t.knowledgeForm.title,"onUpdate:modelValue":e[6]||(e[6]=w=>t.knowledgeForm.title=w),placeholder:"为这份知识起一个易于识别的名称"},null,8,["modelValue"])]),_:1}),t.knowledgeForm.type==="DOCUMENT"?(v(),M(F,{key:3,label:"上传文件",required:""},{default:o(()=>[t.isEdit?(v(),R("div",Ba,[l(Q,{type:"info",closable:!1,"show-icon":"",title:"文档类型知识不支持修改文件内容，如需修改请删除后重新创建"})])):(v(),R("div",La,[l(q,{"auto-upload":!1,limit:1,"on-change":t.handleFileChange,"on-remove":()=>t.fileList=[],"file-list":t.fileList,drag:""},{tip:o(()=>[e[23]||(e[23]=a("div",{class:"el-upload__tip"},"支持 PDF, DOCX, TXT, MD 等格式",-1)),t.fileList.length>0?(v(),R("div",qa," 文件大小: "+B(t.formatFileSize(t.fileList[0].size)),1)):J("",!0)]),default:o(()=>[l(_,{class:"el-icon--upload"},{default:o(()=>[l(X)]),_:1}),e[24]||(e[24]=a("div",{class:"el-upload__text"},[g(" 拖拽文件到此处或 "),a("em",null,"点击选择文件")],-1))]),_:1},8,["on-change","on-remove","file-list"])]))]),_:1})):J("",!0),t.knowledgeForm.type==="QA"||t.knowledgeForm.type==="FAQ"?(v(),R(Y,{key:4},[l(F,{label:"问题",prop:"question",required:""},{default:o(()=>[l(E,{modelValue:t.knowledgeForm.question,"onUpdate:modelValue":e[7]||(e[7]=w=>t.knowledgeForm.question=w),type:"textarea",rows:2,placeholder:"输入用户可能会问的问题..."},null,8,["modelValue"])]),_:1}),l(F,{label:"答案",prop:"answer",required:""},{default:o(()=>[l(E,{modelValue:t.knowledgeForm.answer,"onUpdate:modelValue":e[8]||(e[8]=w=>t.knowledgeForm.answer=w),type:"textarea",rows:5,placeholder:"输入标准答案..."},null,8,["modelValue"])]),_:1})],64)):J("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}const ja=te(Ta,[["render",Ra],["__scopeId","data-v-51c3d2d0"]]),Ja=ae({name:"AgentDetail",components:{BaseLayout:Dt,AgentBaseSetting:Bt,AgentPromptConfig:Nl,BusinessKnowledgeConfig:Ml,AgentSemanticsConfig:xl,AgentPresetsConfig:uo,AgentAccessApi:So,AgentDataSourceConfig:_a,AgentKnowledgeConfig:ja,NotFound:_t,InfoFilled:Ct,Coin:ht,ChatLineSquare:wt,User:bt,Suitcase:vt,Setting:yt,VideoPlay:ft,Connection:qe,Document:Le},setup(){const t=Me(),e=$("basic"),n=$({id:0,name:"loading...",description:"",status:"draft",createdAt:"",updatedAt:"",avatar:"",prompt:"",category:"",adminId:"",tags:"",humanReviewEnabled:!1}),s=$(null),c=$(!1),f=$(!1),u=$(""),d=()=>{console.error("头像图片加载失败"),(!n.value.avatar||n.value.avatar.startsWith("data:"))&&(n.value.avatar=$t())},h=()=>{s.value&&s.value.click()},_=async D=>{var T;const F=(T=D.target.files)==null?void 0:T[0];if(F){if(!F.type.startsWith("image/")){i.error("请选择图片文件");return}if(F.size>5*1024*1024){i.error("图片大小不能超过5MB");return}try{c.value=!0,u.value=n.value.avatar||"";const S=new FileReader;S.onload=N=>{var k;n.value.avatar=(k=N.target)==null?void 0:k.result},S.readAsDataURL(F);const C=await St.uploadAvatar(F);if(C.success)n.value.avatar=C.url,n.value.id&&await re.update(Number(n.value.id),{...n.value,avatar:C.url}),i.success("头像上传成功");else throw new Error(C.message||"上传失败")}catch(S){i.error("头像上传失败: "+(S instanceof Error?S.message:"未知错误")),n.value.avatar=u.value}finally{c.value=!1,s.value&&(s.value.value="")}}},E=D=>{const A=t.currentRoute.value.params.id;e.value=D,D==="go-run"&&t.push(`/agent/${A}/run`)},y=()=>{t.push("/agents")},K=async()=>{try{const D=Number(t.currentRoute.value.params.id),A=await re.get(D);if(A)n.value=A;else throw new Error("Agent 不存在")}catch(D){i.error("加载失败"),console.error("加载失败:",D)}};return ve(async()=>{await K()}),{ArrowLeft:kt,agent:n,activeMenuIndex:e,handleMenuSelect:E,goBack:y,headerFileInput:s,headerUploading:c,showHeaderAvatarButton:f,triggerHeaderFileUpload:h,handleHeaderFileUpload:_,getAvatarUrl:Vt,handleImageError:d}}}),Qa={key:0,class:"avatar-overlay-header"};function Ha(t,e,n,s,c,f){const u=r("el-button"),d=r("el-col"),h=r("el-avatar"),_=r("el-row"),E=r("el-divider"),y=r("el-header"),K=r("InfoFilled"),D=r("el-icon"),A=r("el-menu-item"),F=r("el-menu-item-group"),T=r("Coin"),S=r("ChatLineSquare"),C=r("Document"),N=r("User"),k=r("Suitcase"),b=r("Setting"),L=r("VideoPlay"),P=r("Connection"),z=r("el-menu"),Q=r("el-aside"),X=r("AgentBaseSetting"),q=r("AgentDataSourceConfig"),j=r("AgentPromptConfig"),I=r("BusinessKnowledgeConfig"),w=r("AgentSemanticsConfig"),H=r("AgentPresetsConfig"),x=r("AgentAccessApi"),p=r("AgentKnowledgeConfig"),G=r("NotFound"),Ae=r("el-main"),_e=r("el-container"),Fe=r("BaseLayout");return v(),M(Fe,null,{default:o(()=>[l(_e,{style:{"margin-top":"20px",gap:"10px"}},{default:o(()=>[l(y,{style:{"background-color":"white","margin-bottom":"20px"}},{default:o(()=>[l(_,{gutter:20,align:"middle"},{default:o(()=>[l(d,{span:1},{default:o(()=>[l(u,{type:"primary",icon:t.ArrowLeft,onClick:t.goBack,circle:"",style:{transform:"scale(1.2)"}},null,8,["icon","onClick"])]),_:1}),l(d,{span:1,style:{"text-align":"left"}},{default:o(()=>[a("div",{class:"avatar-wrapper",onMouseenter:e[0]||(e[0]=be=>t.showHeaderAvatarButton=!0),onMouseleave:e[1]||(e[1]=be=>t.showHeaderAvatarButton=!1)},[l(h,{src:t.getAvatarUrl(t.agent.avatar),size:"large",class:"header-avatar",onError:t.handleImageError},{default:o(()=>[g(B(t.agent.name),1)]),_:1},8,["src","onError"]),t.showHeaderAvatarButton?(v(),R("div",Qa,[l(u,{type:"primary",size:"small",onClick:t.triggerHeaderFileUpload,loading:t.headerUploading},{default:o(()=>[g(B(t.headerUploading?"上传中...":"替换头像"),1)]),_:1},8,["onClick","loading"])])):J("",!0)],32),a("input",{ref:"headerFileInput",type:"file",accept:"image/*",style:{display:"none"},onChange:e[2]||(e[2]=(...be)=>t.handleHeaderFileUpload&&t.handleHeaderFileUpload(...be))},null,544)]),_:1}),l(d,{span:30,style:{"text-align":"left"}},{default:o(()=>[a("h2",null,B(t.agent.name),1)]),_:1})]),_:1}),l(E)]),_:1}),l(_e,{style:{gap:"10px"}},{default:o(()=>[l(Q,{width:"200px",style:{"background-color":"white"}},{default:o(()=>[l(z,{"default-active":t.activeMenuIndex,class:"el-menu-vertical-demo",onSelect:t.handleMenuSelect},{default:o(()=>[l(F,{title:"基本信息"},{default:o(()=>[l(A,{index:"basic"},{default:o(()=>[l(D,null,{default:o(()=>[l(K)]),_:1}),e[3]||(e[3]=g(" 基本信息 ",-1))]),_:1})]),_:1}),l(F,{title:"数据源配置"},{default:o(()=>[l(A,{index:"datasource"},{default:o(()=>[l(D,null,{default:o(()=>[l(T)]),_:1}),e[4]||(e[4]=g(" 数据源配置 ",-1))]),_:1})]),_:1}),l(F,{title:"PROMPT配置"},{default:o(()=>[l(A,{index:"prompt"},{default:o(()=>[l(D,null,{default:o(()=>[l(S)]),_:1}),e[5]||(e[5]=g(" 自定义 PROMPT 配置 ",-1))]),_:1})]),_:1}),l(F,{title:"知识配置"},{default:o(()=>[l(A,{index:"agent-knowledge"},{default:o(()=>[l(D,null,{default:o(()=>[l(C)]),_:1}),e[6]||(e[6]=g(" 智能体知识配置 ",-1))]),_:1}),l(A,{index:"business-knowledge"},{default:o(()=>[l(D,null,{default:o(()=>[l(N)]),_:1}),e[7]||(e[7]=g(" 业务知识配置 ",-1))]),_:1}),l(A,{index:"semantic-model"},{default:o(()=>[l(D,null,{default:o(()=>[l(k)]),_:1}),e[8]||(e[8]=g(" 语义模型配置 ",-1))]),_:1})]),_:1}),l(F,{title:"预设问题管理"},{default:o(()=>[l(A,{index:"preset-questions"},{default:o(()=>[l(D,null,{default:o(()=>[l(b)]),_:1}),e[9]||(e[9]=g(" 预设问题管理 ",-1))]),_:1})]),_:1}),l(F,{title:"运行与发布"},{default:o(()=>[l(A,{index:"go-run"},{default:o(()=>[l(D,null,{default:o(()=>[l(L)]),_:1}),e[10]||(e[10]=g(" 前往运行页面 ",-1))]),_:1}),l(A,{index:"access-api"},{default:o(()=>[l(D,null,{default:o(()=>[l(P)]),_:1}),e[11]||(e[11]=g(" 访问 API ",-1))]),_:1})]),_:1})]),_:1},8,["default-active","onSelect"])]),_:1}),l(Ae,{style:{"background-color":"white"}},{default:o(()=>[t.activeMenuIndex==="basic"?(v(),M(X,{key:0,agent:t.agent},null,8,["agent"])):t.activeMenuIndex==="datasource"?(v(),M(q,{key:1,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="prompt"?(v(),M(j,{key:2,"agent-id":t.agent.id,"agent-prompt":t.agent.prompt},null,8,["agent-id","agent-prompt"])):t.activeMenuIndex==="business-knowledge"?(v(),M(I,{key:3,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="semantic-model"?(v(),M(w,{key:4,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="preset-questions"?(v(),M(H,{key:5,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="access-api"?(v(),M(x,{key:6,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="agent-knowledge"?(v(),M(p,{key:7,"agent-id":t.agent.id},null,8,["agent-id"])):(v(),M(G,{key:8}))]),_:1})]),_:1})]),_:1})]),_:1})}const en=te(Ja,[["render",Ha],["__scopeId","data-v-4ad03a8f"]]);export{en as default};
