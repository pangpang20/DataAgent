import{d as L,ap as F,o as O,r as j,p as Q,b as K,f as g,aq as _,E as p,h as S,_ as J,i as I,w as a,l as d,q as e,m as D,n as V,j as n,x as i,t as w,k as v}from"./index-C8bkOYxc.js";import{B as W}from"./BaseLayout-BFRTzKYD.js";const X=L({name:"ModelConfig",components:{BaseLayout:W,Cpu:F},setup(){const o=g(!0),l=g(!1),T=g(!1),B=g(!1),P=g(null),U=g(null),u=g(""),m=g([]),h=g(),y=g({provider:"",apiKey:"",baseUrl:"",modelName:"",modelType:"CHAT",temperature:0,maxTokens:2e3,completionsPath:"",embeddingsPath:"",isActive:!1}),f={deepseek:"https://api.deepseek.com",qwen:"https://dashscope.aliyuncs.com/compatible-mode",openai:"https://api.openai.com",siliconflow:"https://api.siliconflow.cn",custom:""},k=s=>{s&&s!=="custom"&&(y.value.baseUrl=f[s]||"")},N={provider:[{required:!0,message:"请选择提供商",trigger:"change"}],modelType:[{required:!0,message:"请选择模型类型",trigger:"change"}],modelName:[{required:!0,message:"请输入模型名称",trigger:"blur"}],apiKey:[{required:!0,message:"请输入API密钥",trigger:"blur"}],baseUrl:[{required:!0,message:"请输入API地址",trigger:"blur"}],temperature:[{type:"number",min:0,max:2,message:"温度值必须在0-2之间",trigger:"blur"}],maxTokens:[{type:"number",min:100,max:1e4,message:"最大Token必须在100-10000之间",trigger:"blur"}]},M=K(()=>T.value?"编辑模型配置":"新增模型配置"),z=K(()=>{let s=m.value;return u.value&&(s=s.filter(r=>r.modelType===u.value)),s}),b=async()=>{o.value=!0;try{const s=await _.list();m.value=s||[]}catch{p.error("获取模型配置列表失败，请检查网络！"),m.value=[]}finally{o.value=!1}},q=()=>{T.value=!1,y.value={provider:"",apiKey:"",baseUrl:"",modelName:"",modelType:"CHAT",temperature:0,maxTokens:2e3,completionsPath:"",embeddingsPath:"",isActive:!1},l.value=!0},c=s=>{T.value=!0,y.value={...s},l.value=!0},E=async()=>{if(h.value)try{if(await h.value.validate(),B.value=!0,T.value){const s=await _.update(y.value);s.success?(p.success("配置更新成功"),l.value=!1,b()):p.error(s.message||"配置更新失败")}else{const s=await _.add(y.value);s.success?(p.success("配置添加成功"),l.value=!1,b()):p.error(s.message||"配置添加失败")}}catch(s){console.error("表单验证失败:",s)}finally{B.value=!1}},$=async s=>{try{if(await S.confirm(`确定要删除配置 "${s.provider} - ${s.modelName}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),s.id){const r=await _.delete(s.id);r.success?(p.success("配置删除成功"),b()):p.error(r.message||"配置删除失败")}}catch{console.log("删除操作已取消")}},C=async(s,r)=>{if(s)try{if(r==="EMBEDDING")try{await S.confirm("您正在更换嵌入模型，此操作风险较高！由于不同模型的向量空间不一致，切换后可能导致所有历史向量数据（含数据源、智能体知识、业务知识）将全部失效且无法检索。确定要执行吗？","切换嵌入模型确认",{confirmButtonText:"确定继续",cancelButtonText:"取消",type:"warning"})}catch{console.log("用户取消了嵌入模型切换");return}P.value=s;const A=await _.activate(s);A.success?(p.success("模型启用成功"),b()):p.error(A.message||"模型启用失败")}catch{p.error("启用过程中发生错误")}finally{P.value=null}},H=async s=>{if(s.id)try{U.value=s.id;const r=await _.testConnection(s);r.success?p.success(r.message||"连接测试成功！"):p.error(r.message||"连接测试失败")}catch{p.error("连接测试过程中发生错误")}finally{U.value=null}},R=s=>({deepseek:"success",qwen:"warning",openai:"primary",siliconflow:"danger",custom:"info"})[s]||"info";return O(()=>{b()}),{loading:o,dialogVisible:l,isEditMode:T,submitting:B,activatingId:P,testingId:U,activeFilter:u,configs:m,formData:y,formRef:h,formRules:N,filteredConfigs:z,dialogTitle:M,loadConfigs:b,showAddDialog:q,handleEdit:c,handleSubmit:E,handleDelete:$,handleActivate:C,handleTestConnection:H,getProviderTagType:R,updateBaseUrlByProvider:k,Plus:Q,Refresh:j}}}),Y={class:"model-config-page"},Z={class:"main-content"},x={class:"action-section"},ee={class:"action-content"},le={class:"action-buttons"},oe={class:"filter-options"},te={key:0,class:"config-table"},ae={key:0},se={key:1},ne={key:2},ie={class:"action-buttons-cell"},re={key:1,class:"loading-state"},de={key:2,class:"empty-state"},ue={class:"dialog-footer"};function me(o,l,T,B,P,U){const u=n("el-button"),m=n("el-option"),h=n("el-select"),y=n("el-card"),f=n("el-table-column"),k=n("el-tag"),N=n("el-table"),M=n("el-skeleton"),z=n("Cpu"),b=n("el-icon"),q=n("el-empty"),c=n("el-form-item"),E=n("el-radio"),$=n("el-radio-group"),C=n("el-input"),H=n("el-slider"),R=n("el-input-number"),s=n("el-form"),r=n("el-dialog"),A=n("BaseLayout");return v(),I(A,null,{default:a(()=>[d("div",Y,[d("main",Z,[l[20]||(l[20]=d("div",{class:"content-header"},[d("div",{class:"header-info"},[d("h1",{class:"content-title"},"模型配置管理"),d("p",{class:"content-subtitle"},"配置和管理AI模型参数，支持多种模型提供商")])],-1)),d("div",x,[e(y,null,{default:a(()=>[d("div",ee,[d("div",le,[e(u,{type:"primary",icon:o.Plus,onClick:o.showAddDialog,size:"large"},{default:a(()=>[...l[12]||(l[12]=[i(" 新增配置 ",-1)])]),_:1},8,["icon","onClick"]),e(u,{icon:o.Refresh,onClick:o.loadConfigs,size:"large"},{default:a(()=>[...l[13]||(l[13]=[i("刷新",-1)])]),_:1},8,["icon","onClick"])]),d("div",oe,[e(h,{modelValue:o.activeFilter,"onUpdate:modelValue":l[0]||(l[0]=t=>o.activeFilter=t),placeholder:"筛选模型类型",size:"large",clearable:"",style:{width:"300px"}},{default:a(()=>[e(m,{label:"全部",value:""}),e(m,{label:"对话模型 (CHAT)",value:"CHAT"}),e(m,{label:"嵌入模型 (EMBEDDING)",value:"EMBEDDING"})]),_:1},8,["modelValue"])])])]),_:1})]),o.loading?V("",!0):(v(),D("div",te,[e(y,null,{default:a(()=>[e(N,{data:o.filteredConfigs,style:{width:"100%"},stripe:""},{default:a(()=>[e(f,{prop:"id",label:"ID",width:"80"}),e(f,{prop:"provider",label:"提供商",width:"120"},{default:a(t=>[e(k,{type:o.getProviderTagType(t.row.provider),size:"small"},{default:a(()=>[i(w(t.row.provider),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"modelName",label:"模型名称",width:"180"}),e(f,{prop:"modelType",label:"模型类型",width:"120"},{default:a(t=>[e(k,{type:t.row.modelType==="CHAT"?"primary":"success",size:"small"},{default:a(()=>[i(w(t.row.modelType==="CHAT"?"对话模型":"嵌入模型"),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"baseUrl",label:"API地址","min-width":"200","show-overflow-tooltip":""}),e(f,{label:"路径配置","min-width":"180","show-overflow-tooltip":""},{default:a(t=>[t.row.modelType==="CHAT"&&t.row.completionsPath?(v(),D("div",ae,[e(k,{type:"primary",size:"small"},{default:a(()=>[i(" 对话: "+w(t.row.completionsPath),1)]),_:2},1024)])):t.row.modelType==="EMBEDDING"&&t.row.embeddingsPath?(v(),D("div",se,[e(k,{type:"success",size:"small"},{default:a(()=>[i(" 嵌入: "+w(t.row.embeddingsPath),1)]),_:2},1024)])):(v(),D("div",ne,[...l[14]||(l[14]=[d("span",{class:"text-muted"},"使用默认路径",-1)])]))]),_:1}),e(f,{prop:"temperature",label:"温度",width:"100"},{default:a(t=>[i(w(t.row.temperature||0),1)]),_:1}),e(f,{prop:"maxTokens",label:"最大Token",width:"120"},{default:a(t=>[i(w(t.row.maxTokens||2e3),1)]),_:1}),e(f,{prop:"isActive",label:"状态",width:"100"},{default:a(t=>[e(k,{type:t.row.isActive?"success":"info",size:"small",effect:"light"},{default:a(()=>[i(w(t.row.isActive?"已启用":"未启用"),1)]),_:2},1032,["type"])]),_:1}),e(f,{label:"操作",width:"320",fixed:"right"},{default:a(t=>[d("div",ie,[e(u,{type:"info",size:"small",onClick:G=>o.handleTestConnection(t.row),loading:o.testingId===t.row.id},{default:a(()=>[...l[15]||(l[15]=[i(" 连接测试 ",-1)])]),_:1},8,["onClick","loading"]),t.row.isActive?V("",!0):(v(),I(u,{key:0,type:"success",size:"small",onClick:G=>o.handleActivate(t.row.id,t.row.modelType),loading:o.activatingId===t.row.id},{default:a(()=>[...l[16]||(l[16]=[i(" 启用 ",-1)])]),_:1},8,["onClick","loading"])),e(u,{type:"primary",size:"small",onClick:G=>o.handleEdit(t.row)},{default:a(()=>[...l[17]||(l[17]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(u,{type:"danger",size:"small",onClick:G=>o.handleDelete(t.row)},{default:a(()=>[...l[18]||(l[18]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])]),_:1})])),o.loading?(v(),D("div",re,[e(M,{rows:6,animated:""})])):V("",!0),!o.loading&&o.filteredConfigs.length===0?(v(),D("div",de,[e(q,{description:"暂无模型配置"},{image:a(()=>[e(b,{size:"60"},{default:a(()=>[e(z)]),_:1})]),default:a(()=>[e(u,{type:"primary",icon:o.Plus,onClick:o.showAddDialog},{default:a(()=>[...l[19]||(l[19]=[i("新增配置",-1)])]),_:1},8,["icon","onClick"])]),_:1})])):V("",!0)]),e(r,{modelValue:o.dialogVisible,"onUpdate:modelValue":l[11]||(l[11]=t=>o.dialogVisible=t),title:o.dialogTitle,width:"600px","close-on-click-modal":!1},{footer:a(()=>[d("span",ue,[e(u,{onClick:l[10]||(l[10]=t=>o.dialogVisible=!1)},{default:a(()=>[...l[25]||(l[25]=[i("取消",-1)])]),_:1}),e(u,{type:"primary",onClick:o.handleSubmit,loading:o.submitting},{default:a(()=>[i(w(o.isEditMode?"更新":"创建"),1)]),_:1},8,["onClick","loading"])])]),default:a(()=>[e(s,{ref:"formRef",model:o.formData,rules:o.formRules,"label-width":"120px","label-position":"left"},{default:a(()=>[e(c,{label:"提供商",prop:"provider"},{default:a(()=>[e(h,{modelValue:o.formData.provider,"onUpdate:modelValue":l[1]||(l[1]=t=>o.formData.provider=t),placeholder:"请选择提供商",style:{width:"100%"},onChange:o.updateBaseUrlByProvider},{default:a(()=>[e(m,{label:"DeepSeek",value:"deepseek"}),e(m,{label:"Qwen",value:"qwen"}),e(m,{label:"OpenAI",value:"openai"}),e(m,{label:"Siliconflow",value:"siliconflow"}),e(m,{label:"Custom",value:"custom"})]),_:1},8,["modelValue","onChange"])]),_:1}),e(c,{label:"模型类型",prop:"modelType"},{default:a(()=>[e($,{modelValue:o.formData.modelType,"onUpdate:modelValue":l[2]||(l[2]=t=>o.formData.modelType=t)},{default:a(()=>[e(E,{label:"CHAT"},{default:a(()=>[...l[21]||(l[21]=[i("对话模型",-1)])]),_:1}),e(E,{label:"EMBEDDING"},{default:a(()=>[...l[22]||(l[22]=[i("嵌入模型",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"模型名称",prop:"modelName"},{default:a(()=>[e(C,{modelValue:o.formData.modelName,"onUpdate:modelValue":l[3]||(l[3]=t=>o.formData.modelName=t),placeholder:"例如: gpt-4, deepseek-chat,qwen-plus,text-embedding-v4"},null,8,["modelValue"])]),_:1}),e(c,{label:"API密钥",prop:"apiKey"},{default:a(()=>[e(C,{modelValue:o.formData.apiKey,"onUpdate:modelValue":l[4]||(l[4]=t=>o.formData.apiKey=t),type:"password","show-password":"",placeholder:"请输入API密钥"},null,8,["modelValue"])]),_:1}),e(c,{label:"Base URL",prop:"baseUrl"},{default:a(()=>[e(C,{modelValue:o.formData.baseUrl,"onUpdate:modelValue":l[5]||(l[5]=t=>o.formData.baseUrl=t),placeholder:"请填写兼容 OpenAI 协议的 Base URL，通常不包含 /v1 后缀"},null,8,["modelValue"])]),_:1}),o.formData.modelType==="CHAT"?(v(),I(c,{key:0,label:"Completions路径",prop:"completionsPath"},{default:a(()=>[e(C,{modelValue:o.formData.completionsPath,"onUpdate:modelValue":l[6]||(l[6]=t=>o.formData.completionsPath=t),placeholder:"附加到base-url的路径。留空则使用默认值/v1/chat/completions"},null,8,["modelValue"])]),_:1})):V("",!0),o.formData.modelType==="EMBEDDING"?(v(),I(c,{key:1,label:"Embeddings路径",prop:"embeddingsPath"},{default:a(()=>[e(C,{modelValue:o.formData.embeddingsPath,"onUpdate:modelValue":l[7]||(l[7]=t=>o.formData.embeddingsPath=t),placeholder:"附加到附加到base-url的路径。留空则使用默认值/v1/embeddings"},null,8,["modelValue"])]),_:1})):V("",!0),e(c,{label:"温度",prop:"temperature"},{default:a(()=>[e(H,{modelValue:o.formData.temperature,"onUpdate:modelValue":l[8]||(l[8]=t=>o.formData.temperature=t),min:0,max:2,step:.1,"show-input":"","show-input-controls":""},null,8,["modelValue"]),l[23]||(l[23]=d("div",{class:"form-tip"},"建议默认0。控制生成文本的随机性，值越高越随机",-1))]),_:1}),e(c,{label:"最大Token",prop:"maxTokens"},{default:a(()=>[e(R,{modelValue:o.formData.maxTokens,"onUpdate:modelValue":l[9]||(l[9]=t=>o.formData.maxTokens=t),min:100,max:1e4,step:100,style:{width:"100%"}},null,8,["modelValue"]),l[24]||(l[24]=d("div",{class:"form-tip"},"控制生成文本的最大长度",-1))]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])]),_:1})}const ce=J(X,[["render",me],["__scopeId","data-v-4de5f9f4"]]);export{ce as default};
