import{d as se,b as de,a as ze,e as Ue,E as i,h as Y,u as Ke,_ as oe,m as B,l as a,q as l,j as r,w as o,k as b,x as y,n as R,D as Fe,t as M,F as X,y as ye,z as $e,G as le,H as ue,I as xe,J as N,K as Ne,s as Ce,o as ve,f as V,L as Pe,p as _e,i as U,M as Ie,N as Ve,O as Le,P as et,Q as tt,c as lt,R as ot,S as at,T as Me,U as nt,V as st,B as rt,A as it,W as dt,X as ut,Y as pt,Z as mt,$ as ct,a0 as gt,a1 as ft,a2 as yt,a3 as vt,a4 as bt,a5 as wt,a6 as ht}from"./index-DNCKiXbb.js";import{A as ne,g as Ct,a as kt}from"./avatar-DDGUTKZC.js";import{B as Vt}from"./BaseLayout-bdnKF8nQ.js";import{P as Ae}from"./presetQuestion-CaoTIfxB.js";import _t from"./NotFound-B1P5fyAN.js";import{f as Dt}from"./fileUpload-BQXCDLCH.js";const $t=se({name:"AgentBaseSetting",props:{agent:{type:Object,required:!0}},setup(t){const e=Ke(),n=async()=>{try{const c=await ne.update(t.agent.id,t.agent);c===null?(console.error("更新智能体失败:",c),i.error("更新失败：未知错误")):i.success("更新成功！")}catch(c){console.error("更新智能体失败:",c),i.error("更新失败："+(c.message||"未知错误"))}},s=async()=>{try{await Y.confirm(`确定要删除智能体"${t.agent.name}"吗？删除后将无法恢复。`,"删除智能体",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!1}),await ne.delete(t.agent.id)?(i.success("智能体已删除"),await e.push("/agents")):i.error("删除失败：智能体不存在")}catch{}},f=c=>c?new Date(c).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",v=de(()=>f(t.agent.createTime)),m=de(()=>f(t.agent.updateTime));return{Edit:Ue,Delete:ze,props:t,updateAgent:n,handleDeleteAgent:s,formattedCreateTime:v,formattedUpdateTime:m}}}),Tt={class:"agent-base-setting"},St={class:"form-item"},Ft={class:"form-item"},At={class:"form-item"},Nt={class:"form-item"},It={class:"form-item"},Et={class:"form-item"},zt={class:"form-item"},Ut={class:"form-item"},Kt={class:"form-item form-switch"},Pt={class:"button-group"};function Lt(t,e,n,s,f,v){const m=r("el-divider"),c=r("el-input"),C=r("el-col"),_=r("el-row"),S=r("el-option"),g=r("el-select"),q=r("el-switch"),h=r("el-text"),D=r("el-button");return b(),B("div",Tt,[e[19]||(e[19]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"基本信息")],-1)),l(m),l(_,{gutter:20},{default:o(()=>[l(C,{span:12},{default:o(()=>[a("div",St,[e[7]||(e[7]=a("label",null,"智能体名称",-1)),l(c,{modelValue:t.props.agent.name,"onUpdate:modelValue":e[0]||(e[0]=F=>t.props.agent.name=F),placeholder:"请输入智能体名称",size:"large"},null,8,["modelValue"])])]),_:1}),l(C,{span:12},{default:o(()=>[a("div",Ft,[e[8]||(e[8]=a("label",null,"分类",-1)),l(c,{modelValue:t.props.agent.category,"onUpdate:modelValue":e[1]||(e[1]=F=>t.props.agent.category=F),placeholder:"请输入智能体分类",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(C,{span:24},{default:o(()=>[a("div",At,[e[9]||(e[9]=a("label",null,"描述",-1)),l(c,{modelValue:t.props.agent.description,"onUpdate:modelValue":e[2]||(e[2]=F=>t.props.agent.description=F),rows:4,type:"textarea",placeholder:"请输入智能体描述",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(C,{span:24},{default:o(()=>[a("div",Nt,[e[10]||(e[10]=a("label",null,"智能体Prompt",-1)),l(c,{modelValue:t.props.agent.prompt,"onUpdate:modelValue":e[3]||(e[3]=F=>t.props.agent.prompt=F),rows:4,type:"textarea",placeholder:"请输入智能体Prompt",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(C,{span:12},{default:o(()=>[a("div",It,[e[11]||(e[11]=a("label",null,"标签",-1)),l(c,{modelValue:t.props.agent.tags,"onUpdate:modelValue":e[4]||(e[4]=F=>t.props.agent.tags=F),placeholder:"多个标签用逗号分隔",size:"large"},null,8,["modelValue"])])]),_:1}),l(C,{span:12},{default:o(()=>[a("div",Et,[e[12]||(e[12]=a("label",null,"状态",-1)),l(g,{modelValue:t.props.agent.status,"onUpdate:modelValue":e[5]||(e[5]=F=>t.props.agent.status=F),placeholder:"请选择状态",style:{width:"100%"},size:"large"},{default:o(()=>[l(S,{key:"draft",label:"待发布",value:"draft"}),l(S,{key:"published",label:"已发布",value:"published"}),l(S,{key:"offline",label:"已下线",value:"offline"})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(C,{span:12},{default:o(()=>[a("div",zt,[e[13]||(e[13]=a("label",null,"创建时间",-1)),l(c,{disabled:"","model-value":t.formattedCreateTime,size:"large"},null,8,["model-value"])])]),_:1}),l(C,{span:12},{default:o(()=>[a("div",Ut,[e[14]||(e[14]=a("label",null,"更新时间",-1)),l(c,{disabled:"","model-value":t.formattedUpdateTime,size:"large"},null,8,["model-value"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(C,{span:24},{default:o(()=>[a("div",Kt,[l(q,{modelValue:t.props.agent.humanReviewEnabled,"onUpdate:modelValue":e[6]||(e[6]=F=>t.props.agent.humanReviewEnabled=F),size:"large"},null,8,["modelValue"]),e[16]||(e[16]=a("span",null,"启用计划人工复核",-1)),l(h,{class:"mx-1"},{default:o(()=>[...e[15]||(e[15]=[y("（开启后，Planner 计划会在执行前等待人工复核）",-1)])]),_:1})])]),_:1})]),_:1}),a("div",Pt,[l(D,{type:"primary",icon:t.Edit,round:"",onClick:t.updateAgent,size:"large"},{default:o(()=>[...e[17]||(e[17]=[y(" 保存 ",-1)])]),_:1},8,["icon","onClick"]),l(D,{type:"danger",icon:t.Delete,round:"",onClick:t.handleDeleteAgent,size:"large"},{default:o(()=>[...e[18]||(e[18]=[y(" 删除智能体 ",-1)])]),_:1},8,["icon","onClick"])])])}const Mt=oe($t,[["render",Lt],["__scopeId","data-v-c5a3b1ac"]]),qt={name:"AgentPromptConfig",props:{agentId:{type:[String,Number],required:!0},promptType:{type:String,default:"report-generator"},agentPrompt:{type:String,default:""}},data(){return{optimizationConfigs:[],showAddConfigDialog:!1,editingConfig:null,showBatchActions:!1,showPriorityDialog:!1,selectedConfigs:[],editingPriorityConfig:null,formData:{name:"",description:"",optimizationPrompt:"",priority:0,displayOrder:0},priorityForm:{priority:0,displayOrder:0},loading:!1,message:{show:!1,text:"",type:"success"}}},computed:{isAllSelected(){return this.optimizationConfigs.length>0&&this.selectedConfigs.length===this.optimizationConfigs.length},isIndeterminate(){return this.selectedConfigs.length>0&&this.selectedConfigs.length<this.optimizationConfigs.length}},mounted(){this.loadOptimizationConfigs()},methods:{async loadOptimizationConfigs(){try{this.loading=!0;const t=this.agentId?`?agentId=${this.agentId}`:"",n=await(await fetch(`/api/prompt-config/list-by-type/${this.promptType}${t}`)).json();n.success&&(this.optimizationConfigs=n.data||[],this.optimizationConfigs.length===0&&(this.showBatchActions=!1,this.selectedConfigs=[]))}catch(t){console.error("加载优化配置失败:",t),this.showMessage("加载优化配置失败","error")}finally{this.loading=!1}},async saveConfig(){try{const t={...this.formData,promptType:this.promptType,agentId:this.agentId?Number(this.agentId):null,enabled:!0,creator:"user",priority:this.formData.priority||0,displayOrder:this.formData.displayOrder||0};this.editingConfig&&(t.id=this.editingConfig.id);const n=await(await fetch("/api/prompt-config/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();n.success?(this.showMessage(n.message||"保存成功","success"),this.closeDialog(),this.loadOptimizationConfigs()):this.showMessage(n.message||"保存失败","error")}catch(t){console.error("保存配置失败:",t),this.showMessage("保存配置失败","error")}},async toggleConfig(t){try{const e=t.enabled?`/api/prompt-config/${t.id}/disable`:`/api/prompt-config/${t.id}/enable`,s=await(await fetch(e,{method:"POST"})).json();s.success?(this.showMessage(s.message,"success"),this.loadOptimizationConfigs()):this.showMessage(s.message,"error")}catch(e){console.error("切换配置状态失败:",e),this.showMessage("操作失败","error")}},async deleteConfig(t){if(confirm("确定要删除这个优化配置吗？"))try{const n=await(await fetch(`/api/prompt-config/${t}`,{method:"DELETE"})).json();n.success?(this.showMessage(n.message,"success"),this.loadOptimizationConfigs(),this.selectedConfigs=this.selectedConfigs.filter(s=>s!==t)):this.showMessage(n.message,"error")}catch(e){console.error("删除配置失败:",e),this.showMessage("删除配置失败","error")}},editConfig(t){this.editingConfig=t,this.formData={name:t.name,description:t.description,optimizationPrompt:t.optimizationPrompt,priority:t.priority||0,displayOrder:t.displayOrder||0}},closeDialog(){this.showAddConfigDialog=!1,this.editingConfig=null,this.formData={name:"",description:"",optimizationPrompt:"",priority:0,displayOrder:0}},async batchEnable(){if(this.selectedConfigs.length!==0)try{const e=await(await fetch("/api/prompt-config/batch-enable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.selectedConfigs)})).json();e.success?(this.showMessage(e.message,"success"),this.loadOptimizationConfigs(),this.clearSelection()):this.showMessage(e.message,"error")}catch(t){console.error("批量启用失败:",t),this.showMessage("批量启用失败","error")}},async batchDisable(){if(this.selectedConfigs.length!==0)try{const e=await(await fetch("/api/prompt-config/batch-disable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.selectedConfigs)})).json();e.success?(this.showMessage(e.message,"success"),this.loadOptimizationConfigs(),this.clearSelection()):this.showMessage(e.message,"error")}catch(t){console.error("批量禁用失败:",t),this.showMessage("批量禁用失败","error")}},clearSelection(){this.selectedConfigs=[],this.showBatchActions=!1},toggleSelectAll(){this.isAllSelected?this.selectedConfigs=[]:this.selectedConfigs=this.optimizationConfigs.map(t=>t.id)},handleShowPriorityDialog(t){this.editingPriorityConfig=t,this.priorityForm={priority:t.priority||0,displayOrder:t.displayOrder||0},this.showPriorityDialog=!0},async updatePriority(){try{const e=await(await fetch(`/api/prompt-config/${this.editingPriorityConfig.id}/priority`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priority:this.priorityForm.priority})})).json();e.success?(this.showMessage("优先级更新成功","success"),this.loadOptimizationConfigs(),this.closePriorityDialog()):this.showMessage(e.message,"error")}catch(t){console.error("更新优先级失败:",t),this.showMessage("更新优先级失败","error")}},closePriorityDialog(){this.showPriorityDialog=!1,this.editingPriorityConfig=null,this.priorityForm={priority:0,displayOrder:0}},showMessage(t,e="success"){this.message={show:!0,text:t,type:e},setTimeout(()=>{this.message.show=!1},3e3)},hideMessage(){this.message.show=!1}}},Bt={class:"prompt-optimization-config"},Ot={class:"agent-prompt-section"},Rt={class:"prompt-display"},jt={class:"optimization-configs"},Jt={class:"config-list-header"},Qt={class:"header-actions"},Ht={key:0,class:"batch-actions-panel"},Gt={class:"batch-actions-content"},Wt={class:"batch-selection"},Xt=["checked","indeterminate"],Yt={class:"batch-info"},Zt={class:"batch-buttons"},xt=["disabled"],el=["disabled"],tl={key:1,class:"empty-state"},ll={key:2,class:"config-list"},ol={class:"config-header"},al={class:"config-info"},nl=["value"],sl={class:"config-name"},rl={key:0,class:"config-priority"},il={class:"config-actions"},dl=["onClick"],ul=["onClick"],pl=["onClick"],ml=["onClick"],cl={class:"config-content"},gl={class:"config-description"},fl={class:"optimization-prompt"},yl={class:"dialog-header"},vl={class:"form-group"},bl={class:"form-group"},wl={class:"form-group"},hl={class:"form-row"},Cl={class:"form-group"},kl={class:"form-group"},Vl={class:"form-actions"},_l={class:"dialog-header"},Dl={class:"form-group"},$l={class:"form-group"},Tl={class:"form-actions"};function Sl(t,e,n,s,f,v){return b(),B("div",Bt,[f.message.show?(b(),B("div",{key:0,class:Fe(["message-toast",f.message.type])},[a("span",null,M(f.message.text),1),a("button",{class:"message-close",onClick:e[0]||(e[0]=(...m)=>v.hideMessage&&v.hideMessage(...m))},"×")],2)):R("",!0),e[42]||(e[42]=a("div",{class:"config-header"},[a("h3",null,"增强式Prompt优化配置"),a("p",{class:"config-description"}," 配置的Prompt仅用作效果优化，支持多个提示词配置，在原始模板基础上进行增强。示例配置： "),a("ul",{class:"optimization-tips"},[a("li",null,"1. 查询的年销售额精确到小数点后两位。"),a("li",null,"2. 报告格式第一章节请先总结年销售额")])],-1)),a("div",Ot,[e[25]||(e[25]=a("h4",null,"智能体Prompt",-1)),a("div",Rt,M(n.agentPrompt||"你是一个销售数据分析专家，能够帮助用户分析销售趋势，客户行为和业务指标。"),1)]),a("div",jt,[a("div",Jt,[e[28]||(e[28]=a("h4",null,"优化配置列表",-1)),a("div",Qt,[f.optimizationConfigs.length>0?(b(),B("button",{key:0,class:"batch-action-btn",onClick:e[1]||(e[1]=m=>f.showBatchActions=!f.showBatchActions)},[...e[26]||(e[26]=[a("i",{class:"icon-settings"},null,-1),y(" 批量操作 ",-1)])])):R("",!0),a("button",{class:"add-config-btn",onClick:e[2]||(e[2]=m=>f.showAddConfigDialog=!0)},[...e[27]||(e[27]=[a("i",{class:"icon-plus"},null,-1),y(" 添加优化配置 ",-1)])])])]),f.showBatchActions?(b(),B("div",Ht,[a("div",Gt,[a("div",Wt,[a("input",{type:"checkbox",checked:v.isAllSelected,indeterminate:v.isIndeterminate,onChange:e[3]||(e[3]=(...m)=>v.toggleSelectAll&&v.toggleSelectAll(...m)),class:"select-all-checkbox"},null,40,Xt),a("span",Yt,M(v.isAllSelected?"已全选":`已选择 ${f.selectedConfigs.length} 个配置`),1)]),a("div",Zt,[a("button",{class:"batch-btn enable",onClick:e[4]||(e[4]=(...m)=>v.batchEnable&&v.batchEnable(...m)),disabled:f.selectedConfigs.length===0}," 批量启用 ",8,xt),a("button",{class:"batch-btn disable",onClick:e[5]||(e[5]=(...m)=>v.batchDisable&&v.batchDisable(...m)),disabled:f.selectedConfigs.length===0}," 批量禁用 ",8,el),a("button",{class:"batch-btn cancel",onClick:e[6]||(e[6]=(...m)=>v.clearSelection&&v.clearSelection(...m))},"取消选择")])])])):R("",!0),f.optimizationConfigs.length===0?(b(),B("div",tl,[...e[29]||(e[29]=[a("p",null,'暂无优化配置，点击"添加优化配置"开始配置',-1)])])):(b(),B("div",ll,[(b(!0),B(X,null,ye(f.optimizationConfigs,m=>(b(),B("div",{key:m.id,class:Fe(["config-item",{disabled:!m.enabled,selected:f.selectedConfigs.includes(m.id)}])},[a("div",ol,[a("div",al,[le(a("input",{type:"checkbox",value:m.id,"onUpdate:modelValue":e[7]||(e[7]=c=>f.selectedConfigs=c),class:"config-checkbox"},null,8,nl),[[xe,f.selectedConfigs]]),a("span",sl,M(m.name),1),m.priority!==void 0?(b(),B("span",rl," 优先级: "+M(m.priority),1)):R("",!0)]),a("div",il,[a("button",{class:Fe(["toggle-btn",{active:m.enabled}]),onClick:c=>v.toggleConfig(m)},M(m.enabled?"已启用":"已禁用"),11,dl),a("button",{class:"edit-btn",onClick:c=>v.editConfig(m)},"编辑",8,ul),a("button",{class:"priority-btn",onClick:c=>v.handleShowPriorityDialog(m)},"优先级",8,pl),a("button",{class:"delete-btn",onClick:c=>v.deleteConfig(m.id)},"删除",8,ml)])]),a("div",cl,[a("p",gl,M(m.description),1),a("div",fl,M(m.optimizationPrompt),1)])],2))),128))]))]),f.showAddConfigDialog||f.editingConfig?(b(),B("div",{key:1,class:"dialog-overlay",onClick:e[17]||(e[17]=(...m)=>v.closeDialog&&v.closeDialog(...m))},[a("div",{class:"dialog-content",onClick:e[16]||(e[16]=$e(()=>{},["stop"]))},[a("div",yl,[a("h3",null,M(f.editingConfig?"编辑优化配置":"添加优化配置"),1),a("button",{class:"close-btn",onClick:e[8]||(e[8]=(...m)=>v.closeDialog&&v.closeDialog(...m))},"×")]),a("form",{onSubmit:e[15]||(e[15]=$e((...m)=>v.saveConfig&&v.saveConfig(...m),["prevent"])),class:"config-form"},[a("div",vl,[e[30]||(e[30]=a("label",{for:"configName"},"配置名称",-1)),le(a("input",{id:"configName","onUpdate:modelValue":e[9]||(e[9]=m=>f.formData.name=m),type:"text",placeholder:"请输入配置名称",required:""},null,512),[[ue,f.formData.name]])]),a("div",bl,[e[31]||(e[31]=a("label",{for:"description"},"配置描述",-1)),le(a("input",{id:"description","onUpdate:modelValue":e[10]||(e[10]=m=>f.formData.description=m),type:"text",placeholder:"请输入配置描述"},null,512),[[ue,f.formData.description]])]),a("div",wl,[e[32]||(e[32]=a("label",{for:"optimizationPrompt"},"优化提示词内容",-1)),le(a("textarea",{id:"optimizationPrompt","onUpdate:modelValue":e[11]||(e[11]=m=>f.formData.optimizationPrompt=m),rows:"6",placeholder:"请输入优化提示词内容，支持模板变量如 {user_requirements_and_plan}",required:""},null,512),[[ue,f.formData.optimizationPrompt]])]),a("div",hl,[a("div",Cl,[e[33]||(e[33]=a("label",{for:"priority"},"优先级",-1)),le(a("input",{id:"priority","onUpdate:modelValue":e[12]||(e[12]=m=>f.formData.priority=m),type:"number",min:"0",max:"100",placeholder:"0-100，数字越大优先级越高"},null,512),[[ue,f.formData.priority,void 0,{number:!0}]])]),a("div",kl,[e[34]||(e[34]=a("label",{for:"displayOrder"},"显示顺序",-1)),le(a("input",{id:"displayOrder","onUpdate:modelValue":e[13]||(e[13]=m=>f.formData.displayOrder=m),type:"number",min:"0",placeholder:"显示顺序，数字越小越靠前"},null,512),[[ue,f.formData.displayOrder,void 0,{number:!0}]])])]),a("div",Vl,[a("button",{type:"button",class:"cancel-btn",onClick:e[14]||(e[14]=(...m)=>v.closeDialog&&v.closeDialog(...m))},"取消"),e[35]||(e[35]=a("button",{type:"submit",class:"save-btn"},"保存配置",-1))])],32)])])):R("",!0),f.showPriorityDialog?(b(),B("div",{key:2,class:"dialog-overlay",onClick:e[24]||(e[24]=(...m)=>v.closePriorityDialog&&v.closePriorityDialog(...m))},[a("div",{class:"dialog-content",onClick:e[23]||(e[23]=$e(()=>{},["stop"]))},[a("div",_l,[e[36]||(e[36]=a("h3",null,"设置优先级",-1)),a("button",{class:"close-btn",onClick:e[18]||(e[18]=(...m)=>v.closePriorityDialog&&v.closePriorityDialog(...m))},"×")]),a("form",{onSubmit:e[22]||(e[22]=$e((...m)=>v.updatePriority&&v.updatePriority(...m),["prevent"])),class:"priority-form"},[a("div",Dl,[e[37]||(e[37]=a("label",{for:"priorityValue"},"优先级 (0-100)",-1)),le(a("input",{id:"priorityValue","onUpdate:modelValue":e[19]||(e[19]=m=>f.priorityForm.priority=m),type:"number",min:"0",max:"100",placeholder:"数字越大优先级越高",required:""},null,512),[[ue,f.priorityForm.priority,void 0,{number:!0}]]),e[38]||(e[38]=a("p",{class:"form-hint"},"优先级越高，该配置在多个配置中的执行顺序越靠前",-1))]),a("div",$l,[e[39]||(e[39]=a("label",{for:"displayOrderValue"},"显示顺序",-1)),le(a("input",{id:"displayOrderValue","onUpdate:modelValue":e[20]||(e[20]=m=>f.priorityForm.displayOrder=m),type:"number",min:"0",placeholder:"数字越小越靠前"},null,512),[[ue,f.priorityForm.displayOrder,void 0,{number:!0}]]),e[40]||(e[40]=a("p",{class:"form-hint"},"控制配置在列表中的显示顺序",-1))]),a("div",Tl,[a("button",{type:"button",class:"cancel-btn",onClick:e[21]||(e[21]=(...m)=>v.closePriorityDialog&&v.closePriorityDialog(...m))},"取消"),e[41]||(e[41]=a("button",{type:"submit",class:"save-btn"},"保存",-1))])],32)])])):R("",!0)])}const Fl=oe(qt,[["render",Sl],["__scopeId","data-v-dca7029e"]]),ie="/api/business-knowledge";class Al{async list(e,n){try{const s={agentId:e.toString()};return n&&(s.keyword=n),(await N.get(ie,{params:s})).data.data||[]}catch(s){throw console.error("Failed to fetch business knowledge list:",s),s}}async get(e){var n;try{return(await N.get(`${ie}/${e}`)).data.data||null}catch(s){if(N.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return null;throw s}}async create(e){return(await N.post(ie,e)).data.data}async update(e,n){var s;try{return(await N.put(`${ie}/${e}`,n)).data.data||null}catch(f){if(N.isAxiosError(f)&&((s=f.response)==null?void 0:s.status)===404)return null;throw f}}async delete(e){var n;try{return(await N.delete(`${ie}/${e}`)).data.success}catch(s){if(N.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return!1;throw s}}async recallKnowledge(e,n){return(await N.post(`${ie}/recall/${e}`,null,{params:{isRecall:n}})).data.success}async retryEmbedding(e){return(await N.post(`${ie}/retry-embedding/${e}`)).data.success}async refreshAllKnowledgeToVectorStore(e){return(await N.post(`${ie}/refresh-vector-store`,null,{params:{agentId:e}})).data.success}}const pe=new Al,Nl=se({name:"AgentKnowledgeConfig",components:{Search:Ce,Warning:Ne},props:{agentId:{type:Number,required:!0}},setup(t){const e=V([]),n=V(!1),s=V(!1),f=V(""),v=V({businessTerm:"",description:"",synonyms:"",isRecall:!1}),m=V(null),c=V(!1),C=V(!1),_=V({}),S=()=>{s.value=!1,n.value=!0},g=()=>{q()},q=async()=>{try{e.value=await pe.list(t.agentId,f.value||void 0)}catch(E){i.error("加载业务知识列表失败"),console.error("Failed to load business knowledge:",E)}},h=E=>{s.value=!0,m.value=E.id||null,v.value={...E},n.value=!0},D=async E=>{if(E.id)try{await Y.confirm(`确定要删除业务知识 "${E.businessTerm}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await pe.delete(E.id)?(i.success("删除成功"),await q()):i.error("删除失败")}catch{}},F=async(E,p)=>{if(E.id)try{await pe.recallKnowledge(E.id,p)?(i.success(`${p?"设为召回":"取消召回"}成功`),E.isRecall=p):i.error(`${p?"设为召回":"取消召回"}失败`)}catch(P){i.error(`${p?"设为召回":"取消召回"}失败`),console.error("Failed to toggle recall:",P)}},A=async()=>{C.value=!0;try{if(s.value&&m.value){const E={businessTerm:v.value.businessTerm,description:v.value.description,synonyms:v.value.synonyms,agentId:t.agentId};if(await pe.update(m.value,E))i.success("更新成功");else{i.error("更新失败");return}}else{const E={businessTerm:v.value.businessTerm,description:v.value.description,synonyms:v.value.synonyms,isRecall:v.value.isRecall,agentId:t.agentId};await pe.create(E),i.success("创建成功")}n.value=!1,await q()}catch(E){i.error(`${s.value?"更新":"创建"}失败`),console.error("Failed to save knowledge:",E)}finally{C.value=!1}},T=async()=>{try{await Y.confirm("如果所有向量状态正常，即无需同步。确定要清除现有数据并开始重新同步吗？","确认同步",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),c.value=!0,await pe.refreshAllKnowledgeToVectorStore(t.agentId.toString())?i.success("同步到向量库成功"):i.error("同步到向量库失败")}catch(E){E!=="cancel"&&(i.error("同步到向量库失败"),console.error("Failed to refresh vector store:",E))}finally{c.value=!1}},z=async E=>{if(E.id)try{_.value[E.id]=!0,await pe.retryEmbedding(E.id)?(i.success("重试向量化成功"),await q()):i.error("重试向量化失败")}catch(p){i.error("重试向量化失败"),console.error("Failed to retry vectorization:",p)}finally{_.value[E.id]=!1}},$=E=>{switch(E){case"COMPLETED":return"success";case"FAILED":return"danger";case"PENDING":return"warning";case"PROCESSING":return"primary";default:return"info"}};return ve(()=>{q()}),{Plus:_e,Search:Ce,Document:Pe,businessKnowledgeList:e,dialogVisible:n,isEdit:s,searchKeyword:f,knowledgeForm:v,refreshLoading:c,saveLoading:C,retryLoadingMap:_,openCreateDialog:S,editKnowledge:h,deleteKnowledge:D,toggleRecall:F,saveKnowledge:A,handleSearch:g,refreshVectorStore:T,retryEmbedding:z,getVectorStatusType:$}}}),Il={style:{padding:"20px"}},El={style:{"margin-bottom":"30px"}},zl={style:{"text-align":"right"}};function Ul(t,e,n,s,f,v){const m=r("el-divider"),c=r("el-col"),C=r("Search"),_=r("el-icon"),S=r("el-input"),g=r("el-button"),q=r("el-row"),h=r("el-table-column"),D=r("Warning"),F=r("el-tooltip"),A=r("el-tag"),T=r("el-table"),z=r("el-form-item"),$=r("el-form"),E=r("el-dialog");return b(),B(X,null,[a("div",Il,[e[15]||(e[15]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"业务知识管理")],-1)),l(m),a("div",El,[l(q,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(c,{span:12},{default:o(()=>[...e[6]||(e[6]=[a("h3",null,"业务知识列表",-1)])]),_:1}),l(c,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(S,{modelValue:t.searchKeyword,"onUpdate:modelValue":e[0]||(e[0]=p=>t.searchKeyword=p),placeholder:"请输入关键词，并按回车搜索",style:{width:"250px","margin-right":"10px"},clearable:"",onClear:t.handleSearch,onKeyup:Ie(t.handleSearch,["enter"]),size:"large"},{prefix:o(()=>[l(_,null,{default:o(()=>[l(C)]),_:1})]),_:1},8,["modelValue","onClear","onKeyup"]),t.refreshLoading?(b(),U(g,{key:1,size:"large",type:"success",round:"",loading:""},{default:o(()=>[...e[8]||(e[8]=[y("同步中...",-1)])]),_:1})):(b(),U(g,{key:0,onClick:t.refreshVectorStore,size:"large",type:"success",round:"",icon:t.Document},{default:o(()=>[...e[7]||(e[7]=[y(" 同步到向量库 ",-1)])]),_:1},8,["onClick","icon"])),l(g,{onClick:t.openCreateDialog,size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[9]||(e[9]=[y(" 添加知识 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1})]),l(T,{data:t.businessKnowledgeList,style:{width:"100%"},border:""},{default:o(()=>[l(h,{prop:"id",label:"ID","min-width":"60px"}),l(h,{prop:"businessTerm",label:"业务名词","min-width":"120px"}),l(h,{prop:"description",label:"描述","min-width":"150px"}),l(h,{prop:"synonyms",label:"同义词","min-width":"120px"}),l(h,{label:"向量化状态","min-width":"120px"},{default:o(p=>[l(A,{type:t.getVectorStatusType(p.row.embeddingStatus),round:""},{default:o(()=>[y(M(p.row.embeddingStatus||"未知")+" ",1),p.row.embeddingStatus==="FAILED"&&p.row.errorMsg?(b(),U(F,{key:0,content:p.row.errorMsg,placement:"top"},{default:o(()=>[l(_,{style:{"margin-left":"4px"}},{default:o(()=>[l(D)]),_:1})]),_:1},8,["content"])):R("",!0)]),_:2},1032,["type"])]),_:1}),l(h,{label:"是否召回","min-width":"80px"},{default:o(p=>[l(A,{type:p.row.isRecall?"success":"info",round:""},{default:o(()=>[y(M(p.row.isRecall?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(h,{prop:"createdTime",label:"创建时间","min-width":"120px"}),l(h,{label:"操作","min-width":"180px"},{default:o(p=>[l(g,{onClick:P=>t.editKnowledge(p.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[10]||(e[10]=[y(" 编辑 ",-1)])]),_:1},8,["onClick"]),p.row.embeddingStatus==="FAILED"?(b(),U(g,{key:0,onClick:P=>t.retryEmbedding(p.row),size:"small",type:"info",round:"",plain:"",loading:t.retryLoadingMap[p.row.id]},{default:o(()=>[...e[11]||(e[11]=[y(" 重试 ",-1)])]),_:1},8,["onClick","loading"])):R("",!0),p.row.isRecall?(b(),U(g,{key:1,onClick:P=>t.toggleRecall(p.row,!1),size:"small",type:"warning",round:"",plain:""},{default:o(()=>[...e[12]||(e[12]=[y(" 取消召回 ",-1)])]),_:1},8,["onClick"])):(b(),U(g,{key:2,onClick:P=>t.toggleRecall(p.row,!0),size:"small",type:"success",round:"",plain:""},{default:o(()=>[...e[13]||(e[13]=[y(" 设为召回 ",-1)])]),_:1},8,["onClick"])),l(g,{onClick:P=>t.deleteKnowledge(p.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[14]||(e[14]=[y(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),l(E,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[5]||(e[5]=p=>t.dialogVisible=p),title:t.isEdit?"编辑业务知识":"添加业务知识",width:"800"},{footer:o(()=>[a("div",zl,[l(g,{onClick:e[4]||(e[4]=p=>t.dialogVisible=!1)},{default:o(()=>[...e[16]||(e[16]=[y("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:t.saveKnowledge,loading:t.saveLoading,disabled:t.saveLoading},{default:o(()=>[y(M(t.isEdit?"更新":"创建"),1)]),_:1},8,["onClick","loading","disabled"])])]),default:o(()=>[l($,{model:t.knowledgeForm,"label-width":"100px",ref:"knowledgeFormRef"},{default:o(()=>[l(z,{label:"业务名词",prop:"businessTerm",required:""},{default:o(()=>[l(S,{modelValue:t.knowledgeForm.businessTerm,"onUpdate:modelValue":e[1]||(e[1]=p=>t.knowledgeForm.businessTerm=p),placeholder:"请输入业务名词"},null,8,["modelValue"])]),_:1}),l(z,{label:"描述",prop:"description",required:""},{default:o(()=>[l(S,{modelValue:t.knowledgeForm.description,"onUpdate:modelValue":e[2]||(e[2]=p=>t.knowledgeForm.description=p),type:"textarea",rows:3,placeholder:"请输入业务知识描述"},null,8,["modelValue"])]),_:1}),l(z,{label:"同义词",prop:"synonyms"},{default:o(()=>[l(S,{modelValue:t.knowledgeForm.synonyms,"onUpdate:modelValue":e[3]||(e[3]=p=>t.knowledgeForm.synonyms=p),type:"textarea",rows:2,placeholder:"请输入同义词，多个同义词用逗号分隔"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}const Kl=oe(Nl,[["render",Ul]]),Pl=se({name:"BatchImportDialog",components:{UploadFilled:Ve},props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:"批量导入"},jsonTemplate:{type:Array,default:()=>[]},validateJson:{type:Function,required:!0},validateExcelFile:{type:Function,required:!0},onJsonImport:{type:Function,required:!0},onExcelImport:{type:Function,required:!0},onDownloadExcelTemplate:{type:Function,required:!0}},emits:["update:modelValue","imported"],setup(t,{emit:e}){const n=V(""),s=V("input"),f=V(null),v=V(!1),m=V("json"),c=V(null),C=de({get:()=>t.modelValue,set:T=>e("update:modelValue",T)}),_=()=>{s.value="input",f.value=null,n.value="",m.value="json",c.value=null};return Le(()=>t.modelValue,T=>{T&&_()}),{dialogVisible:C,importJsonText:n,importTab:s,importResult:f,importing:v,importMode:m,loadTemplate:()=>{n.value=JSON.stringify(t.jsonTemplate,null,2),i.success("模板已加载")},handleValidateJson:()=>t.validateJson(n.value),handleJsonImport:async()=>{if(!t.validateJson(n.value))return;let T;try{T=JSON.parse(n.value)}catch(z){i.error("JSON格式错误："+z.message);return}try{v.value=!0;const z=await t.onJsonImport(T);f.value=z,s.value="result",z.failCount===0?i.success(`批量导入成功！共导入${z.successCount}条记录`):i.warning(`批量导入完成！成功${z.successCount}条，失败${z.failCount}条`),e("imported",z)}catch(z){i.error("批量导入失败："+z.message),console.error("Failed to batch import:",z)}finally{v.value=!1}},handleFileChange:T=>{c.value=T.raw??null},handleExceed:()=>{i.warning("只能上传一个文件")},downloadExcelTemplate:async()=>{try{await t.onDownloadExcelTemplate(),i.success("模板下载成功")}catch(T){i.error("模板下载失败："+T.message),console.error("Failed to download template:",T)}},handleExcelImport:async()=>{if(!(!t.validateExcelFile(c.value)||!c.value))try{v.value=!0;const T=await t.onExcelImport(c.value);f.value=T,s.value="result",T.failCount===0?i.success(`Excel导入成功！共导入${T.successCount}条记录`):i.warning(`Excel导入完成！成功${T.successCount}条，失败${T.failCount}条`),e("imported",T)}catch(T){i.error("Excel导入失败："+T.message),console.error("Failed to import excel:",T)}finally{v.value=!1}}}}}),Ll={style:{"margin-top":"10px","text-align":"right"}},Ml={style:{"text-align":"center",padding:"40px 0"}},ql={style:{"margin-top":"20px"}},Bl={key:0,style:{"text-align":"left","max-height":"300px","overflow-y":"auto"}},Ol={style:{"text-align":"right"}};function Rl(t,e,n,s,f,v){const m=r("el-alert"),c=r("el-radio-button"),C=r("el-radio-group"),_=r("el-input"),S=r("el-button"),g=r("el-tab-pane"),q=r("upload-filled"),h=r("el-icon"),D=r("el-upload"),F=r("el-result"),A=r("el-tabs"),T=r("el-dialog");return b(),U(T,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[4]||(e[4]=z=>t.dialogVisible=z),title:t.title,width:"900"},{footer:o(()=>[a("div",Ol,[l(S,{onClick:e[3]||(e[3]=z=>t.dialogVisible=!1)},{default:o(()=>[...e[13]||(e[13]=[y("关闭",-1)])]),_:1}),t.importMode==="json"?(b(),U(S,{key:0,type:"primary",onClick:t.handleJsonImport,loading:t.importing},{default:o(()=>[...e[14]||(e[14]=[y(" 开始导入 ",-1)])]),_:1},8,["onClick","loading"])):R("",!0),t.importMode==="excel"?(b(),U(S,{key:1,type:"primary",onClick:t.handleExcelImport,loading:t.importing},{default:o(()=>[...e[15]||(e[15]=[y(" 开始导入 ",-1)])]),_:1},8,["onClick","loading"])):R("",!0)])]),default:o(()=>[l(m,{title:"导入说明",type:"info",closable:!1,style:{"margin-bottom":"20px"}},{default:o(()=>[...e[5]||(e[5]=[a("p",null,"1. 支持JSON和Excel两种导入方式",-1),a("p",null,"2. 如果记录已存在（相同表名+字段名），将自动覆盖更新",-1),a("p",null,'3. 枚举字段信息可以直接写在"业务描述"中，例如：枚举值：1=资产工单, 2=账号工单',-1),a("p",null,"4. 必填字段：表名、字段名、业务名称、数据类型",-1)])]),_:1}),l(C,{modelValue:t.importMode,"onUpdate:modelValue":e[0]||(e[0]=z=>t.importMode=z),style:{"margin-bottom":"20px"}},{default:o(()=>[l(c,{value:"json"},{default:o(()=>[...e[6]||(e[6]=[y("JSON导入",-1)])]),_:1}),l(c,{value:"excel"},{default:o(()=>[...e[7]||(e[7]=[y("Excel导入",-1)])]),_:1})]),_:1},8,["modelValue"]),l(A,{modelValue:t.importTab,"onUpdate:modelValue":e[2]||(e[2]=z=>t.importTab=z)},{default:o(()=>[t.importMode==="json"?(b(),U(g,{key:0,label:"JSON输入",name:"input"},{default:o(()=>[l(_,{modelValue:t.importJsonText,"onUpdate:modelValue":e[1]||(e[1]=z=>t.importJsonText=z),type:"textarea",rows:15,placeholder:"请输入JSON格式的数据...",style:{"font-family":"'Courier New', monospace"}},null,8,["modelValue"]),a("div",Ll,[l(S,{onClick:t.loadTemplate,size:"small"},{default:o(()=>[...e[8]||(e[8]=[y("加载模板",-1)])]),_:1},8,["onClick"]),l(S,{onClick:t.handleValidateJson,size:"small",type:"primary"},{default:o(()=>[...e[9]||(e[9]=[y("验证JSON",-1)])]),_:1},8,["onClick"])])]),_:1})):R("",!0),t.importMode==="excel"?(b(),U(g,{key:1,label:"Excel上传",name:"input"},{default:o(()=>[a("div",Ml,[l(D,{ref:"uploadRef","auto-upload":!1,limit:1,accept:".xlsx,.xls","on-change":t.handleFileChange,"on-exceed":t.handleExceed,drag:""},{tip:o(()=>[...e[10]||(e[10]=[a("div",{class:"el-upload__tip"},"只能上传 xlsx/xls 文件，且不超过 10MB",-1)])]),default:o(()=>[l(h,{class:"el-icon--upload"},{default:o(()=>[l(q)]),_:1}),e[11]||(e[11]=a("div",{class:"el-upload__text"},[y(" 将Excel文件拖到此处，或 "),a("em",null,"点击上传")],-1))]),_:1},8,["on-change","on-exceed"]),a("div",ql,[l(S,{onClick:t.downloadExcelTemplate,type:"primary",plain:""},{default:o(()=>[...e[12]||(e[12]=[y("下载Excel模板",-1)])]),_:1},8,["onClick"])])])]),_:1})):R("",!0),l(g,{label:"导入结果",name:"result",disabled:!t.importResult},{default:o(()=>[t.importResult?(b(),U(F,{key:0,icon:t.importResult.failCount===0?"success":"warning",title:t.importResult.failCount===0?"导入成功":"部分导入失败"},{"sub-title":o(()=>[a("p",null," 总数："+M(t.importResult.total)+" | 成功："+M(t.importResult.successCount)+" | 失败："+M(t.importResult.failCount),1)]),extra:o(()=>[t.importResult.errors.length>0?(b(),B("div",Bl,[(b(!0),B(X,null,ye(t.importResult.errors,(z,$)=>(b(),U(m,{key:$,title:z,type:"error",closable:!1,style:{"margin-bottom":"10px"}},null,8,["title"]))),128))])):R("",!0)]),_:1},8,["icon","title"])):R("",!0)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}const jl=oe(Pl,[["render",Rl]]),ee="/api/semantic-model";class Jl{async list(e,n){const s={};return e!==void 0&&(s.agentId=e.toString()),n&&(s.keyword=n),(await N.get(ee,{params:s})).data.data||[]}async get(e){var n;try{return(await N.get(`${ee}/${e}`)).data.data||null}catch(s){if(N.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return null;throw s}}async create(e){return(await N.post(ee,e)).data.success}async update(e,n){var s;try{return(await N.put(`${ee}/${e}`,n)).data.success}catch(f){if(N.isAxiosError(f)&&((s=f.response)==null?void 0:s.status)===404)return!1;throw f}}async delete(e){var n;try{return(await N.delete(`${ee}/${e}`)).data.success}catch(s){if(N.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return!1;throw s}}async batchDelete(e){return(await N.delete(`${ee}/batch`,{data:e})).data.success}async enable(e){return(await N.put(`${ee}/enable`,e)).data.success}async disable(e){return(await N.put(`${ee}/disable`,e)).data.success}async batchImport(e){return(await N.post(`${ee}/batch-import`,e)).data.data||{total:0,successCount:0,failCount:0,errors:[]}}async importExcel(e,n){const s=new FormData;return s.append("file",e),s.append("agentId",n.toString()),(await N.post(`${ee}/import/excel`,s,{headers:{"Content-Type":"multipart/form-data"}})).data.data||{total:0,successCount:0,failCount:0,errors:[]}}async downloadTemplate(){const e=await N.get(`${ee}/template/download`,{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=n,s.setAttribute("download","semantic_model_template.xlsx"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(n)}}const te=new Jl,Ql=se({name:"AgentSemanticsConfig",components:{UploadFilled:Ve,Search:Ce,BatchImportDialog:jl},props:{agentId:{type:Number,required:!0}},setup(t){const e=V([]),n=V(!1),s=V(!1),f=V(""),v=V([]),m=V({tableName:"",columnName:"",businessName:"",synonyms:"",businessDescription:"",columnComment:"",dataType:"",status:1,agentId:t.agentId}),c=V(null),C=()=>{s.value=!1,m.value={tableName:"",columnName:"",businessName:"",synonyms:"",businessDescription:"",columnComment:"",dataType:"",status:1,agentId:t.agentId},n.value=!0},_=L=>{v.value=L},S=async()=>{if(v.value.length===0){i.warning("请先选择要删除的语义模型");return}try{await Y.confirm(`确定要删除选中的 ${v.value.length} 个语义模型吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const L=v.value.map(I=>I.id).filter(I=>I!==void 0);await te.batchDelete(L)?(i.success(`成功删除 ${L.length} 个语义模型`),v.value=[],await q()):i.error("批量删除失败")}catch{}},g=()=>{q()},q=async()=>{try{e.value=await te.list(t.agentId,f.value||void 0)}catch(L){i.error("加载语义模型列表失败"),console.error("Failed to load semantic models:",L)}},h=L=>{s.value=!0,c.value=L.id||null,m.value={...L},n.value=!0},D=async L=>{if(L.id)try{await Y.confirm(`确定要删除语义模型 "${L.businessName}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await te.delete(L.id)?(i.success("删除成功"),await q()):i.error("删除失败")}catch{}},F=async(L,O)=>{if(L.id)try{const I=[L.id];let w=!1;O===1?w=await te.enable(I):w=await te.disable(I),w?(i.success(`${O===1?"启用":"停用"}成功`),L.status=O):i.error(`${O===1?"启用":"停用"}失败`)}catch(I){i.error(`${O===1?"启用":"停用"}失败`),console.error("Failed to toggle status:",I)}},A=async()=>{try{if(s.value&&c.value){const L={...m.value,id:c.value};if(await te.update(c.value,L))i.success("更新成功");else{i.error("更新失败");return}}else{const L={agentId:t.agentId,tableName:m.value.tableName,columnName:m.value.columnName,businessName:m.value.businessName,synonyms:m.value.synonyms,businessDescription:m.value.businessDescription,columnComment:m.value.columnComment,dataType:m.value.dataType};if(await te.create(L))i.success("创建成功");else{i.error("创建失败");return}}n.value=!1,await q()}catch(L){i.error(`${s.value?"更新":"创建"}失败`),console.error("Failed to save model:",L)}};ve(()=>{q()});const T=V(!1);return{Plus:_e,Search:Ce,Delete:ze,semanticModelList:e,dialogVisible:n,isEdit:s,searchKeyword:f,selectedModels:v,modelForm:m,openCreateDialog:C,handleSelectionChange:_,batchDeleteModels:S,editModel:h,deleteModel:D,toggleStatus:F,saveModel:A,handleSearch:g,batchImportDialogVisible:T,jsonTemplate:[{tableName:"work_order",columnName:"order_type",businessName:"工单类型",synonyms:"类型,工单种类",businessDesc:"用于区分工单种类。枚举值：1=资产工单, 2=账号工单",dataType:"int"},{tableName:"work_order",columnName:"status",businessName:"工单状态",synonyms:"状态,处理状态",businessDesc:"工单当前处理状态。枚举值：0=待处理 1=处理中 2=已完成 3=已关闭",dataType:"int"}],openBatchImportDialog:()=>{T.value=!0},validateJson:L=>{try{const O=JSON.parse(L);if(!Array.isArray(O))return i.error("JSON格式错误：数据必须是数组"),!1;if(O.length===0)return i.error("导入数据不能为空"),!1;for(let I=0;I<O.length;I++){const w=O[I];if(!w.tableName||!w.columnName||!w.businessName||!w.dataType)return i.error(`第${I+1}条记录缺少必填字段（tableName, columnName, businessName, dataType）`),!1}return i.success("JSON格式验证通过"),!0}catch(O){return i.error("JSON格式错误："+O.message),!1}},validateExcelFile:L=>L?!0:(i.error("请先选择Excel文件"),!1),executeBatchImport:async L=>{try{return await te.batchImport({agentId:t.agentId,items:L})}catch(O){throw i.error("批量导入失败："+O.message),console.error("Failed to batch import:",O),O}},downloadExcelTemplate:async()=>{try{await te.downloadTemplate(),i.success("模板下载成功")}catch(L){i.error("模板下载失败："+L.message),console.error("Failed to download template:",L)}},executeExcelImport:async L=>{try{return await te.importExcel(L,t.agentId)}catch(O){throw i.error("Excel导入失败："+O.message),console.error("Failed to import excel:",O),O}},handleBatchImported:async()=>{await q()},formatDateTime:L=>{if(!L)return"-";try{return new Date(L).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return L}}}}}),Hl={style:{padding:"20px"}},Gl={style:{"margin-bottom":"30px"}},Wl={style:{"text-align":"right"}};function Xl(t,e,n,s,f,v){const m=r("el-divider"),c=r("el-button"),C=r("el-col"),_=r("Search"),S=r("el-icon"),g=r("el-input"),q=r("UploadFilled"),h=r("el-row"),D=r("el-table-column"),F=r("el-tag"),A=r("el-table"),T=r("el-form-item"),z=r("el-form"),$=r("el-dialog"),E=r("BatchImportDialog");return b(),B(X,null,[a("div",Hl,[e[18]||(e[18]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"语义模型管理")],-1)),l(m),a("div",Gl,[l(h,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(C,{span:12},{default:o(()=>[e[11]||(e[11]=a("h3",null,"语义模型列表",-1)),t.selectedModels.length>0?(b(),U(c,{key:0,onClick:t.batchDeleteModels,size:"default",type:"danger",plain:"",icon:t.Delete,style:{"margin-left":"10px"}},{default:o(()=>[y(" 批量删除 ("+M(t.selectedModels.length)+") ",1)]),_:1},8,["onClick","icon"])):R("",!0)]),_:1}),l(C,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(g,{modelValue:t.searchKeyword,"onUpdate:modelValue":e[0]||(e[0]=p=>t.searchKeyword=p),placeholder:"请输入关键词，并按回车搜索",style:{width:"250px","margin-right":"10px"},clearable:"",onClear:t.handleSearch,onKeyup:Ie(t.handleSearch,["enter"]),size:"large"},{prefix:o(()=>[l(S,null,{default:o(()=>[l(_)]),_:1})]),_:1},8,["modelValue","onClear","onKeyup"]),l(c,{onClick:t.openBatchImportDialog,size:"large",type:"success",round:""},{default:o(()=>[l(S,null,{default:o(()=>[l(q)]),_:1}),e[12]||(e[12]=y(" 批量导入 ",-1))]),_:1},8,["onClick"]),l(c,{onClick:t.openCreateDialog,size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[13]||(e[13]=[y(" 添加语义模型 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1})]),l(A,{data:t.semanticModelList,style:{width:"100%"},border:"",onSelectionChange:t.handleSelectionChange},{default:o(()=>[l(D,{type:"selection",width:"55"}),l(D,{prop:"id",label:"ID","min-width":"60px"}),l(D,{prop:"tableName",label:"表名","min-width":"120px"}),l(D,{prop:"columnName",label:"数据库字段名","min-width":"120px"}),l(D,{prop:"businessName",label:"业务名称","min-width":"120px"}),l(D,{prop:"synonyms",label:"同义词","min-width":"120px"}),l(D,{prop:"dataType",label:"数据类型","min-width":"80px"}),l(D,{label:"状态","min-width":"80px"},{default:o(p=>[l(F,{type:p.row.status===1?"success":"info",round:""},{default:o(()=>[y(M(p.row.status===1?"启用":"停用"),1)]),_:2},1032,["type"])]),_:1}),l(D,{label:"创建时间","min-width":"160px"},{default:o(p=>[y(M(t.formatDateTime(p.row.createdTime||p.row.createTime)),1)]),_:1}),l(D,{label:"操作","min-width":"180px"},{default:o(p=>[l(c,{onClick:P=>t.editModel(p.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[14]||(e[14]=[y(" 编辑 ",-1)])]),_:1},8,["onClick"]),p.row.status===0?(b(),U(c,{key:0,onClick:P=>t.toggleStatus(p.row,1),size:"small",type:"success",round:"",plain:""},{default:o(()=>[...e[15]||(e[15]=[y(" 启用 ",-1)])]),_:1},8,["onClick"])):(b(),U(c,{key:1,onClick:P=>t.toggleStatus(p.row,0),size:"small",type:"warning",round:"",plain:""},{default:o(()=>[...e[16]||(e[16]=[y(" 停用 ",-1)])]),_:1},8,["onClick"])),l(c,{onClick:P=>t.deleteModel(p.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[17]||(e[17]=[y(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])]),l($,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[9]||(e[9]=p=>t.dialogVisible=p),title:t.isEdit?"编辑语义模型":"添加语义模型",width:"800"},{footer:o(()=>[a("div",Wl,[l(c,{onClick:e[8]||(e[8]=p=>t.dialogVisible=!1)},{default:o(()=>[...e[19]||(e[19]=[y("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:t.saveModel},{default:o(()=>[y(M(t.isEdit?"更新":"创建"),1)]),_:1},8,["onClick"])])]),default:o(()=>[l(z,{model:t.modelForm,"label-width":"120px",ref:"modelFormRef"},{default:o(()=>[l(T,{label:"表名",prop:"tableName",required:""},{default:o(()=>[l(g,{modelValue:t.modelForm.tableName,"onUpdate:modelValue":e[1]||(e[1]=p=>t.modelForm.tableName=p),placeholder:"请输入表名"},null,8,["modelValue"])]),_:1}),l(T,{label:"数据库字段名",prop:"columnName",required:""},{default:o(()=>[l(g,{modelValue:t.modelForm.columnName,"onUpdate:modelValue":e[2]||(e[2]=p=>t.modelForm.columnName=p),placeholder:"请输入数据库字段名"},null,8,["modelValue"])]),_:1}),l(T,{label:"业务名称",prop:"businessName",required:""},{default:o(()=>[l(g,{modelValue:t.modelForm.businessName,"onUpdate:modelValue":e[3]||(e[3]=p=>t.modelForm.businessName=p),placeholder:"请输入业务名称"},null,8,["modelValue"])]),_:1}),l(T,{label:"同义词",prop:"synonyms"},{default:o(()=>[l(g,{modelValue:t.modelForm.synonyms,"onUpdate:modelValue":e[4]||(e[4]=p=>t.modelForm.synonyms=p),type:"textarea",rows:2,placeholder:"请输入同义词，多个同义词用逗号分隔"},null,8,["modelValue"])]),_:1}),l(T,{label:"业务描述",prop:"businessDescription"},{default:o(()=>[l(g,{modelValue:t.modelForm.businessDescription,"onUpdate:modelValue":e[5]||(e[5]=p=>t.modelForm.businessDescription=p),type:"textarea",rows:3,placeholder:"请输入业务描述，用于向LLM解释字段的业务含义"},null,8,["modelValue"])]),_:1}),l(T,{label:"字段注释",prop:"columnComment"},{default:o(()=>[l(g,{modelValue:t.modelForm.columnComment,"onUpdate:modelValue":e[6]||(e[6]=p=>t.modelForm.columnComment=p),type:"textarea",rows:2,placeholder:"请输入数据库字段的原始注释"},null,8,["modelValue"])]),_:1}),l(T,{label:"数据类型",prop:"dataType",required:""},{default:o(()=>[l(g,{modelValue:t.modelForm.dataType,"onUpdate:modelValue":e[7]||(e[7]=p=>t.modelForm.dataType=p),placeholder:"请输入数据类型，如：int, varchar(20)"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(E,{modelValue:t.batchImportDialogVisible,"onUpdate:modelValue":e[10]||(e[10]=p=>t.batchImportDialogVisible=p),title:"批量导入语义模型","json-template":t.jsonTemplate,"validate-json":t.validateJson,"validate-excel-file":t.validateExcelFile,"on-json-import":t.executeBatchImport,"on-excel-import":t.executeExcelImport,"on-download-excel-template":t.downloadExcelTemplate,onImported:t.handleBatchImported},null,8,["modelValue","json-template","validate-json","validate-excel-file","on-json-import","on-excel-import","on-download-excel-template","onImported"])],64)}const Yl=oe(Ql,[["render",Xl]]),Zl=se({name:"AgentPresetsConfig",props:{agentId:{type:Number,required:!0}},setup(t){const e=V([]),n=V(!1),s=V(!1),f=V({agentId:t.agentId,question:"",sortOrder:0,isActive:!0}),v=V(null),m=()=>{s.value=!1,f.value={agentId:t.agentId,question:"",sortOrder:0,isActive:!0},n.value=!0},c=async()=>{try{e.value=await Ae.list(t.agentId)}catch(g){i.error("加载预设问题列表失败"),console.error("加载预设问题失败:",g)}},C=g=>{s.value=!0,v.value=g.id||null,f.value={...g},n.value=!0},_=async g=>{if(g.id)try{await Y.confirm(`确定要删除预设问题 "${g.question.substring(0,50)}..." 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ae.delete(t.agentId,g.id)?(i.success("删除成功"),await c()):i.error("删除失败")}catch{}},S=async()=>{try{if(!f.value.question||f.value.question.trim()===""){i.error("请输入预设问题");return}let g=[];if(s.value&&v.value?g=e.value.map(h=>{const D={question:h.id===v.value?f.value.question:h.question};return h.id===v.value?D.isActive=f.value.isActive===!0:D.isActive=h.isActive===!0,D}):g=[...e.value.map(h=>({question:h.question,isActive:h.isActive===!0})),{question:f.value.question,isActive:f.value.isActive===!0}],console.log("发送的数据:",JSON.stringify(g)),await Ae.batchSave(t.agentId,g))i.success(s.value?"更新成功":"创建成功");else{i.error(s.value?"更新失败":"创建失败");return}n.value=!1,await c()}catch(g){i.error(`${s.value?"更新":"创建"}失败`),console.error("保存预设问题失败:",g)}};return ve(()=>{c()}),{Plus:_e,presetQuestionList:e,dialogVisible:n,isEdit:s,questionForm:f,openCreateDialog:m,editQuestion:C,deleteQuestion:_,saveQuestion:S}}}),xl={style:{padding:"20px"}},eo={style:{"margin-bottom":"30px"}},to={style:{"text-align":"right"}};function lo(t,e,n,s,f,v){const m=r("el-divider"),c=r("el-col"),C=r("el-button"),_=r("el-row"),S=r("el-table-column"),g=r("el-tag"),q=r("el-table"),h=r("el-input"),D=r("el-form-item"),F=r("el-input-number"),A=r("el-switch"),T=r("el-form"),z=r("el-dialog");return b(),B(X,null,[a("div",xl,[e[9]||(e[9]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"预设问题管理")],-1)),l(m),a("div",eo,[l(_,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(c,{span:12},{default:o(()=>[...e[5]||(e[5]=[a("h3",null,"预设问题列表",-1)])]),_:1}),l(c,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(C,{onClick:t.openCreateDialog,size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[6]||(e[6]=[y(" 添加问题 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1})]),l(q,{data:t.presetQuestionList,style:{width:"100%"},border:""},{default:o(()=>[l(S,{prop:"id",label:"ID","min-width":"60px"}),l(S,{prop:"question",label:"问题","min-width":"250px","show-overflow-tooltip":""}),l(S,{prop:"sortOrder",label:"排序","min-width":"80px"}),l(S,{label:"状态","min-width":"80px"},{default:o($=>[l(g,{type:$.row.isActive?"success":"info",round:""},{default:o(()=>[y(M($.row.isActive?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(S,{prop:"createTime",label:"创建时间","min-width":"150px"}),l(S,{label:"操作","min-width":"200px"},{default:o($=>[l(C,{onClick:E=>t.editQuestion($.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[7]||(e[7]=[y(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(C,{onClick:E=>t.deleteQuestion($.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[8]||(e[8]=[y(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),l(z,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[4]||(e[4]=$=>t.dialogVisible=$),title:t.isEdit?"编辑预设问题":"添加预设问题",width:"600"},{footer:o(()=>[a("div",to,[l(C,{onClick:e[3]||(e[3]=$=>t.dialogVisible=!1)},{default:o(()=>[...e[10]||(e[10]=[y("取消",-1)])]),_:1}),l(C,{type:"primary",onClick:t.saveQuestion},{default:o(()=>[y(M(t.isEdit?"更新":"创建"),1)]),_:1},8,["onClick"])])]),default:o(()=>[l(T,{model:t.questionForm,"label-width":"80px",ref:"questionFormRef"},{default:o(()=>[l(D,{label:"问题",prop:"question",required:""},{default:o(()=>[l(h,{modelValue:t.questionForm.question,"onUpdate:modelValue":e[0]||(e[0]=$=>t.questionForm.question=$),type:"textarea",rows:4,placeholder:"请输入预设问题"},null,8,["modelValue"])]),_:1}),l(D,{label:"排序",prop:"sortOrder"},{default:o(()=>[l(F,{modelValue:t.questionForm.sortOrder,"onUpdate:modelValue":e[1]||(e[1]=$=>t.questionForm.sortOrder=$),min:0,"controls-position":"right"},null,8,["modelValue"])]),_:1}),l(D,{label:"状态",prop:"isActive"},{default:o(()=>[l(A,{modelValue:t.questionForm.isActive,"onUpdate:modelValue":e[2]||(e[2]=$=>t.questionForm.isActive=$)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}const oo=oe(Zl,[["render",lo]]),ao=se({name:"AgentAccessApi",props:{agentId:{type:[Number,String],required:!1,default:null}},setup(t){const e=et(),n=de(()=>Number(t.agentId??e.params.id)),s=V(null),f=V(!1),v=V(!0),m=V(!1),c=V({generate:!1,reset:!1,delete:!1,toggle:!1,fetch:!1}),C=V("curl"),_=p=>p?p.startsWith("****")?p:p.length<=8?"****":"****"+p.slice(-4):"",S=de(()=>s.value?v.value?_(s.value):s.value:""),g=de(()=>{const p=window.location.origin,P=n.value;return`# 创建会话
curl -X POST "${p}/api/agent/${P}/sessions" \\
  -H "Content-Type: application/json" \\
  -H "X-API-Key: <your_api_key>" \\
  -d '{"title":"demo"}'

# 发送消息
curl -X POST "${p}/api/sessions/<sessionId>/messages" \\
  -H "Content-Type: application/json" \\
  -H "X-API-Key: <your_api_key>" \\
  -d '{"role":"user","content":"给我一个示例","messageType":"text"}'`}),q=de(()=>{const p=window.location.origin,P=n.value;return String.raw`const apiKey = '<your_api_key>';
const baseUrl = '${p}/api';
const agentId = ${P};

(async () => {
  // 创建会话
  const sessionRes = await fetch(\`${"${baseUrl}"}/agent/${"${agentId}"}/sessions\`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-API-Key': apiKey,
    },
    body: JSON.stringify({ title: 'demo' }),
  });
  const session = await sessionRes.json();

  // 发送消息
  await fetch(\`${"${baseUrl}"}/sessions/${"${session.id}"}/messages\`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-API-Key': apiKey,
    },
    body: JSON.stringify({ role: 'user', content: '你好', messageType: 'text' }),
  });
})();`}),h=de(()=>{const p=window.location.origin,P=n.value;return`import requests

api_key = '<your_api_key>'
base_url = '${p}/api'

headers = {
    'Content-Type': 'application/json',
    'X-API-Key': api_key,
}

# 创建会话
session_resp = requests.post(
    f"{base_url}/agent/${P}/sessions",
    headers=headers,
    json={"title": "demo"},
)
session_id = session_resp.json().get("id")

# 发送消息
requests.post(
    f"{base_url}/sessions/{session_id}/messages",
    headers=headers,
    json={"role": "user", "content": "你好", "messageType": "text"},
)
`}),D=async()=>{c.value.fetch=!0;try{const p=await ne.getApiKey(n.value);s.value=(p==null?void 0:p.apiKey)??null,f.value=!!(p!=null&&p.apiKeyEnabled),v.value=!0,m.value=!1}catch{i.error("获取 API Key 失败")}finally{c.value.fetch=!1}},F=async()=>{c.value.generate=!0;try{const p=await ne.generateApiKey(n.value);s.value=p.apiKey,f.value=!!p.apiKeyEnabled,v.value=!1,m.value=!0,i.success("已生成 API Key")}catch{i.error("生成失败")}finally{c.value.generate=!1}},A=async()=>{if(!s.value){await F();return}c.value.reset=!0;try{const p=await ne.resetApiKey(n.value);s.value=p.apiKey,f.value=!!p.apiKeyEnabled,v.value=!1,m.value=!0,i.success("已重置 API Key")}catch{i.error("重置失败")}finally{c.value.reset=!1}},T=async()=>{if(s.value){try{await Y.confirm("确认删除当前 API Key？删除后需重新生成。","提示",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"})}catch{return}c.value.delete=!0;try{const p=await ne.deleteApiKey(n.value);s.value=p.apiKey,f.value=!!p.apiKeyEnabled,v.value=!0,m.value=!1,i.success("已删除 API Key")}catch{i.error("删除失败")}finally{c.value.delete=!1}}},z=async()=>{if(!m.value||!s.value){i.info("请重新生成或重置后复制完整 Key");return}try{await navigator.clipboard.writeText(s.value),i.success("已复制到剪贴板")}catch{i.error("复制失败")}},$=()=>{s.value&&(v.value=!v.value)},E=async p=>{c.value.toggle=!0;try{const P=await ne.toggleApiKey(n.value,p);f.value=!!P.apiKeyEnabled,s.value=P.apiKey,v.value=!0,m.value=!1,i.success(p?"已启用 API Key":"已禁用 API Key")}catch{f.value=!p,i.error("切换失败")}finally{c.value.toggle=!1}};return ve(()=>{D()}),{apiKey:s,apiKeyEnabled:f,masked:v,canCopy:m,loading:c,exampleTab:C,displayKey:S,curlExample:g,jsExample:q,pyExample:h,handleGenerate:F,handleReset:A,handleDelete:T,handleCopy:z,handleToggle:E,toggleMask:$}}}),no={class:"access-api"},so={class:"section"},ro={class:"card"},io={class:"row"},uo={class:"row key-row"},po={class:"section"},mo={class:"code"},co={class:"code"},go={class:"code"};function fo(t,e,n,s,f,v){const m=r("el-switch"),c=r("el-tag"),C=r("el-input"),_=r("el-button"),S=r("el-alert"),g=r("el-tab-pane"),q=r("el-tabs");return b(),B("div",no,[a("section",so,[e[9]||(e[9]=a("h3",null,"访问 API Key",-1)),e[10]||(e[10]=a("p",{class:"desc"},"为该智能体生成并管理 API Key，用于外部系统访问。",-1)),a("div",ro,[a("div",io,[e[4]||(e[4]=a("div",{class:"label"},"API Key 状态",-1)),l(m,{modelValue:t.apiKeyEnabled,"onUpdate:modelValue":e[0]||(e[0]=h=>t.apiKeyEnabled=h),disabled:!t.apiKey,"active-text":"已启用","inactive-text":"已禁用",onChange:t.handleToggle},null,8,["modelValue","disabled","onChange"]),t.apiKey?R("",!0):(b(),U(c,{key:0,type:"info",size:"small",class:"tag"},{default:o(()=>[...e[3]||(e[3]=[y("未生成",-1)])]),_:1}))]),a("div",uo,[e[8]||(e[8]=a("div",{class:"label"},"当前 Key",-1)),l(C,{modelValue:t.displayKey,"onUpdate:modelValue":e[1]||(e[1]=h=>t.displayKey=h),class:"key-input",readonly:"",placeholder:"尚未生成 API Key"},null,8,["modelValue"]),l(_,{type:"primary",onClick:t.handleGenerate,loading:t.loading.generate},{default:o(()=>[y(M(t.apiKey?"重新生成":"生成 Key"),1)]),_:1},8,["onClick","loading"]),l(_,{onClick:t.handleReset,disabled:!t.apiKey,loading:t.loading.reset},{default:o(()=>[...e[5]||(e[5]=[y(" 重置 ",-1)])]),_:1},8,["onClick","disabled","loading"]),l(_,{onClick:t.handleDelete,disabled:!t.apiKey,loading:t.loading.delete},{default:o(()=>[...e[6]||(e[6]=[y(" 删除 ",-1)])]),_:1},8,["onClick","disabled","loading"]),l(_,{onClick:t.handleCopy,disabled:!t.apiKey||!t.canCopy},{default:o(()=>[...e[7]||(e[7]=[y("复制",-1)])]),_:1},8,["onClick","disabled"]),l(_,{onClick:t.toggleMask,disabled:!t.apiKey},{default:o(()=>[y(M(t.masked?"显示":"隐藏"),1)]),_:1},8,["onClick","disabled"])]),!t.canCopy&&t.apiKey?(b(),U(S,{key:0,type:"info",closable:!1,"show-icon":"",title:"为安全起见，已生成/重置时才显示完整 Key，之后仅显示掩码。如需复制请重新生成/重置。"})):R("",!0)])]),a("section",po,[e[11]||(e[11]=a("h3",null,"调用示例",-1)),e[12]||(e[12]=a("p",{class:"desc"},"使用 `X-API-Key` 请求头调用会话接口。",-1)),l(q,{modelValue:t.exampleTab,"onUpdate:modelValue":e[2]||(e[2]=h=>t.exampleTab=h)},{default:o(()=>[l(g,{label:"curl",name:"curl"},{default:o(()=>[a("pre",mo,[a("code",null,M(t.curlExample),1)])]),_:1}),l(g,{label:"JavaScript",name:"js"},{default:o(()=>[a("pre",co,[a("code",null,M(t.jsExample),1)])]),_:1}),l(g,{label:"Python",name:"py"},{default:o(()=>[a("pre",go,[a("code",null,M(t.pyExample),1)])]),_:1})]),_:1},8,["modelValue"])])])}const yo=oe(ao,[["render",fo],["__scopeId","data-v-7d53eb90"]]),me="/api/datasource";class vo{async getAllDatasource(e,n){const s=new URLSearchParams;return e&&s.append("status",e),n&&s.append("type",n),(await N.get(`${me}${s.toString()?`?${s.toString()}`:""}`)).data}async getDatasourceById(e){var n;try{return(await N.get(`${me}/${e}`)).data}catch(s){if(N.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return null;throw s}}async getDatasourceTables(e){var n;try{return(await N.get(`${me}/${e}/tables`)).data}catch(s){if(N.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===400)return[];throw s}}async createDatasource(e){return(await N.post(me,e)).data}async updateDatasource(e,n){return(await N.put(`${me}/${e}`,n)).data}async deleteDatasource(e){return(await N.delete(`${me}/${e}`)).data}async testConnection(e){return(await N.post(`${me}/${e}/test`)).data}}const ce=new vo,ge=t=>`/api/agent/${t}/datasources`;class bo{async initSchema(e){try{return(await N.post(`${ge(e)}/init`)).data}catch(n){throw new Error(`初始化Schema失败: ${n}`)}}async getAgentDatasource(e){try{const n=await N.get(ge(String(e)));if(n.data.success)return n.data.data||[];throw new Error(n.data.message)}catch(n){throw new Error(`获取数据源列表失败: ${n}`)}}async getActiveAgentDatasource(e){try{const n=await N.get(ge(String(e))+"/active");if(n.data.success){if(n.data.data===void 0)throw new Error("后端错误");return n.data.data}throw new Error(n.data.message)}catch(n){throw new Error(`获取数据源列表失败: ${n}`)}}async addDatasourceToAgent(e,n){try{return(await N.post(`${ge(e)}/${n}`)).data}catch(s){throw new Error(`添加数据源失败: ${s}`)}}async removeDatasourceFromAgent(e,n){try{return(await N.delete(`${ge(e)}/${n}`)).data}catch(s){throw new Error(`移除数据源失败: ${s}`)}}async toggleDatasourceForAgent(e,n){try{return(await N.put(`${ge(e)}/toggle`,n)).data}catch(s){throw new Error(`切换数据源状态失败: ${s}`)}}async updateDatasourceTables(e,n){try{return(await N.post(`${ge(e)}/tables`,n)).data}catch(s){throw new Error(`更新数据源表列表失败: ${s}`)}}}const fe=new bo,we="/api/datasource";class wo{async getLogicalRelations(e){try{return(await N.get(`${we}/${e}/logical-relations`)).data.data||[]}catch(n){return console.error("Failed to get logical relations:",n),[]}}async addLogicalRelation(e,n){try{return(await N.post(`${we}/${e}/logical-relations`,n)).data.data||null}catch(s){throw console.error("Failed to add logical relation:",s),s}}async updateLogicalRelation(e,n,s){return(await N.put(`${we}/${e}/logical-relations/${n}`,s)).data}async deleteLogicalRelation(e,n){return(await N.delete(`${we}/${e}/logical-relations/${n}`)).data}async saveLogicalRelations(e,n){return(await N.put(`${we}/${e}/logical-relations`,n)).data}async getTableColumns(e,n){try{const s=await N.get(`${we}/${e}/tables/${n}/columns`);if(s.data.success)return s.data.data||[];throw new Error(s.data.message)}catch(s){return console.error("Failed to get table columns:",s),[]}}}const he=new wo,ho=se({name:"AgentDataSourceConfig",props:{agentId:{type:Number,required:!0}},setup(t){const e=V([]),n=V(!1),s=V(!1),f=V("select"),v=V([]),m=V({port:3306}),c=V(null),C=V(!1),_=V({}),S=V({}),g=V({}),q=V({}),h=V({}),D=V([]),F=V(!1),A=V(null),T=V([]),z=V(null),$=V({sourceTableName:"",sourceColumnName:"",targetTableName:"",targetColumnName:"",relationType:"",description:""}),E=V([]),p=V([]),P=V([]),j=V(!1);Le(s,u=>{u&&(Z(),m.value={port:3306})});const G=async()=>{c.value=null;try{const u=await fe.getAgentDatasource(t.agentId);D.value=u||[];const k=u||[];e.value=k.map(K=>{var re;const H={...K.datasource};return H.status=K.isActive===1?"active":"inactive",K.selectTables&&((re=K.datasource)!=null&&re.id)&&(g.value[K.datasource.id]=[...K.selectTables]),H})}catch(u){i.error("加载当前智能体的数据源列表失败"),console.error("Failed to load datasource:",u)}},W=u=>{u==null?c.value=null:c.value=u.id},Z=async()=>{try{const u=await ce.getAllDatasource();v.value=u||[]}catch(u){i.error("加载所有数据源列表失败"),console.error("Failed to load all datasource:",u)}},L=async()=>{n.value=!0;try{try{const k=await fe.getActiveAgentDatasource(t.agentId);if(k.datasource==null&&k.datasourceId==null){i.warning("当前智能体没有启用的数据源！请添加一个新数据源，或者启用已有的数据源");return}else if(k.selectTables==null||k.selectTables.length===0){i.warning("当前启用的数据源没有选择相应的数据表！请点击相应数据源左侧按钮，选择相应数据表并更新！");return}}catch{i.warning("当前智能体没有启用的数据源！请添加一个新数据源，或者启用已有的数据源");return}const u=await fe.initSchema(t.agentId);if(u.success===void 0||u.success==null||!u.success)throw i.error("初始化数据源失败"),new Error("初始化数据源失败");i.success("初始化当前智能体的数据源成功")}catch(u){i.error("初始化当前智能体的数据源失败"),console.error("Failed to init datasource:",u)}finally{n.value=!1}},O=async(u,k)=>{const K=u.id;try{const H=await fe.toggleDatasourceForAgent(t.agentId,{datasourceId:K,isActive:k});H.success?(i.success("操作成功！"),u.status=k?"active":"inactive"):(i.error("操作失败！"),console.error("Failed to change datasource:",H))}catch(H){i.error("操作失败！"),console.error("Failed to change datasource:",H)}},I=async u=>{const k=u.id;try{const K=await ce.testConnection(k);K.success?(i.success("测试连接成功！"),u.testStatus="success"):(i.error("测试连接失败！"),console.error("Failed to test connection:",K),u.testStatus="fail")}catch(K){i.error("测试连接失败！"),console.error("Failed to test connection:",K),u.testStatus="fail"}},w=async u=>{const k=u.id;try{await Y.confirm("是否要删除当前数据源吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}catch{return}try{const K=await fe.removeDatasourceFromAgent(t.agentId,k);K.success?(i.success("移除成功！"),e.value=e.value.filter(H=>H.id!==k)):(i.error("移除失败！"),console.error("Failed to remove datasource:",K))}catch(K){i.error("移除失败！"),console.error("Failed to remove datasource:",K)}},J=async u=>{try{await fe.addDatasourceToAgent(t.agentId,u),await G(),i.success("添加数据源成功"),s.value=!1}catch(k){i.error("添加数据源失败"),console.error("Failed to add datasource:",k)}},x=async()=>{const u=c.value;if(u==null){i.warning("请选择一个数据源");return}await J(u)},d=u=>{const k=[];return(!u.name||u.name.trim()==="")&&k.push("数据源名称不能为空"),u.type||k.push("请选择数据源类型"),(!u.host||u.host.trim()==="")&&k.push("主机地址不能为空"),(!u.port||u.port<=0||u.port>65535)&&k.push("请输入有效的端口号（1-65535）"),(!u.databaseName||u.databaseName.trim()==="")&&k.push("数据库名不能为空"),(!u.username||u.username.trim()==="")&&k.push("用户名不能为空"),(!u.password||u.password.trim()==="")&&k.push("密码不能为空"),k},Q=async()=>{const u=d(m.value);if(u.length>0){i.error(u.join(`\r
`));return}try{const K=(await ce.createDatasource(m.value)).id;if(K==null)throw new Error("创建数据源失败");await J(K)}catch(k){i.error("创建数据源失败"),console.error("Failed to create datasource:",k)}s.value=!1},Te=u=>{_.value=JSON.parse(JSON.stringify(u)),C.value=!0},De=async()=>{const u=d(_.value);if(u.length>0){i.error(u.join(`
`));return}try{const k=await ce.updateDatasource(_.value.id,_.value);if(k&&k.id){i.success("修改成功！");const K=v.value.findIndex(H=>H.id===_.value.id);K>=0&&(v.value[K]=k),C.value=!1}else i.error("修改失败！"),console.error("Failed to update datasource:",k)}catch(k){i.error("修改失败！"),console.error("Failed to update datasource:",k)}},Se=async u=>{const k=u.id;try{await Y.confirm("删除后无法恢复，确定要删除该数据源吗？","确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"})}catch{return}try{const K=await ce.deleteDatasource(k);K.success?(i.success("删除成功！"),v.value=v.value.filter(H=>H.id!==k)):(i.error("删除失败！"),console.error("Failed to delete datasource:",K))}catch(K){i.error("删除失败！"),console.error("Failed to delete datasource:",K)}},be=async u=>{if(u.id){q.value[u.id]=!0;try{const k=await ce.getDatasourceTables(u.id);if(S.value[u.id]=k,!g.value[u.id]){const K=D.value.find(H=>{var re;return((re=H.datasource)==null?void 0:re.id)===u.id});g.value[u.id]=(K==null?void 0:K.selectTables)||[]}i.success(`成功加载 ${k.length} 个表`)}catch(k){i.error("加载表列表失败"),console.error("Failed to load datasource tables:",k)}finally{q.value[u.id]=!1}}},qe=async u=>{if(u.id){h.value[u.id]=!0;try{if((await fe.updateDatasourceTables(String(t.agentId),{datasourceId:u.id,tables:g.value[u.id]||[]})).success){i.success("数据表更新成功");const K=D.value.find(H=>{var re;return((re=H.datasource)==null?void 0:re.id)===u.id});K&&(K.selectTables=[...g.value[u.id]||[]])}else i.error("数据表更新失败")}catch(k){i.error("数据表更新失败"),console.error("Failed to update datasource tables:",k)}finally{h.value[u.id]=!1}}},Be=u=>{!u.id||!S.value[u.id]||(g.value[u.id]=[...S.value[u.id]])},Oe=u=>{u.id&&(g.value[u.id]=[])},Re=(u,k)=>!u||u.length<=k?u:u.substring(0,k)+"...",je=(u,k)=>{k.includes(u)&&u.status==="active"&&u.id&&be(u)};ve(()=>{G()});const Je=async u=>{if(!u.id){i.warning("数据源ID不存在");return}A.value=u,F.value=!0;try{E.value=await ce.getDatasourceTables(u.id)}catch(k){i.error("加载表列表失败"),console.error("Failed to load table list:",k)}await Qe(u.id),Ee()},Qe=async u=>{try{T.value=await he.getLogicalRelations(u)}catch(k){i.error("加载逻辑外键列表失败"),console.error("Failed to load logical relations:",k)}},He=async u=>{var k;if(!u||!((k=A.value)!=null&&k.id)){p.value=[],$.value.sourceColumnName="";return}try{p.value=await he.getTableColumns(A.value.id,u),$.value.sourceColumnName=""}catch(K){i.error("加载字段列表失败"),console.error("Failed to load source columns:",K)}},Ge=async u=>{var k;if(!u||!((k=A.value)!=null&&k.id)){P.value=[],$.value.targetColumnName="";return}try{P.value=await he.getTableColumns(A.value.id,u),$.value.targetColumnName=""}catch(K){i.error("加载字段列表失败"),console.error("Failed to load target columns:",K)}},We=async u=>{var k,K;if(z.value=u,$.value={id:u.id,datasourceId:u.datasourceId,sourceTableName:u.sourceTableName,sourceColumnName:u.sourceColumnName,targetTableName:u.targetTableName,targetColumnName:u.targetColumnName,relationType:u.relationType||"",description:u.description||""},u.sourceTableName&&((k=A.value)!=null&&k.id))try{p.value=await he.getTableColumns(A.value.id,u.sourceTableName)}catch(H){console.error("Failed to load source columns:",H)}if(u.targetTableName&&((K=A.value)!=null&&K.id))try{P.value=await he.getTableColumns(A.value.id,u.targetTableName)}catch(H){console.error("Failed to load target columns:",H)}i.info('正在编辑逻辑外键，修改后点击"更新"按钮')},Xe=async()=>{if(!$.value.sourceTableName||!$.value.sourceColumnName||!$.value.targetTableName||!$.value.targetColumnName){i.warning("请完整填写主表、字段、关联表和字段");return}if(T.value.some(k=>{var K;return k.id!==((K=z.value)==null?void 0:K.id)&&k.sourceTableName===$.value.sourceTableName&&k.sourceColumnName===$.value.sourceColumnName&&k.targetTableName===$.value.targetTableName&&k.targetColumnName===$.value.targetColumnName})){i.warning("该逻辑外键关系已存在");return}if(z.value&&z.value.id){const k=T.value.findIndex(K=>K.id===z.value.id);k!==-1&&(T.value[k]={...T.value[k],sourceTableName:$.value.sourceTableName,sourceColumnName:$.value.sourceColumnName,targetTableName:$.value.targetTableName,targetColumnName:$.value.targetColumnName,relationType:$.value.relationType||"",description:$.value.description||""}),i.success('更新成功，请点击"保存全部配置"以保存到数据库')}else T.value.push({sourceTableName:$.value.sourceTableName,sourceColumnName:$.value.sourceColumnName,targetTableName:$.value.targetTableName,targetColumnName:$.value.targetColumnName,relationType:$.value.relationType||"",description:$.value.description||""}),i.success('添加成功，请点击"保存全部配置"以保存到数据库');Ee()},Ye=async(u,k)=>{try{await Y.confirm("确定要删除这条逻辑外键关系吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),T.value.splice(k,1),i.success('删除成功，请点击"保存全部配置"以保存到数据库')}catch{}},Ze=async()=>{var u;if(!((u=A.value)!=null&&u.id)){i.error("数据源ID不存在");return}j.value=!0;try{(await he.saveLogicalRelations(A.value.id,T.value)).success?(i.success("保存成功"),F.value=!1):i.error("保存失败")}catch(k){i.error("保存失败"),console.error("Failed to save logical relations:",k)}finally{j.value=!1}},Ee=()=>{z.value=null,$.value={sourceTableName:"",sourceColumnName:"",targetTableName:"",targetColumnName:"",relationType:"",description:""},p.value=[],P.value=[]};return{props:t,Plus:_e,UploadFilled:Ve,Loading:rt,FolderOpened:st,Lock:nt,datasource:e,initStatus:n,dialogVisible:s,dialogActiveName:f,allDatasource:v,newDatasource:m,editDialogVisible:C,editingDatasource:_,tableLists:S,selectedTables:g,tableLoadingStates:q,updateLoadingStates:h,initAgentDatasource:L,changeDatasource:O,testConnection:I,removeAgentDatasource:w,loadAllDatasource:Z,addSelectDatasource:x,createNewDatasource:Q,handleSelectDatasourceChange:W,editDatasource:Te,saveEditDatasource:De,deleteDatasource:Se,loadDatasourceTables:be,updateDatasourceTables:qe,selectAllTables:Be,clearAllTables:Oe,truncateText:Re,handleExpandChange:je,Connection:Me,Link:at,CirclePlus:ot,Check:lt,Right:tt,Edit:Ue,foreignKeyDialogVisible:F,currentForeignKeyDatasource:A,foreignKeyList:T,newForeignKey:$,tableList:E,sourceColumnList:p,targetColumnList:P,savingForeignKeys:j,openForeignKeyDialog:Je,handleSourceTableChange:He,handleTargetTableChange:Ge,editForeignKey:We,saveOrUpdateForeignKey:Xe,deleteForeignKey:Ye,saveForeignKeyConfig:Ze,editingForeignKey:z}}}),Co={style:{padding:"20px"}},ko={style:{"margin-bottom":"30px"}},Vo={key:0,style:{padding:"20px",background:"#f8f9fa","border-radius":"8px"}},_o={style:{"margin-bottom":"15px",display:"flex","justify-content":"space-between","align-items":"center"}},Do={key:0},$o={style:{"margin-top":"20px","text-align":"right"}},To={key:1,style:{"text-align":"center",padding:"20px"}},So={key:2,style:{"text-align":"center",padding:"20px",color:"#999"}},Fo={key:1,style:{padding:"20px","text-align":"center",color:"#999"}},Ao={class:"connection-url-text"},No={style:{"text-align":"right"}},Io={class:"form-item"},Eo={class:"form-item"},zo={class:"form-item"},Uo={class:"form-item"},Ko={class:"form-item"},Po={class:"form-item"},Lo={class:"form-item"},Mo={class:"form-item"},qo={class:"form-item"},Bo={style:{"text-align":"right"}},Oo={class:"form-item"},Ro={class:"form-item"},jo={class:"form-item"},Jo={class:"form-item"},Qo={class:"form-item"},Ho={class:"form-item"},Go={class:"form-item"},Wo={class:"form-item"},Xo={class:"form-item"},Yo={style:{"text-align":"right"}},Zo={key:0},xo={style:{"margin-bottom":"20px",padding:"10px",background:"#f0f9ff","border-radius":"4px"}},ea={style:{margin:"0","font-size":"14px",color:"#666"}},ta={style:{"font-weight":"600",color:"#1890ff"}},la={style:{"margin-bottom":"30px"}},oa={style:{"font-family":"monospace",color:"#1890ff"}},aa={style:{"font-family":"monospace"}},na={style:{color:"#999","margin-right":"4px"}},sa={style:{"font-family":"monospace"}},ra={style:{"font-family":"monospace",color:"#52c41a"}},ia={style:{"font-family":"monospace"}},da={key:0,style:{"text-align":"center",padding:"40px",color:"#999",background:"#fafafa",border:"1px solid #e8e8e8","border-radius":"4px"}},ua={style:{background:"#f0f9ff",padding:"20px","border-radius":"8px",border:"1px solid #bae7ff"}},pa={style:{"font-size":"14px","font-weight":"600",color:"#333","margin-bottom":"15px"}},ma={style:{"vertical-align":"middle"}},ca={style:{"text-align":"right"}};function ga(t,e,n,s,f,v){const m=r("el-divider"),c=r("el-col"),C=r("el-button"),_=r("el-row"),S=r("el-checkbox"),g=r("el-checkbox-group"),q=r("Loading"),h=r("el-icon"),D=r("FolderOpened"),F=r("Lock"),A=r("el-table-column"),T=r("el-tooltip"),z=r("el-tag"),$=r("Connection"),E=r("el-table"),p=r("el-tab-pane"),P=r("el-input"),j=r("el-option"),G=r("el-select"),W=r("el-input-number"),Z=r("el-tabs"),L=r("el-dialog"),O=r("Link"),I=r("CirclePlus"),w=r("Edit"),J=r("Right"),x=r("Check");return b(),B(X,null,[a("div",Co,[e[50]||(e[50]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"数据源配置")],-1)),l(m),a("div",ko,[l(_,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(c,{span:12},{default:o(()=>[...e[33]||(e[33]=[a("h3",null,"数据源列表",-1)])]),_:1}),l(c,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(C,{onClick:e[0]||(e[0]=d=>t.dialogVisible=!0),size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[34]||(e[34]=[y(" 添加数据源 ",-1)])]),_:1},8,["icon"]),t.initStatus?(b(),U(C,{key:1,size:"large",type:"primary",round:"",loading:""},{default:o(()=>[...e[36]||(e[36]=[y("初始化中...",-1)])]),_:1})):(b(),U(C,{key:0,onClick:t.initAgentDatasource,size:"large",type:"primary",round:"",icon:t.UploadFilled},{default:o(()=>[...e[35]||(e[35]=[y(" 初始化数据源 ",-1)])]),_:1},8,["onClick","icon"]))]),_:1})]),_:1})]),l(E,{data:t.datasource,style:{width:"100%"},border:"",onExpandChange:t.handleExpandChange},{default:o(()=>[l(A,{type:"expand",width:"100",label:"选择数据表"},{default:o(d=>[d.row.status==="active"?(b(),B("div",Vo,[a("div",_o,[e[38]||(e[38]=a("h4",{style:{margin:"0"}},"数据表管理",-1)),l(C,{onClick:Q=>t.loadDatasourceTables(d.row),size:"small",type:"primary",loading:t.tableLoadingStates[d.row.id],round:""},{default:o(()=>[...e[37]||(e[37]=[y(" 刷新表列表 ",-1)])]),_:1},8,["onClick","loading"])]),t.tableLists[d.row.id]&&t.tableLists[d.row.id].length>0?(b(),B("div",Do,[l(g,{modelValue:t.selectedTables[d.row.id],"onUpdate:modelValue":Q=>t.selectedTables[d.row.id]=Q},{default:o(()=>[l(_,{gutter:10},{default:o(()=>[(b(!0),B(X,null,ye(t.tableLists[d.row.id],Q=>(b(),U(c,{key:Q,span:6,style:{"margin-bottom":"10px"}},{default:o(()=>[l(S,{label:Q,size:"large"},{default:o(()=>[y(M(Q),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"]),a("div",$o,[l(C,{onClick:Q=>t.updateDatasourceTables(d.row),size:"small",type:"success",loading:t.updateLoadingStates[d.row.id],round:""},{default:o(()=>[...e[39]||(e[39]=[y(" 更新数据表 ",-1)])]),_:1},8,["onClick","loading"]),l(C,{onClick:Q=>t.selectAllTables(d.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[40]||(e[40]=[y(" 全选 ",-1)])]),_:1},8,["onClick"]),l(C,{onClick:Q=>t.clearAllTables(d.row),size:"small",type:"info",round:"",plain:""},{default:o(()=>[...e[41]||(e[41]=[y(" 清空 ",-1)])]),_:1},8,["onClick"])])])):t.tableLoadingStates[d.row.id]?(b(),B("div",To,[l(h,{class:"is-loading",style:{"font-size":"24px"}},{default:o(()=>[l(q)]),_:1}),e[42]||(e[42]=a("div",{style:{"margin-top":"10px",color:"#666"}},"正在加载表列表...",-1))])):(b(),B("div",So,[l(h,{style:{"font-size":"24px"}},{default:o(()=>[l(D)]),_:1}),e[43]||(e[43]=a("div",{style:{"margin-top":"10px"}},"暂无表数据，请点击刷新表列表",-1))]))])):(b(),B("div",Fo,[l(h,{style:{"font-size":"24px"}},{default:o(()=>[l(F)]),_:1}),e[44]||(e[44]=a("div",{style:{"margin-top":"10px"}},"请先启用数据源以管理表",-1))]))]),_:1}),l(A,{prop:"name",label:"数据源名称","min-width":"120px"}),l(A,{prop:"type",label:"数据源类型","min-width":"100px"}),l(A,{prop:"connectionUrl",label:"连接地址","min-width":"200px"},{default:o(d=>[l(T,{content:d.row.connectionUrl,placement:"top",disabled:!d.row.connectionUrl||d.row.connectionUrl.length<=50},{default:o(()=>[a("span",Ao,M(d.row.connectionUrl?t.truncateText(d.row.connectionUrl,50):"-"),1)]),_:2},1032,["content","disabled"])]),_:1}),l(A,{label:"连接状态","min-width":"50px"},{default:o(d=>[l(z,{type:d.row.testStatus==="success"?"success":"danger",round:""},{default:o(()=>[y(M(d.row.testStatus==="success"?"连接成功":"连接失败"),1)]),_:2},1032,["type"])]),_:1}),l(A,{label:"状态","min-width":"40px"},{default:o(d=>[l(z,{type:d.row.status==="active"?"success":"info",round:""},{default:o(()=>[y(M(d.row.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(A,{prop:"createTime",label:"创建时间","min-width":"100px"}),l(A,{label:"操作","min-width":"120px"},{default:o(d=>[d.row.status==="active"?(b(),U(C,{key:0,onClick:Q=>t.changeDatasource(d.row,!1),size:"small",type:"warning",round:"",plain:""},{default:o(()=>[...e[45]||(e[45]=[y(" 禁用 ",-1)])]),_:1},8,["onClick"])):(b(),U(C,{key:1,onClick:Q=>t.changeDatasource(d.row,!0),size:"small",type:"success",round:"",plain:""},{default:o(()=>[...e[46]||(e[46]=[y(" 启用 ",-1)])]),_:1},8,["onClick"])),l(C,{onClick:Q=>t.testConnection(d.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[47]||(e[47]=[y(" 测试连接 ",-1)])]),_:1},8,["onClick"]),l(C,{onClick:Q=>t.openForeignKeyDialog(d.row),size:"small",type:"success",round:"",plain:""},{default:o(()=>[l(h,{style:{"margin-right":"4px"}},{default:o(()=>[l($)]),_:1}),e[48]||(e[48]=y(" 逻辑外键配置 ",-1))]),_:1},8,["onClick"]),l(C,{onClick:Q=>t.removeAgentDatasource(d.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[49]||(e[49]=[y(" 移除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","onExpandChange"])]),l(L,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[13]||(e[13]=d=>t.dialogVisible=d),title:"添加数据源",width:"1000"},{default:o(()=>[l(Z,{modelValue:t.dialogActiveName,"onUpdate:modelValue":e[12]||(e[12]=d=>t.dialogActiveName=d),type:"card",stretch:""},{default:o(()=>[l(p,{label:"选择已有数据源",name:"select"},{default:o(()=>[l(E,{onCurrentChange:t.handleSelectDatasourceChange,data:t.allDatasource,"highlight-current-row":"",style:{width:"100%"}},{default:o(()=>[l(A,{property:"name",label:"数据源名称",width:"150"}),l(A,{property:"type",label:"数据源类型",width:"100"}),l(A,{property:"host",label:"Host",width:"100"}),l(A,{property:"port",label:"Port",width:"80"}),l(A,{property:"description",label:"描述",width:"300"}),l(A,{label:"操作",width:"150"},{default:o(d=>[l(C,{onClick:Q=>t.editDatasource(d.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[51]||(e[51]=[y(" 修改 ",-1)])]),_:1},8,["onClick"]),l(C,{onClick:Q=>t.deleteDatasource(d.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[52]||(e[52]=[y(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["onCurrentChange","data"]),l(m),a("div",No,[l(C,{onClick:e[1]||(e[1]=d=>t.dialogVisible=!1)},{default:o(()=>[...e[53]||(e[53]=[y("取消",-1)])]),_:1}),l(C,{type:"primary",onClick:t.addSelectDatasource},{default:o(()=>[...e[54]||(e[54]=[y("添加选中数据源",-1)])]),_:1},8,["onClick"])])]),_:1}),l(p,{label:"添加新数据源",name:"add"},{default:o(()=>[l(_,{gutter:20},{default:o(()=>[l(c,{span:12},{default:o(()=>[a("div",Io,[e[55]||(e[55]=a("label",null,"数据源名称 *",-1)),l(P,{modelValue:t.newDatasource.name,"onUpdate:modelValue":e[2]||(e[2]=d=>t.newDatasource.name=d),placeholder:"请输入数据源名称",size:"large"},null,8,["modelValue"])])]),_:1}),l(c,{span:12},{default:o(()=>[a("div",Eo,[e[56]||(e[56]=a("label",null,"数据源类型 *",-1)),l(G,{modelValue:t.newDatasource.type,"onUpdate:modelValue":e[3]||(e[3]=d=>t.newDatasource.type=d),placeholder:"请选择数据源类型",style:{width:"100%"},size:"large"},{default:o(()=>[l(j,{key:"mysql",label:"MySQL",value:"mysql"}),l(j,{key:"postgresql",label:"PostgreSQL",value:"postgresql"}),l(j,{key:"sqlserver",label:"SQL Server",value:"sqlserver"}),l(j,{key:"dameng",label:"达梦(Dameng)",value:"dameng"})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(c,{span:12},{default:o(()=>[a("div",zo,[e[57]||(e[57]=a("label",null,"主机地址 *",-1)),l(P,{modelValue:t.newDatasource.host,"onUpdate:modelValue":e[4]||(e[4]=d=>t.newDatasource.host=d),placeholder:"例如：localhost 或 192.168.1.100",size:"large"},null,8,["modelValue"])])]),_:1}),l(c,{span:12},{default:o(()=>[a("div",Uo,[e[58]||(e[58]=a("label",null,"端口号 *",-1)),l(W,{modelValue:t.newDatasource.port,"onUpdate:modelValue":e[5]||(e[5]=d=>t.newDatasource.port=d),min:0,max:65535,size:"large",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(c,null,{default:o(()=>[a("div",Ko,[e[59]||(e[59]=a("label",null,"数据库名 *",-1)),l(P,{modelValue:t.newDatasource.databaseName,"onUpdate:modelValue":e[6]||(e[6]=d=>t.newDatasource.databaseName=d),placeholder:"请输入数据库（schema）名称",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(c,null,{default:o(()=>[a("div",Po,[e[60]||(e[60]=a("label",null,"连接地址",-1)),l(P,{modelValue:t.newDatasource.connectionUrl,"onUpdate:modelValue":e[7]||(e[7]=d=>t.newDatasource.connectionUrl=d),placeholder:"请输入JDBC地址（若不填则自动生成）",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(c,{span:12},{default:o(()=>[a("div",Lo,[e[61]||(e[61]=a("label",null,"用户名 *",-1)),l(P,{modelValue:t.newDatasource.username,"onUpdate:modelValue":e[8]||(e[8]=d=>t.newDatasource.username=d),placeholder:"请输入数据库用户名",size:"large"},null,8,["modelValue"])])]),_:1}),l(c,{span:12},{default:o(()=>[a("div",Mo,[e[62]||(e[62]=a("label",null,"密码 *",-1)),l(P,{modelValue:t.newDatasource.password,"onUpdate:modelValue":e[9]||(e[9]=d=>t.newDatasource.password=d),placeholder:"请输入数据库密码",size:"large","show-password":""},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:30},{default:o(()=>[l(c,{span:24},{default:o(()=>[a("div",qo,[e[63]||(e[63]=a("label",null,"描述",-1)),l(P,{modelValue:t.newDatasource.description,"onUpdate:modelValue":e[10]||(e[10]=d=>t.newDatasource.description=d),rows:4,type:"textarea",placeholder:"请输入数据源描述（可选）",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(m),a("div",Bo,[l(C,{onClick:e[11]||(e[11]=d=>t.dialogVisible=!1)},{default:o(()=>[...e[64]||(e[64]=[y("取消",-1)])]),_:1}),l(C,{type:"primary",onClick:t.createNewDatasource},{default:o(()=>[...e[65]||(e[65]=[y("创建并添加",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),l(L,{modelValue:t.editDialogVisible,"onUpdate:modelValue":e[24]||(e[24]=d=>t.editDialogVisible=d),title:"编辑数据源",width:"1000"},{default:o(()=>[l(_,{gutter:20},{default:o(()=>[l(c,{span:12},{default:o(()=>[a("div",Oo,[e[66]||(e[66]=a("label",null,"数据源名称 *",-1)),l(P,{modelValue:t.editingDatasource.name,"onUpdate:modelValue":e[14]||(e[14]=d=>t.editingDatasource.name=d),placeholder:"请输入数据源名称",size:"large"},null,8,["modelValue"])])]),_:1}),l(c,{span:12},{default:o(()=>[a("div",Ro,[e[67]||(e[67]=a("label",null,"数据源类型 *",-1)),l(G,{modelValue:t.editingDatasource.type,"onUpdate:modelValue":e[15]||(e[15]=d=>t.editingDatasource.type=d),placeholder:"请选择数据源类型",style:{width:"100%"},size:"large"},{default:o(()=>[l(j,{key:"mysql",label:"MySQL",value:"mysql"}),l(j,{key:"postgresql",label:"PostgreSQL",value:"postgresql"}),l(j,{key:"dameng",label:"达梦(Dameng)",value:"dameng"})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(c,{span:12},{default:o(()=>[a("div",jo,[e[68]||(e[68]=a("label",null,"主机地址 *",-1)),l(P,{modelValue:t.editingDatasource.host,"onUpdate:modelValue":e[16]||(e[16]=d=>t.editingDatasource.host=d),placeholder:"例如：localhost 或 192.168.1.100",size:"large"},null,8,["modelValue"])])]),_:1}),l(c,{span:12},{default:o(()=>[a("div",Jo,[e[69]||(e[69]=a("label",null,"端口号 *",-1)),l(W,{modelValue:t.editingDatasource.port,"onUpdate:modelValue":e[17]||(e[17]=d=>t.editingDatasource.port=d),min:0,max:65535,size:"large",style:{width:"100%"}},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(c,null,{default:o(()=>[a("div",Qo,[e[70]||(e[70]=a("label",null,"数据库名 *",-1)),l(P,{modelValue:t.editingDatasource.databaseName,"onUpdate:modelValue":e[18]||(e[18]=d=>t.editingDatasource.databaseName=d),placeholder:"请输入数据库（schema）名称",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(c,null,{default:o(()=>[a("div",Ho,[e[71]||(e[71]=a("label",null,"连接地址",-1)),l(P,{modelValue:t.editingDatasource.connectionUrl,"onUpdate:modelValue":e[19]||(e[19]=d=>t.editingDatasource.connectionUrl=d),placeholder:"请输入JDBC地址（若不填则自动生成）",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:20},{default:o(()=>[l(c,{span:12},{default:o(()=>[a("div",Go,[e[72]||(e[72]=a("label",null,"用户名 *",-1)),l(P,{modelValue:t.editingDatasource.username,"onUpdate:modelValue":e[20]||(e[20]=d=>t.editingDatasource.username=d),placeholder:"请输入数据库用户名",size:"large"},null,8,["modelValue"])])]),_:1}),l(c,{span:12},{default:o(()=>[a("div",Wo,[e[73]||(e[73]=a("label",null,"密码 *",-1)),l(P,{modelValue:t.editingDatasource.password,"onUpdate:modelValue":e[21]||(e[21]=d=>t.editingDatasource.password=d),placeholder:"请输入数据库密码",size:"large","show-password":""},null,8,["modelValue"])])]),_:1})]),_:1}),l(_,{gutter:30},{default:o(()=>[l(c,{span:24},{default:o(()=>[a("div",Xo,[e[74]||(e[74]=a("label",null,"描述",-1)),l(P,{modelValue:t.editingDatasource.description,"onUpdate:modelValue":e[22]||(e[22]=d=>t.editingDatasource.description=d),rows:4,type:"textarea",placeholder:"请输入数据源描述（可选）",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),l(m),a("div",Yo,[l(C,{onClick:e[23]||(e[23]=d=>t.editDialogVisible=!1)},{default:o(()=>[...e[75]||(e[75]=[y("取消",-1)])]),_:1}),l(C,{type:"primary",onClick:t.saveEditDatasource},{default:o(()=>[...e[76]||(e[76]=[y("保存修改",-1)])]),_:1},8,["onClick"])])]),_:1},8,["modelValue"]),l(L,{modelValue:t.foreignKeyDialogVisible,"onUpdate:modelValue":e[32]||(e[32]=d=>t.foreignKeyDialogVisible=d),title:"逻辑外键配置",width:"900px","close-on-click-modal":!1},{footer:o(()=>[a("div",ca,[l(C,{onClick:e[31]||(e[31]=d=>t.foreignKeyDialogVisible=!1),size:"large"},{default:o(()=>[...e[87]||(e[87]=[y("取消",-1)])]),_:1}),l(C,{type:"primary",onClick:t.saveForeignKeyConfig,size:"large",loading:t.savingForeignKeys},{default:o(()=>[...e[88]||(e[88]=[y(" 保存全部配置 ",-1)])]),_:1},8,["onClick","loading"])])]),default:o(()=>[t.currentForeignKeyDatasource?(b(),B("div",Zo,[a("div",xo,[a("p",ea,[e[77]||(e[77]=y(" 当前配置数据源： ",-1)),a("span",ta,M(t.currentForeignKeyDatasource.name),1)])]),a("div",la,[e[81]||(e[81]=a("h4",{style:{"font-size":"14px","font-weight":"600",color:"#333","margin-bottom":"15px","border-left":"4px solid #1890ff","padding-left":"10px"}}," 已生效的逻辑外键 (Logical Foreign Keys) ",-1)),l(E,{data:t.foreignKeyList,border:"",style:{width:"100%"},size:"small"},{default:o(()=>[l(A,{prop:"sourceTableName",label:"主表 (Source)","min-width":"100px"},{default:o(d=>[a("span",oa,M(d.row.sourceTableName),1)]),_:1}),l(A,{prop:"sourceColumnName",label:"字段","min-width":"80px"},{default:o(d=>[a("span",aa,M(d.row.sourceColumnName),1)]),_:1}),l(A,{label:"关系类型","min-width":"90px",align:"center"},{default:o(d=>[a("span",na,[l(h,null,{default:o(()=>[l(O)]),_:1})]),a("span",sa,M(d.row.relationType||"-"),1)]),_:1}),l(A,{prop:"targetTableName",label:"关联表 (Target)","min-width":"100px"},{default:o(d=>[a("span",ra,M(d.row.targetTableName),1)]),_:1}),l(A,{prop:"targetColumnName",label:"字段","min-width":"80px"},{default:o(d=>[a("span",ia,M(d.row.targetColumnName),1)]),_:1}),l(A,{prop:"description",label:"描述","min-width":"120px"}),l(A,{label:"操作",width:"140px",align:"right"},{default:o(d=>[l(C,{onClick:Q=>t.editForeignKey(d.row),size:"small",type:"primary",link:""},{default:o(()=>[...e[78]||(e[78]=[y(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(C,{onClick:Q=>t.deleteForeignKey(d.row,d.$index),size:"small",type:"danger",link:""},{default:o(()=>[...e[79]||(e[79]=[y(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),!t.foreignKeyList||t.foreignKeyList.length===0?(b(),B("div",da,[l(h,{style:{"font-size":"32px","margin-bottom":"10px"}},{default:o(()=>[l(D)]),_:1}),e[80]||(e[80]=a("div",null,"暂无逻辑外键配置",-1))])):R("",!0)]),a("div",ua,[a("h4",pa,[l(h,{style:{"margin-right":"6px","vertical-align":"middle",color:"#1890ff"}},{default:o(()=>[t.editingForeignKey?(b(),U(w,{key:1})):(b(),U(I,{key:0}))]),_:1}),a("span",ma,M(t.editingForeignKey?"编辑关联关系":"新增关联关系"),1)]),l(_,{gutter:10},{default:o(()=>[l(c,{span:5},{default:o(()=>[e[82]||(e[82]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}}," 主表 (Left Table) ")],-1)),l(G,{modelValue:t.newForeignKey.sourceTableName,"onUpdate:modelValue":e[25]||(e[25]=d=>t.newForeignKey.sourceTableName=d),placeholder:"请选择表...",style:{width:"100%"},size:"large",onChange:t.handleSourceTableChange,clearable:"",filterable:""},{default:o(()=>[(b(!0),B(X,null,ye(t.tableList,d=>(b(),U(j,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(c,{span:4},{default:o(()=>[e[83]||(e[83]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}},"字段")],-1)),l(G,{modelValue:t.newForeignKey.sourceColumnName,"onUpdate:modelValue":e[26]||(e[26]=d=>t.newForeignKey.sourceColumnName=d),placeholder:"先选表",style:{width:"100%"},size:"large",disabled:!t.newForeignKey.sourceTableName,clearable:"",filterable:""},{default:o(()=>[(b(!0),B(X,null,ye(t.sourceColumnList,d=>(b(),U(j,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(c,{span:1,style:{"text-align":"center","line-height":"70px"}},{default:o(()=>[l(h,{color:"#999",size:20},{default:o(()=>[l(J)]),_:1})]),_:1}),l(c,{span:5},{default:o(()=>[e[84]||(e[84]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}}," 关联表 (Right Table) ")],-1)),l(G,{modelValue:t.newForeignKey.targetTableName,"onUpdate:modelValue":e[27]||(e[27]=d=>t.newForeignKey.targetTableName=d),placeholder:"请选择表...",style:{width:"100%"},size:"large",onChange:t.handleTargetTableChange,clearable:"",filterable:""},{default:o(()=>[(b(!0),B(X,null,ye(t.tableList,d=>(b(),U(j,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(c,{span:4},{default:o(()=>[e[85]||(e[85]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}},"字段")],-1)),l(G,{modelValue:t.newForeignKey.targetColumnName,"onUpdate:modelValue":e[28]||(e[28]=d=>t.newForeignKey.targetColumnName=d),placeholder:"先选表",style:{width:"100%"},size:"large",disabled:!t.newForeignKey.targetTableName,clearable:"",filterable:""},{default:o(()=>[(b(!0),B(X,null,ye(t.targetColumnList,d=>(b(),U(j,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(c,{span:5,style:{"line-height":"70px"}},{default:o(()=>[l(C,{onClick:t.saveOrUpdateForeignKey,type:"primary",size:"large",style:{width:"100%"}},{default:o(()=>[l(h,{style:{"margin-right":"4px"}},{default:o(()=>[l(x)]),_:1}),y(" "+M(t.editingForeignKey?"更新":"添加"),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),l(_,{style:{"margin-top":"10px"}},{default:o(()=>[l(c,{span:24},{default:o(()=>[e[86]||(e[86]=a("div",{style:{"margin-bottom":"5px"}},[a("label",{style:{"font-size":"12px","font-weight":"600",color:"#666"}}," 关系类型 (Relation Type) ")],-1)),l(G,{modelValue:t.newForeignKey.relationType,"onUpdate:modelValue":e[29]||(e[29]=d=>t.newForeignKey.relationType=d),placeholder:"选择关系类型（可选）",size:"large",clearable:"",style:{width:"100%"}},{default:o(()=>[l(j,{label:"1:1 (一对一)",value:"1:1"}),l(j,{label:"1:N (一对多)",value:"1:N"}),l(j,{label:"N:1 (多对一)",value:"N:1"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(_,{style:{"margin-top":"10px"}},{default:o(()=>[l(c,{span:24},{default:o(()=>[l(P,{modelValue:t.newForeignKey.description,"onUpdate:modelValue":e[30]||(e[30]=d=>t.newForeignKey.description=d),placeholder:"描述（可选）：例如 '订单关联用户'，帮助 LLM 理解语义",size:"large",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})])])):R("",!0)]),_:1},8,["modelValue"])],64)}const fa=oe(ho,[["render",ga]]),ae="/api/agent-knowledge";class ya{async queryByPage(e){return(await N.post(`${ae}/query/page`,e)).data}async listByAgentId(e,n,s,f){const v={};return n&&(v.type=n),s&&(v.status=s),f&&(v.keyword=f),(await N.get(`${ae}/agent/${e}`,{params:v})).data.data}async getById(e){var n;try{return(await N.get(`${ae}/${e}`)).data.data}catch(s){if(N.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return null;throw s}}async create(e){return(await N.post(`${ae}/create`,e)).data.data}async update(e,n){var s;try{return(await N.put(`${ae}/${e}`,n)).data.data}catch(f){if(N.isAxiosError(f)&&((s=f.response)==null?void 0:s.status)===404)return null;throw f}}async updateRecallStatus(e,n){try{return(await N.put(`${ae}/recall/${e}`,null,{params:{isRecall:n}})).data.data}catch(s){return console.error("Failed to update recall status:",s),null}}async delete(e){var n;try{return await N.delete(`${ae}/${e}`),!0}catch(s){if(N.isAxiosError(s)&&((n=s.response)==null?void 0:n.status)===404)return!1;throw s}}async retryEmbedding(e){try{return(await N.post(`${ae}/retry-embedding/${e}`)).data.success}catch(n){return console.error("Failed to retry embedding:",n),!1}}async getStatistics(e){return(await N.get(`${ae}/statistics/${e}`)).data.data}}const ke=new ya,va=se({name:"AgentKnowledgeConfig",components:{Search:Ce,Warning:Ne,UploadFilled:Ve},props:{agentId:{type:Number,required:!0}},setup(t){const e=V([]),n=V(0),s=V(!1),f=V(!1),v=V(!1),m=V(!1),c=V(null),C=V([]),_=V(!1),S=it({agentId:t.agentId,title:"",type:"",embeddingStatus:"",pageNum:1,pageSize:10}),g=V({agentId:t.agentId,title:"",content:"",type:"DOCUMENT",isRecall:!0,question:"",answer:""}),q=()=>{_.value=!_.value},h=()=>{S.type="",S.embeddingStatus="",F()},D=async()=>{s.value=!0;try{const I={...S,type:S.type?S.type:"",embeddingStatus:S.embeddingStatus?S.embeddingStatus:""},w=await ke.queryByPage(I);w.success?(e.value=w.data,n.value=w.total):i.error(w.message||"加载知识列表失败")}catch(I){i.error("加载知识列表失败"),console.error("Failed to load knowledge list:",I)}finally{s.value=!1}},F=()=>{S.pageNum=1,D()},A=I=>{S.pageSize=I,D()},T=I=>{S.pageNum=I,D()},z=()=>{v.value=!1,f.value=!0,O()},$=()=>{f.value=!1,O()},E=I=>{v.value=!0,c.value=I.id||null,g.value={...I,type:I.type},(I.type==="QA"||I.type==="FAQ")&&(g.value.answer=I.content),f.value=!0},p=I=>{if(!I.id)return;const w=!I.isRecall,J=w?"召回":"取消召回";Y.confirm(`确定要${J}知识 "${I.title}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ke.updateRecallStatus(I.id,w)?(I.isRecall=w,i.success(`${J}成功`)):i.error(`${J}失败`)}catch(x){i.error(`${J}失败`),console.error(`Failed to ${J} knowledge:`,x)}}).catch(()=>{})},P=async I=>{if(I.id)try{await ke.retryEmbedding(I.id)?(i.success("重试请求已发送"),D()):i.error("重试失败")}catch{i.error("重试失败")}},j=I=>{I.id&&Y.confirm(`确定要删除知识 "${I.title}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ke.delete(I.id)?(i.success("删除成功"),await D()):i.error("删除失败")}catch(w){i.error("删除失败"),console.error("Failed to delete knowledge:",w)}}).catch(()=>{})},G=()=>{g.value.content="",g.value.question="",g.value.answer="",C.value=[]},W=I=>{C.value=[I],g.value.file=I.raw},Z=I=>{if(!I)return"0 B";const w=1024,J=["B","KB","MB","GB"],x=Math.floor(Math.log(I)/Math.log(w));return Math.round(I/Math.pow(w,x)*100)/100+" "+J[x]},L=async()=>{var I;if(!g.value.title||!g.value.title.trim()){i.warning("请输入知识标题");return}if(g.value.type==="DOCUMENT"){if(!v.value&&!g.value.file&&C.value.length===0){i.warning("请上传文件");return}}else if(g.value.type==="QA"||g.value.type==="FAQ"){if(!g.value.question||!g.value.question.trim()){i.warning("请输入问题");return}if(!g.value.answer||!g.value.answer.trim()){i.warning("请输入答案");return}g.value.content=g.value.answer}m.value=!0;try{if(v.value&&c.value){const w={...g.value,type:(I=g.value.type)==null?void 0:I.toUpperCase()};if(await ke.update(c.value,w))i.success("更新成功");else{i.error("更新失败");return}}else{const w=new FormData;w.append("agentId",String(g.value.agentId)),w.append("title",g.value.title),w.append("type",g.value.type||"DOCUMENT"),w.append("isRecall",g.value.isRecall?"1":"0"),g.value.type==="DOCUMENT"&&g.value.file?w.append("file",g.value.file):(g.value.content&&w.append("content",g.value.content),g.value.question&&w.append("question",g.value.question));const J=await N.post("/api/agent-knowledge/create",w,{headers:{"Content-Type":"multipart/form-data"}});if(J.data.success)i.success("创建成功");else{i.error(J.data.message||"创建失败");return}}f.value=!1,await D()}catch(w){i.error(`${v.value?"更新":"创建"}失败`),console.error("Failed to save knowledge:",w)}finally{m.value=!1}},O=()=>{g.value={agentId:t.agentId,title:"",content:"",type:"DOCUMENT",isRecall:!0,question:"",answer:""},c.value=null,C.value=[]};return ve(()=>{D()}),{Plus:_e,Search:Ce,FilterIcon:ut,RefreshLeft:dt,UploadFilled:Ve,Warning:Ne,knowledgeList:e,total:n,loading:s,dialogVisible:f,isEdit:v,saveLoading:m,queryParams:S,knowledgeForm:g,fileList:C,filterVisible:_,toggleFilter:q,clearFilters:h,loadKnowledgeList:D,handleSearch:F,handleSizeChange:A,handleCurrentChange:T,openCreateDialog:z,closeDialog:$,editKnowledge:E,deleteKnowledge:j,saveKnowledge:L,resetForm:O,handleTypeChange:G,handleFileChange:W,toggleStatus:p,handleRetry:P,formatFileSize:Z}}}),ba={style:{padding:"20px"}},wa={style:{"margin-bottom":"30px"}},ha={style:{"margin-bottom":"20px"}},Ca={key:0},ka={key:1},Va={key:2},_a={key:3},Da={style:{display:"flex","align-items":"center"}},$a={key:1},Ta={style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},Sa={key:0,style:{width:"100%"}},Fa={key:0,class:"el-upload__tip",style:{color:"#409eff"}},Aa={key:1},Na={style:{"text-align":"right"}};function Ia(t,e,n,s,f,v){const m=r("el-divider"),c=r("el-col"),C=r("Search"),_=r("el-icon"),S=r("el-input"),g=r("el-button"),q=r("el-row"),h=r("el-option"),D=r("el-select"),F=r("el-form-item"),A=r("el-form"),T=r("el-card"),z=r("el-collapse-transition"),$=r("el-table-column"),E=r("el-tag"),p=r("Warning"),P=r("el-tooltip"),j=r("el-table"),G=r("el-pagination"),W=r("el-alert"),Z=r("UploadFilled"),L=r("el-upload"),O=r("el-dialog"),I=pt("loading");return b(),B(X,null,[a("div",ba,[e[19]||(e[19]=a("div",{style:{"margin-bottom":"20px"}},[a("h2",null,"智能体知识库"),a("p",{style:{color:"#909399","font-size":"14px","margin-top":"5px"}}," 管理用于增强智能体能力的知识源。 ")],-1)),l(m),a("div",wa,[l(q,{style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:o(()=>[l(c,{span:12},{default:o(()=>[...e[10]||(e[10]=[a("h3",null,"知识列表",-1)])]),_:1}),l(c,{span:12,style:{"text-align":"right"}},{default:o(()=>[l(S,{modelValue:t.queryParams.title,"onUpdate:modelValue":e[0]||(e[0]=w=>t.queryParams.title=w),placeholder:"请输入知识标题搜索",style:{width:"400px","margin-right":"10px"},clearable:"",onClear:t.handleSearch,onKeyup:Ie(t.handleSearch,["enter"]),size:"large"},{prefix:o(()=>[l(_,null,{default:o(()=>[l(C)]),_:1})]),_:1},8,["modelValue","onClear","onKeyup"]),l(g,{onClick:t.toggleFilter,size:"large",type:t.filterVisible?"primary":"",round:"",icon:t.FilterIcon},{default:o(()=>[...e[11]||(e[11]=[y(" 筛选 ",-1)])]),_:1},8,["onClick","type","icon"]),l(g,{onClick:t.openCreateDialog,size:"large",type:"primary",round:"",icon:t.Plus},{default:o(()=>[...e[12]||(e[12]=[y(" 添加知识 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1})]),l(z,null,{default:o(()=>[le(a("div",ha,[l(T,{shadow:"never"},{default:o(()=>[l(A,{inline:!0,model:t.queryParams},{default:o(()=>[l(F,{label:"知识类型"},{default:o(()=>[l(D,{modelValue:t.queryParams.type,"onUpdate:modelValue":e[1]||(e[1]=w=>t.queryParams.type=w),placeholder:"全部类型",clearable:"",onChange:t.handleSearch,style:{width:"150px"}},{default:o(()=>[l(h,{label:"文档",value:"DOCUMENT"}),l(h,{label:"问答对",value:"QA"}),l(h,{label:"常见问题",value:"FAQ"})]),_:1},8,["modelValue","onChange"])]),_:1}),l(F,{label:"处理状态"},{default:o(()=>[l(D,{modelValue:t.queryParams.embeddingStatus,"onUpdate:modelValue":e[2]||(e[2]=w=>t.queryParams.embeddingStatus=w),placeholder:"全部状态",clearable:"",onChange:t.handleSearch,style:{width:"150px"}},{default:o(()=>[l(h,{label:"COMPLETED",value:"COMPLETED"}),l(h,{label:"PROCESSING",value:"PROCESSING"}),l(h,{label:"FAILED",value:"FAILED"}),l(h,{label:"PENDING",value:"PENDING"})]),_:1},8,["modelValue","onChange"])]),_:1}),l(F,null,{default:o(()=>[l(g,{onClick:t.clearFilters,icon:t.RefreshLeft},{default:o(()=>[...e[13]||(e[13]=[y("清空筛选",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1},8,["model"])]),_:1})],512),[[mt,t.filterVisible]])]),_:1}),le((b(),U(j,{data:t.knowledgeList,style:{width:"100%"},border:""},{default:o(()=>[l($,{prop:"title",label:"标题","min-width":"150px"}),l($,{prop:"type",label:"类型","min-width":"100px"},{default:o(w=>[w.row.type==="DOCUMENT"?(b(),B("span",Ca,"文档")):w.row.type==="QA"?(b(),B("span",ka,"问答对")):w.row.type==="FAQ"?(b(),B("span",Va,"常见问题")):(b(),B("span",_a,M(w.row.type),1))]),_:1}),l($,{label:"处理状态","min-width":"120px"},{default:o(w=>[w.row.embeddingStatus==="COMPLETED"?(b(),U(E,{key:0,type:"success",round:""},{default:o(()=>[y(M(w.row.embeddingStatus),1)]),_:2},1024)):w.row.embeddingStatus==="PROCESSING"?(b(),U(E,{key:1,type:"primary",round:""},{default:o(()=>[y(M(w.row.embeddingStatus),1)]),_:2},1024)):w.row.embeddingStatus==="FAILED"?(b(),U(E,{key:2,type:"danger",round:""},{default:o(()=>[w.row.errorMsg?(b(),U(P,{key:0,content:w.row.errorMsg,placement:"top"},{default:o(()=>[a("span",Da,[l(_,{style:{"margin-right":"4px"}},{default:o(()=>[l(p)]),_:1}),y(" "+M(w.row.embeddingStatus),1)])]),_:2},1032,["content"])):(b(),B("span",$a,M(w.row.embeddingStatus),1))]),_:2},1024)):(b(),U(E,{key:3,type:"info",round:""},{default:o(()=>[y(M(w.row.embeddingStatus),1)]),_:2},1024))]),_:1}),l($,{label:"召回状态","min-width":"100px"},{default:o(w=>[l(E,{type:w.row.isRecall?"success":"info",round:""},{default:o(()=>[y(M(w.row.isRecall?"已召回":"未召回"),1)]),_:2},1032,["type"])]),_:1}),l($,{label:"操作","min-width":"280px"},{default:o(w=>[l(g,{onClick:J=>t.editKnowledge(w.row),size:"small",type:"primary",round:"",plain:""},{default:o(()=>[...e[14]||(e[14]=[y(" 管理 ",-1)])]),_:1},8,["onClick"]),w.row.embeddingStatus==="FAILED"?(b(),U(g,{key:0,onClick:J=>t.handleRetry(w.row),size:"small",type:"info",round:"",plain:""},{default:o(()=>[...e[15]||(e[15]=[y(" 重试 ",-1)])]),_:1},8,["onClick"])):R("",!0),w.row.isRecall?(b(),U(g,{key:1,onClick:J=>t.toggleStatus(w.row),size:"small",type:"warning",round:"",plain:""},{default:o(()=>[...e[16]||(e[16]=[y(" 取消召回 ",-1)])]),_:1},8,["onClick"])):(b(),U(g,{key:2,onClick:J=>t.toggleStatus(w.row),size:"small",type:"success",round:"",plain:""},{default:o(()=>[...e[17]||(e[17]=[y(" 召回 ",-1)])]),_:1},8,["onClick"])),l(g,{onClick:J=>t.deleteKnowledge(w.row),size:"small",type:"danger",round:"",plain:""},{default:o(()=>[...e[18]||(e[18]=[y(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,t.loading]]),a("div",Ta,[l(G,{"current-page":t.queryParams.pageNum,"onUpdate:currentPage":e[3]||(e[3]=w=>t.queryParams.pageNum=w),"page-size":t.queryParams.pageSize,"onUpdate:pageSize":e[4]||(e[4]=w=>t.queryParams.pageSize=w),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:t.total,onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),l(O,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[9]||(e[9]=w=>t.dialogVisible=w),title:t.isEdit?"编辑知识":"添加新知识",width:"800","close-on-click-modal":!1},{footer:o(()=>[a("div",Na,[l(g,{onClick:t.closeDialog},{default:o(()=>[...e[25]||(e[25]=[y("取消",-1)])]),_:1},8,["onClick"]),l(g,{type:"primary",onClick:t.saveKnowledge,loading:t.saveLoading},{default:o(()=>[y(M(t.isEdit?"更新":"添加并处理"),1)]),_:1},8,["onClick","loading"])])]),default:o(()=>[l(A,{model:t.knowledgeForm,"label-width":"100px",ref:"knowledgeFormRef"},{default:o(()=>[l(F,{label:"知识类型",prop:"type",required:""},{default:o(()=>[l(D,{modelValue:t.knowledgeForm.type,"onUpdate:modelValue":e[5]||(e[5]=w=>t.knowledgeForm.type=w),placeholder:"请选择知识类型",onChange:t.handleTypeChange,disabled:t.isEdit,style:{width:"100%"}},{default:o(()=>[l(h,{label:"文档 (文件上传)",value:"DOCUMENT"}),l(h,{label:"问答对 (Q&A)",value:"QA"}),l(h,{label:"常见问题 (FAQ)",value:"FAQ"})]),_:1},8,["modelValue","onChange","disabled"])]),_:1}),t.knowledgeForm.type==="QA"?(b(),U(F,{key:0},{default:o(()=>[l(W,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"10px"}},{title:o(()=>[...e[20]||(e[20]=[a("div",{style:{"line-height":"1.6"}}," 请录入具体的'分析需求'作为问题,并在答案中写出详细的'思考步骤'与'数据查找逻辑'(而非直接给结果),以此教会 AI 如何拆解任务。 ",-1)])]),_:1})]),_:1})):R("",!0),t.knowledgeForm.type==="FAQ"?(b(),U(F,{key:1},{default:o(()=>[l(W,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"10px"}},{title:o(()=>[...e[21]||(e[21]=[a("div",{style:{"line-height":"1.6"}}," 请针对特定的'业务术语'、'指标口径'或'常见歧义'进行提问和定义(例如:'什么是有效日活'),以此统一 AI 的判断标准。 ",-1)])]),_:1})]),_:1})):R("",!0),t.knowledgeForm.type==="DOCUMENT"?(b(),U(F,{key:2},{default:o(()=>[l(W,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"10px"}},{title:o(()=>[...e[22]||(e[22]=[a("div",{style:{"line-height":"1.6"}}," 请上传完整的'数据库表结构'、'码表映射字典'或'业务背景说明',供 AI 在分析时检索字段含义和数据关系。 ",-1)])]),_:1})]),_:1})):R("",!0),l(F,{label:"知识标题",prop:"title",required:""},{default:o(()=>[l(S,{modelValue:t.knowledgeForm.title,"onUpdate:modelValue":e[6]||(e[6]=w=>t.knowledgeForm.title=w),placeholder:"为这份知识起一个易于识别的名称"},null,8,["modelValue"])]),_:1}),t.knowledgeForm.type==="DOCUMENT"?(b(),U(F,{key:3,label:"上传文件",required:""},{default:o(()=>[t.isEdit?(b(),B("div",Aa,[l(W,{type:"info",closable:!1,"show-icon":"",title:"文档类型知识不支持修改文件内容，如需修改请删除后重新创建"})])):(b(),B("div",Sa,[l(L,{"auto-upload":!1,limit:1,"on-change":t.handleFileChange,"on-remove":()=>t.fileList=[],"file-list":t.fileList,drag:""},{tip:o(()=>[e[23]||(e[23]=a("div",{class:"el-upload__tip"},"支持 PDF, DOCX, TXT, MD 等格式",-1)),t.fileList.length>0?(b(),B("div",Fa," 文件大小: "+M(t.formatFileSize(t.fileList[0].size)),1)):R("",!0)]),default:o(()=>[l(_,{class:"el-icon--upload"},{default:o(()=>[l(Z)]),_:1}),e[24]||(e[24]=a("div",{class:"el-upload__text"},[y(" 拖拽文件到此处或 "),a("em",null,"点击选择文件")],-1))]),_:1},8,["on-change","on-remove","file-list"])]))]),_:1})):R("",!0),t.knowledgeForm.type==="QA"||t.knowledgeForm.type==="FAQ"?(b(),B(X,{key:4},[l(F,{label:"问题",prop:"question",required:""},{default:o(()=>[l(S,{modelValue:t.knowledgeForm.question,"onUpdate:modelValue":e[7]||(e[7]=w=>t.knowledgeForm.question=w),type:"textarea",rows:2,placeholder:"输入用户可能会问的问题..."},null,8,["modelValue"])]),_:1}),l(F,{label:"答案",prop:"answer",required:""},{default:o(()=>[l(S,{modelValue:t.knowledgeForm.answer,"onUpdate:modelValue":e[8]||(e[8]=w=>t.knowledgeForm.answer=w),type:"textarea",rows:5,placeholder:"输入标准答案..."},null,8,["modelValue"])]),_:1})],64)):R("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}const Ea=oe(va,[["render",Ia],["__scopeId","data-v-51c3d2d0"]]),za=se({name:"AgentDetail",components:{BaseLayout:Vt,AgentBaseSetting:Mt,AgentPromptConfig:Fl,BusinessKnowledgeConfig:Kl,AgentSemanticsConfig:Yl,AgentPresetsConfig:oo,AgentAccessApi:yo,AgentDataSourceConfig:fa,AgentKnowledgeConfig:Ea,NotFound:_t,InfoFilled:wt,Coin:bt,ChatLineSquare:vt,User:yt,Suitcase:ft,Setting:gt,VideoPlay:ct,Connection:Me,Document:Pe},setup(){const t=Ke(),e=V("basic"),n=V({id:0,name:"loading...",description:"",status:"draft",createdAt:"",updatedAt:"",avatar:"",prompt:"",category:"",adminId:"",tags:"",humanReviewEnabled:!1}),s=V(null),f=V(!1),v=V(!1),m=V(""),c=()=>{console.error("头像图片加载失败"),(!n.value.avatar||n.value.avatar.startsWith("data:"))&&(n.value.avatar=kt())},C=()=>{s.value&&s.value.click()},_=async h=>{var A;const F=(A=h.target.files)==null?void 0:A[0];if(F){if(!F.type.startsWith("image/")){i.error("请选择图片文件");return}if(F.size>5*1024*1024){i.error("图片大小不能超过5MB");return}try{f.value=!0,m.value=n.value.avatar||"";const T=new FileReader;T.onload=$=>{var E;n.value.avatar=(E=$.target)==null?void 0:E.result},T.readAsDataURL(F);const z=await Dt.uploadAvatar(F);if(z.success)n.value.avatar=z.url,n.value.id&&await ne.update(Number(n.value.id),{...n.value,avatar:z.url}),i.success("头像上传成功");else throw new Error(z.message||"上传失败")}catch(T){i.error("头像上传失败: "+(T instanceof Error?T.message:"未知错误")),n.value.avatar=m.value}finally{f.value=!1,s.value&&(s.value.value="")}}},S=h=>{const D=t.currentRoute.value.params.id;e.value=h,h==="go-run"&&t.push(`/agent/${D}/run`)},g=()=>{t.push("/agents")},q=async()=>{try{const h=Number(t.currentRoute.value.params.id),D=await ne.get(h);if(D)n.value=D;else throw new Error("Agent 不存在")}catch(h){i.error("加载失败"),console.error("加载失败:",h)}};return ve(async()=>{await q()}),{ArrowLeft:ht,agent:n,activeMenuIndex:e,handleMenuSelect:S,goBack:g,headerFileInput:s,headerUploading:f,showHeaderAvatarButton:v,triggerHeaderFileUpload:C,handleHeaderFileUpload:_,getAvatarUrl:Ct,handleImageError:c}}}),Ua={key:0,class:"avatar-overlay-header"};function Ka(t,e,n,s,f,v){const m=r("el-button"),c=r("el-col"),C=r("el-avatar"),_=r("el-row"),S=r("el-divider"),g=r("el-header"),q=r("InfoFilled"),h=r("el-icon"),D=r("el-menu-item"),F=r("el-menu-item-group"),A=r("Coin"),T=r("ChatLineSquare"),z=r("Document"),$=r("User"),E=r("Suitcase"),p=r("Setting"),P=r("VideoPlay"),j=r("Connection"),G=r("el-menu"),W=r("el-aside"),Z=r("AgentBaseSetting"),L=r("AgentDataSourceConfig"),O=r("AgentPromptConfig"),I=r("BusinessKnowledgeConfig"),w=r("AgentSemanticsConfig"),J=r("AgentPresetsConfig"),x=r("AgentAccessApi"),d=r("AgentKnowledgeConfig"),Q=r("NotFound"),Te=r("el-main"),De=r("el-container"),Se=r("BaseLayout");return b(),U(Se,null,{default:o(()=>[l(De,{style:{"margin-top":"20px",gap:"10px"}},{default:o(()=>[l(g,{style:{"background-color":"white","margin-bottom":"20px"}},{default:o(()=>[l(_,{gutter:20,align:"middle"},{default:o(()=>[l(c,{span:1},{default:o(()=>[l(m,{type:"primary",icon:t.ArrowLeft,onClick:t.goBack,circle:"",style:{transform:"scale(1.2)"}},null,8,["icon","onClick"])]),_:1}),l(c,{span:1,style:{"text-align":"left"}},{default:o(()=>[a("div",{class:"avatar-wrapper",onMouseenter:e[0]||(e[0]=be=>t.showHeaderAvatarButton=!0),onMouseleave:e[1]||(e[1]=be=>t.showHeaderAvatarButton=!1)},[l(C,{src:t.getAvatarUrl(t.agent.avatar),size:"large",class:"header-avatar",onError:t.handleImageError},{default:o(()=>[y(M(t.agent.name),1)]),_:1},8,["src","onError"]),t.showHeaderAvatarButton?(b(),B("div",Ua,[l(m,{type:"primary",size:"small",onClick:t.triggerHeaderFileUpload,loading:t.headerUploading},{default:o(()=>[y(M(t.headerUploading?"上传中...":"替换头像"),1)]),_:1},8,["onClick","loading"])])):R("",!0)],32),a("input",{ref:"headerFileInput",type:"file",accept:"image/*",style:{display:"none"},onChange:e[2]||(e[2]=(...be)=>t.handleHeaderFileUpload&&t.handleHeaderFileUpload(...be))},null,544)]),_:1}),l(c,{span:30,style:{"text-align":"left"}},{default:o(()=>[a("h2",null,M(t.agent.name),1)]),_:1})]),_:1}),l(S)]),_:1}),l(De,{style:{gap:"10px"}},{default:o(()=>[l(W,{width:"200px",style:{"background-color":"white"}},{default:o(()=>[l(G,{"default-active":t.activeMenuIndex,class:"el-menu-vertical-demo",onSelect:t.handleMenuSelect},{default:o(()=>[l(F,{title:"基本信息"},{default:o(()=>[l(D,{index:"basic"},{default:o(()=>[l(h,null,{default:o(()=>[l(q)]),_:1}),e[3]||(e[3]=y(" 基本信息 ",-1))]),_:1})]),_:1}),l(F,{title:"数据源配置"},{default:o(()=>[l(D,{index:"datasource"},{default:o(()=>[l(h,null,{default:o(()=>[l(A)]),_:1}),e[4]||(e[4]=y(" 数据源配置 ",-1))]),_:1})]),_:1}),l(F,{title:"PROMPT配置"},{default:o(()=>[l(D,{index:"prompt"},{default:o(()=>[l(h,null,{default:o(()=>[l(T)]),_:1}),e[5]||(e[5]=y(" 自定义 PROMPT 配置 ",-1))]),_:1})]),_:1}),l(F,{title:"知识配置"},{default:o(()=>[l(D,{index:"agent-knowledge"},{default:o(()=>[l(h,null,{default:o(()=>[l(z)]),_:1}),e[6]||(e[6]=y(" 智能体知识配置 ",-1))]),_:1}),l(D,{index:"business-knowledge"},{default:o(()=>[l(h,null,{default:o(()=>[l($)]),_:1}),e[7]||(e[7]=y(" 业务知识配置 ",-1))]),_:1}),l(D,{index:"semantic-model"},{default:o(()=>[l(h,null,{default:o(()=>[l(E)]),_:1}),e[8]||(e[8]=y(" 语义模型配置 ",-1))]),_:1})]),_:1}),l(F,{title:"预设问题管理"},{default:o(()=>[l(D,{index:"preset-questions"},{default:o(()=>[l(h,null,{default:o(()=>[l(p)]),_:1}),e[9]||(e[9]=y(" 预设问题管理 ",-1))]),_:1})]),_:1}),l(F,{title:"运行与发布"},{default:o(()=>[l(D,{index:"go-run"},{default:o(()=>[l(h,null,{default:o(()=>[l(P)]),_:1}),e[10]||(e[10]=y(" 前往运行页面 ",-1))]),_:1}),l(D,{index:"access-api"},{default:o(()=>[l(h,null,{default:o(()=>[l(j)]),_:1}),e[11]||(e[11]=y(" 访问 API ",-1))]),_:1})]),_:1})]),_:1},8,["default-active","onSelect"])]),_:1}),l(Te,{style:{"background-color":"white"}},{default:o(()=>[t.activeMenuIndex==="basic"?(b(),U(Z,{key:0,agent:t.agent},null,8,["agent"])):t.activeMenuIndex==="datasource"?(b(),U(L,{key:1,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="prompt"?(b(),U(O,{key:2,"agent-id":t.agent.id,"agent-prompt":t.agent.prompt},null,8,["agent-id","agent-prompt"])):t.activeMenuIndex==="business-knowledge"?(b(),U(I,{key:3,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="semantic-model"?(b(),U(w,{key:4,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="preset-questions"?(b(),U(J,{key:5,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="access-api"?(b(),U(x,{key:6,"agent-id":t.agent.id},null,8,["agent-id"])):t.activeMenuIndex==="agent-knowledge"?(b(),U(d,{key:7,"agent-id":t.agent.id},null,8,["agent-id"])):(b(),U(Q,{key:8}))]),_:1})]),_:1})]),_:1})]),_:1})}const Ra=oe(za,[["render",Ka],["__scopeId","data-v-4ad03a8f"]]);export{Ra as default};
