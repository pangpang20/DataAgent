import{d as R,o as $,A as P,f as h,B as N,C as D,r as M,p as S,u as W,E as p,_ as j,i as k,w as n,j as d,k as U,l as t,q as o,x as y,n as B,t as I}from"./index-DNCKiXbb.js";import{B as q}from"./BaseLayout-bdnKF8nQ.js";import{a as w,g as T,A as G}from"./avatar-DDGUTKZC.js";import{f as H}from"./fileUpload-BQXCDLCH.js";const J=R({name:"AgentCreate",components:{BaseLayout:q},setup(){const a=W(),e=h(!1),g=h(null),b=h(!1),l=P({name:"",description:"",avatar:"",category:"",tags:"",prompt:"",status:"draft",humanReviewEnabled:!1});return $(()=>{l.avatar||(l.avatar=w())}),{Plus:S,Refresh:M,Upload:D,Loading:N,agentForm:l,loading:e,fileInput:g,uploading:b,goBack:()=>{a.push("/agents")},regenerateAvatar:()=>{l.avatar=w()},triggerFileUpload:()=>{g.value&&g.value.click()},handleFileUpload:async r=>{var V;const i=(V=r.target.files)==null?void 0:V[0];if(!i)return;if(!i.type.startsWith("image/")){p.error("请选择图片文件");return}if(i.size>5*1024*1024){p.error("图片大小不能超过5MB");return}let c="";try{b.value=!0,c=l.avatar;const m=new FileReader;m.onload=s=>{var z;(z=s.target)!=null&&z.result&&(l.avatar=s.target.result)},m.readAsDataURL(i);const _=await H.uploadAvatar(i);if(_.success)l.avatar=_.url,p.success("头像上传成功");else throw new Error(_.message||"上传失败")}catch(m){console.error("头像上传失败:",m),p.error("头像上传失败: "+(m instanceof Error?m.message:"未知错误")),c?l.avatar=c:l.avatar=w()}finally{b.value=!1,g.value&&(g.value.value="")}},handleImageLoad:()=>{console.log("头像图片加载成功")},handleImageError:()=>{console.error("头像图片加载失败"),(!l.avatar||l.avatar.startsWith("data:"))&&(l.avatar=w())},createAgent:async()=>{if(!l.name.trim()||!l.category.trim()||!l.tags.trim()){p.error("请填写必要的字段！");return}try{e.value=!0;const r={name:l.name.trim(),description:l.description.trim(),avatar:l.avatar.trim(),category:l.category.trim(),tags:l.tags.trim(),prompt:l.prompt.trim(),status:l.status,humanReviewEnabled:l.humanReviewEnabled?1:0},u=await G.create(r);p.success(`智能体创建成功！状态：${r.status==="published"?"已发布":"草稿"}`),await a.push(`/agent/${u.id}`)}catch(r){console.error("创建智能体失败:",r),p.error("创建失败，请重试")}finally{e.value=!1}},getAvatarUrl:T}}}),K={class:"agent-create-page"},O={class:"create-form-wrapper"},Q={class:"form-section"},X={class:"section-card"},Y={class:"form-group"},Z={class:"avatar-upload"},x={class:"avatar-preview"},ee=["src"],ae={class:"avatar-controls"},te={class:"avatar-buttons"},oe={class:"form-item"},le={class:"form-item"},se={class:"form-item"},ne={class:"form-item"},re={class:"form-item"},de={class:"form-item"},ie={class:"form-item form-switch"},ue={class:"bottom-actions"},me={class:"action-card"},pe={class:"form-actions"};function ge(a,e,g,b,l,L){const A=d("Refresh"),F=d("el-icon"),v=d("el-button"),C=d("Upload"),E=d("Loading"),f=d("el-input"),r=d("el-col"),u=d("el-row"),i=d("el-option"),c=d("el-select"),V=d("el-switch"),m=d("el-text"),_=d("BaseLayout");return U(),k(_,null,{default:n(()=>[t("div",K,[t("div",O,[t("div",Q,[t("div",X,[e[20]||(e[20]=t("div",{class:"section-header"},[t("h3",null,"创建智能体"),t("p",null,"配置您的专属数据分析智能体，让AI帮助您更好地理解和分析数据")],-1)),t("div",Y,[e[11]||(e[11]=t("label",null,"头像设置",-1)),t("div",Z,[t("div",x,[t("img",{src:a.getAvatarUrl(a.agentForm.avatar),alt:"智能体头像",onLoad:e[0]||(e[0]=(...s)=>a.handleImageLoad&&a.handleImageLoad(...s)),onError:e[1]||(e[1]=(...s)=>a.handleImageError&&a.handleImageError(...s))},null,40,ee)]),t("div",ae,[t("div",te,[o(v,{onClick:a.regenerateAvatar,size:"large"},{default:n(()=>[o(F,null,{default:n(()=>[o(A)]),_:1}),e[10]||(e[10]=y(" 重新生成 ",-1))]),_:1},8,["onClick"]),o(v,{onClick:a.triggerFileUpload,disabled:a.uploading,size:"large"},{default:n(()=>[a.uploading?B("",!0):(U(),k(F,{key:0},{default:n(()=>[o(C)]),_:1})),a.uploading?(U(),k(F,{key:1},{default:n(()=>[o(E)]),_:1})):B("",!0),y(" "+I(a.uploading?"上传中...":"上传图片"),1)]),_:1},8,["onClick","disabled"]),t("input",{ref:"fileInput",type:"file",accept:"image/*",style:{display:"none"},onChange:e[2]||(e[2]=(...s)=>a.handleFileUpload&&a.handleFileUpload(...s))},null,544)])])])]),o(u,{gutter:20},{default:n(()=>[o(r,{span:12},{default:n(()=>[t("div",oe,[e[12]||(e[12]=t("label",null,"智能体名称 *",-1)),o(f,{modelValue:a.agentForm.name,"onUpdate:modelValue":e[3]||(e[3]=s=>a.agentForm.name=s),placeholder:"请输入智能体名称",size:"large"},null,8,["modelValue"])])]),_:1}),o(r,{span:12},{default:n(()=>[t("div",le,[e[13]||(e[13]=t("label",null,"分类 *",-1)),o(f,{modelValue:a.agentForm.category,"onUpdate:modelValue":e[4]||(e[4]=s=>a.agentForm.category=s),placeholder:"请输入智能体分类",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),o(u,{gutter:20},{default:n(()=>[o(r,{span:24},{default:n(()=>[t("div",se,[e[14]||(e[14]=t("label",null,"描述",-1)),o(f,{modelValue:a.agentForm.description,"onUpdate:modelValue":e[5]||(e[5]=s=>a.agentForm.description=s),rows:4,type:"textarea",placeholder:"请输入智能体描述",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),o(u,{gutter:20},{default:n(()=>[o(r,{span:24},{default:n(()=>[t("div",ne,[e[15]||(e[15]=t("label",null,"智能体Prompt",-1)),o(f,{modelValue:a.agentForm.prompt,"onUpdate:modelValue":e[6]||(e[6]=s=>a.agentForm.prompt=s),rows:4,type:"textarea",placeholder:"请输入智能体Prompt",size:"large"},null,8,["modelValue"])])]),_:1})]),_:1}),o(u,{gutter:20},{default:n(()=>[o(r,{span:12},{default:n(()=>[t("div",re,[e[16]||(e[16]=t("label",null,"标签 *",-1)),o(f,{modelValue:a.agentForm.tags,"onUpdate:modelValue":e[7]||(e[7]=s=>a.agentForm.tags=s),placeholder:"多个标签用逗号分隔",size:"large"},null,8,["modelValue"])])]),_:1}),o(r,{span:12},{default:n(()=>[t("div",de,[e[17]||(e[17]=t("label",null,"状态",-1)),o(c,{modelValue:a.agentForm.status,"onUpdate:modelValue":e[8]||(e[8]=s=>a.agentForm.status=s),placeholder:"请选择状态",style:{width:"100%"},size:"large"},{default:n(()=>[o(i,{key:"draft",label:"待发布",value:"draft"}),o(i,{key:"published",label:"已发布",value:"published"}),o(i,{key:"offline",label:"已下线",value:"offline"})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),o(u,{gutter:20},{default:n(()=>[o(r,{span:24},{default:n(()=>[t("div",ie,[o(V,{modelValue:a.agentForm.humanReviewEnabled,"onUpdate:modelValue":e[9]||(e[9]=s=>a.agentForm.humanReviewEnabled=s),size:"large"},null,8,["modelValue"]),e[19]||(e[19]=t("span",null,"启用计划人工复核",-1)),o(m,{class:"mx-1"},{default:n(()=>[...e[18]||(e[18]=[y("（开启后，Planner 计划会在执行前等待人工复核）",-1)])]),_:1})])]),_:1})]),_:1})])]),t("div",ue,[t("div",me,[t("div",pe,[o(v,{onClick:a.goBack,size:"large"},{default:n(()=>[...e[21]||(e[21]=[y("取消",-1)])]),_:1},8,["onClick"]),o(v,{type:"primary",icon:a.Plus,round:"",onClick:a.createAgent,loading:a.loading,size:"large"},{default:n(()=>[y(I(a.loading?"创建中...":"创建智能体"),1)]),_:1},8,["icon","onClick","loading"])])])])])])]),_:1})}const ye=j(J,[["render",ge],["__scopeId","data-v-bc648d4a"]]);export{ye as default};
