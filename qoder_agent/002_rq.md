# 需求文档：分页功能与数据源类型动态获取

## 1. 需求概述

### 1.1 需求背景
在DataAgent前端项目中，存在多个TODO标记的功能点需要实现：
1. 业务知识管理、语义模型管理、智能体列表需要添加分页功能
2. 数据源配置中的数据源类型需要从后端动态获取，而非硬编码

### 1.2 需求目标
- 提升系统性能，避免一次性加载大量数据导致页面卡顿
- 提升用户体验，支持用户快速浏览和查找数据
- 提高系统可维护性，数据源类型由后端统一管理

---

## 2. 功能需求

### 2.1 分页功能

#### 2.1.1 业务知识管理分页
**文件位置**: `data-agent-frontend/src/components/agent/BusinessKnowledgeConfig.vue`

**当前实现**:
```vue
<!-- todo: 添加分页 -->
<div style="padding: 20px">
  <el-table :data="businessKnowledgeList" style="width: 100%" border>
    <!-- 表格列定义 -->
  </el-table>
</div>
```

**需求描述**:
- 在业务知识列表底部添加分页组件
- 支持每页显示数量选择（10/20/50/100条）
- 支持页码跳转
- 显示总记录数和当前页信息
- 分页参数：`pageNum`（页码，从1开始）、`pageSize`（每页数量）

**交互流程**:
1. 用户进入业务知识管理页面，默认加载第1页数据（每页10条）
2. 用户点击页码或切换每页数量时，重新加载数据
3. 搜索功能与分页联动，搜索后重置到第1页

**后端接口要求**:
```
GET /api/business-knowledge/list
参数:
- agentId: 智能体ID
- keyword: 搜索关键词（可选）
- pageNum: 页码（默认1）
- pageSize: 每页数量（默认10）

返回:
{
  "success": true,
  "data": {
    "list": [...],
    "total": 100,
    "pageNum": 1,
    "pageSize": 10
  }
}
```

---

#### 2.1.2 语义模型管理分页
**文件位置**: `data-agent-frontend/src/components/agent/SemanticsConfig.vue`

**当前实现**:
```vue
<!-- todo: 添加分页 -->
<div style="padding: 20px">
  <el-table :data="semanticModelList" style="width: 100%" border>
    <!-- 表格列定义 -->
  </el-table>
</div>
```

**需求描述**:
- 在语义模型列表底部添加分页组件
- 支持每页显示数量选择（10/20/50/100条）
- 支持页码跳转
- 显示总记录数和当前页信息
- 分页参数：`pageNum`（页码，从1开始）、`pageSize`（每页数量）

**交互流程**:
1. 用户进入语义模型管理页面，默认加载第1页数据（每页10条）
2. 用户点击页码或切换每页数量时，重新加载数据
3. 搜索功能与分页联动，搜索后重置到第1页
4. 批量删除后刷新当前页数据

**后端接口要求**:
```
GET /api/semantic-model/list
参数:
- agentId: 智能体ID
- keyword: 搜索关键词（可选）
- pageNum: 页码（默认1）
- pageSize: 每页数量（默认10）

返回:
{
  "success": true,
  "data": {
    "list": [...],
    "total": 100,
    "pageNum": 1,
    "pageSize": 10
  }
}
```

---

#### 2.1.3 智能体列表分页
**文件位置**: `data-agent-frontend/src/views/AgentList.vue`

**当前实现**:
```vue
<!-- todo: 支持分页（需后端支持）-->
<div class="agents-grid" v-if="!loading">
  <el-row :gutter="20">
    <el-col v-for="agent in filteredAgents" :key="agent.id">
      <!-- 智能体卡片 -->
    </el-col>
  </el-row>
</div>
```

**需求描述**:
- 在智能体网格底部添加分页组件
- 支持每页显示数量选择（12/24/48条，适配网格布局）
- 支持页码跳转
- 显示总记录数和当前页信息
- 分页参数：`pageNum`（页码，从1开始）、`pageSize`（每页数量）

**交互流程**:
1. 用户进入智能体列表页面，默认加载第1页数据（每页12条）
2. 用户点击页码或切换每页数量时，重新加载数据
3. 搜索功能与分页联动，搜索后重置到第1页
4. 状态过滤（全部/已发布/草稿/已下线）与分页联动，切换过滤条件后重置到第1页

**后端接口要求**:
```
GET /api/agent/list
参数:
- status: 状态过滤（可选：published/draft/offline）
- keyword: 搜索关键词（可选）
- pageNum: 页码（默认1）
- pageSize: 每页数量（默认12）

返回:
{
  "success": true,
  "data": {
    "list": [...],
    "total": 100,
    "pageNum": 1,
    "pageSize": 12
  }
}
```

---

#### 2.1.4 数据源选择分页
**文件位置**: `data-agent-frontend/src/components/agent/DataSourceConfig.vue`

**当前实现**:
```vue
<!-- todo: 添加分页和查询 -->
<el-tab-pane label="选择已有数据源" name="select">
  <el-table :data="allDatasource" highlight-current-row style="width: 100%">
    <!-- 表格列定义 -->
  </el-table>
</el-tab-pane>
```

**需求描述**:
- 在选择已有数据源的表格底部添加分页组件
- 添加搜索输入框，支持按数据源名称、类型、主机地址搜索
- 支持每页显示数量选择（10/20/50条）
- 分页参数：`pageNum`（页码，从1开始）、`pageSize`（每页数量）

**交互流程**:
1. 用户打开"选择已有数据源"对话框，默认加载第1页数据（每页10条）
2. 用户输入搜索关键词后，按回车或点击搜索按钮，重新加载数据并重置到第1页
3. 用户点击页码或切换每页数量时，重新加载数据

**后端接口要求**:
```
GET /api/datasource/all
参数:
- keyword: 搜索关键词（可选）
- pageNum: 页码（默认1）
- pageSize: 每页数量（默认10）

返回:
{
  "success": true,
  "data": {
    "list": [...],
    "total": 100,
    "pageNum": 1,
    "pageSize": 10
  }
}
```

---

### 2.2 数据源类型动态获取

**文件位置**: `data-agent-frontend/src/components/agent/DataSourceConfig.vue`

**当前实现**:
```vue
<!-- todo: 改为后端动态获取-->
<el-select v-model="newDatasource.type" placeholder="请选择数据源类型">
  <el-option key="mysql" label="MySQL" value="mysql" />
  <el-option key="postgresql" label="PostgreSQL" value="postgresql" />
  <el-option key="sqlserver" label="SQL Server" value="sqlserver" />
  <el-option key="dameng" label="达梦(Dameng)" value="dameng" />
</el-select>
```

**需求描述**:
- 数据源类型选项从后端接口动态获取
- 支持的数据源类型可能随系统版本更新而变化
- 编辑数据源时也使用动态获取的类型列表

**交互流程**:
1. 用户打开"添加数据源"对话框，自动加载可用的数据源类型列表
2. 用户在数据源类型下拉框中选择类型
3. 编辑数据源时，同样使用动态获取的类型列表

**后端接口要求**:
```
GET /api/datasource/types

返回:
{
  "success": true,
  "data": [
    {
      "value": "mysql",
      "label": "MySQL",
      "description": "MySQL数据库"
    },
    {
      "value": "postgresql",
      "label": "PostgreSQL",
      "description": "PostgreSQL数据库"
    },
    {
      "value": "sqlserver",
      "label": "SQL Server",
      "description": "Microsoft SQL Server"
    },
    {
      "value": "dameng",
      "label": "达梦(Dameng)",
      "description": "达梦数据库"
    }
  ]
}
```

---

## 3. 前端实现方案

### 3.1 分页组件封装

```vue
<!-- components/Pagination.vue -->
<template>
  <el-pagination
    v-model:current-page="currentPage"
    v-model:page-size="pageSize"
    :page-sizes="pageSizes"
    :total="total"
    layout="total, sizes, prev, pager, next, jumper"
    @size-change="handleSizeChange"
    @current-change="handleCurrentChange"
  />
</template>

<script setup lang="ts">
import { ref, watch } from 'vue';

const props = defineProps<{
  total: number;
  modelValue?: { pageNum: number; pageSize: number };
  pageSizes?: number[];
}>();

const emit = defineEmits<{
  (e: 'update:modelValue', value: { pageNum: number; pageSize: number }): void;
  (e: 'change', value: { pageNum: number; pageSize: number }): void;
}>();

const currentPage = ref(props.modelValue?.pageNum || 1);
const pageSize = ref(props.modelValue?.pageSize || 10);
const pageSizes = props.pageSizes || [10, 20, 50, 100];

const handleSizeChange = (size: number) => {
  pageSize.value = size;
  currentPage.value = 1;
  emitChange();
};

const handleCurrentChange = (page: number) => {
  currentPage.value = page;
  emitChange();
};

const emitChange = () => {
  const value = { pageNum: currentPage.value, pageSize: pageSize.value };
  emit('update:modelValue', value);
  emit('change', value);
};

watch(
  () => props.modelValue,
  (val) => {
    if (val) {
      currentPage.value = val.pageNum;
      pageSize.value = val.pageSize;
    }
  },
  { deep: true }
);
</script>
```

---

### 3.2 业务知识管理分页实现

```vue
<!-- BusinessKnowledgeConfig.vue -->
<template>
  <div style="padding: 20px">
    <el-table :data="businessKnowledgeList" style="width: 100%" border>
      <!-- 表格列定义 -->
    </el-table>

    <Pagination
      v-model="pagination"
      :total="total"
      :page-sizes="[10, 20, 50, 100]"
      @change="loadBusinessKnowledge"
    />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';

const businessKnowledgeList = ref([]);
const total = ref(0);
const pagination = ref({ pageNum: 1, pageSize: 10 });

const loadBusinessKnowledge = async () => {
  const response = await businessKnowledgeService.list({
    agentId: props.agentId,
    keyword: searchKeyword.value || undefined,
    pageNum: pagination.value.pageNum,
    pageSize: pagination.value.pageSize,
  });
  businessKnowledgeList.value = response.list;
  total.value = response.total;
};

const handleSearch = () => {
  pagination.value.pageNum = 1;
  loadBusinessKnowledge();
};
</script>
```

---

### 3.3 数据源类型动态获取实现

```vue
<!-- DataSourceConfig.vue -->
<template>
  <el-select v-model="newDatasource.type" placeholder="请选择数据源类型">
    <el-option
      v-for="type in datasourceTypes"
      :key="type.value"
      :label="type.label"
      :value="type.value"
    />
  </el-select>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';

const datasourceTypes = ref([]);

const loadDatasourceTypes = async () => {
  const response = await datasourceService.getDatasourceTypes();
  datasourceTypes.value = response;
};

onMounted(() => {
  loadDatasourceTypes();
});
</script>
```

---

## 4. 后端实现方案

### 4.1 分页响应DTO

```java
@Data
public class PageResult<T> {
    private List<T> list;
    private Long total;
    private Integer pageNum;
    private Integer pageSize;
}
```

---

### 4.2 业务知识分页接口

```java
@GetMapping("/list")
public ApiResponse<PageResult<BusinessKnowledgeVO>> list(
    @RequestParam Integer agentId,
    @RequestParam(required = false) String keyword,
    @RequestParam(defaultValue = "1") Integer pageNum,
    @RequestParam(defaultValue = "10") Integer pageSize
) {
    PageResult<BusinessKnowledgeVO> result = businessKnowledgeService.list(
        agentId, keyword, pageNum, pageSize
    );
    return ApiResponse.success(result);
}
```

---

### 4.3 数据源类型接口

```java
@GetMapping("/types")
public ApiResponse<List<DatasourceTypeVO>> getTypes() {
    List<DatasourceTypeVO> types = datasourceService.getSupportedTypes();
    return ApiResponse.success(types);
}

@Data
public class DatasourceTypeVO {
    private String value;
    private String label;
    private String description;
}
```

---

## 5. 测试用例

### 5.1 分页功能测试

| 测试场景 | 测试步骤 | 预期结果 |
|---------|---------|---------|
| 默认加载 | 进入业务知识管理页面 | 显示第1页数据，每页10条 |
| 切换页码 | 点击第2页 | 显示第2页数据 |
| 切换每页数量 | 选择每页20条 | 每页显示20条数据 |
| 搜索分页 | 输入关键词搜索 | 搜索结果分页显示，重置到第1页 |
| 边界测试 | 最后一页删除数据 | 自动跳转到前一页 |

---

### 5.2 数据源类型动态获取测试

| 测试场景 | 测试步骤 | 预期结果 |
|---------|---------|---------|
| 默认加载 | 打开添加数据源对话框 | 数据源类型下拉框显示所有支持的类型 |
| 类型选择 | 选择MySQL | 选中MySQL类型 |
| 后端更新 | 后端新增数据源类型 | 前端自动显示新类型 |

---

## 6. 非功能性需求

### 6.1 性能要求
- 分页加载时间 < 500ms
- 数据源类型加载时间 < 200ms

### 6.2 兼容性要求
- 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- 响应式设计，适配不同屏幕尺寸

### 6.3 可维护性要求
- 分页组件可复用
- 接口参数统一规范

---

## 7. 验收标准

- [ ] 业务知识管理支持分页，默认每页10条
- [ ] 语义模型管理支持分页，默认每页10条
- [ ] 智能体列表支持分页，默认每页12条
- [ ] 数据源选择支持分页和搜索，默认每页10条
- [ ] 数据源类型从后端动态获取
- [ ] 搜索功能与分页联动
- [ ] 过滤功能与分页联动
- [ ] 分页组件样式统一
- [ ] 接口响应时间符合性能要求
- [ ] 通过所有测试用例

---

## 8. 附录

### 8.1 相关文件清单

| 文件路径 | 修改类型 | 说明 |
|---------|---------|------|
| `src/components/agent/BusinessKnowledgeConfig.vue` | 修改 | 添加分页功能 |
| `src/components/agent/SemanticsConfig.vue` | 修改 | 添加分页功能 |
| `src/views/AgentList.vue` | 修改 | 添加分页功能 |
| `src/components/agent/DataSourceConfig.vue` | 修改 | 添加分页和数据源类型动态获取 |
| `src/services/businessKnowledge.ts` | 修改 | 添加分页参数 |
| `src/services/semanticModel.ts` | 修改 | 添加分页参数 |
| `src/services/agent.ts` | 修改 | 添加分页参数 |
| `src/services/datasource.ts` | 修改 | 添加分页参数和类型接口 |
| `src/components/Pagination.vue` | 新增 | 分页组件 |

---

### 8.2 接口变更汇总

| 接口路径 | 变更类型 | 变更说明 |
|---------|---------|---------|
| GET /api/business-knowledge/list | 修改 | 添加pageNum、pageSize参数，返回分页数据 |
| GET /api/semantic-model/list | 修改 | 添加pageNum、pageSize参数，返回分页数据 |
| GET /api/agent/list | 修改 | 添加pageNum、pageSize参数，返回分页数据 |
| GET /api/datasource/all | 修改 | 添加pageNum、pageSize、keyword参数，返回分页数据 |
| GET /api/datasource/types | 新增 | 返回支持的数据源类型列表 |

---

**文档版本**: v1.0
**创建日期**: 2025-02-03
**最后更新**: 2025-02-03
